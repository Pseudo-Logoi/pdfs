
    <!DOCTYPE html>
    <html lang="en">
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>PCI_Express_System_Architecture_部分1</title>
        <style>
            * {
              padding: 0;
              margin: 0;
              box-sizing: border-box;
            }
             html {
              line-height: 1.15; /* 1 */
              -webkit-text-size-adjust: 100%; /* 2 */
            }
            body {
              padding: 20px;
              margin: 0;
            }
            main {
              display: block;
            }
            h1 {
              font-size: 2em;
              margin: 0.67em 0;
            }
            hr {
              box-sizing: content-box; /* 1 */
              height: 0; /* 1 */
              overflow: visible; /* 2 */
            }
            pre {
              font-family: monospace, monospace; /* 1 */
              font-size: 1em; /* 2 */
            }
            a {
              background-color: transparent;
            }
            abbr[title] {
              border-bottom: none; /* 1 */
              text-decoration: underline; /* 2 */
              text-decoration: underline dotted; /* 2 */
            }
            b,
            strong {
              font-weight: bolder;
            }
            code,
            kbd,
            samp {
              font-family: monospace, monospace; /* 1 */
              font-size: 1em; /* 2 */
            }
            small {
              font-size: 80%;
            }
            sub,
            sup {
              font-size: 75%;
              line-height: 0;
              position: relative;
              vertical-align: baseline;
            }
            sub {
              bottom: -0.25em;
            }
            sup {
              top: -0.5em;
            }
            img {
              border-style: none;
            }
            button,
            input,
            optgroup,
            select,
            textarea {
              font-family: inherit; /* 1 */
              font-size: 100%; /* 1 */
              line-height: 1.15; /* 1 */
              margin: 0; /* 2 */
            }
            button,
            input { /* 1 */
              overflow: visible;
            }
            button,
            select { /* 1 */
              text-transform: none;
            }
            button,
            [type="button"],
            [type="reset"],
            [type="submit"] {
              -webkit-appearance: button;
            }
            button::-moz-focus-inner,
            [type="button"]::-moz-focus-inner,
            [type="reset"]::-moz-focus-inner,
            [type="submit"]::-moz-focus-inner {
              border-style: none;
              padding: 0;
            }
            button:-moz-focusring,
            [type="button"]:-moz-focusring,
            [type="reset"]:-moz-focusring,
            [type="submit"]:-moz-focusring {
              outline: 1px dotted ButtonText;
            }
            fieldset {
              padding: 0.35em 0.75em 0.625em;
            }
            legend {
              box-sizing: border-box; /* 1 */
              color: inherit; /* 2 */
              display: table; /* 1 */
              max-width: 100%; /* 1 */
              padding: 0; /* 3 */
              white-space: normal; /* 1 */
            }
            progress {
              vertical-align: baseline;
            }
            textarea {
              overflow: auto;
            }
            [type="checkbox"],
            [type="radio"] {
              box-sizing: border-box; /* 1 */
              padding: 0; /* 2 */
            }
            [type="number"]::-webkit-inner-spin-button,
            [type="number"]::-webkit-outer-spin-button {
              height: auto;
            }
            [type="search"] {
              -webkit-appearance: textfield; /* 1 */
              outline-offset: -2px; /* 2 */
            }
            [type="search"]::-webkit-search-decoration {
              -webkit-appearance: none;
            }
            ::-webkit-file-upload-button {
              -webkit-appearance: button; /* 1 */
              font: inherit; /* 2 */
            }
            details {
              display: block;
            }
            summary {
              display: list-item;
            }
            [hidden] {
              display: none;
            }
             table {
                border-collapse: collapse;
                width: 100%;
                margin-top: 20px;
                margin-bottom: 20px;
              }
              table thead {
                background-color: #e5e5e5;
              }
              table td {
                padding: 8px;
                /*background-color: #e5e5e5;*/
                border: 1px solid #ccc; /* 可选，添加边框样式 */
              }
              table th {
                padding: 8px;
                /*background-color: #e5e5e5;*/
                border: 1px solid #ccc; /* 可选，添加边框样式 */
              }
              h1, h2, h3, h4, h5, h6 {
                margin-bottom: 20px;
              }
              p {
                margin-top: 20px;
                text-indent: 2em;
                margin-bottom: 20px;
              }
        </style>
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      </head>
      <body>
        <div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="1" id="mark-396251f9-f3f3-43e0-9c0c-937aff6152e3" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h1><div><div>PCI EXPRESS  System  ARCHITECTURE</div></div></h1><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_1.jpg?x=40&amp;y=939&amp;w=760&amp;h=759"></div></div><div><div><div></div></div></div><div><div><div>MINDSHARE</div></div></div><div><div><div></div></div></div><div><div><div>Ravi Budruk</div></div></div><div><div><div></div></div></div><div><div><div>Don Anderson</div></div></div><div><div><div></div></div></div><div><div><div>Tom Shanley</div></div></div><div><div><div></div></div></div><div><div><div>Edited by Joe Winkles</div></div></div><div><div><div></div></div></div><div><div><div>PC SYSTEM</div></div></div><div><div><div></div></div></div><div><div><div>ARCHITECTURE</div></div></div><div><div><div></div></div></div><div><div><div>SMAIMS world-class technical training</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="2" id="mark-3a73f88f-fd02-45c6-ac31-484bd8714f6d" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Are your company's technical training needs being addressed in the most effective manner?</div></div></h2><div><div><div></div></div></div><div><div><div>MindShare has over 25 years experience in conducting technical training on cutting-edge technologies. We understand the challenges companies have when searching for quality, effective training which reduces the students’ time away from work and provides cost-effective alternatives. MindShare offers many flexible solutions to meet those needs. Our courses are taught by highly-skilled, enthusiastic, knowledgeable and experienced instructors. We bring life to knowledge through a wide variety of learning methods and delivery options.</div></div></div><div><div><div></div></div></div><h2><div><div>training that fits your needs</div></div></h2><div><div><div></div></div></div><h2><div><div>MindShare recognizes and addresses your company's technical training issues with:</div></div></h2><div><div><div></div></div></div><div><ul><li>Scalable cost training - Customizable training options</li></ul></div><div><div><div></div></div></div><div><ul><li>Just-in-time training - Overview and advanced topic courses</li></ul></div><div><div><div></div></div></div><div><ul><li>Training in a classroom, at your cubicle or home office</li></ul></div><div><div><div></div></div></div><div><ul><li>Reducing time away from work</li></ul></div><div><div><div></div></div></div><div><ul><li>Training delivered effectively globally</li></ul></div><div><div><div></div></div></div><div><ul><li>Concurrently delivered multiple-site training</li></ul></div><div><div><div></div></div></div><div><div><div>MindShare training courses expand your technical skillset</div></div></div><div><div><div></div></div></div><div><div><div>a PCI Express 2.0®</div></div></div><div><div><div></div></div></div><div><ul><li>Intel Core 2 Processor Architecture</li></ul></div><div><div><div></div></div></div><div><div><div>5 AMD Opteron Processor Architecture</div></div></div><div><div><div></div></div></div><div><div><div>= Intel 64 and IA-32 Software Architecture</div></div></div><div><div><div></div></div></div><div><ul><li>Intel PC and Chipset Architecture</li></ul></div><div><div><div></div></div></div><div><div><div>a PC Virtualization</div></div></div><div><div><div></div></div></div><div><div><div>ausb 2.0</div></div></div><div><div><div></div></div></div><div><div><div>a Wireless USB</div></div></div><div><div><div></div></div></div><div><div><div>FRATALATA</div></div></div><div><div><div></div></div></div><div><div><div>5 Serial Attached SCSI (SAS)</div></div></div><div><div><div></div></div></div><div><div><div>= DDR2/DDR3 DRAM Technology</div></div></div><div><div><div></div></div></div><div><div><div>PCIBIOS Firmware</div></div></div><div><div><div></div></div></div><div><ul><li>High-Speed Design</li></ul></div><div><div><div></div></div></div><div><div><div>= Windows Internals and Drivers</div></div></div><div><div><div></div></div></div><div><div><div>a Linux Fundamentals</div></div></div><div><div><div></div></div></div><div><div><div>... and many more.</div></div></div><div><div><div></div></div></div><div><div><div>All courses can be customized to meet your</div></div></div><div><div><div></div></div></div><div><div><div>group's needs. Detailed course outlines can</div></div></div><div><div><div></div></div></div><div><div><div>be found at www.mindshare.com bringing life to knowledge. real-world tech training put into practice worldwide MindShare Learning Options</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="3" id="mark-fc568618-1f45-481e-a659-10048bb14727" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_3.jpg?x=14&amp;y=219&amp;w=1402&amp;h=1186"></div></div><div><div><div></div></div></div><h2><div><div>Engage MindShare</div></div></h2><div><div><div></div></div></div><div><div><div>Have knowledge that you want to bring to life? MindShare will work with you to “Bring Your Knowledge to Life.” Engage us to transform your knowledge and design courses that can be delivered in classroom or virtual classroom settings, create online eLearning modules, or publish a book that you author.</div></div></div><div><div><div></div></div></div><h2><div><div>We are proud to be the preferred training provider at an extensive list of clients that include:</div></div></h2><div><div><div></div></div></div><div><div><div>ADAPTEC • AMD • AGILENT TECHNOLOGIES • APPLE • BROADCOM • CADENCE • CRAY • CISCO • DELL • FREESCALE GENERAL DYNAMICS • HP • IBM • KODAK • LSI LOGIC • MOTOROLA • MICROSOFT • NASA • NATIONAL SEMICONDUCTOR NETAPP - NOKIA - NVIDIA - PLX TECHNOLOGY - QLOGIC - SIEMENS - SUN MICROSYSTEMS SYNOPSYS - TI - UNISYS</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"></div><div data-page="4" id="mark-70e2768c-b1d9-4c4d-87cc-38db226640fe" class="markdown-parser-view mb-5 relative cursor-pointer bg-theme-brand bg-opacity-10                border-dashed border-theme-brand border-2                border-opacity-70 rounded-md"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>PCI Express</div></div></div><div><div><div></div></div></div><div><div><div>System Architecture</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="5" id="mark-7c3ee743-7161-4a1d-96f1-499b43dcde94" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>The PC System Architecture Series</div></div></h2><div><div><div></div></div></div><hr><div><div><div></div></div></div><div><!-- Code --></div><div><div><div></div></div></div><div><div><div>MindShare, Inc.</div></div></div><div><div><div></div></div></div><div><div><div>Please see our web site at www.awprofessional.com/series/ for more information on these titles.</div></div></div><div><div><div></div></div></div><div><div><div>AGP System Architecture: Second Edition</div></div></div><div><div><div></div></div></div><div><div><div>0-201-70069-7</div></div></div><div><div><div></div></div></div><div><div><div>CardBus System Architecture</div></div></div><div><div><div></div></div></div><div><div><div>0-201-40997-6</div></div></div><div><div><div></div></div></div><div><div><div>FireWire <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="0" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-cAE TEX-A"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="15" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-cAE TEX-A"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="30" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-cAE TEX-A"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="45" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-cAE TEX-A"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="60" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-cAE TEX-A"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="75" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-cAE TEX-A"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mrow data-mjx-texclass="ORD"></mrow><mrow data-mjx-texclass="ORD"><mi>®</mi></mrow></msup></math></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container> System Architecture: Second Edition</div></div></div><div><div><div></div></div></div><div><div><div>0-201-48535-4</div></div></div><div><div><div></div></div></div><div><div><div>HyperTransport <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="1" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c4D"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="16" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c4D"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="31" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c4D"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="46" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c4D"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="61" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c4D"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="76" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c4D"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mrow data-mjx-texclass="ORD"></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">TM</mi></mrow></mrow></mrow></msup></math></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container> System Architecture</div></div></div><div><div><div></div></div></div><div><div><div>0-321-16845-3</div></div></div><div><div><div></div></div></div><div><div><div>InfiniBand System Architecture</div></div></div><div><div><div></div></div></div><div><div><div>0-321-11765-4</div></div></div><div><div><div></div></div></div><div><div><div>ISA System Architecture: Third Edition</div></div></div><div><div><div></div></div></div><div><div><div>0-201-40996-8</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express System Architecture</div></div></div><div><div><div></div></div></div><div><div><div>0-321-15630-7</div></div></div><div><div><div></div></div></div><div><div><div>PCI System Architecture: Fourth Edition</div></div></div><div><div><div></div></div></div><div><div><div>0-201-30974-2</div></div></div><div><div><div></div></div></div><div><div><div>PCI-X System Architecture</div></div></div><div><div><div></div></div></div><div><div><div>0-201-72682-3</div></div></div><div><div><div></div></div></div><div><div><div>PCMCIA System Architecture: Second Edition</div></div></div><div><div><div></div></div></div><div><div><div>0-201-40991-7</div></div></div><div><div><div></div></div></div><div><div><div>Pentium® Pro and Pentium® II System Architecture: Second Edition</div></div></div><div><div><div></div></div></div><div><div><div>0-201-30973-4</div></div></div><div><div><div></div></div></div><div><div><div>Pentium® Processor System Architecture: Second Edition</div></div></div><div><div><div></div></div></div><div><div><div>0-201-40992-5</div></div></div><div><div><div></div></div></div><div><div><div>Plug and Play System Architecture</div></div></div><div><div><div></div></div></div><div><div><div>0-201-41013-3</div></div></div><div><div><div></div></div></div><div><div><div>Protected Mode Software Architecture</div></div></div><div><div><div></div></div></div><div><div><div>0-201-55447-X</div></div></div><div><div><div></div></div></div><div><div><div>The Unabridged Pentium 4</div></div></div><div><div><div></div></div></div><div><div><div>0-321-24656-X</div></div></div><div><div><div></div></div></div><div><div><div>Universal Serial Bus System Architecture: Second Edition</div></div></div><div><div><div></div></div></div><div><div><div>0-201-30975-0</div></div></div><div><div><div></div></div></div><div><!-- Code --></div><div><div><div></div></div></div><hr><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="6" id="mark-532202dd-064f-4c6b-b0ed-64d910ea8891" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h1><div><div>PCI Express  System  Architecture</div></div></h1><div><div><div></div></div></div><div><div><div>MindShare, Inc. Ravi Budruk Don Anderson Tom Shanley</div></div></div><div><div><div></div></div></div><div><div><div>Technical Edit by Joe Winkles</div></div></div><div><div><div></div></div></div><div><div><div>ADDISON-WESLEY DEVELOPER'S PRESS</div></div></div><div><div><div></div></div></div><div><div><div>Boston <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="2" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="17" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="32" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="47" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="62" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="77" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∙</mo></math></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container> San Francisco <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="3" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="18" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="33" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="48" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="63" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="78" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∙</mo></math></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container> New York <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="4" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="19" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="34" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="49" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="64" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="79" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∙</mo></math></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container> Toronto</div></div></div><div><div><div></div></div></div><div><div><div>Montreal <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="5" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="20" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="35" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="50" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="65" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="80" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∙</mo></math></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container> London <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="6" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="21" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="36" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="51" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="66" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="81" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∙</mo></math></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container> Munich <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="7" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="22" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="37" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="52" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="67" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="82" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∙</mo></math></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container> Paris <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="8" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="23" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="38" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="53" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="68" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="83" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∙</mo></math></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container> Madrid <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="9" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="24" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="39" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="54" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="69" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="84" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∙</mo></math></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container> Sydney</div></div></div><div><div><div></div></div></div><div><div><div>Cape Town <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="10" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="25" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="40" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="55" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="70" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="85" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∙</mo></math></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container> Tokyo <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="11" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="26" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="41" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="56" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="71" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="86" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∙</mo></math></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container> Singapore <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="12" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="27" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="42" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="57" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="72" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="87" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2219"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>∙</mo></math></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container> Mexico City</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="7" id="mark-0f5ca7b9-15c4-41b6-8c0c-e39819cc93dd" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Many of the designations used by manufacturers and sellers to distinguish their products are claimed as trademarks. Where those designators appear in this book, and Addison-Wesley was aware of the trademark claim, the designations have been printed in initial capital letters or all capital letters.</div></div></div><div><div><div></div></div></div><div><div><div>The authors and publishers have taken care in preparation of this book, but make no expressed or implied warranty of any kind and assume no responsibility for errors or omissions. No liability is assumed for incidental or consequential damages in connection with or arising out of the use of the information or programs contained herein.</div></div></div><div><div><div></div></div></div><div><div><div>Library of Congress Cataloging-in-Publication Data ISBN: 0-321-15630-7</div></div></div><div><div><div></div></div></div><div><div><div>Copyright ©2003 by MindShare, Inc.</div></div></div><div><div><div></div></div></div><div><div><div>All rights reserved. No part of this publication may be reproduced, stored in a retrieval system, or transmitted, in any form or by any means, electronic, mechanical, photocopying, recording, or otherwise, without the prior written permission of the publisher. Printed in the United States of America. Published simultaneously in Canada.</div></div></div><div><div><div></div></div></div><div><div><div>Sponsoring Editor:</div></div></div><div><div><div></div></div></div><div><div><div>Project Manager:</div></div></div><div><div><div></div></div></div><div><div><div>Cover Design:</div></div></div><div><div><div></div></div></div><div><div><div>Set in 10 point Palatino by MindShare, Inc.</div></div></div><div><div><div></div></div></div><div><div><div>123456789-MA-999897</div></div></div><div><div><div></div></div></div><div><div><div>9th Printing, April, 2008</div></div></div><div><div><div></div></div></div><div><div><div>Addison-Wesley books available for bulk purchases by corporations, institutions, and other organizations. For more information please contact the Corporate, Government, and Special Sales Department at (800) 238-9682.</div></div></div><div><div><div></div></div></div><div><div><div>Find A-W Developer's Press on the World-Wide Web at:</div></div></div><div><div><div></div></div></div><div><div><div>http://www.awl.com/devpress/</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="8" id="mark-00b79c01-a59e-40bd-9e52-140526d85bac" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>To my parents Aruna and Shripal Budruk who started me on the path to Knowledge</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="9" id="mark-0138d824-8480-4c38-9208-a277ed097d09" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>The MindShare Architecture Series ..1</div></div></div><div><div><div></div></div></div><div><div><div>Cautionary Note . .. 2</div></div></div><div><div><div></div></div></div><div><div><div>Intended Audience ..2</div></div></div><div><div><div></div></div></div><div><div><div>Prerequisite Knowledge . .. 3</div></div></div><div><div><div></div></div></div><div><div><div>Topics and Organization . . 3</div></div></div><div><div><div></div></div></div><div><div><div>Documentation Conventions. ..4</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="13" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c4D"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="28" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c4D"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="43" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c4D"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="58" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c4D"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="73" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c4D"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="88" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c4D"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mrow data-mjx-texclass="ORD"></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">TM</mi></mrow></mrow></mrow></msup></math></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container> . ..4</div></div></div><div><div><div></div></div></div><div><div><div>Hexadecimal Notation ..4</div></div></div><div><div><div></div></div></div><div><div><div>Binary Notation. ..4</div></div></div><div><div><div></div></div></div><div><div><div>Decimal Notation. ..4</div></div></div><div><div><div></div></div></div><div><div><div>Bits Versus Bytes Notation ..5</div></div></div><div><div><div></div></div></div><div><div><div>Bit Fields. ..5</div></div></div><div><div><div></div></div></div><div><div><div>Active Signal States. ..5</div></div></div><div><div><div></div></div></div><div><div><div>Visit Our Web Site. . . 5</div></div></div><div><div><div></div></div></div><div><div><div>We Want Your Feedback. .. 6</div></div></div><div><div><div></div></div></div><h2><div><div>Part One: The Big Picture</div></div></h2><div><div><div></div></div></div><h2><div><div>Chapter 1: Architectural Perspective</div></div></h2><div><div><div></div></div></div><div><div><div>Introduction To PCI Express. ...9</div></div></div><div><div><div></div></div></div><div><div><div>The Role of the Original PCI Solution.. .10</div></div></div><div><div><div></div></div></div><div><div><div>Don't Throw Away What is Good! Keep It .10</div></div></div><div><div><div></div></div></div><div><div><div>Make Improvements for the Future.. ..10</div></div></div><div><div><div></div></div></div><div><div><div>Looking into the Future .. 11</div></div></div><div><div><div></div></div></div><div><div><div>Predecessor Buses Compared . .. 11</div></div></div><div><div><div></div></div></div><div><div><div>Author's Disclaimer.. ..12</div></div></div><div><div><div></div></div></div><div><div><div>Bus Performances and Number of Slots Compared . . 12</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express Aggregate Throughput . .13</div></div></div><div><div><div></div></div></div><div><div><div>Performance Per Pin Compared . 1.14</div></div></div><div><div><div></div></div></div><div><div><div>I/O Bus Architecture Perspective . ..16</div></div></div><div><div><div></div></div></div><div><div><div>33 MHz PCI Bus Based System .16</div></div></div><div><div><div></div></div></div><div><div><div>Electrical Load Limit of a 33 MHz PCI Bus. .17</div></div></div><div><div><div></div></div></div><div><div><div>PCI Transaction Model - Programmed IO. .. 19</div></div></div><div><div><div></div></div></div><div><div><div>PCI Transaction Model - Peer-to-Peer. .22</div></div></div><div><div><div></div></div></div><div><div><div>PCI Bus Arbitration. . . 22</div></div></div><div><div><div></div></div></div><div><div><div>PCI Delayed Transaction Protocol ..23</div></div></div><div><div><div></div></div></div><div><div><div>PCI Retry Protocol: . .23</div></div></div><div><div><div></div></div></div><div><div><div>PCI Disconnect Protocol: . . 24</div></div></div><div><div><div></div></div></div><div><div><div>PCI Interrupt Handling.. ..25</div></div></div><div><div><div></div></div></div><h2><div><div>About This Book</div></div></h2><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="10" id="mark-dfbf6dda-1ca2-4f76-accc-954f375304a0" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>PCI Error Handling . . . 26</div></div></div><div><div><div></div></div></div><div><div><div>PCI Address Space Map . ..27</div></div></div><div><div><div></div></div></div><div><div><div>PCI Configuration Cycle Generation. ..29</div></div></div><div><div><div></div></div></div><div><div><div>PCI Function Configuration Register Space .30</div></div></div><div><div><div></div></div></div><div><div><div>PCI Programming Model . .31</div></div></div><div><div><div></div></div></div><div><div><div>Limitations of a 33 MHz PCI System. ..31</div></div></div><div><div><div></div></div></div><div><div><div>Latest Generation of Intel PCI Chipsets .32</div></div></div><div><div><div></div></div></div><div><div><div>66 MHz PCI Bus Based System. .33</div></div></div><div><div><div></div></div></div><div><div><div>Limitations of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="14" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="29" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="44" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="59" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="74" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="89" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>66</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MHz</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container></mjx-assistive-mml></mjx-container> PCI bus . .34</div></div></div><div><div><div></div></div></div><div><div><div>Limitations of PCI Architecture. 3.34</div></div></div><div><div><div></div></div></div><div><div><div>66 MHz and 133 MHz PCI-X 1.0 Bus Based Platforms. .35</div></div></div><div><div><div></div></div></div><div><div><div>PCI-X Features.. . 36</div></div></div><div><div><div></div></div></div><div><div><div>PCI-X Requester/Completer Split Transaction Model . . . 37</div></div></div><div><div><div></div></div></div><div><div><div>DDR and QDR PCI-X 2.0 Bus Based Platforms . . 39</div></div></div><div><div><div></div></div></div><div><div><div>The PCI Express Way . ..41</div></div></div><div><div><div></div></div></div><div><div><div>The Link - A Point-to-Point Interconnect .41</div></div></div><div><div><div></div></div></div><div><div><div>Differential Signaling . 4.41</div></div></div><div><div><div></div></div></div><div><div><div>Switches Used to Interconnect Multiple Devices. . .42</div></div></div><div><div><div></div></div></div><div><div><div>Packet Based Protocol . . .42</div></div></div><div><div><div></div></div></div><div><div><div>Bandwidth and Clocking. .43</div></div></div><div><div><div></div></div></div><div><div><div>Address Space . ..43</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express Transactions . .43</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express Transaction Model. .43</div></div></div><div><div><div></div></div></div><div><div><div>Error Handling and Robustness of Data Transfer .44</div></div></div><div><div><div></div></div></div><div><div><div>Quality of Service (QoS), Traffic Classes (TCs) and Virtual Channels (VCs) . .44</div></div></div><div><div><div></div></div></div><div><div><div>Flow Control.. .45</div></div></div><div><div><div></div></div></div><div><div><div>MSI Style Interrupt Handling Similar to PCI-X . .45</div></div></div><div><div><div></div></div></div><div><div><div>Power Management.: ..45</div></div></div><div><div><div></div></div></div><div><div><div>Hot Plug Support.. . 46</div></div></div><div><div><div></div></div></div><div><div><div>PCI Compatible Software Model.. . .46</div></div></div><div><div><div></div></div></div><div><div><div>Mechanical Form Factors. ..47</div></div></div><div><div><div></div></div></div><div><div><div>PCI-like Peripheral Card and Connector . .47</div></div></div><div><div><div></div></div></div><div><div><div>Mini PCI Express Form Factor. ..47</div></div></div><div><div><div></div></div></div><div><div><div>Mechanical Form Factors Pending Release.. ..47</div></div></div><div><div><div></div></div></div><div><div><div>NEWCARD Form Factor. . .47</div></div></div><div><div><div></div></div></div><div><div><div>Server IO Module (SIOM) Form Factor. . .47</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express Topology . ..48</div></div></div><div><div><div></div></div></div><div><div><div>Enumerating the System. ..50</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express System Block Diagram. . .51</div></div></div><div><div><div></div></div></div><div><div><div>Low Cost PCI Express Chipset . ..51</div></div></div><div><div><div></div></div></div><div><div><div>High-End Server System. .53</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express Specifications. .. 54</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="11" id="mark-3eecbfa7-df35-4085-a39a-3132ab7958ac" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Chapter 2: Architecture Overview</div></div></div><div><div><div></div></div></div><div><div><div>Introduction to PCI Express Transactions. .. 55</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express Transaction Protocol . 5.57</div></div></div><div><div><div></div></div></div><div><div><div>Non-Posted Read Transactions. . . 58</div></div></div><div><div><div></div></div></div><div><div><div>Non-Posted Read Transaction for Locked Requests . . 59</div></div></div><div><div><div></div></div></div><div><div><div>Non-Posted Write Transactions. ..61</div></div></div><div><div><div></div></div></div><div><div><div>Posted Memory Write Transactions. .. 62</div></div></div><div><div><div></div></div></div><div><div><div>Posted Message Transactions. ..63</div></div></div><div><div><div></div></div></div><div><div><div>Some Examples of Transactions.. 6.64</div></div></div><div><div><div></div></div></div><div><div><div>Memory Read Originated by CPU, Targeting an Endpoint.. 6.64</div></div></div><div><div><div></div></div></div><div><div><div>Memory Read Originated by Endpoint, Targeting System Memory. 6.66</div></div></div><div><div><div></div></div></div><div><div><div>IO Write Initiated by CPU, Targeting an Endpoint. . .67</div></div></div><div><div><div></div></div></div><div><div><div>Memory Write Transaction Originated by CPU and</div></div></div><div><div><div></div></div></div><div><div><div>Targeting an Endpoint. .68</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express Device Layers . .. 69</div></div></div><div><div><div></div></div></div><div><div><div>Overview. .69</div></div></div><div><div><div></div></div></div><div><div><div>Transmit Portion of Device Layers. ..71</div></div></div><div><div><div></div></div></div><div><div><div>Receive Portion of Device Layers. ..71</div></div></div><div><div><div></div></div></div><div><div><div>Device Layers and their Associated Packets ..71</div></div></div><div><div><div></div></div></div><div><div><div>Transaction Layer Packets (TLPs) . ..71</div></div></div><div><div><div></div></div></div><div><div><div>TLP Packet Assembly. ..72</div></div></div><div><div><div></div></div></div><div><div><div>TLP Packet Disassembly. ..73</div></div></div><div><div><div></div></div></div><div><div><div>Data Link Layer Packets (DLLPs) ..74</div></div></div><div><div><div></div></div></div><div><div><div>DLLP Assembly. ..75</div></div></div><div><div><div></div></div></div><div><div><div>DLLP Disassembly ..76</div></div></div><div><div><div></div></div></div><div><div><div>Physical Layer Packets (PLPs) . ..77</div></div></div><div><div><div></div></div></div><div><div><div>Function of Each PCI Express Device Layer. .78</div></div></div><div><div><div></div></div></div><div><div><div>Device Core / Software Layer . ..78</div></div></div><div><div><div></div></div></div><div><div><div>Transmit Side. ..78</div></div></div><div><div><div></div></div></div><div><div><div>Receive Side . .78</div></div></div><div><div><div></div></div></div><div><div><div>Transaction Layer . ..79</div></div></div><div><div><div></div></div></div><div><div><div>Transmit Side. ..80</div></div></div><div><div><div></div></div></div><div><div><div>Receiver Side . . . 81</div></div></div><div><div><div></div></div></div><div><div><div>Flow Control.. . . 81</div></div></div><div><div><div></div></div></div><div><div><div>Quality of Service (QoS) . . 82</div></div></div><div><div><div></div></div></div><div><div><div>Traffic Classes (TCs) and Virtual Channels (VCs). . . 84</div></div></div><div><div><div></div></div></div><div><div><div>Port Arbitration and VC Arbitration ..85</div></div></div><div><div><div></div></div></div><div><div><div>Transaction Ordering . ..87</div></div></div><div><div><div></div></div></div><div><div><div>Power Management . ..87</div></div></div><div><div><div></div></div></div><div><div><div>Configuration Registers. . . 87</div></div></div><div><div><div></div></div></div><div><div><div>Data Link Layer.. ..87</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="12" id="mark-69eb5af6-984a-4105-b689-13532557b12e" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Transmit Side . . 88</div></div></div><div><div><div></div></div></div><div><div><div>Receive Side. ..89</div></div></div><div><div><div></div></div></div><div><div><div>Data Link Layer Contribution to TLPs and DLLPs ..89</div></div></div><div><div><div></div></div></div><div><div><div>Non-Posted Transaction Showing ACK-NAK Protocol .. 90</div></div></div><div><div><div></div></div></div><div><div><div>Posted Transaction Showing ACK-NAK Protocol . ..92</div></div></div><div><div><div></div></div></div><div><div><div>Other Functions of the Data Link Layer. ..92</div></div></div><div><div><div></div></div></div><div><div><div>Physical Layer . ..93</div></div></div><div><div><div></div></div></div><div><div><div>Transmit Side ..93</div></div></div><div><div><div></div></div></div><div><div><div>Receive Side. ..93</div></div></div><div><div><div></div></div></div><div><div><div>Link Training and Initialization ..94</div></div></div><div><div><div></div></div></div><div><div><div>Link Power Management . ..95</div></div></div><div><div><div></div></div></div><div><div><div>Reset.. ..95</div></div></div><div><div><div></div></div></div><div><div><div>Electrical Physical Layer. ..96</div></div></div><div><div><div></div></div></div><div><div><div>Example of a Non-Posted Memory Read Transaction . . 96</div></div></div><div><div><div></div></div></div><div><div><div>Memory Read Request Phase. ..97</div></div></div><div><div><div></div></div></div><div><div><div>Completion with Data Phase . ..99</div></div></div><div><div><div></div></div></div><div><div><div>Hot Plug . .101</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express Performance and Data Transfer Efficiency .101</div></div></div><div><div><div></div></div></div><h2><div><div>Part Two: Transaction Protocol</div></div></h2><div><div><div></div></div></div><div><div><div>Chapter 3: Address Spaces &amp; Transaction Routing</div></div></div><div><div><div></div></div></div><div><div><div>Introduction. .106</div></div></div><div><div><div></div></div></div><div><div><div>Receivers Check For Three Types of Link Traffic .107</div></div></div><div><div><div></div></div></div><div><div><div>Multi-port Devices Assume the Routing Burden. .107</div></div></div><div><div><div></div></div></div><div><div><div>Endpoints Have Limited Routing Responsibilities. .107</div></div></div><div><div><div></div></div></div><div><div><div>System Routing Strategy Is Programmed .108</div></div></div><div><div><div></div></div></div><div><div><div>Two Types of Local Link Traffic. .108</div></div></div><div><div><div></div></div></div><div><div><div>Ordered Sets . 108</div></div></div><div><div><div></div></div></div><div><div><div>Data Link Layer Packets (DLLPs).. ..111</div></div></div><div><div><div></div></div></div><div><div><div>Transaction Layer Packet Routing Basics. .113</div></div></div><div><div><div></div></div></div><div><div><div>TLPs Used to Access Four Address Spaces. ..113</div></div></div><div><div><div></div></div></div><div><div><div>Split Transaction Protocol Is Used. .114</div></div></div><div><div><div></div></div></div><div><div><div>Split Transactions: Better Performance, More Overhead. 1.114</div></div></div><div><div><div></div></div></div><div><div><div>Write Posting: Sometimes a Completion Isn’t Needed . ..115</div></div></div><div><div><div></div></div></div><div><div><div>Three Methods of TLP Routing. .117</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express Routing Is Compatible with PCI ..117</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express Adds Implicit Routing for Messages. . . 118</div></div></div><div><div><div></div></div></div><div><div><div>Why Were Messages Added to PCI Express Protocol? .118</div></div></div><div><div><div></div></div></div><div><div><div>How Implicit Routing Helps with Messages.. .118</div></div></div><div><div><div></div></div></div><div><div><div>Header Fields Define Packet Format and Routing .119</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="13" id="mark-b5372d9c-ef0a-497b-86ab-deb9b1027889" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Using TLP Header Information: Overview. . . 120</div></div></div><div><div><div></div></div></div><div><div><div>General ..120</div></div></div><div><div><div></div></div></div><div><div><div>Header Type/Format Field Encodings .. 120</div></div></div><div><div><div></div></div></div><div><div><div>Applying Routing Mechanisms .. 121</div></div></div><div><div><div></div></div></div><div><div><div>Address Routing . .122</div></div></div><div><div><div></div></div></div><div><div><div>Memory and IO Address Maps. .122</div></div></div><div><div><div></div></div></div><div><div><div>Key TLP Header Fields in Address Routing .123</div></div></div><div><div><div></div></div></div><div><div><div>TLPs with 3DW, 32-Bit Address. .123</div></div></div><div><div><div></div></div></div><div><div><div>TLPs With 4DW, 64-Bit Address . .124</div></div></div><div><div><div></div></div></div><div><div><div>An Endpoint Checks an Address-Routed TLP. .125</div></div></div><div><div><div></div></div></div><div><div><div>A Switch Receives an Address Routed TLP: Two Checks. .125</div></div></div><div><div><div></div></div></div><div><div><div>General. . . 125</div></div></div><div><div><div></div></div></div><div><div><div>Other Notes About Switch Address-Routing. .127</div></div></div><div><div><div></div></div></div><div><div><div>ID Routing. .127</div></div></div><div><div><div></div></div></div><div><div><div>ID Bus Number, Device Number, Function Number Limits ..127</div></div></div><div><div><div></div></div></div><div><div><div>Key TLP Header Fields in ID Routing. . 128</div></div></div><div><div><div></div></div></div><div><div><div>3DW TLP, ID Routing. .128</div></div></div><div><div><div></div></div></div><div><div><div>4DW TLP, ID Routing. .129</div></div></div><div><div><div></div></div></div><div><div><div>An Endpoint Checks an ID-Routed TLP . .130</div></div></div><div><div><div></div></div></div><div><div><div>A Switch Receives an ID-Routed TLP: Two Checks. ..130</div></div></div><div><div><div></div></div></div><div><div><div>Other Notes About Switch ID Routing. .130</div></div></div><div><div><div></div></div></div><div><div><div>Implicit Routing . .131</div></div></div><div><div><div></div></div></div><div><div><div>Only Messages May Use Implicit Routing.. .132</div></div></div><div><div><div></div></div></div><div><div><div>Messages May Also Use Address or ID Routing. .132</div></div></div><div><div><div></div></div></div><div><div><div>Routing Sub-Field in Header Indicates Routing Method .132</div></div></div><div><div><div></div></div></div><div><div><div>Key TLP Header Fields in Implicit Routing .132</div></div></div><div><div><div></div></div></div><div><div><div>Message Type Field Summary. .133</div></div></div><div><div><div></div></div></div><div><div><div>An Endpoint Checks a TLP Routed Implicitly. .134</div></div></div><div><div><div></div></div></div><div><div><div>A Switch Receives a TLP Routed Implicitly .134</div></div></div><div><div><div></div></div></div><div><div><div>Plug-And-Play Configuration of Routing Options .. 135</div></div></div><div><div><div></div></div></div><div><div><div>Routing Configuration Is PCI-Compatible .135</div></div></div><div><div><div></div></div></div><div><div><div>Two Configuration Space Header Formats: Type 0, Type 1 .135</div></div></div><div><div><div></div></div></div><div><div><div>Routing Registers Are Located in Configuration Header .135</div></div></div><div><div><div></div></div></div><div><div><div>Base Address Registers (BARs): Type 0, 1 Headers. .136</div></div></div><div><div><div></div></div></div><div><div><div>General . ..136</div></div></div><div><div><div></div></div></div><div><div><div>BAR Setup Example One: 1MB, Prefetchable Memory Request. .138</div></div></div><div><div><div></div></div></div><div><div><div>BAR Setup Example Two: 64-Bit, 64MB Memory Request. ..140</div></div></div><div><div><div></div></div></div><div><div><div>BAR Setup Example Three: 256-Byte IO Request . .142</div></div></div><div><div><div></div></div></div><div><div><div>Base/Limit Registers, Type 1 Header Only ..144</div></div></div><div><div><div></div></div></div><div><div><div>General . ..144</div></div></div><div><div><div></div></div></div><div><div><div>Prefetchable Memory Base/Limit Registers. 1.144</div></div></div><div><div><div></div></div></div><div><div><div>Non-Prefetchable Memory Base/Limit Registers. .146</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="14" id="mark-08fba31b-162a-4fae-8339-b0c02318911b" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Contents</div></div></h2><div><div><div></div></div></div><div><div><div>IO Base/Limit Registers. . . 148</div></div></div><div><div><div></div></div></div><div><div><div>Bus Number Registers, Type 1 Header Only. .150</div></div></div><div><div><div></div></div></div><div><div><div>Primary Bus Number. .151</div></div></div><div><div><div></div></div></div><div><div><div>Secondary Bus Number. .151</div></div></div><div><div><div></div></div></div><div><div><div>Subordinate Bus Number. .151</div></div></div><div><div><div></div></div></div><div><div><div>A Switch Is a Two-Level Bridge Structure. . . 151</div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 4: Packet-Based Transactions</div></div></h2><div><div><div></div></div></div><div><div><div>Introduction to the Packet-Based Protocol. .154</div></div></div><div><div><div></div></div></div><div><div><div>Why Use A Packet-Based Transaction Protocol . .154</div></div></div><div><div><div></div></div></div><div><div><div>Packet Formats Are Well Defined. .154</div></div></div><div><div><div></div></div></div><div><div><div>Framing Symbols Indicate Packet Boundaries. .156</div></div></div><div><div><div></div></div></div><div><div><div>CRC Protects Entire Packet . .156</div></div></div><div><div><div></div></div></div><div><div><div>Transaction Layer Packets . .156</div></div></div><div><div><div></div></div></div><div><div><div>TLPs Are Assembled And Disassembled. .157</div></div></div><div><div><div></div></div></div><div><div><div>Device Core Requests Access to Four Spaces .159</div></div></div><div><div><div></div></div></div><div><div><div>TLP Transaction Variants Defined . 1.160</div></div></div><div><div><div></div></div></div><div><div><div>TLP Structure. ..161</div></div></div><div><div><div></div></div></div><div><div><div>Generic TLP Header Format . ..161</div></div></div><div><div><div></div></div></div><div><div><div>Generic Header Field Summary. .162</div></div></div><div><div><div></div></div></div><div><div><div>Header Type/Format Field Encodings .165</div></div></div><div><div><div></div></div></div><div><div><div>The Digest and ECRC Field. .166</div></div></div><div><div><div></div></div></div><div><div><div>ECRC Generation and Checking . .166</div></div></div><div><div><div></div></div></div><div><div><div>Who Can Check ECRC?.. ..167</div></div></div><div><div><div></div></div></div><div><div><div>Using Byte Enables . .167</div></div></div><div><div><div></div></div></div><div><div><div>Byte Enable Rules . ..167</div></div></div><div><div><div></div></div></div><div><div><div>Transaction Descriptor Fields .169</div></div></div><div><div><div></div></div></div><div><div><div>Transaction ID.. .169</div></div></div><div><div><div></div></div></div><div><div><div>Traffic Class. .169</div></div></div><div><div><div></div></div></div><div><div><div>Transaction Attributes . .169</div></div></div><div><div><div></div></div></div><div><div><div>Additional Rules For TLPs With Data Payloads. .170</div></div></div><div><div><div></div></div></div><div><div><div>Building Transactions: TLP Requests &amp; Completions. ..171</div></div></div><div><div><div></div></div></div><div><div><div>IO Requests . .171</div></div></div><div><div><div></div></div></div><div><div><div>IO Request Header Format . 172</div></div></div><div><div><div></div></div></div><div><div><div>Definitions Of IO Request Header Fields .173</div></div></div><div><div><div></div></div></div><div><div><div>Memory Requests . .174</div></div></div><div><div><div></div></div></div><div><div><div>Description of 3DW And 4DW Memory Request Header Fields. ..176</div></div></div><div><div><div></div></div></div><div><div><div>Memory Request Notes . ..179</div></div></div><div><div><div></div></div></div><div><div><div>Configuration Requests . .179</div></div></div><div><div><div></div></div></div><div><div><div>Definitions Of Configuration Request Header Fields. .181</div></div></div><div><div><div></div></div></div><div><div><div>Configuration Request Notes .183</div></div></div><div><div><div></div></div></div><div><div><div>Completions. .183</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="15" id="mark-336dc6a0-82a6-4590-a293-c6fd6224b6c2" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Definitions Of Completion Header Fields . . 185</div></div></div><div><div><div></div></div></div><div><div><div>Summary of Completion Status Codes: ..187</div></div></div><div><div><div></div></div></div><div><div><div>Calculating The Lower Address Field (Byte 11, bits 7:0): ..187</div></div></div><div><div><div></div></div></div><div><div><div>Using The Byte Count Modified Bit. .188</div></div></div><div><div><div></div></div></div><div><div><div>Data Returned For Read Requests: .188</div></div></div><div><div><div></div></div></div><div><div><div>Receiver Completion Handling Rules:. .189</div></div></div><div><div><div></div></div></div><div><div><div>Message Requests. .190</div></div></div><div><div><div></div></div></div><div><div><div>Definitions Of Message Request Header Fields. .191</div></div></div><div><div><div></div></div></div><div><div><div>Message Notes: .193</div></div></div><div><div><div></div></div></div><div><div><div>INTx Interrupt Signaling. .193</div></div></div><div><div><div></div></div></div><div><div><div>Power Management Messages .194</div></div></div><div><div><div></div></div></div><div><div><div>Error Messages. . 195</div></div></div><div><div><div></div></div></div><div><div><div>Unlock Message. .196</div></div></div><div><div><div></div></div></div><div><div><div>Slot Power Limit Message. .196</div></div></div><div><div><div></div></div></div><div><div><div>Hot Plug Signaling Message ..197</div></div></div><div><div><div></div></div></div><div><div><div>Data Link Layer Packets .198</div></div></div><div><div><div></div></div></div><div><div><div>Types Of DLLPs . .199</div></div></div><div><div><div></div></div></div><div><div><div>DLLPs Are Local Traffic. .199</div></div></div><div><div><div></div></div></div><div><div><div>Receiver handling of DLLPs. .199</div></div></div><div><div><div></div></div></div><div><div><div>Sending A Data Link Layer Packet. .200</div></div></div><div><div><div></div></div></div><div><div><div>Fixed DLLP Packet Size: 8 Bytes. ..201</div></div></div><div><div><div></div></div></div><div><div><div>DLLP Packet Types. .. 201</div></div></div><div><div><div></div></div></div><div><div><div>Ack Or Nak DLLP Packet Format .202</div></div></div><div><div><div></div></div></div><div><div><div>Definitions Of Ack Or Nak DLLP Fields.. .203</div></div></div><div><div><div></div></div></div><div><div><div>Power Management DLLP Packet Format. .204</div></div></div><div><div><div></div></div></div><div><div><div>Definitions Of Power Management DLLP Fields .204</div></div></div><div><div><div></div></div></div><div><div><div>Flow Control Packet Format . .205</div></div></div><div><div><div></div></div></div><div><div><div>Definitions Of Flow Control DLLP Fields .206</div></div></div><div><div><div></div></div></div><div><div><div>Vendor Specific DLLP Format . .207</div></div></div><div><div><div></div></div></div><div><div><div>Definitions Of Vendor Specific DLLP Fields. .. 207</div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 5: ACK/NAK Protocol</div></div></h2><div><div><div></div></div></div><div><div><div>Reliable Transport of TLPs Across Each Link. .210</div></div></div><div><div><div></div></div></div><div><div><div>Elements of the ACK/NAK Protocol . .. 212</div></div></div><div><div><div></div></div></div><div><div><div>Transmitter Elements of the ACK/NAK Protocol. ..213</div></div></div><div><div><div></div></div></div><div><div><div>Replay Buffer. .213</div></div></div><div><div><div></div></div></div><div><div><div>NEXT_TRANSMIT_SEQ Counter. .. 213</div></div></div><div><div><div></div></div></div><div><div><div>LCRC Generator.. . . 213</div></div></div><div><div><div></div></div></div><div><div><div>REPLAY_NUM Count . ..213</div></div></div><div><div><div></div></div></div><div><div><div>REPLAY_TIMER Count. .214</div></div></div><div><div><div></div></div></div><div><div><div>ACKD_SEQ Count. ..214</div></div></div><div><div><div></div></div></div><div><div><div>DLLP CRC Check . .. 214</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="16" id="mark-1b47fd1b-27ef-4f57-8cb8-975c0e7dd714" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Receiver Elements of the ACK/NAK Protocol. ..216</div></div></div><div><div><div></div></div></div><div><div><div>Receive Buffer. .216</div></div></div><div><div><div></div></div></div><div><div><div>LCRC Error Check. ..216</div></div></div><div><div><div></div></div></div><div><div><div>NEXT_RCV_SEQ Count. ..216</div></div></div><div><div><div></div></div></div><div><div><div>Sequence Number Check. ..216</div></div></div><div><div><div></div></div></div><div><div><div>NAK_SCHEDULED Flag ..217</div></div></div><div><div><div></div></div></div><div><div><div>ACKNAK_LATENCY_TIMER ..217</div></div></div><div><div><div></div></div></div><div><div><div>ACK/NAK DLLP Generator . ..217</div></div></div><div><div><div></div></div></div><div><div><div>ACK/NAK DLLP Format . ..219</div></div></div><div><div><div></div></div></div><div><div><div>ACK/NAK Protocol Details. . . 220</div></div></div><div><div><div></div></div></div><div><div><div>Transmitter Protocol Details . . 220</div></div></div><div><div><div></div></div></div><div><div><div>Sequence Number. ..220</div></div></div><div><div><div></div></div></div><div><div><div>32-Bit LCRC . . . 221</div></div></div><div><div><div></div></div></div><div><div><div>Replay (Retry) Buffer. .221</div></div></div><div><div><div></div></div></div><div><div><div>General. .. 221</div></div></div><div><div><div></div></div></div><div><div><div>Replay Buffer Sizing. .. 221</div></div></div><div><div><div></div></div></div><div><div><div>Transmitter's Response to an ACK DLLP. . . 222</div></div></div><div><div><div></div></div></div><div><div><div>General. . . 222</div></div></div><div><div><div></div></div></div><div><div><div>Purging the Replay Buffer. .222</div></div></div><div><div><div></div></div></div><div><div><div>Examples of Transmitter ACK DLLP Processing ..222</div></div></div><div><div><div></div></div></div><div><div><div>Example 1. .. 222</div></div></div><div><div><div></div></div></div><div><div><div>Example 2. . . 223</div></div></div><div><div><div></div></div></div><div><div><div>Transmitter's Response to a NAK DLLP. . . 224</div></div></div><div><div><div></div></div></div><div><div><div>TLP Replay. .225</div></div></div><div><div><div></div></div></div><div><div><div>Efficient TLP Replay. .225</div></div></div><div><div><div></div></div></div><div><div><div>Example of Transmitter NAK DLLP Processing. .. 225</div></div></div><div><div><div></div></div></div><div><div><div>Repeated Replay of TLPs. ..226</div></div></div><div><div><div></div></div></div><div><div><div>What Happens After the Replay Number Rollover? .227</div></div></div><div><div><div></div></div></div><div><div><div>Transmitter's Replay Timer. .227</div></div></div><div><div><div></div></div></div><div><div><div>REPLAY_TIMER Equation. .. 227</div></div></div><div><div><div></div></div></div><div><div><div>REPLAY_TIMER Summary Table .. 228</div></div></div><div><div><div></div></div></div><div><div><div>Transmitter DLLP Handling . ..229</div></div></div><div><div><div></div></div></div><div><div><div>Receiver Protocol Details . ..230</div></div></div><div><div><div></div></div></div><div><div><div>TLP Received at Physical Layer. .230</div></div></div><div><div><div></div></div></div><div><div><div>Received TLP Error Check .230</div></div></div><div><div><div></div></div></div><div><div><div>Next Received TLP's Sequence Number. .230</div></div></div><div><div><div></div></div></div><div><div><div>Receiver Schedules An ACK DLLP.. ..231</div></div></div><div><div><div></div></div></div><div><div><div>Example of Receiver ACK Scheduling . ..232</div></div></div><div><div><div></div></div></div><div><div><div>NAK Scheduled Flag. .233</div></div></div><div><div><div></div></div></div><div><div><div>Receiver Schedules a NAK. .233</div></div></div><div><div><div></div></div></div><div><div><div>Receiver Sequence Number Check .234</div></div></div><div><div><div></div></div></div><div><div><div>Receiver Preserves TLP Ordering . .235</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="17" id="mark-2746e8b3-0569-43dc-b4c9-4e83938e2641" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Example of Receiver NAK Scheduling. .236</div></div></div><div><div><div></div></div></div><div><div><div>Receivers ACKNAK_LATENCY_TIMER ..237</div></div></div><div><div><div></div></div></div><div><div><div>ACKNAK_LATENCY_TIMER Equation. ..238</div></div></div><div><div><div></div></div></div><div><div><div>ACKNAK_LATENCY_TIMER Summary Table. .238</div></div></div><div><div><div></div></div></div><div><div><div>Error Situations Reliably Handled by ACK/NAK Protocol. .239</div></div></div><div><div><div></div></div></div><div><div><div>ACK/NAK Protocol Summary. . . 241</div></div></div><div><div><div></div></div></div><div><div><div>Transmitter Side . .. 241</div></div></div><div><div><div></div></div></div><div><div><div>Non-Error Case (ACK DLLP Management). . . 241</div></div></div><div><div><div></div></div></div><div><div><div>Error Case (NAK DLLP Management). .. 242</div></div></div><div><div><div></div></div></div><div><div><div>Receiver Side. ..242</div></div></div><div><div><div></div></div></div><div><div><div>Non-Error Case . .. 242</div></div></div><div><div><div></div></div></div><div><div><div>Error Case .243</div></div></div><div><div><div></div></div></div><div><div><div>Recommended Priority To Schedule Packets. .. 244</div></div></div><div><div><div></div></div></div><div><div><div>Some More Examples . .244</div></div></div><div><div><div></div></div></div><div><div><div>Lost TLP.. . . 244</div></div></div><div><div><div></div></div></div><div><div><div>Lost ACK DLLP or ACK DLLP with CRC Error. ..245</div></div></div><div><div><div></div></div></div><div><div><div>Lost ACK DLLP followed by NAK DLLP.. .246</div></div></div><div><div><div></div></div></div><div><div><div>Switch Cut-Through Mode . . . 248</div></div></div><div><div><div></div></div></div><div><div><div>Without Cut-Through Mode . 248</div></div></div><div><div><div></div></div></div><div><div><div>Background.. . 248</div></div></div><div><div><div></div></div></div><div><div><div>Possible Solution. .. 248</div></div></div><div><div><div></div></div></div><div><div><div>Switch Cut-Through Mode. . . 249</div></div></div><div><div><div></div></div></div><div><div><div>Background. ...249</div></div></div><div><div><div></div></div></div><div><div><div>Example That Demonstrates Switch Cut-Through Feature .. 249</div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 6: QoS/TCs/VCs and Arbitration</div></div></h2><div><div><div></div></div></div><div><div><div>Quality of Service. .252</div></div></div><div><div><div></div></div></div><div><div><div>Isochronous Transaction Support.. ..253</div></div></div><div><div><div></div></div></div><div><div><div>Synchronous Versus Isochronous Transactions. .253</div></div></div><div><div><div></div></div></div><div><div><div>Isochronous Transaction Management .255</div></div></div><div><div><div></div></div></div><div><div><div>Differentiated Services . ..255</div></div></div><div><div><div></div></div></div><div><div><div>Perspective on QOS/TC/VC and Arbitration. .. 255</div></div></div><div><div><div></div></div></div><div><div><div>Traffic Classes and Virtual Channels . .256</div></div></div><div><div><div></div></div></div><div><div><div>VC Assignment and TC Mapping . . 258</div></div></div><div><div><div></div></div></div><div><div><div>Determining the Number of VCs to be Used . . 258</div></div></div><div><div><div></div></div></div><div><div><div>Assigning VC Numbers (IDs) . . 260</div></div></div><div><div><div></div></div></div><div><div><div>Assigning TCs to each VC - TC/VC Mapping .262</div></div></div><div><div><div></div></div></div><div><div><div>Arbitration. ..263</div></div></div><div><div><div></div></div></div><div><div><div>Virtual Channel Arbitration . . 264</div></div></div><div><div><div></div></div></div><div><div><div>Strict Priority VC Arbitration. ..265</div></div></div><div><div><div></div></div></div><div><div><div>Low- and High-Priority VC Arbitration. .267</div></div></div><div><div><div></div></div></div><div><div><div>Hardware Fixed Arbitration Scheme. ...269</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="18" id="mark-070d5fab-fbae-455c-abad-ad86e306a27d" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Weighted Round Robin Arbitration Scheme. . 269</div></div></div><div><div><div></div></div></div><div><div><div>Round Robin Arbitration (Equal or Weighted) for All VCs. ..270</div></div></div><div><div><div></div></div></div><div><div><div>Loading the Virtual Channel Arbitration Table. ..270</div></div></div><div><div><div></div></div></div><div><div><div>VC Arbitration within Multiple Function Endpoints. .273</div></div></div><div><div><div></div></div></div><div><div><div>Port Arbitration. . . 274</div></div></div><div><div><div></div></div></div><div><div><div>The Port Arbitration Mechanisms. . . 277</div></div></div><div><div><div></div></div></div><div><div><div>Non-Configurable Hardware-Fixed Arbitration . . 278</div></div></div><div><div><div></div></div></div><div><div><div>Weighted Round Robin Arbitration. ..279</div></div></div><div><div><div></div></div></div><div><div><div>Time-Based, Weighted Round Robin Arbitration. ..279</div></div></div><div><div><div></div></div></div><div><div><div>Loading the Port Arbitration Tables. .280</div></div></div><div><div><div></div></div></div><div><div><div>Switch Arbitration Example. . . 282</div></div></div><div><div><div></div></div></div><div><div><div>Chapter 7: Flow Control</div></div></div><div><div><div></div></div></div><div><div><div>Flow Control Concept . . 286</div></div></div><div><div><div></div></div></div><div><div><div>Flow Control Buffers. .288</div></div></div><div><div><div></div></div></div><div><div><div>VC Flow Control Buffer Organization. . . 288</div></div></div><div><div><div></div></div></div><div><div><div>Flow Control Credits. .289</div></div></div><div><div><div></div></div></div><div><div><div>Maximum Flow Control Buffer Size . . . 290</div></div></div><div><div><div></div></div></div><div><div><div>Introduction to the Flow Control Mechanism . . 290</div></div></div><div><div><div></div></div></div><div><div><div>The Flow Control Elements . . 290</div></div></div><div><div><div></div></div></div><div><div><div>Transmitter Elements . ..291</div></div></div><div><div><div></div></div></div><div><div><div>Receiver Elements. ..291</div></div></div><div><div><div></div></div></div><div><div><div>Flow Control Packets. .293</div></div></div><div><div><div></div></div></div><div><div><div>Operation of the Flow Control Model - An Example . . 294</div></div></div><div><div><div></div></div></div><div><div><div>Stage 1 - Flow Control Following Initialization. .294</div></div></div><div><div><div></div></div></div><div><div><div>Stage 2 — Flow Control Buffer Fills Up. .298</div></div></div><div><div><div></div></div></div><div><div><div>Stage 3 — The Credit Limit count Rolls Over. ...299</div></div></div><div><div><div></div></div></div><div><div><div>Stage 4 — FC Buffer Overflow Error Check .300</div></div></div><div><div><div></div></div></div><div><div><div>Infinite Flow Control Advertisement . .301</div></div></div><div><div><div></div></div></div><div><div><div>Who Advertises Infinite Flow Control Credits?. .301</div></div></div><div><div><div></div></div></div><div><div><div>Special Use for Infinite Credit Advertisements. . . 302</div></div></div><div><div><div></div></div></div><div><div><div>Header and Data Advertisements May Conflict. ..302</div></div></div><div><div><div></div></div></div><div><div><div>The Minimum Flow Control Advertisement. .303</div></div></div><div><div><div></div></div></div><div><div><div>Flow Control Initialization. .304</div></div></div><div><div><div></div></div></div><div><div><div>The FC Initialization Sequence.. .305</div></div></div><div><div><div></div></div></div><div><div><div>FC Init1 Packets Advertise Flow Control Credits Available. .305</div></div></div><div><div><div></div></div></div><div><div><div>FC Init2 Packets Confirm Successful FC Initialization. ..307</div></div></div><div><div><div></div></div></div><div><div><div>Rate of FC_INIT1 and FC_INIT2 Transmission . . 308</div></div></div><div><div><div></div></div></div><div><div><div>Violations of the Flow Control Initialization Protocol .308</div></div></div><div><div><div></div></div></div><div><div><div>Flow Control Updates Following FC_INIT. . . 308</div></div></div><div><div><div></div></div></div><div><div><div>FC_Update DLLP Format and Content. ...309</div></div></div><div><div><div></div></div></div><div><div><div>Flow Control Update Frequency . .310</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="19" id="mark-25ecd96f-87dc-4de8-aaea-25ec5b23bf42" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Immediate Notification of Credits Allocated ..311</div></div></div><div><div><div></div></div></div><div><div><div>Maximum Latency Between Update Flow Control DLLPs. ..311</div></div></div><div><div><div></div></div></div><div><div><div>Calculating Update Frequency Based on Payload Size and Link Width . . 311</div></div></div><div><div><div></div></div></div><div><div><div>Error Detection Timer - A Pseudo Requirement . .312</div></div></div><div><div><div></div></div></div><div><div><div>Chapter 8: Transaction Ordering</div></div></div><div><div><div></div></div></div><div><div><div>Introduction. . .316</div></div></div><div><div><div></div></div></div><div><div><div>Producer/Consumer Model . .317</div></div></div><div><div><div></div></div></div><div><div><div>Native PCI Express Ordering Rules .318</div></div></div><div><div><div></div></div></div><div><div><div>Producer/Consumer Model with Native Devices. ..318</div></div></div><div><div><div></div></div></div><div><div><div>Relaxed Ordering. .319</div></div></div><div><div><div></div></div></div><div><div><div>RO Effects on Memory Writes and Messages. 3.319</div></div></div><div><div><div></div></div></div><div><div><div>RO Effects on Memory Read Transactions. . . 320</div></div></div><div><div><div></div></div></div><div><div><div>Summary of Strong Ordering Rules. . . 321</div></div></div><div><div><div></div></div></div><div><div><div>Modified Ordering Rules Improve Performance .322</div></div></div><div><div><div></div></div></div><div><div><div>Strong Ordering Can Result in Transaction Blocking . . 322</div></div></div><div><div><div></div></div></div><div><div><div>The Problem. .323</div></div></div><div><div><div></div></div></div><div><div><div>The Weakly Ordered Solution . 324</div></div></div><div><div><div></div></div></div><div><div><div>Order Management Accomplished with VC Buffers ..324</div></div></div><div><div><div></div></div></div><div><div><div>Summary of Modified Ordering Rules. . . 325</div></div></div><div><div><div></div></div></div><div><div><div>Support for PCI Buses and Deadlock Avoidance. . . 326</div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 9: Interrupts</div></div></h2><div><div><div></div></div></div><div><div><div>Two Methods of Interrupt Delivery. .330</div></div></div><div><div><div></div></div></div><div><div><div>Message Signaled Interrupts . .331</div></div></div><div><div><div></div></div></div><div><div><div>The MSI Capability Register Set . .332</div></div></div><div><div><div></div></div></div><div><div><div>Capability ID. .332</div></div></div><div><div><div></div></div></div><div><div><div>Pointer To Next New Capability .333</div></div></div><div><div><div></div></div></div><div><div><div>Message Control Register. .333</div></div></div><div><div><div></div></div></div><div><div><div>Message Address Register. .335</div></div></div><div><div><div></div></div></div><div><div><div>Message Data Register. ..335</div></div></div><div><div><div></div></div></div><div><div><div>Basics of MSI Configuration. .336</div></div></div><div><div><div></div></div></div><div><div><div>Basics of Generating an MSI Interrupt Request . .338</div></div></div><div><div><div></div></div></div><div><div><div>Memory Write Transaction (MSI) .338</div></div></div><div><div><div></div></div></div><div><div><div>Multiple Messages. .339</div></div></div><div><div><div></div></div></div><div><div><div>Memory Synchronization When Interrupt Handler Entered. . .340</div></div></div><div><div><div></div></div></div><div><div><div>The Problem. .340</div></div></div><div><div><div></div></div></div><div><div><div>Solving the Problem ..341</div></div></div><div><div><div></div></div></div><div><div><div>Interrupt Latency . .341</div></div></div><div><div><div></div></div></div><div><div><div>MSI Results In ECRC Error. . 341</div></div></div><div><div><div></div></div></div><div><div><div>Some Rules, Recommendations, etc. ..341</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="20" id="mark-7a2a768f-bf17-4b86-903e-68033c8e7ad9" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Legacy PCI Interrupt Delivery . . 342</div></div></div><div><div><div></div></div></div><div><div><div>Background - PCI Interrupt Signaling ..342</div></div></div><div><div><div></div></div></div><div><div><div>Device INTx# Pins ..342</div></div></div><div><div><div></div></div></div><div><div><div>Determining if a Function Uses INTx# Pins 3.343</div></div></div><div><div><div></div></div></div><div><div><div>Interrupt Routing. 3.344</div></div></div><div><div><div></div></div></div><div><div><div>Associating the INTx# Line to an IRQ Number. . 345</div></div></div><div><div><div></div></div></div><div><div><div>INTx# Signaling . 3.345</div></div></div><div><div><div></div></div></div><div><div><div>Interrupt Disable. .346</div></div></div><div><div><div></div></div></div><div><div><div>Interrupt Status. . 346</div></div></div><div><div><div></div></div></div><div><div><div>Virtual INTx Signaling. 3.347</div></div></div><div><div><div></div></div></div><div><div><div>Virtual INTx Wire Delivery.. 3.348</div></div></div><div><div><div></div></div></div><div><div><div>Collapsing INTx Signals within a Bridge. .349</div></div></div><div><div><div></div></div></div><div><div><div>INTx Message Format. . 351</div></div></div><div><div><div></div></div></div><div><div><div>Devices May Support Both MSI and Legacy Interrupts .352</div></div></div><div><div><div></div></div></div><div><div><div>Special Consideration for Base System Peripherals .353</div></div></div><div><div><div></div></div></div><div><div><div>Example System . .353</div></div></div><div><div><div></div></div></div><div><div><div>Background. .356</div></div></div><div><div><div></div></div></div><div><div><div>Introduction to PCI Express Error Management. .356</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express Error Checking Mechanisms. . .356</div></div></div><div><div><div></div></div></div><div><div><div>Transaction Layer Errors . 358</div></div></div><div><div><div></div></div></div><div><div><div>Data Link Layer Errors . .358</div></div></div><div><div><div></div></div></div><div><div><div>Physical Layer Errors . . 358</div></div></div><div><div><div></div></div></div><div><div><div>Error Reporting Mechanisms. . 359</div></div></div><div><div><div></div></div></div><div><div><div>Error Handling Mechanisms. . . 360</div></div></div><div><div><div></div></div></div><div><div><div>Sources of PCI Express Errors. .361</div></div></div><div><div><div></div></div></div><div><div><div>ECRC Generation and Checking ..361</div></div></div><div><div><div></div></div></div><div><div><div>Data Poisoning (Optional). .362</div></div></div><div><div><div></div></div></div><div><div><div>TC to VC Mapping Errors.. 3.363</div></div></div><div><div><div></div></div></div><div><div><div>Link Flow Control-Related Errors. .363</div></div></div><div><div><div></div></div></div><div><div><div>Malformed Transaction Layer Packet (TLP). . 364</div></div></div><div><div><div></div></div></div><div><div><div>Split Transaction Errors . .365</div></div></div><div><div><div></div></div></div><div><div><div>Unsupported Request . .365</div></div></div><div><div><div></div></div></div><div><div><div>Completer Abort. .366</div></div></div><div><div><div></div></div></div><div><div><div>Unexpected Completion ..367</div></div></div><div><div><div></div></div></div><div><div><div>Completion Time-out. .367</div></div></div><div><div><div></div></div></div><div><div><div>Error Classifications . . . 368</div></div></div><div><div><div></div></div></div><div><div><div>Correctable Errors. . 369</div></div></div><div><div><div></div></div></div><div><div><div>Uncorrectable Non-Fatal Errors. .369</div></div></div><div><div><div></div></div></div><div><div><div>Uncorrectable Fatal Errors. 3.369</div></div></div><div><div><div></div></div></div><div><div><div>How Errors are Reported . . . 370</div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 10: Error Detection and Handling</div></div></h2><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="21" id="mark-b0140401-24c3-405d-8ee7-8b1ead1c7a70" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Error Messages . .370</div></div></div><div><div><div></div></div></div><div><div><div>Completion Status. . . 371</div></div></div><div><div><div></div></div></div><div><div><div>Baseline Error Detection and Handling. .372</div></div></div><div><div><div></div></div></div><div><div><div>PCI-Compatible Error Reporting Mechanisms . .372</div></div></div><div><div><div></div></div></div><div><div><div>Configuration Command and Status Registers. .373</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express Baseline Error Handling. . . 375</div></div></div><div><div><div></div></div></div><div><div><div>Enabling/Disabling Error Reporting. . 376</div></div></div><div><div><div></div></div></div><div><div><div>Enabling Error Reporting - Device Control Register. ..377</div></div></div><div><div><div></div></div></div><div><div><div>Error Status - Device Status Register . 378</div></div></div><div><div><div></div></div></div><div><div><div>Link Errors. 3.379</div></div></div><div><div><div></div></div></div><div><div><div>Root's Response to Error Message . . . 381</div></div></div><div><div><div></div></div></div><div><div><div>Advanced Error Reporting Mechanisms .382</div></div></div><div><div><div></div></div></div><div><div><div>ECRC Generation and Checking .383</div></div></div><div><div><div></div></div></div><div><div><div>Handling Sticky Bits . .383</div></div></div><div><div><div></div></div></div><div><div><div>Advanced Correctable Error Handling . .384</div></div></div><div><div><div></div></div></div><div><div><div>Advanced Correctable Error Status .385</div></div></div><div><div><div></div></div></div><div><div><div>Advanced Correctable Error Reporting .385</div></div></div><div><div><div></div></div></div><div><div><div>Advanced Uncorrectable Error Handling . . 386</div></div></div><div><div><div></div></div></div><div><div><div>Advanced Uncorrectable Error Status. .387</div></div></div><div><div><div></div></div></div><div><div><div>Selecting the Severity of Each Uncorrectable Error. .388</div></div></div><div><div><div></div></div></div><div><div><div>Uncorrectable Error Reporting . . . 388</div></div></div><div><div><div></div></div></div><div><div><div>Error Logging . . . 389</div></div></div><div><div><div></div></div></div><div><div><div>Root Complex Error Tracking and Reporting .390</div></div></div><div><div><div></div></div></div><div><div><div>Root Complex Error Status Registers .390</div></div></div><div><div><div></div></div></div><div><div><div>Advanced Source ID Register . .391</div></div></div><div><div><div></div></div></div><div><div><div>Root Error Command Register . . 392</div></div></div><div><div><div></div></div></div><div><div><div>Reporting Errors to the Host System .392</div></div></div><div><div><div></div></div></div><div><div><div>Summary of Error Logging and Reporting . .392</div></div></div><div><div><div></div></div></div><h2><div><div>Part Three: The Physical Layer</div></div></h2><div><div><div></div></div></div><div><div><div>Chapter 11: Physical Layer Logic</div></div></div><div><div><div></div></div></div><div><div><div>Physical Layer Overview. .. 397</div></div></div><div><div><div></div></div></div><div><div><div>Disclaimer. .400</div></div></div><div><div><div></div></div></div><div><div><div>Transmit Logic Overview . .400</div></div></div><div><div><div></div></div></div><div><div><div>Receive Logic Overview . .. 402</div></div></div><div><div><div></div></div></div><div><div><div>Physical Layer Link Active State Power Management .. 403</div></div></div><div><div><div></div></div></div><div><div><div>Link Training and Initialization. ..403</div></div></div><div><div><div></div></div></div><div><div><div>Transmit Logic Details. .. 403</div></div></div><div><div><div></div></div></div><div><div><div>Tx Buffer. .404</div></div></div><div><div><div></div></div></div><div><div><div>Multiplexer (Mux) and Mux Control Logic . .. 404</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="22" id="mark-70aa0a53-29e0-4a19-9c67-4e7d7da22b58" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>General . ..404</div></div></div><div><div><div></div></div></div><div><div><div>Definition of Characters and Symbols. .. 405</div></div></div><div><div><div></div></div></div><div><div><div>Byte Striping (Optional). .408</div></div></div><div><div><div></div></div></div><div><div><div>Packet Format Rules. .411</div></div></div><div><div><div></div></div></div><div><div><div>General Packet Format Rules. .411</div></div></div><div><div><div></div></div></div><div><div><div>x1 Packet Format Example. . 412</div></div></div><div><div><div></div></div></div><div><div><div>x4 Packet Format Rules. .412</div></div></div><div><div><div></div></div></div><div><div><div>x4 Packet Format Example. .. 412</div></div></div><div><div><div></div></div></div><div><div><div>x8, x12, x16 or x32 Packet Format Rules. .413</div></div></div><div><div><div></div></div></div><div><div><div>x8 Packet Format Example. .415</div></div></div><div><div><div></div></div></div><div><div><div>Scrambler.. ..416</div></div></div><div><div><div></div></div></div><div><div><div>Purpose of Scrambling Outbound Transmission. .416</div></div></div><div><div><div></div></div></div><div><div><div>Scrambler Algorithm. .416</div></div></div><div><div><div></div></div></div><div><div><div>Some Scrambler implementation rules:. ..417</div></div></div><div><div><div></div></div></div><div><div><div>Disabling Scrambling . .418</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="90" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> Encoding. 4.419</div></div></div><div><div><div></div></div></div><div><div><div>General . ..419</div></div></div><div><div><div></div></div></div><div><div><div>Purpose of Encoding a Character Stream. 4.419</div></div></div><div><div><div></div></div></div><div><div><div>Properties of 10-bit (10b) Symbols.. . 421</div></div></div><div><div><div></div></div></div><div><div><div>Preparing 8-bit Character Notation. . . 422</div></div></div><div><div><div></div></div></div><div><div><div>Disparity. ..423</div></div></div><div><div><div></div></div></div><div><div><div>Definition. .423</div></div></div><div><div><div></div></div></div><div><div><div>Two Categories of 8-bit Characters. . 423</div></div></div><div><div><div></div></div></div><div><div><div>CRD (Current Running Disparity). .423</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="91" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> Encoding Procedure .424</div></div></div><div><div><div></div></div></div><div><div><div>Example Encodings. .424</div></div></div><div><div><div></div></div></div><div><div><div>Example Transmission. .425</div></div></div><div><div><div></div></div></div><div><div><div>The Lookup Tables . . . 427</div></div></div><div><div><div></div></div></div><div><div><div>Control Character Encoding .430</div></div></div><div><div><div></div></div></div><div><div><div>Ordered-Sets. .433</div></div></div><div><div><div></div></div></div><div><div><div>General. .433</div></div></div><div><div><div></div></div></div><div><div><div>TS1 and TS2 Ordered-Sets. .434</div></div></div><div><div><div></div></div></div><div><div><div>SKIP Ordered-Set. .434</div></div></div><div><div><div></div></div></div><div><div><div>Electrical Idle Ordered-Set . .434</div></div></div><div><div><div></div></div></div><div><div><div>FTS Ordered-Set.. .434</div></div></div><div><div><div></div></div></div><div><div><div>Parallel-to-Serial Converter (Serializer). .434</div></div></div><div><div><div></div></div></div><div><div><div>Differential Transmit Driver.. .435</div></div></div><div><div><div></div></div></div><div><div><div>Transmit (Tx) Clock . .435</div></div></div><div><div><div></div></div></div><div><div><div>Other Miscellaneous Transmit Logic Topics . . 436</div></div></div><div><div><div></div></div></div><div><div><div>Logical Idle Sequence. .436</div></div></div><div><div><div></div></div></div><div><div><div>Inserting Clock Compensation Zones. . .436</div></div></div><div><div><div></div></div></div><div><div><div>Background. .436</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="23" id="mark-245b5361-cab4-490a-bedc-72c9fae9f30c" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>SKIP Ordered-Set Insertion Rules. .437</div></div></div><div><div><div></div></div></div><div><div><div>Receive Logic Details . .437</div></div></div><div><div><div></div></div></div><div><div><div>Differential Receiver. .439</div></div></div><div><div><div></div></div></div><div><div><div>Rx Clock Recovery. .440</div></div></div><div><div><div></div></div></div><div><div><div>General . . .440</div></div></div><div><div><div></div></div></div><div><div><div>Achieving Bit Lock .440</div></div></div><div><div><div></div></div></div><div><div><div>Losing Bit Lock. . 441</div></div></div><div><div><div></div></div></div><div><div><div>Regaining Bit Lock. .441</div></div></div><div><div><div></div></div></div><div><div><div>Serial-to-Parallel converter (Deserializer) . .441</div></div></div><div><div><div></div></div></div><div><div><div>Symbol Boundary Sensing (Symbol Lock). .441</div></div></div><div><div><div></div></div></div><div><div><div>Receiver Clock Compensation Logic 4.442</div></div></div><div><div><div></div></div></div><div><div><div>Background.. . . 442</div></div></div><div><div><div></div></div></div><div><div><div>The Elastic Buffer's Role in the Receiver. . . 442</div></div></div><div><div><div></div></div></div><div><div><div>Lane-to-Lane De-Skew. . . 444</div></div></div><div><div><div></div></div></div><div><div><div>Not a Problem on a Single-Lane Link. ..444</div></div></div><div><div><div></div></div></div><div><div><div>Flight Time Varies from Lane-to-Lane .444</div></div></div><div><div><div></div></div></div><div><div><div>If Lane Data Is Not Aligned, Byte Unstriping Wouldn't Work .444</div></div></div><div><div><div></div></div></div><div><div><div>TS1/TS2 or FTS Ordered-Sets Used to De-Skew Link 4.444</div></div></div><div><div><div></div></div></div><div><div><div>De-Skew During Link Training, Retraining and L0s Exit.. . 445</div></div></div><div><div><div></div></div></div><div><div><div>Lane-to-Lane De-Skew Capability of Receiver. . .445</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="92" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> Decoder. ..446</div></div></div><div><div><div></div></div></div><div><div><div>General . . .446</div></div></div><div><div><div></div></div></div><div><div><div>Disparity Calculator . .446</div></div></div><div><div><div></div></div></div><div><div><div>Code Violation and Disparity Error Detection. .446</div></div></div><div><div><div></div></div></div><div><div><div>General. . . 446</div></div></div><div><div><div></div></div></div><div><div><div>Code Violations. .446</div></div></div><div><div><div></div></div></div><div><div><div>Disparity Errors.. ..447</div></div></div><div><div><div></div></div></div><div><div><div>De-Scrambler . . 448</div></div></div><div><div><div></div></div></div><div><div><div>Some De-Scrambler Implementation Rules: 4.448</div></div></div><div><div><div></div></div></div><div><div><div>Disabling De-Scrambling. .449</div></div></div><div><div><div></div></div></div><div><div><div>Byte Un-Striping.. . 449</div></div></div><div><div><div></div></div></div><div><div><div>Filter and Packet Alignment Check. .450</div></div></div><div><div><div></div></div></div><div><div><div>Receive Buffer (Rx Buffer) . .450</div></div></div><div><div><div></div></div></div><div><div><div>Physical Layer Error Handling . .450</div></div></div><div><div><div></div></div></div><div><div><div>Response of Data Link Layer to 'Receiver Error' Indication. .451</div></div></div><div><div><div></div></div></div><div><div><div>Chapter 12: Electrical Physical Layer</div></div></div><div><div><div></div></div></div><div><div><div>Electrical Physical Layer Overview .453</div></div></div><div><div><div></div></div></div><div><div><div>High Speed Electrical Signaling .455</div></div></div><div><div><div></div></div></div><div><div><div>Clock Requirements. . 456</div></div></div><div><div><div></div></div></div><div><div><div>General . ..456</div></div></div><div><div><div></div></div></div><div><div><div>Spread Spectrum Clocking (SSC) . .456</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="24" id="mark-8839ef01-556d-4b38-b2cd-5ad189d83f34" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Impedance and Termination . 456</div></div></div><div><div><div></div></div></div><div><div><div>Transmitter Impedance Requirements . .457</div></div></div><div><div><div></div></div></div><div><div><div>Receiver Impedance Requirements. ..457</div></div></div><div><div><div></div></div></div><div><div><div>DC Common Mode Voltages. .457</div></div></div><div><div><div></div></div></div><div><div><div>Transmitter DC Common Mode Voltage .457</div></div></div><div><div><div></div></div></div><div><div><div>Receiver DC Common Mode Voltage. .457</div></div></div><div><div><div></div></div></div><div><div><div>ESD and Short Circuit Requirements. .458</div></div></div><div><div><div></div></div></div><div><div><div>Receiver Detection . .459</div></div></div><div><div><div></div></div></div><div><div><div>General . . 459</div></div></div><div><div><div></div></div></div><div><div><div>With a Receiver Attached . .459</div></div></div><div><div><div></div></div></div><div><div><div>Without a Receiver Attached .459</div></div></div><div><div><div></div></div></div><div><div><div>Procedure To Detect Presence or Absence of Receiver . .459</div></div></div><div><div><div></div></div></div><div><div><div>Differential Drivers and Receivers .461</div></div></div><div><div><div></div></div></div><div><div><div>Advantages of Differential Signaling .461</div></div></div><div><div><div></div></div></div><div><div><div>Differential Voltages. . 461</div></div></div><div><div><div></div></div></div><div><div><div>Differential Voltage Notation. .462</div></div></div><div><div><div></div></div></div><div><div><div>General . . 462</div></div></div><div><div><div></div></div></div><div><div><div>Differential Peak Voltage. . . 462</div></div></div><div><div><div></div></div></div><div><div><div>Differential Peak-to-Peak Voltage. .462</div></div></div><div><div><div></div></div></div><div><div><div>Common Mode Voltage ..462</div></div></div><div><div><div></div></div></div><div><div><div>Electrical Idle . ..464</div></div></div><div><div><div></div></div></div><div><div><div>Transmitter Responsibility . .464</div></div></div><div><div><div></div></div></div><div><div><div>Receiver Responsibility. .465</div></div></div><div><div><div></div></div></div><div><div><div>Power Consumed When Link Is in Electrical Idle State . 465</div></div></div><div><div><div></div></div></div><div><div><div>Electrical Idle Exit . . 465</div></div></div><div><div><div></div></div></div><div><div><div>Transmission Line Loss on Link ..465</div></div></div><div><div><div></div></div></div><div><div><div>AC Coupling. ..466</div></div></div><div><div><div></div></div></div><div><div><div>De-Emphasis (or Pre-Emphasis) . . 466</div></div></div><div><div><div></div></div></div><div><div><div>What is De-Emphasis? .466</div></div></div><div><div><div></div></div></div><div><div><div>What is the Problem Addressed By De-emphasis? .467</div></div></div><div><div><div></div></div></div><div><div><div>Solution. . 468</div></div></div><div><div><div></div></div></div><div><div><div>Beacon Signaling . .469</div></div></div><div><div><div></div></div></div><div><div><div>General . ..469</div></div></div><div><div><div></div></div></div><div><div><div>Properties of the Beacon Signal .469</div></div></div><div><div><div></div></div></div><div><div><div>LVDS Eye Diagram. 4.470</div></div></div><div><div><div></div></div></div><div><div><div>Jitter, Noise, and Signal Attenuation .470</div></div></div><div><div><div></div></div></div><div><div><div>The Eye Test. 4.470</div></div></div><div><div><div></div></div></div><div><div><div>Optimal Eye .471</div></div></div><div><div><div></div></div></div><div><div><div>Jitter Widens or Narrows the Eye Sideways. . 471</div></div></div><div><div><div></div></div></div><div><div><div>Noise and Signal Attenuation Heighten the Eye ..472</div></div></div><div><div><div></div></div></div><div><div><div>Transmitter Driver Characteristics 4.477</div></div></div><div><div><div></div></div></div><div><div><div>General.. .. 477</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="25" id="mark-f2358474-6353-4170-bb45-846e832c449c" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Transmit Driver Compliance Test and Measurement Load . . 479</div></div></div><div><div><div></div></div></div><div><div><div>Input Receiver Characteristics. . . 480</div></div></div><div><div><div></div></div></div><div><div><div>Electrical Physical Layer State in Power States. . . 481</div></div></div><div><div><div></div></div></div><div><div><div>Chapter 13: System Reset</div></div></div><div><div><div></div></div></div><div><div><div>Two Categories of System Reset. .487</div></div></div><div><div><div></div></div></div><div><div><div>Fundamental Reset. . 488</div></div></div><div><div><div></div></div></div><div><div><div>Methods of Signaling Fundamental Reset . .489</div></div></div><div><div><div></div></div></div><div><div><div>PERST# Type Fundamental Reset Generation. .489</div></div></div><div><div><div></div></div></div><div><div><div>Autonomous Method of Fundamental Reset Generation .489</div></div></div><div><div><div></div></div></div><div><div><div>In-Band Reset or Hot Reset. .491</div></div></div><div><div><div></div></div></div><div><div><div>Response to Receiving a Hot Reset Command . . 491</div></div></div><div><div><div></div></div></div><div><div><div>Switches Generate Hot Reset on Their Downstream Ports . . 492</div></div></div><div><div><div></div></div></div><div><div><div>Bridges Forward Hot Reset to the Secondary Bus . .492</div></div></div><div><div><div></div></div></div><div><div><div>How Does Software Tell a Device (e.g. Switch or Root Complex) to Generate Hot</div></div></div><div><div><div></div></div></div><div><div><div>Reset?. . . 492</div></div></div><div><div><div></div></div></div><div><div><div>Reset Exit. .496</div></div></div><div><div><div></div></div></div><div><div><div>Link Wakeup from L2 Low Power State. 4.497</div></div></div><div><div><div></div></div></div><div><div><div>Device Signals Wakeup. . . 497</div></div></div><div><div><div></div></div></div><div><div><div>Power Management Software Generates Wakeup Event. .497</div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 14: Link Initialization &amp; Training</div></div></h2><div><div><div></div></div></div><div><div><div>Link Initialization and Training Overview. 500</div></div></div><div><div><div></div></div></div><div><div><div>General. .500</div></div></div><div><div><div></div></div></div><div><div><div>Ordered-Sets Used During Link Training and Initialization .504</div></div></div><div><div><div></div></div></div><div><div><div>TS1 and TS2 Ordered-Sets . .505</div></div></div><div><div><div></div></div></div><div><div><div>Electrical Idle Ordered-Set. 5.507</div></div></div><div><div><div></div></div></div><div><div><div>FTS Ordered-Set. .507</div></div></div><div><div><div></div></div></div><div><div><div>SKIP Ordered-Set. .508</div></div></div><div><div><div></div></div></div><div><div><div>Link Training and Status State Machine (LTSSM). 5.508</div></div></div><div><div><div></div></div></div><div><div><div>General. . . 508</div></div></div><div><div><div></div></div></div><div><div><div>Overview of LTSSM States . .511</div></div></div><div><div><div></div></div></div><div><div><div>Detailed Description of LTSSM States. .513</div></div></div><div><div><div></div></div></div><div><div><div>Detect State.. .513</div></div></div><div><div><div></div></div></div><div><div><div>Detect.Quiet SubState. .513</div></div></div><div><div><div></div></div></div><div><div><div>Detect.Active SubState . 5.514</div></div></div><div><div><div></div></div></div><div><div><div>Polling State . 5.515</div></div></div><div><div><div></div></div></div><div><div><div>Introduction. ..515</div></div></div><div><div><div></div></div></div><div><div><div>Polling.Active SubState. ..516</div></div></div><div><div><div></div></div></div><div><div><div>Polling.Configuration SubState . .517</div></div></div><div><div><div></div></div></div><div><div><div>Polling.Compliance SubState. 5.518</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="26" id="mark-be9a7544-4b55-4144-9f6f-033bf1b224e3" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Polling.Speed SubState. ..518</div></div></div><div><div><div></div></div></div><div><div><div>Configuration State. 5.519</div></div></div><div><div><div></div></div></div><div><div><div>General . ..519</div></div></div><div><div><div></div></div></div><div><div><div>Configuration.RcvrCfg SubState . . 521</div></div></div><div><div><div></div></div></div><div><div><div>Configuration.Idle SubState. .522</div></div></div><div><div><div></div></div></div><div><div><div>Designing Devices with Links that can be Merged .522</div></div></div><div><div><div></div></div></div><div><div><div>General. .522</div></div></div><div><div><div></div></div></div><div><div><div>Four-x2 Configuration .523</div></div></div><div><div><div></div></div></div><div><div><div>Two-x4 Configuration. .523</div></div></div><div><div><div></div></div></div><div><div><div>Examples That Demonstrate Configuration.RcvrCfg Function. .524</div></div></div><div><div><div></div></div></div><div><div><div>RcvrCfg Example 1 . . . 524</div></div></div><div><div><div></div></div></div><div><div><div>Link Number Negotiation. .525</div></div></div><div><div><div></div></div></div><div><div><div>Lane Number Negotiation . . 526</div></div></div><div><div><div></div></div></div><div><div><div>Confirmation of Link Number and Lane Number Negotiated . .526</div></div></div><div><div><div></div></div></div><div><div><div>RcvrCfg Example 2 . .527</div></div></div><div><div><div></div></div></div><div><div><div>Link Number Negotiation: .527</div></div></div><div><div><div></div></div></div><div><div><div>Lane Number Negotiation .528</div></div></div><div><div><div></div></div></div><div><div><div>Confirmation of Link Number and Lane Number Negotiated .529</div></div></div><div><div><div></div></div></div><div><div><div>RcvrCfg Example 3 . .530</div></div></div><div><div><div></div></div></div><div><div><div>Link Number Negotiation. .530</div></div></div><div><div><div></div></div></div><div><div><div>Lane Number Negotiation ..531</div></div></div><div><div><div></div></div></div><div><div><div>Confirmation of Link Number and Lane Number Negotiated .531</div></div></div><div><div><div></div></div></div><div><div><div>Recovery State . .532</div></div></div><div><div><div></div></div></div><div><div><div>Reasons that a Device Enters the Recovery State. .533</div></div></div><div><div><div></div></div></div><div><div><div>Initiating the Recovery Process. 5.533</div></div></div><div><div><div></div></div></div><div><div><div>Recovery.RcvrLock SubState .533</div></div></div><div><div><div></div></div></div><div><div><div>Recovery.RcvrCfg SubState. .534</div></div></div><div><div><div></div></div></div><div><div><div>Recovery.Idle SubState. .535</div></div></div><div><div><div></div></div></div><div><div><div>L0 State . 5.537</div></div></div><div><div><div></div></div></div><div><div><div>L0s State. .538</div></div></div><div><div><div></div></div></div><div><div><div>L0s Transmitter State Machine .538</div></div></div><div><div><div></div></div></div><div><div><div>Tx_L0s.Entry SubState .538</div></div></div><div><div><div></div></div></div><div><div><div>Tx_L0s.Idle SubState . .538</div></div></div><div><div><div></div></div></div><div><div><div>Tx_L0s.FTS SubState . 5.539</div></div></div><div><div><div></div></div></div><div><div><div>L0s Receiver State Machine . .540</div></div></div><div><div><div></div></div></div><div><div><div>Rx_L0s.Entry SubState . .540</div></div></div><div><div><div></div></div></div><div><div><div>Rx_L0s.Idle SubState. 5.540</div></div></div><div><div><div></div></div></div><div><div><div>Rx_L0s.FTS SubState . 5.540</div></div></div><div><div><div></div></div></div><div><div><div>L1 State . ..541</div></div></div><div><div><div></div></div></div><div><div><div>L1.Entry SubState. . .541</div></div></div><div><div><div></div></div></div><div><div><div>L1.Idle SubState.. .542</div></div></div><div><div><div></div></div></div><div><div><div>L2 State . ..543</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="27" id="mark-40571e29-3e9a-4acd-bd07-cfea84d73bce" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>L2.Idle SubState. ..543</div></div></div><div><div><div></div></div></div><div><div><div>L1.TransmitWake SubState . ..543</div></div></div><div><div><div></div></div></div><div><div><div>Hot Reset State.. .544</div></div></div><div><div><div></div></div></div><div><div><div>Disable State.. 5.545</div></div></div><div><div><div></div></div></div><div><div><div>Loopback State 5.547</div></div></div><div><div><div></div></div></div><div><div><div>Loopback.Entry SubState. 5.547</div></div></div><div><div><div></div></div></div><div><div><div>Loopback.Active SubState. . .548</div></div></div><div><div><div></div></div></div><div><div><div>Loopback.Exit SubState. 5.548</div></div></div><div><div><div></div></div></div><div><div><div>LTSSM Related Configuration Registers. 5.549</div></div></div><div><div><div></div></div></div><div><div><div>Link Capability Register . 5.549</div></div></div><div><div><div></div></div></div><div><div><div>Maximum Link Speed[3:0] . 5.549</div></div></div><div><div><div></div></div></div><div><div><div>Maximum Link Width[9:4]. .550</div></div></div><div><div><div></div></div></div><div><div><div>Link Status Register. .551</div></div></div><div><div><div></div></div></div><div><div><div>Link Speed[3:0]:. ..551</div></div></div><div><div><div></div></div></div><div><div><div>Negotiate Link Width[9:4]. ..551</div></div></div><div><div><div></div></div></div><div><div><div>Training Error[10] ..551</div></div></div><div><div><div></div></div></div><div><div><div>Link Training[11]. ..551</div></div></div><div><div><div></div></div></div><div><div><div>Link Control Register . .552</div></div></div><div><div><div></div></div></div><div><div><div>Link Disable. . 552</div></div></div><div><div><div></div></div></div><div><div><div>Retrain Link. . 552</div></div></div><div><div><div></div></div></div><div><div><div>Extended Synch. ..552</div></div></div><div><div><div></div></div></div><h2><div><div>Part Four: Power-Related Topics</div></div></h2><div><div><div></div></div></div><div><div><div>Chapter 15: Power Budgeting</div></div></div><div><div><div></div></div></div><div><div><div>Introduction to Power Budgeting 5.557</div></div></div><div><div><div></div></div></div><div><div><div>The Power Budgeting Elements. 5.558</div></div></div><div><div><div></div></div></div><div><div><div>Slot Power Limit Control. .562</div></div></div><div><div><div></div></div></div><div><div><div>Expansion Port Delivers Slot Power Limit. .562</div></div></div><div><div><div></div></div></div><div><div><div>Expansion Device Limits Power Consumption. 5.564</div></div></div><div><div><div></div></div></div><div><div><div>The Power Budget Capabilities Register Set. .564</div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 16: Power Management</div></div></h2><div><div><div></div></div></div><div><div><div>Introduction. .568</div></div></div><div><div><div></div></div></div><div><div><div>Primer on Configuration Software .569</div></div></div><div><div><div></div></div></div><div><div><div>Basics of PCI PM . .569</div></div></div><div><div><div></div></div></div><div><div><div>OnNow Design Initiative Scheme Defines Overall PM . ..571</div></div></div><div><div><div></div></div></div><div><div><div>Goals. .572</div></div></div><div><div><div></div></div></div><div><div><div>System PM States . .572</div></div></div><div><div><div></div></div></div><div><div><div>Device PM States. .573</div></div></div><div><div><div></div></div></div><div><div><div>Definition of Device Context. 5.574</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="28" id="mark-ff974f3e-7405-4b58-99c3-355c1d1b4e23" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>General . 5.574</div></div></div><div><div><div></div></div></div><div><div><div>PM Event (PME) Context . .575</div></div></div><div><div><div></div></div></div><div><div><div>Device Class-Specific PM Specifications . . . 576</div></div></div><div><div><div></div></div></div><div><div><div>Default Device Class Specification. .576</div></div></div><div><div><div></div></div></div><div><div><div>Device Class-Specific PM Specifications. .576</div></div></div><div><div><div></div></div></div><div><div><div>Power Management Policy Owner . .577</div></div></div><div><div><div></div></div></div><div><div><div>General. 5.577</div></div></div><div><div><div></div></div></div><div><div><div>In Windows OS Environment.. 5.577</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express Power Management vs. ACPI. .577</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express Bus Driver Accesses PCI Express Configuration and PM Registers.</div></div></div><div><div><div></div></div></div><div><div><div>577</div></div></div><div><div><div></div></div></div><div><div><div>ACPI Driver Controls Non-Standard Embedded Devices 5.577</div></div></div><div><div><div></div></div></div><div><div><div>Some Example Scenarios . 5.579</div></div></div><div><div><div></div></div></div><div><div><div>Scenario-OS Wishes To Power Down PCI Express Devices. . . 580</div></div></div><div><div><div></div></div></div><div><div><div>Scenario-Restore All Functions To Powered Up State .582</div></div></div><div><div><div></div></div></div><div><div><div>Scenario-Setup a Function-Specific System WakeUp Event. .583</div></div></div><div><div><div></div></div></div><div><div><div>Function Power Management. 5.585</div></div></div><div><div><div></div></div></div><div><div><div>The PM Capability Register Set .585</div></div></div><div><div><div></div></div></div><div><div><div>Device PM States.. .586</div></div></div><div><div><div></div></div></div><div><div><div>D0 State—Full On . .586</div></div></div><div><div><div></div></div></div><div><div><div>Mandatory. . 586</div></div></div><div><div><div></div></div></div><div><div><div>D0 Uninitialized. .586</div></div></div><div><div><div></div></div></div><div><div><div>D0 Active . 5.587</div></div></div><div><div><div></div></div></div><div><div><div>D1 State-Light Sleep. .587</div></div></div><div><div><div></div></div></div><div><div><div>D2 State-Deep Sleep. 5.589</div></div></div><div><div><div></div></div></div><div><div><div>D3-Full Off . .590</div></div></div><div><div><div></div></div></div><div><div><div>D3Hot State.. ..591</div></div></div><div><div><div></div></div></div><div><div><div>D3Cold State. .592</div></div></div><div><div><div></div></div></div><div><div><div>Function PM State Transitions . .593</div></div></div><div><div><div></div></div></div><div><div><div>Detailed Description of PCI-PM Registers. .596</div></div></div><div><div><div></div></div></div><div><div><div>PM Capabilities (PMC) Register. 5.597</div></div></div><div><div><div></div></div></div><div><div><div>PM Control/Status (PMCSR) Register 5.599</div></div></div><div><div><div></div></div></div><div><div><div>Data Register. .603</div></div></div><div><div><div></div></div></div><div><div><div>Determining Presence of the Data Register. . . 604</div></div></div><div><div><div></div></div></div><div><div><div>Operation of the Data Register . . 604</div></div></div><div><div><div></div></div></div><div><div><div>Multi-Function Devices . .. 604</div></div></div><div><div><div></div></div></div><div><div><div>Virtual PCI-to-PCI Bridge Power Data. . . 604</div></div></div><div><div><div></div></div></div><div><div><div>Introduction to Link Power Management. 6.606</div></div></div><div><div><div></div></div></div><div><div><div>Link Active State Power Management. .. 608</div></div></div><div><div><div></div></div></div><div><div><div>L0s State. .611</div></div></div><div><div><div></div></div></div><div><div><div>Entry into L0s. . .611</div></div></div><div><div><div></div></div></div><div><div><div>Entry into L0s Triggered by Link Idle Time . ..611</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="29" id="mark-b061746a-c9b0-44f1-b159-8f3303126bf8" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Flow Control Credits Must be Delivered. ..612</div></div></div><div><div><div></div></div></div><div><div><div>Transmitter Initiates Entry to L0s ..612</div></div></div><div><div><div></div></div></div><div><div><div>Exit from L0s State. ..613</div></div></div><div><div><div></div></div></div><div><div><div>Transmitter Initiates L0s Exit. .613</div></div></div><div><div><div></div></div></div><div><div><div>Actions Taken by Switches that Receive L0s Exit. .613</div></div></div><div><div><div></div></div></div><div><div><div>L1 ASPM State . 6.614</div></div></div><div><div><div></div></div></div><div><div><div>Downstream Component Decides to Enter L1 ASPM ..615</div></div></div><div><div><div></div></div></div><div><div><div>Negotiation Required to Enter L1 ASPM. .616</div></div></div><div><div><div></div></div></div><div><div><div>Scenario 1: Both Ports Ready to Enter L1 ASPM State . ..616</div></div></div><div><div><div></div></div></div><div><div><div>Downstream Component Issues Request to Enter L1 State. .616</div></div></div><div><div><div></div></div></div><div><div><div>Upstream Component Requirements to Enter L1 ASPM. ..617</div></div></div><div><div><div></div></div></div><div><div><div>Upstream Component Acknowledges Request to Enter L1 6.617</div></div></div><div><div><div></div></div></div><div><div><div>Downstream Component Detects Acknowledgement ..617</div></div></div><div><div><div></div></div></div><div><div><div>Upstream Component Receives Electrical Idle. ..617</div></div></div><div><div><div></div></div></div><div><div><div>Scenario 2: Upstream Component Transmits TLP Just Prior to Receiving L1 Re-</div></div></div><div><div><div></div></div></div><div><div><div>quest. ..618</div></div></div><div><div><div></div></div></div><div><div><div>TLP Must Be Accepted by Downstream Component . 6.619</div></div></div><div><div><div></div></div></div><div><div><div>Upstream Component Receives Request to Enter L1. 6.619</div></div></div><div><div><div></div></div></div><div><div><div>Exit from L1 ASPM State . .. 621</div></div></div><div><div><div></div></div></div><div><div><div>L1 ASPM Exit Signaling. .. 621</div></div></div><div><div><div></div></div></div><div><div><div>Switch Receives L1 Exit from Downstream Component. .622</div></div></div><div><div><div></div></div></div><div><div><div>Switch Receives L1 Exit from Upstream Component ..623</div></div></div><div><div><div></div></div></div><div><div><div>ASPM Exit Latency. ..624</div></div></div><div><div><div></div></div></div><div><div><div>Reporting a Valid ASPM Exit Latency . .625</div></div></div><div><div><div></div></div></div><div><div><div>L0s Exit Latency Update. 6.625</div></div></div><div><div><div></div></div></div><div><div><div>L1 Exit Latency Update . . .626</div></div></div><div><div><div></div></div></div><div><div><div>Calculating Latency Between Endpoint to Root Complex . ..626</div></div></div><div><div><div></div></div></div><div><div><div>Software Initiated Link Power Management .. 629</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="93" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c44"></mjx-c></mjx-mi></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c44"></mjx-c></mjx-mi></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c44"></mjx-c></mjx-mi></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">D</mi></mrow><mn>1</mn><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">D</mi></mrow><mn>2</mn><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">D</mi></mrow><mn>3</mn></math></mjx-assistive-mml></mjx-container> Hot and the L1 State . 6.629</div></div></div><div><div><div></div></div></div><div><div><div>Entering the L1 State . .630</div></div></div><div><div><div></div></div></div><div><div><div>Exiting the L1 State. .632</div></div></div><div><div><div></div></div></div><div><div><div>Upstream Component Initiates L1 to L0 Transition. ..632</div></div></div><div><div><div></div></div></div><div><div><div>Downstream Component Initiates L1 to L0 Transition .633</div></div></div><div><div><div></div></div></div><div><div><div>The L1 Exit Protocol. ..633</div></div></div><div><div><div></div></div></div><div><div><div>L2/L3 Ready — Removing Power from the Link. ..633</div></div></div><div><div><div></div></div></div><div><div><div>L2/L3 Ready Handshake Sequence. 6.634</div></div></div><div><div><div></div></div></div><div><div><div>Exiting the L2/L3 Ready State - Clock and Power Removed. ..637</div></div></div><div><div><div></div></div></div><div><div><div>The L2 State.. ..637</div></div></div><div><div><div></div></div></div><div><div><div>The L3 State.. .637</div></div></div><div><div><div></div></div></div><div><div><div>Link Wake Protocol and PME Generation 6.638</div></div></div><div><div><div></div></div></div><div><div><div>The PME Message. .639</div></div></div><div><div><div></div></div></div><div><div><div>The PME Sequence.. . . 640</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="30" id="mark-fd357316-4b91-4568-935c-887bd4fee056" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>PME Message Back Pressure Deadlock Avoidance . . . 640</div></div></div><div><div><div></div></div></div><div><div><div>Background.. .. 641</div></div></div><div><div><div></div></div></div><div><div><div>The Problem. . .641</div></div></div><div><div><div></div></div></div><div><div><div>The Solution. .. 641</div></div></div><div><div><div></div></div></div><div><div><div>The PME Context . 6.642</div></div></div><div><div><div></div></div></div><div><div><div>Waking Non-Communicating Links. .. 642</div></div></div><div><div><div></div></div></div><div><div><div>Beacon.. . .643</div></div></div><div><div><div></div></div></div><div><div><div>WAKE# (AUX Power). .. 643</div></div></div><div><div><div></div></div></div><div><div><div>Auxiliary Power . .. 645</div></div></div><div><div><div></div></div></div><h2><div><div>Part Five: Optional Topics</div></div></h2><div><div><div></div></div></div><h2><div><div>Chapter 17: Hot Plug</div></div></h2><div><div><div></div></div></div><div><div><div>Background . 6.650</div></div></div><div><div><div></div></div></div><div><div><div>Hot Plug in the PCI Express Environment. . .651</div></div></div><div><div><div></div></div></div><div><div><div>Surprise Removal Notification.. .652</div></div></div><div><div><div></div></div></div><div><div><div>Differences between PCI and PCI Express Hot Plug. ..652</div></div></div><div><div><div></div></div></div><div><div><div>Elements Required to Support Hot Plug. 6.655</div></div></div><div><div><div></div></div></div><div><div><div>Software Elements . 6.655</div></div></div><div><div><div></div></div></div><div><div><div>Hardware Elements. .656</div></div></div><div><div><div></div></div></div><div><div><div>Card Removal and Insertion Procedures . 6.658</div></div></div><div><div><div></div></div></div><div><div><div>On and Off States . 6.658</div></div></div><div><div><div></div></div></div><div><div><div>Definition of On and Off. 6.658</div></div></div><div><div><div></div></div></div><div><div><div>Turning Slot Off. .658</div></div></div><div><div><div></div></div></div><div><div><div>Turning Slot On.. 6.659</div></div></div><div><div><div></div></div></div><div><div><div>Card Removal Procedure. . 659</div></div></div><div><div><div></div></div></div><div><div><div>Attention Button Used to Initiate Hot Plug Removal . .659</div></div></div><div><div><div></div></div></div><div><div><div>Hot Plug Removal Request Issued via User Interface. .660</div></div></div><div><div><div></div></div></div><div><div><div>Card Insertion Procedure.. . .661</div></div></div><div><div><div></div></div></div><div><div><div>Card Insertion Initiated by Pressing Attention Button . 6.661</div></div></div><div><div><div></div></div></div><div><div><div>Card Insertion Initiated by User Interface ..662</div></div></div><div><div><div></div></div></div><div><div><div>Standardized Usage Model . .663</div></div></div><div><div><div></div></div></div><div><div><div>Background. ..663</div></div></div><div><div><div></div></div></div><div><div><div>Standard User Interface .664</div></div></div><div><div><div></div></div></div><div><div><div>Attention Indicator . 6.664</div></div></div><div><div><div></div></div></div><div><div><div>Power Indicator.. .665</div></div></div><div><div><div></div></div></div><div><div><div>Manually Operated Retention Latch and Sensor. 6.666</div></div></div><div><div><div></div></div></div><div><div><div>Electromechanical Interlock (optional). ..667</div></div></div><div><div><div></div></div></div><div><div><div>Software User Interface. 6.667</div></div></div><div><div><div></div></div></div><div><div><div>Attention Button. .667</div></div></div><div><div><div></div></div></div><div><div><div>Slot Numbering Identification. 6.668</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="31" id="mark-f7bfa8ba-15fc-4a62-afe8-1f5e6f7b0358" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Standard Hot Plug Controller Signaling Interface. 6.668</div></div></div><div><div><div></div></div></div><div><div><div>The Hot-Plug Controller Programming Interface. 6.670</div></div></div><div><div><div></div></div></div><div><div><div>Slot Capabilities. ..670</div></div></div><div><div><div></div></div></div><div><div><div>Slot Power Limit Control. ..672</div></div></div><div><div><div></div></div></div><div><div><div>Slot Control. 6.672</div></div></div><div><div><div></div></div></div><div><div><div>Slot Status and Events Management. 6.674</div></div></div><div><div><div></div></div></div><div><div><div>Card Slot vs Server IO Module Implementations . 6.676</div></div></div><div><div><div></div></div></div><div><div><div>Detecting Module and Blade Capabilities. 6.678</div></div></div><div><div><div></div></div></div><div><div><div>Hot Plug Messages. 6.678</div></div></div><div><div><div></div></div></div><div><div><div>Attention and Power Indicator Control Messages . .678</div></div></div><div><div><div></div></div></div><div><div><div>Attention Button Pressed Message 6.679</div></div></div><div><div><div></div></div></div><div><div><div>Limitations of the Hot Plug Messages. 6.679</div></div></div><div><div><div></div></div></div><div><div><div>Slot Numbering. .681</div></div></div><div><div><div></div></div></div><div><div><div>Physical Slot ID.. . . 681</div></div></div><div><div><div></div></div></div><div><div><div>Quiescing Card and Driver. .681</div></div></div><div><div><div></div></div></div><div><div><div>General. . . 681</div></div></div><div><div><div></div></div></div><div><div><div>Pausing a Driver (Optional) . .681</div></div></div><div><div><div></div></div></div><div><div><div>Quiescing a Driver That Controls Multiple Devices . . 682</div></div></div><div><div><div></div></div></div><div><div><div>Quiescing a Failed Card. . . 682</div></div></div><div><div><div></div></div></div><div><div><div>The Primitives.. 6.682</div></div></div><div><div><div></div></div></div><div><div><div>Introduction. .686</div></div></div><div><div><div></div></div></div><div><div><div>Add-in Connector. .686</div></div></div><div><div><div></div></div></div><div><div><div>Auxiliary Signals. .693</div></div></div><div><div><div></div></div></div><div><div><div>General . ..693</div></div></div><div><div><div></div></div></div><div><div><div>Reference Clock. 6.694</div></div></div><div><div><div></div></div></div><div><div><div>PERST#. ...695</div></div></div><div><div><div></div></div></div><div><div><div>WAKE#. 6.696</div></div></div><div><div><div></div></div></div><div><div><div>SMBus. .698</div></div></div><div><div><div></div></div></div><div><div><div>JTAG . 6.699</div></div></div><div><div><div></div></div></div><div><div><div>PRSNT Pins. .699</div></div></div><div><div><div></div></div></div><div><div><div>Electrical Requirements. ..700</div></div></div><div><div><div></div></div></div><div><div><div>Power Supply Requirements .700</div></div></div><div><div><div></div></div></div><div><div><div>Power Dissipation Limits .701</div></div></div><div><div><div></div></div></div><div><div><div>Add-in Card Interoperability. ..702</div></div></div><div><div><div></div></div></div><div><div><div>Form Factors Under Development. .703</div></div></div><div><div><div></div></div></div><div><div><div>General.. ..703</div></div></div><div><div><div></div></div></div><div><div><div>Server IO Module (SIOM). ..703</div></div></div><div><div><div></div></div></div><div><div><div>Riser Card. ..704</div></div></div><div><div><div></div></div></div><div><div><div>Mini PCI Express Card. ..704</div></div></div><div><div><div></div></div></div><div><div><div>NEWCARD form factor. ..707</div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 18: Add-in Cards and Connectors</div></div></h2><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="32" id="mark-e0ec7861-365a-4b8a-bf13-558a7f78bac2" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Part Six: PCI Express Configuration</div></div></h2><div><div><div></div></div></div><div><div><div>Chapter 19: Configuration Overview</div></div></div><div><div><div></div></div></div><div><div><div>Definition of Device and Function. .. 712</div></div></div><div><div><div></div></div></div><div><div><div>Definition of Primary and Secondary Bus ..714</div></div></div><div><div><div></div></div></div><div><div><div>Topology Is Unknown At Startup . . .714</div></div></div><div><div><div></div></div></div><div><div><div>Each Function Implements a Set of Configuration</div></div></div><div><div><div></div></div></div><div><div><div>Registers. ..715</div></div></div><div><div><div></div></div></div><div><div><div>Introduction. ..715</div></div></div><div><div><div></div></div></div><div><div><div>Function Configuration Space. ..715</div></div></div><div><div><div></div></div></div><div><div><div>PCI-Compatible Space ..715</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express Extended Configuration Space. ..716</div></div></div><div><div><div></div></div></div><div><div><div>Host/PCI Bridge's Configuration Registers. ..716</div></div></div><div><div><div></div></div></div><div><div><div>Configuration Transactions Are Originated by the</div></div></div><div><div><div></div></div></div><div><div><div>Processor. .718</div></div></div><div><div><div></div></div></div><div><div><div>Only the Root Complex Can Originate Configuration Transactions ..718</div></div></div><div><div><div></div></div></div><div><div><div>Configuration Transactions Only Move DownStream.. ..718</div></div></div><div><div><div></div></div></div><div><div><div>No Peer-to-Peer Configuration Transactions.. ..718</div></div></div><div><div><div></div></div></div><div><div><div>Configuration Transactions Are Routed Via Bus, Device, and Function Number... 718</div></div></div><div><div><div></div></div></div><div><div><div>How a Function Is Discovered.. ..719</div></div></div><div><div><div></div></div></div><div><div><div>How To Differentiate a PCI-to-PCI Bridge From a Non-Bridge Function. . .719</div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 20: Configuration Mechanisms</div></div></h2><div><div><div></div></div></div><div><div><div>Introduction. .722</div></div></div><div><div><div></div></div></div><div><div><div>PCI-Compatible Configuration Mechanism. . .723</div></div></div><div><div><div></div></div></div><div><div><div>Background. ...724</div></div></div><div><div><div></div></div></div><div><div><div>PCI-Compatible Configuration Mechanism</div></div></div><div><div><div></div></div></div><div><div><div>Description. . .724</div></div></div><div><div><div></div></div></div><div><div><div>General ..724</div></div></div><div><div><div></div></div></div><div><div><div>Configuration Address Port. ..725</div></div></div><div><div><div></div></div></div><div><div><div>Bus Compare and Data Port Usage. ..726</div></div></div><div><div><div></div></div></div><div><div><div>Target Bus <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="94" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>0</mn></math></mjx-assistive-mml></mjx-container> .. . .726</div></div></div><div><div><div></div></div></div><div><div><div>Bus Number <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="95" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3C"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>&lt;</mo></math></mjx-assistive-mml></mjx-container> Target Bus <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="96" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2264"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>≤</mo></math></mjx-assistive-mml></mjx-container> Subordinate Bus Number. .727</div></div></div><div><div><div></div></div></div><div><div><div>Single Host/PCI Bridge. .727</div></div></div><div><div><div></div></div></div><div><div><div>Multiple Host/PCI Bridges. ...729</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express Enhanced Configuration Mechanism ..731</div></div></div><div><div><div></div></div></div><div><div><div>Description. . .731</div></div></div><div><div><div></div></div></div><div><div><div>Some Rules. .731</div></div></div><div><div><div></div></div></div><div><div><div>Type 0 Configuration Request .732</div></div></div><div><div><div></div></div></div><div><div><div>Type 1 Configuration Request .733</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="33" id="mark-02e6e1e8-a8bc-44c3-9e9d-91aef2230b37" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Example PCI-Compatible Configuration Access . 735</div></div></div><div><div><div></div></div></div><div><div><div>Example Enhanced Configuration Access. ..736</div></div></div><div><div><div></div></div></div><div><div><div>Initial Configuration Accesses ..738</div></div></div><div><div><div></div></div></div><div><div><div>What's Going On During Initialization Time? . .738</div></div></div><div><div><div></div></div></div><div><div><div>Definition of Initialization Period In PCI . .738</div></div></div><div><div><div></div></div></div><div><div><div>Definition of Initialization Period In PCI-X ..739</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express and Initialization Time. .739</div></div></div><div><div><div></div></div></div><div><div><div>Initial Configuration Access Failure Timeout ...739</div></div></div><div><div><div></div></div></div><div><div><div>Delay Prior To Initial Configuration Access to Device ..739</div></div></div><div><div><div></div></div></div><div><div><div>A Device With a Lengthy Self-Initialization Period . ..740</div></div></div><div><div><div></div></div></div><div><div><div>RC Response To CRS Receipt During Run-Time ..740</div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 21: PCI Express Enumeration</div></div></h2><div><div><div></div></div></div><div><div><div>Introduction. . . 741</div></div></div><div><div><div></div></div></div><div><div><div>Enumerating a System With a Single Root Complex. . 742</div></div></div><div><div><div></div></div></div><div><div><div>Enumerating a System With Multiple Root Complexes . 753</div></div></div><div><div><div></div></div></div><div><div><div>Operational Characteristics of the PCI-Compatible Mechanism. ..754</div></div></div><div><div><div></div></div></div><div><div><div>Operational Characteristics of the Enhanced</div></div></div><div><div><div></div></div></div><div><div><div>Configuration Mechanism . ..755</div></div></div><div><div><div></div></div></div><div><div><div>The Enumeration Process . ..755</div></div></div><div><div><div></div></div></div><div><div><div>A Multifunction Device Within a Root Complex or a Switch .. 758</div></div></div><div><div><div></div></div></div><div><div><div>A Multifunction Device Within a Root Complex. ..758</div></div></div><div><div><div></div></div></div><div><div><div>A Multifunction Device Within a Switch . .759</div></div></div><div><div><div></div></div></div><div><div><div>An Endpoint Embedded in a Switch or Root Complex. ..761</div></div></div><div><div><div></div></div></div><div><div><div>Memorize Your Identity ..763</div></div></div><div><div><div></div></div></div><div><div><div>General. ..763</div></div></div><div><div><div></div></div></div><div><div><div>Root Complex Bus Number/Device Number</div></div></div><div><div><div></div></div></div><div><div><div>Assignment . .764</div></div></div><div><div><div></div></div></div><div><div><div>Initiating Requests Prior To ID Assignment .764</div></div></div><div><div><div></div></div></div><div><div><div>Initiating Completions Prior to ID Assignment .765</div></div></div><div><div><div></div></div></div><div><div><div>Root Complex Register Blocks (RCRBs) . .765</div></div></div><div><div><div></div></div></div><div><div><div>What Problem Does an RCRB Address? . ..765</div></div></div><div><div><div></div></div></div><div><div><div>Additional Information on RCRBs. . .766</div></div></div><div><div><div></div></div></div><div><div><div>Miscellaneous Rules. ..766</div></div></div><div><div><div></div></div></div><div><div><div>A Split Configuration Transaction Requires a Single</div></div></div><div><div><div></div></div></div><div><div><div>Completion. .766</div></div></div><div><div><div></div></div></div><div><div><div>An Issue For PCI Express-to-PCI or -PCI-X Bridges. ..767</div></div></div><div><div><div></div></div></div><div><div><div>PCI Special Cycle Transactions. ..767</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="34" id="mark-f0637bc0-97eb-42d4-a05c-e1d2efb8bf89" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Chapter 22: PCI Compatible Configuration Registers</div></div></div><div><div><div></div></div></div><div><div><div>Header Type 0 . . . 770</div></div></div><div><div><div></div></div></div><div><div><div>General. ..770</div></div></div><div><div><div></div></div></div><div><div><div>Header Type 0 Registers Compatible With PCI .772</div></div></div><div><div><div></div></div></div><div><div><div>Header Type 0 Registers Incompatible With PCI ..772</div></div></div><div><div><div></div></div></div><div><div><div>Registers Used to Identify Device's Driver. ..773</div></div></div><div><div><div></div></div></div><div><div><div>Vendor ID Register. ..773</div></div></div><div><div><div></div></div></div><div><div><div>Device ID Register . ..773</div></div></div><div><div><div></div></div></div><div><div><div>Revision ID Register. ...773</div></div></div><div><div><div></div></div></div><div><div><div>Class Code Register. . . 774</div></div></div><div><div><div></div></div></div><div><div><div>General . ...774</div></div></div><div><div><div></div></div></div><div><div><div>The Programming Interface Byte . ..774</div></div></div><div><div><div></div></div></div><div><div><div>Detailed Class Code Description. . .775</div></div></div><div><div><div></div></div></div><div><div><div>Subsystem Vendor ID and Subsystem ID Registers. ..776</div></div></div><div><div><div></div></div></div><div><div><div>General . ..776</div></div></div><div><div><div></div></div></div><div><div><div>The Problem Solved by This Register Pair. ...776</div></div></div><div><div><div></div></div></div><div><div><div>Must Contain Valid Data When First Accessed. ..777</div></div></div><div><div><div></div></div></div><div><div><div>Header Type Register. ..777</div></div></div><div><div><div></div></div></div><div><div><div>BIST Register.. ..778</div></div></div><div><div><div></div></div></div><div><div><div>Capabilities Pointer Register. ..779</div></div></div><div><div><div></div></div></div><div><div><div>Configuration Header Space Not Large Enough ..779</div></div></div><div><div><div></div></div></div><div><div><div>Discovering That Capabilities Exist . ..779</div></div></div><div><div><div></div></div></div><div><div><div>What the Capabilities List Looks Like . . . 780</div></div></div><div><div><div></div></div></div><div><div><div>CardBus CIS Pointer Register ..782</div></div></div><div><div><div></div></div></div><div><div><div>Expansion ROM Base Address Register. ..783</div></div></div><div><div><div></div></div></div><div><div><div>Command Register. ..785</div></div></div><div><div><div></div></div></div><div><div><div>Status Register . 7.788</div></div></div><div><div><div></div></div></div><div><div><div>Cache Line Size Register. .790</div></div></div><div><div><div></div></div></div><div><div><div>Master Latency Timer Register .790</div></div></div><div><div><div></div></div></div><div><div><div>Interrupt Line Register. ..791</div></div></div><div><div><div></div></div></div><div><div><div>Usage In a PCI Function . ..791</div></div></div><div><div><div></div></div></div><div><div><div>Usage In a PCI Express Function. ..791</div></div></div><div><div><div></div></div></div><div><div><div>Interrupt Pin Register. . .792</div></div></div><div><div><div></div></div></div><div><div><div>Usage In a PCI Function ..792</div></div></div><div><div><div></div></div></div><div><div><div>Usage In a PCI Express Function. ..792</div></div></div><div><div><div></div></div></div><div><div><div>Base Address Registers. ..792</div></div></div><div><div><div></div></div></div><div><div><div>Introduction.. ..793</div></div></div><div><div><div></div></div></div><div><div><div>IO Space Usage. ..793</div></div></div><div><div><div></div></div></div><div><div><div>Memory Base Address Register. . . 794</div></div></div><div><div><div></div></div></div><div><div><div>Decoder Width Field. . . 794</div></div></div><div><div><div></div></div></div><div><div><div>Prefetchable Attribute Bit . ...795</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="35" id="mark-b97c083f-2625-4fb4-b98c-aa7e42e63da5" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Base Address Field . . . 796</div></div></div><div><div><div></div></div></div><div><div><div>IO Base Address Register ..797</div></div></div><div><div><div></div></div></div><div><div><div>Introduction. ..797</div></div></div><div><div><div></div></div></div><div><div><div>IO BAR Description. . . 797</div></div></div><div><div><div></div></div></div><div><div><div>PC-Compatible IO Decoder ...797</div></div></div><div><div><div></div></div></div><div><div><div>Legacy IO Decoders ...798</div></div></div><div><div><div></div></div></div><div><div><div>Finding Block Size and Assigning Address Range. . . 799</div></div></div><div><div><div></div></div></div><div><div><div>How It Works. ...799</div></div></div><div><div><div></div></div></div><div><div><div>A Memory Example . ..799</div></div></div><div><div><div></div></div></div><div><div><div>An IO Example. .. 800</div></div></div><div><div><div></div></div></div><div><div><div>Smallest/Largest Decoder Sizes. ... 800</div></div></div><div><div><div></div></div></div><div><div><div>Smallest/Largest Memory Decoders. . . 800</div></div></div><div><div><div></div></div></div><div><div><div>Smallest/Largest IO Decoders. . . 800</div></div></div><div><div><div></div></div></div><div><div><div>Byte Merging . .801</div></div></div><div><div><div></div></div></div><div><div><div>Bridge Must Discard Unconsumed Prefetched Data .801</div></div></div><div><div><div></div></div></div><div><div><div>Min_Gnt/Max_Lat Registers .802</div></div></div><div><div><div></div></div></div><div><div><div>Header Type 1. .802</div></div></div><div><div><div></div></div></div><div><div><div>General. . . 802</div></div></div><div><div><div></div></div></div><div><div><div>Header Type 1 Registers Compatible With PCI . . 803</div></div></div><div><div><div></div></div></div><div><div><div>Header Type 1 Registers Incompatible With PCI . ... 804</div></div></div><div><div><div></div></div></div><div><div><div>Terminology. . . 805</div></div></div><div><div><div></div></div></div><div><div><div>Bus Number Registers. 8.805</div></div></div><div><div><div></div></div></div><div><div><div>Introduction. ... 805</div></div></div><div><div><div></div></div></div><div><div><div>Primary Bus Number Register. 8.806</div></div></div><div><div><div></div></div></div><div><div><div>Secondary Bus Number Register.. .806</div></div></div><div><div><div></div></div></div><div><div><div>Subordinate Bus Number Register. ..807</div></div></div><div><div><div></div></div></div><div><div><div>Bridge Routes ID Addressed Packets Using Bus Number</div></div></div><div><div><div></div></div></div><div><div><div>Registers. ..807</div></div></div><div><div><div></div></div></div><div><div><div>Vendor ID Register . . . 808</div></div></div><div><div><div></div></div></div><div><div><div>Device ID Register . . . 808</div></div></div><div><div><div></div></div></div><div><div><div>Revision ID Register. . . 808</div></div></div><div><div><div></div></div></div><div><div><div>Class Code Register . ... 808</div></div></div><div><div><div></div></div></div><div><div><div>Header Type Register. . . 808</div></div></div><div><div><div></div></div></div><div><div><div>BIST Register. . . 809</div></div></div><div><div><div></div></div></div><div><div><div>Capabilities Pointer Register. ... 809</div></div></div><div><div><div></div></div></div><div><div><div>Basic Transaction Filtering Mechanism. . . 809</div></div></div><div><div><div></div></div></div><div><div><div>Bridge's Memory, Register Set and Device ROM . . 810</div></div></div><div><div><div></div></div></div><div><div><div>Introduction. ..810</div></div></div><div><div><div></div></div></div><div><div><div>Base Address Registers . . . 811</div></div></div><div><div><div></div></div></div><div><div><div>Expansion ROM Base Address Register. ..811</div></div></div><div><div><div></div></div></div><div><div><div>Bridge's IO Filter. . . 811</div></div></div><div><div><div></div></div></div><div><div><div>Introduction. . . 811</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="36" id="mark-5f3912fc-d59d-4957-ae96-70d0e630c785" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Bridge Doesn’t Support Any IO Space Behind Bridge. ..812</div></div></div><div><div><div></div></div></div><div><div><div>Bridge Supports 64KB IO Space Behind Bridge . . 813</div></div></div><div><div><div></div></div></div><div><div><div>Bridge Supports 4GB IO Space Behind Bridge. . . 817</div></div></div><div><div><div></div></div></div><div><div><div>Bridge's Prefetchable Memory Filter ..819</div></div></div><div><div><div></div></div></div><div><div><div>An Important Note From the Authors .819</div></div></div><div><div><div></div></div></div><div><div><div>In PCI. . 820</div></div></div><div><div><div></div></div></div><div><div><div>In PCI Express . . . 821</div></div></div><div><div><div></div></div></div><div><div><div>Spec References To Prefetchable Memory. . . 822</div></div></div><div><div><div></div></div></div><div><div><div>Characteristics of Prefetchable Memory Devices. ..823</div></div></div><div><div><div></div></div></div><div><div><div>Multiple Reads Yield the Same Data . . . 823</div></div></div><div><div><div></div></div></div><div><div><div>Byte Merging Permitted In the Posted Write Buffer .823</div></div></div><div><div><div></div></div></div><div><div><div>Characteristics of Memory-Mapped IO Devices. . . 823</div></div></div><div><div><div></div></div></div><div><div><div>Read Characteristics. .824</div></div></div><div><div><div></div></div></div><div><div><div>Write Characteristics. . . 824</div></div></div><div><div><div></div></div></div><div><div><div>Determining If Memory Is Prefetchable or Not . .824</div></div></div><div><div><div></div></div></div><div><div><div>Bridge Support For Downstream Prefetchable Memory Is Optional . . 825</div></div></div><div><div><div></div></div></div><div><div><div>Must Support &gt; 4GB Prefetchable Memory On Secondary Side .825</div></div></div><div><div><div></div></div></div><div><div><div>Rules for Bridge Prefetchable Memory Accesses. . . 829</div></div></div><div><div><div></div></div></div><div><div><div>Bridge's Memory-Mapped IO Filter. . 830</div></div></div><div><div><div></div></div></div><div><div><div>Bridge Command Registers. ..832</div></div></div><div><div><div></div></div></div><div><div><div>Introduction. . 832</div></div></div><div><div><div></div></div></div><div><div><div>Bridge Command Register .832</div></div></div><div><div><div></div></div></div><div><div><div>Bridge Control Register .835</div></div></div><div><div><div></div></div></div><div><div><div>Bridge Status Registers. .837</div></div></div><div><div><div></div></div></div><div><div><div>Introduction. .837</div></div></div><div><div><div></div></div></div><div><div><div>Bridge Status Register (Primary Bus). .837</div></div></div><div><div><div></div></div></div><div><div><div>Bridge Secondary Status Register ..840</div></div></div><div><div><div></div></div></div><div><div><div>Bridge Cache Line Size Register . 8.843</div></div></div><div><div><div></div></div></div><div><div><div>Bridge Latency Timer Registers. . . 843</div></div></div><div><div><div></div></div></div><div><div><div>Bridge Latency Timer Register (Primary Bus). . . 843</div></div></div><div><div><div></div></div></div><div><div><div>Bridge Secondary Latency Timer Register. . . 843</div></div></div><div><div><div></div></div></div><div><div><div>Bridge Interrupt-Related Registers. . . 844</div></div></div><div><div><div></div></div></div><div><div><div>Interrupt Line Register. ..844</div></div></div><div><div><div></div></div></div><div><div><div>Interrupt Pin Register. . . 844</div></div></div><div><div><div></div></div></div><div><div><div>PCI-Compatible Capabilities. .. 845</div></div></div><div><div><div></div></div></div><div><div><div>AGP Capability . . 845</div></div></div><div><div><div></div></div></div><div><div><div>AGP Status Register . ..845</div></div></div><div><div><div></div></div></div><div><div><div>AGP Command Register . . . 846</div></div></div><div><div><div></div></div></div><div><div><div>Vital Product Data (VPD) Capability. . . 848</div></div></div><div><div><div></div></div></div><div><div><div>Introduction.. ..848</div></div></div><div><div><div></div></div></div><div><div><div>It's Not Really Vital . 8.849</div></div></div><div><div><div></div></div></div><div><div><div>What Is VPD? 8.849</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="37" id="mark-aaa54b88-30f0-417e-8f4b-ebbe1383dd76" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Where Is the VPD Really Stored? . 8.849</div></div></div><div><div><div></div></div></div><div><div><div>VPD On Cards vs. Embedded PCI Devices . . 849</div></div></div><div><div><div></div></div></div><div><div><div>How Is VPD Accessed?. . . 849</div></div></div><div><div><div></div></div></div><div><div><div>Reading VPD Data. .850</div></div></div><div><div><div></div></div></div><div><div><div>Writing VPD Data. . 850</div></div></div><div><div><div></div></div></div><div><div><div>Rules That Apply To Both Read and Writes . . . 850</div></div></div><div><div><div></div></div></div><div><div><div>VPD Data Structure Made Up of Descriptors and Keywords ..851</div></div></div><div><div><div></div></div></div><div><div><div>VPD Read-Only Descriptor (VPD-R) and Keywords. . 853</div></div></div><div><div><div></div></div></div><div><div><div>Is Read-Only Checksum Keyword Mandatory?. . .855</div></div></div><div><div><div></div></div></div><div><div><div>VPD Read/Write Descriptor (VPD-W) and Keywords . 856</div></div></div><div><div><div></div></div></div><div><div><div>Example VPD List. ..857</div></div></div><div><div><div></div></div></div><div><div><div>Introduction To Chassis/Slot Numbering Registers. . 859</div></div></div><div><div><div></div></div></div><div><div><div>Chassis and Slot Number Assignment . ..861</div></div></div><div><div><div></div></div></div><div><div><div>Problem: Adding/Removing Bridge Causes Buses to Be Renumbered. ..861</div></div></div><div><div><div></div></div></div><div><div><div>If Buses Added/Removed, Slot Labels Must Remain Correct.. ..861</div></div></div><div><div><div></div></div></div><div><div><div>Definition of a Chassis . . . 862</div></div></div><div><div><div></div></div></div><div><div><div>Chassis/Slot Numbering Registers. .863</div></div></div><div><div><div></div></div></div><div><div><div>PCI-Compatible Chassis/Slot Numbering Register Set . 863</div></div></div><div><div><div></div></div></div><div><div><div>Express-Specific Slot-Related Registers.. . . 863</div></div></div><div><div><div></div></div></div><div><div><div>Two Examples. . . 866</div></div></div><div><div><div></div></div></div><div><div><div>First Example.. . . 866</div></div></div><div><div><div></div></div></div><div><div><div>Second Example. ..867</div></div></div><div><div><div></div></div></div><div><div><div>Chapter 23: Expansion ROMs</div></div></div><div><div><div></div></div></div><div><div><div>ROM Purpose-Device Can Be Used In Boot Process. .872</div></div></div><div><div><div></div></div></div><div><div><div>ROM Detection. .872</div></div></div><div><div><div></div></div></div><div><div><div>ROM Shadowing Required .875</div></div></div><div><div><div></div></div></div><div><div><div>ROM Content. .875</div></div></div><div><div><div></div></div></div><div><div><div>Multiple Code Images . . . 875</div></div></div><div><div><div></div></div></div><div><div><div>Format of a Code Image. .878</div></div></div><div><div><div></div></div></div><div><div><div>General . ..878</div></div></div><div><div><div></div></div></div><div><div><div>ROM Header Format. ..879</div></div></div><div><div><div></div></div></div><div><div><div>ROM Data Structure Format . ..881</div></div></div><div><div><div></div></div></div><div><div><div>ROM Signature . . . 883</div></div></div><div><div><div></div></div></div><div><div><div>Vendor ID field in ROM data structure . . . 883</div></div></div><div><div><div></div></div></div><div><div><div>Device ID in ROM data structure. . 883</div></div></div><div><div><div></div></div></div><div><div><div>Pointer to Vital Product Data (VPD). . . 884</div></div></div><div><div><div></div></div></div><div><div><div>PCI Data Structure Length. . . 884</div></div></div><div><div><div></div></div></div><div><div><div>PCI Data Structure Revision . .884</div></div></div><div><div><div></div></div></div><div><div><div>Class Code . . . 884</div></div></div><div><div><div></div></div></div><div><div><div>Image Length. 8.884</div></div></div><div><div><div></div></div></div><div><div><div>Revision Level of Code/Data . . 885</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="38" id="mark-0cf8222a-b65a-480a-807b-8ec14910ae23" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Code Type. . . 885</div></div></div><div><div><div></div></div></div><div><div><div>Indicator Byte. . . 885</div></div></div><div><div><div></div></div></div><div><div><div>Execution of Initialization Code . . 885</div></div></div><div><div><div></div></div></div><div><div><div>Introduction to Open Firmware . . . 888</div></div></div><div><div><div></div></div></div><div><div><div>Introduction. . . 888</div></div></div><div><div><div></div></div></div><div><div><div>Universal Device Driver Format. . . 889</div></div></div><div><div><div></div></div></div><div><div><div>Passing Resource List To Plug-and-Play OS. . . 890</div></div></div><div><div><div></div></div></div><div><div><div>BIOS Calls Bus Enumerators For Different Bus Environments . . 890</div></div></div><div><div><div></div></div></div><div><div><div>BIOS Selects Boot Devices and Finds Drivers For Them . . 891</div></div></div><div><div><div></div></div></div><div><div><div>BIOS Boots Plug-and-Play OS and Passes Pointer To It . ..891</div></div></div><div><div><div></div></div></div><div><div><div>OS Locates and Loads Drivers and Calls Init Code In Each. .. 891</div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 24: Express-Specific Configuration Registers</div></div></h2><div><div><div></div></div></div><div><div><div>Introduction. . . 894</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express Capability Register Set. . . 896</div></div></div><div><div><div></div></div></div><div><div><div>Introduction. . . 896</div></div></div><div><div><div></div></div></div><div><div><div>Required Registers. .897</div></div></div><div><div><div></div></div></div><div><div><div>General . ..897</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express Capability ID Register ...898</div></div></div><div><div><div></div></div></div><div><div><div>Next Capability Pointer Register.. .898</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express Capabilities Register . . 898</div></div></div><div><div><div></div></div></div><div><div><div>Device Capabilities Register . . 900</div></div></div><div><div><div></div></div></div><div><div><div>Device Control Register .005</div></div></div><div><div><div></div></div></div><div><div><div>Device Status Register. ... 909</div></div></div><div><div><div></div></div></div><div><div><div>Link Registers (Required). ..912</div></div></div><div><div><div></div></div></div><div><div><div>Link Capabilities Register .912</div></div></div><div><div><div></div></div></div><div><div><div>Link Control Register. ..915</div></div></div><div><div><div></div></div></div><div><div><div>Link Status Register.. ..918</div></div></div><div><div><div></div></div></div><div><div><div>Slot Registers.. . . 920</div></div></div><div><div><div></div></div></div><div><div><div>Introduction. . . 920</div></div></div><div><div><div></div></div></div><div><div><div>Slot Capabilities Register . . . 920</div></div></div><div><div><div></div></div></div><div><div><div>Slot Control Register . .923</div></div></div><div><div><div></div></div></div><div><div><div>Slot Status Register. . .925</div></div></div><div><div><div></div></div></div><div><div><div>Root Port Registers . .. 926</div></div></div><div><div><div></div></div></div><div><div><div>Introduction. . . 926</div></div></div><div><div><div></div></div></div><div><div><div>Root Control Register. . .926</div></div></div><div><div><div></div></div></div><div><div><div>Root Status Register.. . 928</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express Extended Capabilities . . 929</div></div></div><div><div><div></div></div></div><div><div><div>General.. ..929</div></div></div><div><div><div></div></div></div><div><div><div>Advanced Error Reporting Capability. ..930</div></div></div><div><div><div></div></div></div><div><div><div>General . ..930</div></div></div><div><div><div></div></div></div><div><div><div>Detailed Description. . . 930</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="39" id="mark-226c8137-a8ef-4a71-bb2e-1980f86f7c2b" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Virtual Channel Capability. . 939</div></div></div><div><div><div></div></div></div><div><div><div>The VC Register Set's Purpose. .939</div></div></div><div><div><div></div></div></div><div><div><div>Who Must Implement This Register Set?. ..940</div></div></div><div><div><div></div></div></div><div><div><div>Multifunction Upstream Port Restriction. . . 940</div></div></div><div><div><div></div></div></div><div><div><div>The Register Set.. . .940</div></div></div><div><div><div></div></div></div><div><div><div>Detailed Description of VCs. . . 940</div></div></div><div><div><div></div></div></div><div><div><div>Port VC Capability Register 1 ..941</div></div></div><div><div><div></div></div></div><div><div><div>Port VC Capability Register 2 . . 943</div></div></div><div><div><div></div></div></div><div><div><div>Port VC Control Register ..944</div></div></div><div><div><div></div></div></div><div><div><div>Port VC Status Register. ..945</div></div></div><div><div><div></div></div></div><div><div><div>VC Resource Registers. . 946</div></div></div><div><div><div></div></div></div><div><div><div>General. . .946</div></div></div><div><div><div></div></div></div><div><div><div>VC Resource Capability Register . 9.946</div></div></div><div><div><div></div></div></div><div><div><div>VC Resource Control Register. . 948</div></div></div><div><div><div></div></div></div><div><div><div>VC Resource Status Register. . 950</div></div></div><div><div><div></div></div></div><div><div><div>VC Arbitration Table. ..951</div></div></div><div><div><div></div></div></div><div><div><div>Port Arbitration Tables . ..952</div></div></div><div><div><div></div></div></div><div><div><div>Device Serial Number Capability . 952</div></div></div><div><div><div></div></div></div><div><div><div>Power Budgeting Capability . 954</div></div></div><div><div><div></div></div></div><div><div><div>General . . 954</div></div></div><div><div><div></div></div></div><div><div><div>How It Works. . 955</div></div></div><div><div><div></div></div></div><div><div><div>RCRB . 0.957</div></div></div><div><div><div></div></div></div><div><div><div>General. ..957</div></div></div><div><div><div></div></div></div><div><div><div>Firmware Gives OS Base Address of Each RCRB .957</div></div></div><div><div><div></div></div></div><div><div><div>Misaligned or Locked Accesses To an RCRB. .057</div></div></div><div><div><div></div></div></div><div><div><div>Extended Capabilities in an RCRB. .957</div></div></div><div><div><div></div></div></div><div><div><div>The RCRB Missing Link. . 958</div></div></div><div><div><div></div></div></div><h2><div><div>Appendices</div></div></h2><div><div><div></div></div></div><div><div><div>Appendix A: Test,Debug and Verification of PCI Express <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="97" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c4D"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mrow data-mjx-texclass="ORD"></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">TM</mi></mrow></mrow></mrow></msup></math></mjx-assistive-mml></mjx-container> Designs . . 961 Appendix B: Markets &amp;Applications for the PCI Express <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="98" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c4D"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mrow data-mjx-texclass="ORD"></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">TM</mi></mrow></mrow></mrow></msup></math></mjx-assistive-mml></mjx-container> Architecture . . 989 Appendix C: Implementing Intelligent Adapters and Multi-Host Systems With</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="99" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c4D"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mrow data-mjx-texclass="ORD"></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">TM</mi></mrow></mrow></mrow></msup></math></mjx-assistive-mml></mjx-container> Technology. ..999</div></div></div><div><div><div></div></div></div><div><div><div>Appendix D: Class Codes. .1019</div></div></div><div><div><div></div></div></div><div><div><div>Appendix E: Locked Transactions Series .1033</div></div></div><div><div><div></div></div></div><hr><div><div><div></div></div></div><div><!-- Footnote --></div><div><div><div></div></div></div><div><div><div>Index. .. 1043</div></div></div><div><div><div></div></div></div><div><!-- Footnote --></div><div><div><div></div></div></div><hr><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="40" id="mark-e803d138-a934-43d6-92ab-1982f00f47be" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>1-1 Comparison of Performance Per Pin for Various Buses ..15</div></div></div><div><div><div></div></div></div><div><div><div>33 MHz PCI Bus Based Platform . ..17</div></div></div><div><div><div></div></div></div><div><div><div>1-3 Typical PCI Burst Memory Read Bus Cycle ..18</div></div></div><div><div><div></div></div></div><div><div><div>1-4 33 MHz PCI Based System Showing Implementation of a PCI-to-PCI Bridge. ..19</div></div></div><div><div><div></div></div></div><div><div><div>1-5 PCI Transaction Model. ..20</div></div></div><div><div><div></div></div></div><div><div><div>1-6 PCI Bus Arbitration. ..22</div></div></div><div><div><div></div></div></div><div><div><div>1-7 PCI Transaction Retry Mechanism. ..23</div></div></div><div><div><div></div></div></div><div><div><div>1-8 PCI Transaction Disconnect Mechanism ...24</div></div></div><div><div><div></div></div></div><div><div><div>1-9 PCI Interrupt Handling.. ..26</div></div></div><div><div><div></div></div></div><div><div><div>1-10 PCI Error Handling Protocol. ..27</div></div></div><div><div><div></div></div></div><div><div><div>1-11 Address Space Mapping. ..28</div></div></div><div><div><div></div></div></div><div><div><div>1-12 PCI Configuration Cycle Generation. ..29</div></div></div><div><div><div></div></div></div><div><div><div>1-13 256 Byte PCI Function Configuration Register Space. ..30</div></div></div><div><div><div></div></div></div><div><div><div>1-14 Latest Generation of PCI Chipsets. ..32</div></div></div><div><div><div></div></div></div><div><div><div>1-15 66 MHz PCI Bus Based Platform. ..33</div></div></div><div><div><div></div></div></div><div><div><div>1-16 66 MHz/133 MHz PCI-X Bus Based Platform.. ..36</div></div></div><div><div><div></div></div></div><div><div><div>1-17 Example PCI-X Burst Memory Read Bus Cycle ..37</div></div></div><div><div><div></div></div></div><div><div><div>1-18 PCI-X Split Transaction Protocol .. ..38</div></div></div><div><div><div></div></div></div><div><div><div>1-19 Hypothetical PCI-X 2.0 Bus Based Platform ..40</div></div></div><div><div><div></div></div></div><div><div><div>1-20 PCI Express Link. ..41</div></div></div><div><div><div></div></div></div><div><div><div>1-21 PCI Express Differential Signal.. ..42</div></div></div><div><div><div></div></div></div><div><div><div>1-22 PCI Express Topology. ..48</div></div></div><div><div><div></div></div></div><div><div><div>1-23 Low Cost PCI Express System. ..52</div></div></div><div><div><div></div></div></div><div><div><div>1-24 Another Low Cost PCI Express System ..53</div></div></div><div><div><div></div></div></div><div><div><div>1-25 PCI Express High-End Server System .. ..54</div></div></div><div><div><div></div></div></div><div><div><div>2-1 Non-Posted Read Transaction Protocol. ..59</div></div></div><div><div><div></div></div></div><div><div><div>2-2 Non-Posted Locked Read Transaction Protocol. ...60</div></div></div><div><div><div></div></div></div><div><div><div>2-3 Non-Posted Write Transaction Protocol.. ...61</div></div></div><div><div><div></div></div></div><div><div><div>2-4 Posted Memory Write Transaction Protocol. ...63</div></div></div><div><div><div></div></div></div><div><div><div>2-5 Posted Message Transaction Protocol.. ...64</div></div></div><div><div><div></div></div></div><div><div><div>2-6 Non-Posted Memory Read Originated by CPU and Targeting an Endpoint . ..65</div></div></div><div><div><div></div></div></div><div><div><div>2-7 Non-Posted Memory Read Originated by Endpoint and Targeting Memory ...67</div></div></div><div><div><div></div></div></div><div><div><div>2-8 IO Write Transaction Originated by CPU, Targeting Legacy Endpoint. ...68</div></div></div><div><div><div></div></div></div><div><div><div>2-9 Memory Write Transaction Originated by CPU, Targeting Endpoint. ...69</div></div></div><div><div><div></div></div></div><div><div><div>2-10 PCI Express Device Layers . ..70</div></div></div><div><div><div></div></div></div><div><div><div>2-11 TLP Origin and Destination. ...72</div></div></div><div><div><div></div></div></div><div><div><div>2-12 TLP Assembly.. ...73</div></div></div><div><div><div></div></div></div><div><div><div>2-13 TLP Disassembly. ...74</div></div></div><div><div><div></div></div></div><div><div><div>2-14 DLLP Origin and Destination. ...75</div></div></div><div><div><div></div></div></div><div><div><div>2-15 DLLP Assembly ...76</div></div></div><div><div><div></div></div></div><div><div><div>2-16 DLLP Disassembly. ...76</div></div></div><div><div><div></div></div></div><div><div><div>2-17 PLP Origin and Destination. ...77</div></div></div><div><div><div></div></div></div><div><div><div>2-18 PLP or Ordered-Set Structure . ...78</div></div></div><div><div><div></div></div></div><div><div><div>2-19 Detailed Block Diagram of PCI Express Device's Layers . ...79</div></div></div><div><div><div></div></div></div><div><div><div>2-20 TLP Structure at the Transaction Layer. ..80</div></div></div><div><div><div></div></div></div><div><div><div>2-21 Flow Control Process.. ...82</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="41" id="mark-5ea843ee-06c0-49c3-abbd-60751429500a" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>2-22 Example Showing QoS Capability of PCI Express . ...83</div></div></div><div><div><div></div></div></div><div><div><div>2-23 TC Numbers and VC Buffers. ...85</div></div></div><div><div><div></div></div></div><div><div><div>2-24 Switch Implements Port Arbitration and VC Arbitration Logic. ...86</div></div></div><div><div><div></div></div></div><div><div><div>-25 Data Link Layer Replay Mechanism. ...88</div></div></div><div><div><div></div></div></div><div><div><div>2-26 TLP and DLLP Structure at the Data Link Layer ...90</div></div></div><div><div><div></div></div></div><div><div><div>2-27 Non-Posted Transaction on Link. ...91</div></div></div><div><div><div></div></div></div><div><div><div>2-28 Posted Transaction on Link. ...92</div></div></div><div><div><div></div></div></div><div><div><div>2-29 TLP and DLLP Structure at the Physical Layer. ...94</div></div></div><div><div><div></div></div></div><div><div><div>2-30 Electrical Physical Layer Showing Differential Transmitter and Receiver ...96</div></div></div><div><div><div></div></div></div><div><div><div>2-31 Memory Read Request Phase.. ...97</div></div></div><div><div><div></div></div></div><div><div><div>2-32 Completion with Data Phase.. ...99</div></div></div><div><div><div></div></div></div><div><div><div>3-1 Multi-Port PCI Express Devices Have Routing Responsibilities . ..106</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express Link Local Traffic: Ordered Sets. ..110</div></div></div><div><div><div></div></div></div><div><div><div>3-3 PCI Express Link Local Traffic: DLLPs.. ..112</div></div></div><div><div><div></div></div></div><div><div><div>3-4 PCI Express Transaction Request And Completion TLPs ..115</div></div></div><div><div><div></div></div></div><div><div><div>5 Transaction Layer Packet Generic 3DW And 4DW Headers . ..119</div></div></div><div><div><div></div></div></div><div><div><div>6 Generic System Memory And IO Address Maps. ..122</div></div></div><div><div><div></div></div></div><div><div><div>3-7 3DW TLP Header Address Routing Fields . ..123</div></div></div><div><div><div></div></div></div><div><div><div>3-8 4DW TLP Header Address Routing Fields . ...124</div></div></div><div><div><div></div></div></div><div><div><div>3-9 Endpoint Checks Routing Of An Inbound TLP Using Address Routing. ..125</div></div></div><div><div><div></div></div></div><div><div><div>3-10 Switch Checks Routing Of An Inbound TLP Using Address Routing. ..126</div></div></div><div><div><div></div></div></div><div><div><div>3-11 3DW TLP Header ID Routing Fields.. ..128</div></div></div><div><div><div></div></div></div><div><div><div>3-12 4DW TLP Header ID Routing Fields. ..129</div></div></div><div><div><div></div></div></div><div><div><div>3-13 Switch Checks Routing Of An Inbound TLP Using ID Routing. ..131</div></div></div><div><div><div></div></div></div><div><div><div>3-14 4DW Message TLP Header Implicit Routing Fields. ..133</div></div></div><div><div><div></div></div></div><div><div><div>3-15 PCI Express Devices And Type 0 And Type 1 Header Use. ..136</div></div></div><div><div><div></div></div></div><div><div><div>3-16 PCI Express Configuration Space Type 0 and Type 1 Headers ..137</div></div></div><div><div><div></div></div></div><div><div><div>3-17 32-Bit Prefetchable Memory BAR Set Up. ..139</div></div></div><div><div><div></div></div></div><div><div><div>3-18 64-Bit Prefetchable Memory BAR Set Up. ..141</div></div></div><div><div><div></div></div></div><div><div><div>3-19 IO BAR Set Up. ..143</div></div></div><div><div><div></div></div></div><div><div><div>-20 6GB, 64-Bit Prefetchable Memory Base/Limit Register Set Up ..145</div></div></div><div><div><div></div></div></div><div><div><div>-21 2MB, 32-Bit Non-Prefetchable Base/Limit Register Set Up. ...147</div></div></div><div><div><div></div></div></div><div><div><div>3-22 IO Base/Limit Register Set Up.. ..149</div></div></div><div><div><div></div></div></div><div><div><div>3-23 Bus Number Registers In A Switch.. ..152</div></div></div><div><div><div></div></div></div><div><div><div>TLP And DLLP Packets.. ..155</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express Layered Protocol And TLP Assembly/Disassembly ..158</div></div></div><div><div><div></div></div></div><div><div><div>Generic TLP Header Fields.. ..162</div></div></div><div><div><div></div></div></div><div><div><div>Using First DW and Last DW Byte Enable Fields. ..168</div></div></div><div><div><div></div></div></div><div><div><div>Transaction Descriptor Fields . ..169</div></div></div><div><div><div></div></div></div><div><div><div>4-6 System IO Map. ..171</div></div></div><div><div><div></div></div></div><div><div><div>4-7 3DW IO Request Header Format.. ..172</div></div></div><div><div><div></div></div></div><div><div><div>4-8 3DW And 4DW Memory Request Header Formats ..175</div></div></div><div><div><div></div></div></div><div><div><div>4-9 3DW Configuration Request And Header Format . ..180</div></div></div><div><div><div></div></div></div><div><div><div>4-10 3DW Completion Header Format . ..184</div></div></div><div><div><div></div></div></div><div><div><div>4-11 4DW Message Request Header Format. ..190</div></div></div><div><div><div></div></div></div><div><div><div>4-12 Data Link Layer Sends A DLLP.. ..198</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="42" id="mark-68478cc5-4eae-4183-9b36-acf242cf442c" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>4-13 Generic Data Link Layer Packet Format.. ...200</div></div></div><div><div><div></div></div></div><div><div><div>4-14 Ack Or Nak DLLP Packet Format. ...202</div></div></div><div><div><div></div></div></div><div><div><div>4-15 Power Management DLLP Packet Format. ...204</div></div></div><div><div><div></div></div></div><div><div><div>4-16 Flow Control DLLP Packet Format . ...205</div></div></div><div><div><div></div></div></div><div><div><div>4-17 Vendor Specific DLLP Packet Format.. ..207</div></div></div><div><div><div></div></div></div><div><div><div>5-1 Data Link Layer.. ..210</div></div></div><div><div><div></div></div></div><div><div><div>5-2 Overview of the ACK/NAK Protocol ..211</div></div></div><div><div><div></div></div></div><div><div><div>5-3 Elements of the ACK/NAK Protocol.. ...212</div></div></div><div><div><div></div></div></div><div><div><div>5-4 Transmitter Elements Associated with the ACK/NAK Protocol . ...215</div></div></div><div><div><div></div></div></div><div><div><div>5-5 Receiver Elements Associated with the ACK/NAK Protocol. ..218</div></div></div><div><div><div></div></div></div><div><div><div>5-6 Ack Or Nak DLLP Packet Format. ..219</div></div></div><div><div><div></div></div></div><div><div><div>5-7 Example 1 that Shows Transmitter Behavior with Receipt of an ACK DLLP. ..223</div></div></div><div><div><div></div></div></div><div><div><div>5-8 Example 2 that Shows Transmitter Behavior with Receipt of an ACK DLLP . ...224</div></div></div><div><div><div></div></div></div><div><div><div>5-9 Example that Shows Transmitter Behavior on Receipt of a NAK DLLP. ..226</div></div></div><div><div><div></div></div></div><div><div><div>5-10 Table and Equation to Calculate REPLAY_TIMER Load Value.. ...229</div></div></div><div><div><div></div></div></div><div><div><div>5-11 Example that Shows Receiver Behavior with Receipt of Good TLP ..233</div></div></div><div><div><div></div></div></div><div><div><div>5-12 Example that Shows Receiver Behavior When It Receives Bad TLPs. ..237</div></div></div><div><div><div></div></div></div><div><div><div>5-13 Table to Calculate ACKNAK_LATENCY_TIMER Load Value. ...239</div></div></div><div><div><div></div></div></div><div><div><div>5-14 Lost TLP Handling.. ...245</div></div></div><div><div><div></div></div></div><div><div><div>5-15 Lost ACK DLLP Handling. ...246</div></div></div><div><div><div></div></div></div><div><div><div>5-16 Lost ACK DLLP Handling.. ...247</div></div></div><div><div><div></div></div></div><div><div><div>5-17 Switch Cut-Through Mode Showing Error Handling. ..250</div></div></div><div><div><div></div></div></div><div><div><div>6-1 Example Application of Isochronous Transaction.. ..254</div></div></div><div><div><div></div></div></div><div><div><div>6-2 VC Configuration Registers Mapped in Extended Configuration Address Space. ..257</div></div></div><div><div><div></div></div></div><div><div><div>6-3 The Number of VCs Supported by Device Can Vary. ...259</div></div></div><div><div><div></div></div></div><div><div><div>6-4 Extended VCs Supported Field ...260</div></div></div><div><div><div></div></div></div><div><div><div>6-5 VC Resource Control Register.. ...261</div></div></div><div><div><div></div></div></div><div><div><div>6-6 TC to VC Mapping Example ... ...262</div></div></div><div><div><div></div></div></div><div><div><div>6-7 Conceptual VC Arbitration Example. ..265</div></div></div><div><div><div></div></div></div><div><div><div>6-8 Strict Arbitration Priority....... ..266</div></div></div><div><div><div></div></div></div><div><div><div>6-9 Low Priority Extended VC Count. ..267</div></div></div><div><div><div></div></div></div><div><div><div>6-10 Determining VC Arbitration Capabilities and Selecting the Scheme ...268</div></div></div><div><div><div></div></div></div><div><div><div>6-11 VC Arbitration with Low- and High-Priority Implementations . ...269</div></div></div><div><div><div></div></div></div><div><div><div>6-12 Weighted Round Robin Low-Priority VC Arbitration Table Example. ..270</div></div></div><div><div><div></div></div></div><div><div><div>-13 VC Arbitration Table Offset and Load VC Arbitration Table Fields . ..271</div></div></div><div><div><div></div></div></div><div><div><div>Loading the VC Arbitration Table Entries . ..272</div></div></div><div><div><div></div></div></div><div><div><div>6-15 15 Example Multi-Function Endpoint Implementation with VC Arbitration ...274</div></div></div><div><div><div></div></div></div><div><div><div>6-16 Port Arbitration Concept . ...275</div></div></div><div><div><div></div></div></div><div><div><div>6-17 Port Arbitration Tables Needed for nEach VC. ..276</div></div></div><div><div><div></div></div></div><div><div><div>6-18 Port Arbitration Buffering . ..277</div></div></div><div><div><div></div></div></div><div><div><div>6-19 Software checks Port Arbitration Capabilities and Selects the Scheme to be Used. ..278</div></div></div><div><div><div></div></div></div><div><div><div>6-20 Maximum Time Slots Register.. ..280</div></div></div><div><div><div></div></div></div><div><div><div>6-21 Format of Port Arbitration Table. ...281</div></div></div><div><div><div></div></div></div><div><div><div>6-22 Example of Port and VC Arbitration within A Switch. ..283</div></div></div><div><div><div></div></div></div><div><div><div>7-1 Location of Flow Control Logic. ...287</div></div></div><div><div><div></div></div></div><div><div><div>7-2 Flow Control Buffer Organization. ..289</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="43" id="mark-477cbff9-f7c7-427d-936f-fca767a740a2" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>7-3 Flow Control Elements. ...292</div></div></div><div><div><div></div></div></div><div><div><div>7-4 Types and Format of Flow Control Packets. ...293</div></div></div><div><div><div></div></div></div><div><div><div>-5 Flow Control Elements Following Initialization ...295</div></div></div><div><div><div></div></div></div><div><div><div>7-6 Flow Control Elements Following Delivery of First Transaction. ..297</div></div></div><div><div><div></div></div></div><div><div><div>7-7 Flow Control Elements with Flow Control Buffer Filled. ..299</div></div></div><div><div><div></div></div></div><div><div><div>7-8 Flow Control Rollover Problem.. ..300</div></div></div><div><div><div></div></div></div><div><div><div>7-9 Initial State of Example FC Elements. ..304</div></div></div><div><div><div></div></div></div><div><div><div>7-10 INIT1 Flow Control Packet Format and Contents ..305</div></div></div><div><div><div></div></div></div><div><div><div>7-11 Devices Send and Initialize Flow Control Registers. ..306</div></div></div><div><div><div></div></div></div><div><div><div>7-12 Device Confirm that Flow Control Initialization is Completed for a Given Buffer. .307</div></div></div><div><div><div></div></div></div><div><div><div>7-13 Flow Control Update Example . ..309</div></div></div><div><div><div></div></div></div><div><div><div>7-14 Update Flow Control Packet Format and Contents. ..310</div></div></div><div><div><div></div></div></div><div><div><div>8-1 Example of Strongly Ordered Transactions that Results in Temporary Blocking . ...323</div></div></div><div><div><div></div></div></div><div><div><div>-1 Native PCI Express and Legacy PCI Interrupt Delivery. ..331</div></div></div><div><div><div></div></div></div><div><div><div>9-2 64-bit MSI Capability Register Format . ..332</div></div></div><div><div><div></div></div></div><div><div><div>9-3 32-bit MSI Capability Register Set Format ..332</div></div></div><div><div><div></div></div></div><div><div><div>9-4 Message Control Register. ..333</div></div></div><div><div><div></div></div></div><div><div><div>Device MSI Configuration Process. ..337</div></div></div><div><div><div></div></div></div><div><div><div>Format of Memory Write Transaction for Native-Deive MSI Delivery. ...339</div></div></div><div><div><div></div></div></div><div><div><div>9-7 Interrupt Pin Register within PCI Configuration Header ..343</div></div></div><div><div><div></div></div></div><div><div><div>9-8 INTx Signal Routing is Platform Specific ..344</div></div></div><div><div><div></div></div></div><div><div><div>9-9 Configuration Command Register - Interrupt Disable Field. ..346</div></div></div><div><div><div></div></div></div><div><div><div>-10 Configuration Status Register - Interrupt Status Field . .347</div></div></div><div><div><div></div></div></div><div><div><div>9-11 Legacy Devices Use INTx Messages Virtualize INTA#-INTD# Signal Transitions . ..348</div></div></div><div><div><div></div></div></div><div><div><div>9-12 Switch Collapses INTx Message to Achieve Wired-OR Characteristics. ..350</div></div></div><div><div><div></div></div></div><div><div><div>9-13 INTx Message Format and Types. ..351</div></div></div><div><div><div></div></div></div><div><div><div>4 PCI Express System with PCI-Based IO Controller Hub. ...354</div></div></div><div><div><div></div></div></div><div><div><div>0-1 The Scope of PCI Express Error Checking and Reporting. ..357</div></div></div><div><div><div></div></div></div><div><div><div>10-2 Location of PCI Express Error-Related Configuration Registers ..360</div></div></div><div><div><div></div></div></div><div><div><div>-3 The Error/Poisoned Bit within Packet Headers. ..362</div></div></div><div><div><div></div></div></div><div><div><div>10-4 Basic Format of the Error Messages . .370</div></div></div><div><div><div></div></div></div><div><div><div>5 Completion Status Field within the Completion Header ...371</div></div></div><div><div><div></div></div></div><div><div><div>0-6 PCI-Compatible Configuration Command Register . ..373</div></div></div><div><div><div></div></div></div><div><div><div>PCI-Compatible Status Register (Error-Related Bits). ..374</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="100" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c38"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mo>−</mo><mn>8</mn></math></mjx-assistive-mml></mjx-container> PCI Express Capability Register Set.. ..376</div></div></div><div><div><div></div></div></div><div><div><div>Device Control Register Bit Fields Related to Error Handling ..378</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="101" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow></math></mjx-assistive-mml></mjx-container> Device Status Register Bit Fields Related to Error Handling ..379</div></div></div><div><div><div></div></div></div><div><div><div>Link Control Register Allows Retraining of Link . ..380</div></div></div><div><div><div></div></div></div><div><div><div>2 Link Retraining Status Bits within the Link Status Register. ..380</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="102" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>13</mn></mrow></math></mjx-assistive-mml></mjx-container> Root Control Register . ..381</div></div></div><div><div><div></div></div></div><div><div><div>Advanced Error Capability Registers. ..382</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="103" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>15</mn></mrow></math></mjx-assistive-mml></mjx-container> The Advanced Error Capability &amp; Control Register . ..383</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="104" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>16</mn></mrow></math></mjx-assistive-mml></mjx-container> Advanced Correctable Error Status Register. ..385</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="105" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c37"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>17</mn></mrow></math></mjx-assistive-mml></mjx-container> Advanced Correctable Error Mask Register .. ..386</div></div></div><div><div><div></div></div></div><div><div><div>10-18 Advanced Uncorrectable Error Status Register.. ..387</div></div></div><div><div><div></div></div></div><div><div><div>10-19 Advanced Uncorrectable Error Severity Register. ..388</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="44" id="mark-b1ec4f5e-6a25-4fdb-99b8-32804f6631e0" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>10-20 Advanced Uncorrectable Error Mask Register. ...389</div></div></div><div><div><div></div></div></div><div><div><div>10-21 Root Error Status Register . ..391</div></div></div><div><div><div></div></div></div><div><div><div>10-22 Advanced Source ID Register ...391</div></div></div><div><div><div></div></div></div><div><div><div>10-23 Advanced Root Error Command Register. ..392</div></div></div><div><div><div></div></div></div><div><div><div>10-24 Error Handling Flow Chart. ..393</div></div></div><div><div><div></div></div></div><div><div><div>11-1 Physical Layer. ..398</div></div></div><div><div><div></div></div></div><div><div><div>11-2 Logical and Electrical Sub-Blocks of the Physical Layer. ...399</div></div></div><div><div><div></div></div></div><div><div><div>11-3 Physical Layer Details . ..401</div></div></div><div><div><div></div></div></div><div><div><div>11-4 Physical Layer Transmit Logic Details ..406</div></div></div><div><div><div></div></div></div><div><div><div>11-5 Transmit Logic Multiplexer. ..407</div></div></div><div><div><div></div></div></div><div><div><div>11-6 TLP and DLLP Packet Framing with Start and End Control Characters ..408</div></div></div><div><div><div></div></div></div><div><div><div>11-7 x1 Byte Striping . ..409</div></div></div><div><div><div></div></div></div><div><div><div>11-8 x4 Byte Striping . ..410</div></div></div><div><div><div></div></div></div><div><div><div>11-9 x8, x12, x16, x32 Byte Striping. ..411</div></div></div><div><div><div></div></div></div><div><div><div>11-10 x1 Packet Format. ..413</div></div></div><div><div><div></div></div></div><div><div><div>11-11 x4 Packet Format. ..414</div></div></div><div><div><div></div></div></div><div><div><div>11-12 x8 Packet Format. ..415</div></div></div><div><div><div></div></div></div><div><div><div>11-13 Scrambler.. ..418</div></div></div><div><div><div></div></div></div><div><div><div>11-14 Example of 8-bit Character of 00h Encoded to 10-bit Symbol.. ..420</div></div></div><div><div><div></div></div></div><div><div><div>11-15 Preparing 8-bit Character for Encode . ..422</div></div></div><div><div><div></div></div></div><div><div><div>11-16 8-bit to 10-bit (8b/10b) Encoder. ..425</div></div></div><div><div><div></div></div></div><div><div><div>11-17 Example 8-bit/10-bit Encodings. ..426</div></div></div><div><div><div></div></div></div><div><div><div>11-18 Example 8-bit/10-bit Transmission ..427</div></div></div><div><div><div></div></div></div><div><div><div>11-19 SKIP Ordered-Set. ..437</div></div></div><div><div><div></div></div></div><div><div><div>11-20 Physical Layer Receive Logic Details. ..438</div></div></div><div><div><div></div></div></div><div><div><div>11-21 Receiver Logic's Front End Per Lane . ..439</div></div></div><div><div><div></div></div></div><div><div><div>11-22 Receiver's Link De-Skew Logic. ..445</div></div></div><div><div><div></div></div></div><div><div><div>11-23 8b/10b Decoder per Lane . ..447</div></div></div><div><div><div></div></div></div><div><div><div>11-24 Example of Delayed Disparity Error Detection. ..448</div></div></div><div><div><div></div></div></div><div><div><div>11-25 Example of x8 Byte Un-Striping . ..449</div></div></div><div><div><div></div></div></div><div><div><div>12-1 Electrical Sub-Block of the Physical Layer ..454</div></div></div><div><div><div></div></div></div><div><div><div>12-2 Differential Transmitter/Receiver... ..455</div></div></div><div><div><div></div></div></div><div><div><div>12-3 Receiver DC Common Mode Voltage Requirement. ..458</div></div></div><div><div><div></div></div></div><div><div><div>12-4 Receiver Detection Mechanism.. ..460</div></div></div><div><div><div></div></div></div><div><div><div>12-5 Pictorial Representation of Differential Peak-to-Peak and Differential Peak Voltages.. 463</div></div></div><div><div><div></div></div></div><div><div><div>12-6 Electrical Idle Ordered-Set.. ..464</div></div></div><div><div><div></div></div></div><div><div><div>12-7 Transmission with De-emphasis .. ..467</div></div></div><div><div><div></div></div></div><div><div><div>12-8 Problem of Inter-Symbol Interference . ..468</div></div></div><div><div><div></div></div></div><div><div><div>12-9 Solution is Pre-emphasis.. ..468</div></div></div><div><div><div></div></div></div><div><div><div>12-10 LVDS (Low-Voltage Differential Signal) Transmitter Eye Diagram. ..472</div></div></div><div><div><div></div></div></div><div><div><div>12-11 Transmitter Eye Diagram Jitter Indication. ..473</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="106" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>12</mn></mrow><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>12</mn></mrow></math></mjx-assistive-mml></mjx-container> 2 Transmitter Eye Diagram Noise/Attenuation Indication ..474</div></div></div><div><div><div></div></div></div><div><div><div>12-13 Screen Capture of a Normal Eye (With no De-emphasis Shown) ..475</div></div></div><div><div><div></div></div></div><div><div><div>12-14 Screen Capture of a Bad Eye Showing Effect of Jitter, Noise and</div></div></div><div><div><div></div></div></div><div><div><div>Signal Attenuation (With no De-emphasis Shown). ...476</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="107" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>12</mn></mrow><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>15</mn></mrow></math></mjx-assistive-mml></mjx-container> Compliance Test/Measurement Load. ...479</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="45" id="mark-2cd7aff2-614b-4681-8478-d67259dee037" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>12-16 Receiver Eye Diagram. ...481</div></div></div><div><div><div></div></div></div><div><div><div>12-17 L0 Full-On Link State . ..482</div></div></div><div><div><div></div></div></div><div><div><div>12-18 L0s Low Power Link State ..483</div></div></div><div><div><div></div></div></div><div><div><div>12-19 L1 Low Power Link State. ..484</div></div></div><div><div><div></div></div></div><div><div><div>12-20 L2 Low Power Link State. ..485</div></div></div><div><div><div></div></div></div><div><div><div>12-21 L3 Link Off State . ..486</div></div></div><div><div><div></div></div></div><div><div><div>13-1 PERST# Generation. ..490</div></div></div><div><div><div></div></div></div><div><div><div>13-2 TS1 Ordered-Set Showing the Hot Reset Bit. ..491</div></div></div><div><div><div></div></div></div><div><div><div>13-3 Secondary Bus Reset Register to Generate Hot Reset. ..493</div></div></div><div><div><div></div></div></div><div><div><div>13-4 Switch Generates Hot Reset on One Downstream Port. ..494</div></div></div><div><div><div></div></div></div><div><div><div>13-5 Switch Generates Hot Reset on All Downstream Ports ..495</div></div></div><div><div><div></div></div></div><div><div><div>14-1 Link Training and Status State Machine Location. ..501</div></div></div><div><div><div></div></div></div><div><div><div>14-2 Example Showing Lane Reversal . ...502</div></div></div><div><div><div></div></div></div><div><div><div>14-3 Example Showing Polarity Inversion ...503</div></div></div><div><div><div></div></div></div><div><div><div>14-4 Five Ordered-Sets Used in the Link Training and Initialization Process . ..504</div></div></div><div><div><div></div></div></div><div><div><div>14-5 Link Training and Status State Machine (LTSSM). ..510</div></div></div><div><div><div></div></div></div><div><div><div>14-6 Detect State Machine . ..515</div></div></div><div><div><div></div></div></div><div><div><div>14-7 Polling State Machine. ..519</div></div></div><div><div><div></div></div></div><div><div><div>14-8 Configuration State Machine . ..520</div></div></div><div><div><div></div></div></div><div><div><div>14-9 Combining Lanes to form Links. ..524</div></div></div><div><div><div></div></div></div><div><div><div>14-10 Example 1 Link Numbering and Lane Numbering. ..527</div></div></div><div><div><div></div></div></div><div><div><div>14-11 Example 2 Link Numbering and Lane Numbering. ..529</div></div></div><div><div><div></div></div></div><div><div><div>14-12 Example 3 Link Numbering and Lane Numbering. ..532</div></div></div><div><div><div></div></div></div><div><div><div>14-13 Recovery State Machine. ..537</div></div></div><div><div><div></div></div></div><div><div><div>14-14 L0s Transmitter State Machine ..539</div></div></div><div><div><div></div></div></div><div><div><div>14-15 L0s Receiver State Machine . ..541</div></div></div><div><div><div></div></div></div><div><div><div>14-16 L1 State Machine. ...542</div></div></div><div><div><div></div></div></div><div><div><div>14-17 L2 State Machine . ..544</div></div></div><div><div><div></div></div></div><div><div><div>14-18 Hot Reset State Machine. ..545</div></div></div><div><div><div></div></div></div><div><div><div>14-19 Disable State Machine . ..546</div></div></div><div><div><div></div></div></div><div><div><div>14-20 Loopback State Machine. ..549</div></div></div><div><div><div></div></div></div><div><div><div>14-21 Link Capabilities Register. ...550</div></div></div><div><div><div></div></div></div><div><div><div>14-22 Link Status Register. ..552</div></div></div><div><div><div></div></div></div><div><div><div>14-23 Link Control Register. ..553</div></div></div><div><div><div></div></div></div><div><div><div>15-1 System Allocated Bit. ..559</div></div></div><div><div><div></div></div></div><div><div><div>15-2 Elements Involved in Power Budget.. ..561</div></div></div><div><div><div></div></div></div><div><div><div>15-3 Slot Power Limit Sequence . ...563</div></div></div><div><div><div></div></div></div><div><div><div>15-4 Power Budget Capability Registers.. ..565</div></div></div><div><div><div></div></div></div><div><div><div>15-5 Power Budget Data Field Format and Definition ..566</div></div></div><div><div><div></div></div></div><div><div><div>16-1 Relationship of OS, Device Drivers, Bus Driver, PCI Express Registers, and ACPI ..578</div></div></div><div><div><div></div></div></div><div><div><div>2 Example of OS Powering Down All Functions On</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express Links and then the Links Themselves . ...581</div></div></div><div><div><div></div></div></div><div><div><div>-3 Example of OS Restoring a PCI Express Function To Full Power. ...583</div></div></div><div><div><div></div></div></div><div><div><div>16-4 OS Prepares a Function To Cause System WakeUp On Device-Specific Event . ...584</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="108" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>16</mn></mrow><mo>−</mo><mn>5</mn></math></mjx-assistive-mml></mjx-container> PCI Power Management Capability Register Set.. ...586</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="109" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>16</mn></mrow><mo>−</mo><mn>6</mn></math></mjx-assistive-mml></mjx-container> PCI Express Function Power Management State Transitions. ...594</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="46" id="mark-93c1598e-9236-4ba6-843e-d3c9e8d7d239" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>16-7 PCI Function's PM Registers. ...596</div></div></div><div><div><div></div></div></div><div><div><div>16-8 Power Management Capabilities (PMC) Register - Read Only ...597</div></div></div><div><div><div></div></div></div><div><div><div>16-9 Power Management Control/Status (PMCSR) Register - R/W ...600</div></div></div><div><div><div></div></div></div><div><div><div>16-10 PM Registers. ...605</div></div></div><div><div><div></div></div></div><div><div><div>16-11 ASPM Link State Transitions ...609</div></div></div><div><div><div></div></div></div><div><div><div>16-12 ASPM Support.. ..610</div></div></div><div><div><div></div></div></div><div><div><div>16-13 Active State PM Control Field. ...611</div></div></div><div><div><div></div></div></div><div><div><div>16-14 Ports that Initiate L1 ASPM Transitions ...615</div></div></div><div><div><div></div></div></div><div><div><div>6-15 Negotiation Sequence Required to Enter L1 Active State PM.. ...618</div></div></div><div><div><div></div></div></div><div><div><div>16-16 Negotiation Sequence Resulting in Rejection to Enter L1 ASPM State. ..621</div></div></div><div><div><div></div></div></div><div><div><div>16-17 Switch Behavior When Downstream Component Signals L1 Exit. ..623</div></div></div><div><div><div></div></div></div><div><div><div>-18 Switch Behavior When Upstream Component Signals L1 Exit ..624</div></div></div><div><div><div></div></div></div><div><div><div>16-19 Example of Total L1 Latency. ...627</div></div></div><div><div><div></div></div></div><div><div><div>16-20 Config. Registers Used for ASPM Exit Latency Management and Reporting. ..628</div></div></div><div><div><div></div></div></div><div><div><div>16-21 Devices Transition to L1 When Software Changes their Power Level from D0. ..629</div></div></div><div><div><div></div></div></div><div><div><div>5-22 Software Placing a Device into a D2 State and Subsequent Transition to L1 ...630</div></div></div><div><div><div></div></div></div><div><div><div>16-23 Procedure Used to Transition a Link from the L0 to L1 State ..632</div></div></div><div><div><div></div></div></div><div><div><div>5-24 Link States Transitions Associated with Preparing Devices</div></div></div><div><div><div></div></div></div><div><div><div>for Removal of the Reference Clock and Power. ..634</div></div></div><div><div><div></div></div></div><div><div><div>6-25 Negotiation for Entering L2/L3 Ready State. ..636</div></div></div><div><div><div></div></div></div><div><div><div>16-26 State Transitions from L2/L3 Ready When Power is Removed. ..637</div></div></div><div><div><div></div></div></div><div><div><div>16-27 PME Message Format.. ..639</div></div></div><div><div><div></div></div></div><div><div><div>16-28 WAKE# Signal Implementations. ..644</div></div></div><div><div><div></div></div></div><div><div><div>16-29 Auxiliary Current Enable for Devices Not Supporting PMEs ..645</div></div></div><div><div><div></div></div></div><div><div><div>17-1 PCI Hot Plug Elements. ..653</div></div></div><div><div><div></div></div></div><div><div><div>17-2 PCI Express Hot-Plug Hardware/Software Elements. ..654</div></div></div><div><div><div></div></div></div><div><div><div>17-3 Hot Plug Control Functions within a Switch.. ...669</div></div></div><div><div><div></div></div></div><div><div><div>17-4 PCI Express Configuration Registers Used for Hot-Plug. ...670</div></div></div><div><div><div></div></div></div><div><div><div>17-5 Attention Button and Hot Plug Indicators Present Bits ..671</div></div></div><div><div><div></div></div></div><div><div><div>17-6 Slot Control Register Fields ...673</div></div></div><div><div><div></div></div></div><div><div><div>17-7 Slot Status Register Fields. ...675</div></div></div><div><div><div></div></div></div><div><div><div>17-8 Location of Attention Button and Indicators. ...677</div></div></div><div><div><div></div></div></div><div><div><div>17-9 Hot-Plug Capability Bits for Server IO Modules ..678</div></div></div><div><div><div></div></div></div><div><div><div>17-10 Hot Plug Message Format ..680</div></div></div><div><div><div></div></div></div><div><div><div>18-1 PCI Express <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="110" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-cD7"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>×</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> connector.. ...687</div></div></div><div><div><div></div></div></div><div><div><div>18-2 PCI Express Connectors on System Board. ...688</div></div></div><div><div><div></div></div></div><div><div><div>18-3 PERST Timing During Power Up.. ...695</div></div></div><div><div><div></div></div></div><div><div><div>18-4 PERST# Timing During Power Management States. ..696</div></div></div><div><div><div></div></div></div><div><div><div>18-5 Example of WAKE# Circuit Protection. ..698</div></div></div><div><div><div></div></div></div><div><div><div>18-6 Presence Detect.. ..700</div></div></div><div><div><div></div></div></div><div><div><div>18-7 PCI Express Riser Card . ...704</div></div></div><div><div><div></div></div></div><div><div><div>18-8 Mini PCI Express Add-in Card Installed in a Mobile Platform. ...705</div></div></div><div><div><div></div></div></div><div><div><div>18-9 Mini PCI Express Add-in Card Photo 1 . ...706</div></div></div><div><div><div></div></div></div><div><div><div>18-10 Mini PCI Express Add-in Card Photo 2 . ..706</div></div></div><div><div><div></div></div></div><div><div><div>19-1 Example System. ...713</div></div></div><div><div><div></div></div></div><div><div><div>19-2 Topology View At Startup. ...714</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="47" id="mark-9630d061-d5c4-44f9-aa77-2e8d94bd7a77" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>19-3 4KB Configuration Space per PCI Express Function. ...717</div></div></div><div><div><div></div></div></div><div><div><div>19-4 Header Type Register.. ...719</div></div></div><div><div><div></div></div></div><div><div><div>20-1 A Function's Configuration Space.. ...723</div></div></div><div><div><div></div></div></div><div><div><div>20-2 Configuration Address Port at 0CF8h ...726</div></div></div><div><div><div></div></div></div><div><div><div>20-3 Example System. ..728</div></div></div><div><div><div></div></div></div><div><div><div>20-4 Peer Root Complexes.. ...730</div></div></div><div><div><div></div></div></div><div><div><div>20-5 Type 0 Configuration Read Request Packet Header ...733</div></div></div><div><div><div></div></div></div><div><div><div>20-6 Type 0 Configuration Write Request Packet Header ...733</div></div></div><div><div><div></div></div></div><div><div><div>20-7 Type 1 Configuration Read Request Packet Header . ...734</div></div></div><div><div><div></div></div></div><div><div><div>20-8 Type 1 Configuration Write Request Packet Header ...734</div></div></div><div><div><div></div></div></div><div><div><div>20-9 Example Configuration Access.. ...737</div></div></div><div><div><div></div></div></div><div><div><div>21-1 Topology View At Startup. ...742</div></div></div><div><div><div></div></div></div><div><div><div>21-2 Example System Before Bus Enumeration. ...748</div></div></div><div><div><div></div></div></div><div><div><div>21-3 Example System After Bus Enumeration ...749</div></div></div><div><div><div></div></div></div><div><div><div>21-4 Header Type Register. ..750</div></div></div><div><div><div></div></div></div><div><div><div>21-5 Capability Register . ...750</div></div></div><div><div><div></div></div></div><div><div><div>21-6 Header Type 0 . ...751</div></div></div><div><div><div></div></div></div><div><div><div>21-7 Header Type 1 . ...752</div></div></div><div><div><div></div></div></div><div><div><div>21-8 Peer Root Complexes.. ...757</div></div></div><div><div><div></div></div></div><div><div><div>21-9 Multifunction Bridges in Root Complex. ...759</div></div></div><div><div><div></div></div></div><div><div><div>21-10 First Example of a Multifunction Bridge In a Switch ...760</div></div></div><div><div><div></div></div></div><div><div><div>21-11 Second Example of a Multifunction Bridge In a Switch. ...761</div></div></div><div><div><div></div></div></div><div><div><div>21-12 Embedded Root Endpoint . ...762</div></div></div><div><div><div></div></div></div><div><div><div>21-13 Embedded Switch Endpoint . ...763</div></div></div><div><div><div></div></div></div><div><div><div>21-14 Type 0 Configuration Write Request Packet Header ...764</div></div></div><div><div><div></div></div></div><div><div><div>21-15 RCRB Example . ..766</div></div></div><div><div><div></div></div></div><div><div><div>22-1 Header Type 0 . ...771</div></div></div><div><div><div></div></div></div><div><div><div>22-2 Class Code Register . ...775</div></div></div><div><div><div></div></div></div><div><div><div>22-3 Header Type Register Bit Assignment. ...778</div></div></div><div><div><div></div></div></div><div><div><div>22-4 BIST Register Bit Assignment . ...778</div></div></div><div><div><div></div></div></div><div><div><div>22-5 Status Register . ..780</div></div></div><div><div><div></div></div></div><div><div><div>22-6 General Format of a New Capabilities List Entry. ...782</div></div></div><div><div><div></div></div></div><div><div><div>22-7 Expansion ROM Base Address Register Bit Assignment. ...785</div></div></div><div><div><div></div></div></div><div><div><div>22-8 Command Register. ...785</div></div></div><div><div><div></div></div></div><div><div><div>22-9 PCI Configuration Status Register.. ...788</div></div></div><div><div><div></div></div></div><div><div><div>22-10 32-Bit Memory Base Address Register Bit Assignment ..796</div></div></div><div><div><div></div></div></div><div><div><div>22-11 64-Bit Memory Base Address Register Bit Assignment . ...797</div></div></div><div><div><div></div></div></div><div><div><div>22-12 IO Base Address Register Bit Assignment . ...798</div></div></div><div><div><div></div></div></div><div><div><div>22-13 Header Type 1 . ...803</div></div></div><div><div><div></div></div></div><div><div><div>22-14 IO Base Register . ..815</div></div></div><div><div><div></div></div></div><div><div><div>22-15 IO Limit Register. ...815</div></div></div><div><div><div></div></div></div><div><div><div>22-16 Example of IO Filtering Actions . ..817</div></div></div><div><div><div></div></div></div><div><div><div>22-17 Prefetchable Memory Base Register. ...827</div></div></div><div><div><div></div></div></div><div><div><div>22-18 Prefetchable Memory Limit Register ...828</div></div></div><div><div><div></div></div></div><div><div><div>22-19 Memory-Mapped IO Base Register . ...831</div></div></div><div><div><div></div></div></div><div><div><div>Memory-Mapped IO Limit Register ...831</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="48" id="mark-955744a4-c812-4f17-8e9d-1e075c8457da" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>22-21 Command Register. ...832</div></div></div><div><div><div></div></div></div><div><div><div>22-22 Bridge Control Register.. ...835</div></div></div><div><div><div></div></div></div><div><div><div>22-23 Primary Interface Status Register. ...838</div></div></div><div><div><div></div></div></div><div><div><div>22-24 Secondary Status Register. ...841</div></div></div><div><div><div></div></div></div><div><div><div>22-25 Format of the AGP Capability Register Set. ..845</div></div></div><div><div><div></div></div></div><div><div><div>22-26 VPD Capability Registers ...851</div></div></div><div><div><div></div></div></div><div><div><div>22-27 Chassis and Slot Number Registers. ...859</div></div></div><div><div><div></div></div></div><div><div><div>22-28 Main Chassis.. ...862</div></div></div><div><div><div></div></div></div><div><div><div>22-29 Expansion Slot Register.. ...864</div></div></div><div><div><div></div></div></div><div><div><div>22-30 Slot Capability Register. ...865</div></div></div><div><div><div></div></div></div><div><div><div>22-31 PCI Express Capabilities Register. ...865</div></div></div><div><div><div></div></div></div><div><div><div>22-32 Chassis Example One. ..867</div></div></div><div><div><div></div></div></div><div><div><div>22-33 Chassis Example Two.. ...869</div></div></div><div><div><div></div></div></div><div><div><div>23-1 Expansion ROM Base Address Register Bit Assignment.. ..873</div></div></div><div><div><div></div></div></div><div><div><div>23-2 Header Type Zero Configuration Register Format.. ..874</div></div></div><div><div><div></div></div></div><div><div><div>23-3 Multiple Code Images Contained In One Device ROM. ..877</div></div></div><div><div><div></div></div></div><div><div><div>23-4 Code Image Format. ..879</div></div></div><div><div><div></div></div></div><div><div><div>23-5 AX Contents On Entry To Initialization Code. ..888</div></div></div><div><div><div></div></div></div><div><div><div>24-1 Function's Configuration Space Layout ...895</div></div></div><div><div><div></div></div></div><div><div><div>24-2 PCI Express Capability Register Set. ...897</div></div></div><div><div><div></div></div></div><div><div><div>24-3 PCI Express Capabilities Register. ...898</div></div></div><div><div><div></div></div></div><div><div><div>24-4 Device Capabilities Register. ...901</div></div></div><div><div><div></div></div></div><div><div><div>24-5 Device Control Register ...906</div></div></div><div><div><div></div></div></div><div><div><div>24-6 Device Status Register.. ..910</div></div></div><div><div><div></div></div></div><div><div><div>24-7 Link Capabilities Register. ...913</div></div></div><div><div><div></div></div></div><div><div><div>24-8 Link Control Register. ..916</div></div></div><div><div><div></div></div></div><div><div><div>24-9 Link Status Register.. ...918</div></div></div><div><div><div></div></div></div><div><div><div>24-10 Slot Capabilities Register ...921</div></div></div><div><div><div></div></div></div><div><div><div>24-11 Slot Control Register. ...923</div></div></div><div><div><div></div></div></div><div><div><div>24-12 Slot Status Register . ...925</div></div></div><div><div><div></div></div></div><div><div><div>24-13 Root Control Register. ...927</div></div></div><div><div><div></div></div></div><div><div><div>24-14 Root Status Register. ...928</div></div></div><div><div><div></div></div></div><div><div><div>24-15 Enhanced Capability Header Register.. ...930</div></div></div><div><div><div></div></div></div><div><div><div>24-16 Advanced Error Reporting Capability Register Set. ...931</div></div></div><div><div><div></div></div></div><div><div><div>24-17 Advanced Error Reporting Enhanced Capability Header ..935</div></div></div><div><div><div></div></div></div><div><div><div>8 Advanced Error Capabilities and Control Register. ...935</div></div></div><div><div><div></div></div></div><div><div><div>24-19 Advanced Error Correctable Error Mask Register.. ...935</div></div></div><div><div><div></div></div></div><div><div><div>24-20 Advanced Error Correctable Error Status Register.. ...936</div></div></div><div><div><div></div></div></div><div><div><div>24-21 Advanced Error Uncorrectable Error Mask Register . ...936</div></div></div><div><div><div></div></div></div><div><div><div>24-22 Advanced Error Uncorrectable Error Severity Register. ..937</div></div></div><div><div><div></div></div></div><div><div><div>24-23 Advanced Error Uncorrectable Error Status Register ...937</div></div></div><div><div><div></div></div></div><div><div><div>24-24 Advanced Error Root Error Command Register. ...938</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="111" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>24</mn></mrow><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>25</mn></mrow></math></mjx-assistive-mml></mjx-container> Advanced Error Root Error Status Register. ...938</div></div></div><div><div><div></div></div></div><div><div><div>24-26 Advanced Error Uncorrectable and Uncorrectable Error Source ID Registers ...938</div></div></div><div><div><div></div></div></div><div><div><div>24-27 Port and VC Arbitration.. ...939</div></div></div><div><div><div></div></div></div><div><div><div>24-28 Virtual Channel Capability Register Set. ...941</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="49" id="mark-810a91dc-3f30-46aa-b06f-455223e2c4eb" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>24-29 VC Enhanced Capability Header . ...941</div></div></div><div><div><div></div></div></div><div><div><div>24-30 Port VC Capability Register 1 (Read-Only) . ...942</div></div></div><div><div><div></div></div></div><div><div><div>24-31 Port VC Capability Register 2 (Read-Only) ...943</div></div></div><div><div><div></div></div></div><div><div><div>24-32 Port VC Control Register (Read-Write). ...944</div></div></div><div><div><div></div></div></div><div><div><div>24-33 Port VC Status Register (Read-Only). ...946</div></div></div><div><div><div></div></div></div><div><div><div>24-34 VC Resource Capability Register.. ...947</div></div></div><div><div><div></div></div></div><div><div><div>24-35 VC Resource Control Register (Read-Write). ...948</div></div></div><div><div><div></div></div></div><div><div><div>24-36 VC Resource Status Register (Read-Only) ...951</div></div></div><div><div><div></div></div></div><div><div><div>24-37 Device Serial Number Enhanced Capability Header ...953</div></div></div><div><div><div></div></div></div><div><div><div>24-38 Device Serial Number Register. ..953</div></div></div><div><div><div></div></div></div><div><div><div>24-39 EUI-64 Format . ...954</div></div></div><div><div><div></div></div></div><div><div><div>24-40 Power Budget Register Set . ..955</div></div></div><div><div><div></div></div></div><div><div><div>24-41 Power Budgeting Enhanced Capability Header ...955</div></div></div><div><div><div></div></div></div><div><div><div>24-42 Power Budgeting Data Register... ...956</div></div></div><div><div><div></div></div></div><div><div><div>24-43 Power Budgeting Capability Register.. ...956</div></div></div><div><div><div></div></div></div><div><div><div>24-44 RCRB Example . ..958</div></div></div><div><div><div></div></div></div><div><div><div>A-1 2.5-GT/s PCIe Compliance Pattern. ..963</div></div></div><div><div><div></div></div></div><div><div><div>A-2 5-GT/s PCIe Compliance Pattern. ...964</div></div></div><div><div><div></div></div></div><div><div><div>A-3 3 Typical Setup for Testing and Add-In Card ...965</div></div></div><div><div><div></div></div></div><div><div><div>A-4 Typical Setup for Testing a Motherboard . ...965</div></div></div><div><div><div></div></div></div><div><div><div>A-5 Oscilloscope Eye Diagram. ...966</div></div></div><div><div><div></div></div></div><div><div><div>A-6 Testing the LTSSM with the Agilent N5309A Exerciser for PCIe 2.0. ...967</div></div></div><div><div><div></div></div></div><div><div><div>A-7 Representation of Traffic on a PCIe Link Using an Agilent Protocol Analyzer...... ...970</div></div></div><div><div><div></div></div></div><div><div><div>A-8 Finding a Particular Condition or Sequence of Events Using a Trigger Sequencer. ..973</div></div></div><div><div><div></div></div></div><div><div><div>A-9 Typical PCIe Error Conditions Triggerable on Agilent Protocol Analyzer . ...974</div></div></div><div><div><div></div></div></div><div><div><div>A-10 Agilent PCIe 2.0 Exerciser Provides Powerful and Flexible Validation Platform ...975</div></div></div><div><div><div></div></div></div><div><div><div>A-11 The Agilent PCIe 2.0 N5309A Exerciser... ...976</div></div></div><div><div><div></div></div></div><div><div><div>A-12 Templates for Creating Traffic Using the Exerciser.. ...977</div></div></div><div><div><div></div></div></div><div><div><div>Adding Single or Multiple Error Scenarios to each Request. ...978</div></div></div><div><div><div></div></div></div><div><div><div>A-14 Programming Completer Behaviors. ...979</div></div></div><div><div><div></div></div></div><div><div><div>-15 Inserting Request and Completion Errors Using the Exerciser ...980</div></div></div><div><div><div></div></div></div><div><div><div>A-16 Using Continuous Mode on Exerciser Running Loop of Memory and I/O Transactions ..</div></div></div><div><div><div></div></div></div><div><div><div>...981</div></div></div><div><div><div></div></div></div><div><div><div>17 The Exerciser Has Fully Programmable Memory and I/O Decoders. ...982</div></div></div><div><div><div></div></div></div><div><div><div>A-18 Topology Tests Using the Agilent E2969A Protocol Test Card.. ...984</div></div></div><div><div><div></div></div></div><div><div><div>B-1 Migration from PCI to PCI Express. ...990</div></div></div><div><div><div></div></div></div><div><div><div>B-2 PCI Express in a Desktop System. ...992</div></div></div><div><div><div></div></div></div><div><div><div>B-3 PCI Express in a Server System. ...993</div></div></div><div><div><div></div></div></div><div><div><div>B-4 PCI Express in Embedded-Control Applications.. ...994</div></div></div><div><div><div></div></div></div><div><div><div>B-5 PCI Express in a Storage System . ...995</div></div></div><div><div><div></div></div></div><div><div><div>B-6 PCI Express in Communications Systems. ...997</div></div></div><div><div><div></div></div></div><div><div><div>C-1 Enumeration Using Transparent Bridges.. ..1002</div></div></div><div><div><div></div></div></div><div><div><div>C-2 Direct Address Translation.. ..1004</div></div></div><div><div><div></div></div></div><div><div><div>C-3 Look Up Table Translation Creates Multiple Windows . ..1005</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="50" id="mark-450a4741-a6a9-4c0b-95bc-004e063095ef" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>C-4 Intelligent Adapters in PCI and PCI Express Systems. ..1006</div></div></div><div><div><div></div></div></div><div><div><div>C-5 Host Failover in PCI and PCI Express Systems. ..1008</div></div></div><div><div><div></div></div></div><div><div><div>C-6 Dual Host in a PCI and PCI Express System ..1010</div></div></div><div><div><div></div></div></div><div><div><div>C-7 Dual-Star Fabric . ...1012</div></div></div><div><div><div></div></div></div><div><div><div>C-8 Direct Address Translation... ..1014</div></div></div><div><div><div></div></div></div><div><div><div>C-9 Lookup Table Based Translation. ..1015</div></div></div><div><div><div></div></div></div><div><div><div>C-10 Use of Limit Register. ...1016</div></div></div><div><div><div></div></div></div><div><div><div>D-1 Class Code Register . ..1019</div></div></div><div><div><div></div></div></div><div><div><div>E-1 Lock Sequence Begins with Memory Read Lock Request. ...1037</div></div></div><div><div><div></div></div></div><div><div><div>E-2 Lock Completes with Memory Write Followed by Unlock Message ..1038</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="51" id="mark-f1c9d017-ee6b-4d79-a94c-4f925c6637db" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>1 PC Architecture Book Series ..1</div></div></div><div><div><div></div></div></div><div><div><div>1-1 Bus Specifications and Release Dates .12</div></div></div><div><div><div></div></div></div><div><div><div>1-2 Comparison of Bus Frequency, Bandwidth and Number of Slots .. 13</div></div></div><div><div><div></div></div></div><div><div><div>1-3 PCI Express Aggregate Throughput for Various Link Widths. . . 14</div></div></div><div><div><div></div></div></div><div><div><div>2-1 PCI Express Non-Posted and Posted Transactions. .56</div></div></div><div><div><div></div></div></div><div><div><div>2-2 PCI Express TLP Packet Types . ..57</div></div></div><div><div><div></div></div></div><div><div><div>2-3 PCI Express Aggregate Throughput for Various Link Widths. .101</div></div></div><div><div><div></div></div></div><div><div><div>3-1 Ordered Set Types . .109</div></div></div><div><div><div></div></div></div><div><div><div>3-2 Data Link Layer Packet (DLLP) Types ..111</div></div></div><div><div><div></div></div></div><div><div><div>3-3 PCI Express Address Space And Transaction Types .113</div></div></div><div><div><div></div></div></div><div><div><div>3-4 PCI Express Posted and Non-Posted Transactions. .116</div></div></div><div><div><div></div></div></div><div><div><div>3-5 PCI Express TLP Variants And Routing Options 1.117</div></div></div><div><div><div></div></div></div><div><div><div>3-6 TLP Header Type and Format Field Encodings. . . 120</div></div></div><div><div><div></div></div></div><div><div><div>3-7 Message Request Header Type Field Usage .134</div></div></div><div><div><div></div></div></div><div><div><div>3-8 Results Of Reading The BAR after Writing All "1s" To It. ..140</div></div></div><div><div><div></div></div></div><div><div><div>3-9 Results Of Reading The BAR Pair after Writing All "1s" To Both .142</div></div></div><div><div><div></div></div></div><div><div><div>3-10 Results Of Reading The IO BAR after Writing All "1s" To It . .144</div></div></div><div><div><div></div></div></div><div><div><div>3-11 6 GB, 64-Bit Prefetchable Base/Limit Register Setup. .146</div></div></div><div><div><div></div></div></div><div><div><div>3-12 2MB, 32-Bit Non-Prefetchable Base/Limit Register Setup .148</div></div></div><div><div><div></div></div></div><div><div><div>3-13 256 Byte IO Base/Limit Register Setup ..150</div></div></div><div><div><div></div></div></div><div><div><div>4-1 PCI Express Address Space And Transaction Types . .. 159</div></div></div><div><div><div></div></div></div><div><div><div>4-2 TLP Header Type Field Defines Transaction Variant .160</div></div></div><div><div><div></div></div></div><div><div><div>4-3 TLP Header Type Field Defines Transaction Variant .161</div></div></div><div><div><div></div></div></div><div><div><div>4-4 Generic Header Field Summary. ..163</div></div></div><div><div><div></div></div></div><div><div><div>4-5 TLP Header Type and Format Field Encodings. .165</div></div></div><div><div><div></div></div></div><div><div><div>4-6 IO Request Header Fields. .173</div></div></div><div><div><div></div></div></div><div><div><div>4-7 4DW Memory Request Header Fields. ..176</div></div></div><div><div><div></div></div></div><div><div><div>4-8 Configuration Request Header Fields ..181</div></div></div><div><div><div></div></div></div><div><div><div>4-9 Completion Header Fields .185</div></div></div><div><div><div></div></div></div><div><div><div>4-10 Message Request Header Fields . 1.191</div></div></div><div><div><div></div></div></div><div><div><div>4-11 INTx Interrupt Signaling Message Coding. . . 193</div></div></div><div><div><div></div></div></div><div><div><div>4-12 Power Management Message Coding ..194</div></div></div><div><div><div></div></div></div><div><div><div>4-13 Error Message Coding . ..195</div></div></div><div><div><div></div></div></div><div><div><div>4-14 Unlock Message Coding . . ..196</div></div></div><div><div><div></div></div></div><div><div><div>4-15 Slot Power Limit Message Coding. .196</div></div></div><div><div><div></div></div></div><div><div><div>4-16 Hot Plug Message Coding. .197</div></div></div><div><div><div></div></div></div><div><div><div>4-17 DLLP Packet Types. .. 201</div></div></div><div><div><div></div></div></div><div><div><div>4-18 Ack or Nak DLLP Fields. .. 203</div></div></div><div><div><div></div></div></div><div><div><div>4-19 Power Management DLLP Fields. . . 204</div></div></div><div><div><div></div></div></div><div><div><div>4-20 Flow Control DLLP Fields. . . 206</div></div></div><div><div><div></div></div></div><div><div><div>4-21 Vendor-Specific DLLP Fields. .. 207</div></div></div><div><div><div></div></div></div><div><div><div>5-1 Ack or Nak DLLP Fields. . 219</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="52" id="mark-d66d3eba-b896-411a-a5be-1edb79258329" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>6-1 Example TC to VC Mappings . .263</div></div></div><div><div><div></div></div></div><div><div><div>7-1 Required Minimum Flow Control Advertisements ..303</div></div></div><div><div><div></div></div></div><div><div><div>8-1 Transactions That Can Be Reordered Due to Relaxed Ordering . . . 321</div></div></div><div><div><div></div></div></div><div><div><div>8-2 Fundamental Ordering Rules Based on Strong Ordering and RO Attribute .. 322</div></div></div><div><div><div></div></div></div><div><div><div>8-3 Weak Ordering Rules Enhance Performance . . 326</div></div></div><div><div><div></div></div></div><div><div><div>8-4 Ordering Rules with Deadlock Avoidance Rules .327</div></div></div><div><div><div></div></div></div><div><div><div>9-1 Format and Usage of Message Control Register. . 333</div></div></div><div><div><div></div></div></div><div><div><div>9-2 INTx Message Codes. ..351</div></div></div><div><div><div></div></div></div><div><div><div>10-1 Error Message Codes and Description ..371</div></div></div><div><div><div></div></div></div><div><div><div>10-2 Completion Code and Description . 372</div></div></div><div><div><div></div></div></div><div><div><div>10-3 Error-Related Command Register Bits . . 373</div></div></div><div><div><div></div></div></div><div><div><div>10-4 Description of PCI-Compatible Status Register Bits for Reporting Errors . 374</div></div></div><div><div><div></div></div></div><div><div><div>10-5 Default Classification of Errors. . 377</div></div></div><div><div><div></div></div></div><div><div><div>10-6 Transaction Layer Errors That are Logged .389</div></div></div><div><div><div></div></div></div><div><div><div>11-1 5-bit to 6-bit Encode Table for Data Characters ..427</div></div></div><div><div><div></div></div></div><div><div><div>11-2 5-bit to 6-bit Encode Table for Control Characters .429</div></div></div><div><div><div></div></div></div><div><div><div>11-3 3-bit to 4-bit Encode Table for Data Characters . . 429</div></div></div><div><div><div></div></div></div><div><div><div>11-4 3-bit to 4-bit Encode Table for Control Characters .430</div></div></div><div><div><div></div></div></div><div><div><div>11-5 Control Character Encoding and Definition. . . 432</div></div></div><div><div><div></div></div></div><div><div><div>12-1 Output Driver Characteristics. ..477</div></div></div><div><div><div></div></div></div><div><div><div>12-2 Input Receiver Characteristics . . . 480</div></div></div><div><div><div></div></div></div><div><div><div>14-1 Summary of TS1 and TS2 Ordered-Set Contents. .506</div></div></div><div><div><div></div></div></div><div><div><div>15-1 Maximum Power Consumption for System Board Expansion Slots .562</div></div></div><div><div><div></div></div></div><div><div><div>16-1 Major Software/Hardware Elements Involved In PC PM. 5.69</div></div></div><div><div><div></div></div></div><div><div><div>16-2 System PM States as Defined by the OnNow Design Initiative . 5.572</div></div></div><div><div><div></div></div></div><div><div><div>16-3 OnNow Definition of Device-Level PM States. .573</div></div></div><div><div><div></div></div></div><div><div><div>16-4 Concise Description of OnNow Device PM States .574</div></div></div><div><div><div></div></div></div><div><div><div>16-5 Default Device Class PM States. 5.576</div></div></div><div><div><div></div></div></div><div><div><div>16-6 D0 Power Management Policies. .587</div></div></div><div><div><div></div></div></div><div><div><div>16-7 D1 Power Management Policies. .588</div></div></div><div><div><div></div></div></div><div><div><div>16-8 D2 Power Management Policies. .590</div></div></div><div><div><div></div></div></div><div><div><div>16-9 D3hot Power Management Policies. 5.592</div></div></div><div><div><div></div></div></div><div><div><div>16-10 D3cold Power Management Policies .593</div></div></div><div><div><div></div></div></div><div><div><div>16-11 Description of Function State Transitions. 5.594</div></div></div><div><div><div></div></div></div><div><div><div>16-12 Function State Transition Delays . .596</div></div></div><div><div><div></div></div></div><div><div><div>16-13 The PMC Register Bit Assignments 5.597</div></div></div><div><div><div></div></div></div><div><div><div>6-14 PM Control/Status Register (PMCSR) Bit Assignments .000</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="112" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>16</mn></mrow><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>15</mn></mrow></math></mjx-assistive-mml></mjx-container> Data Register Interpretation. 6.605</div></div></div><div><div><div></div></div></div><div><div><div>-16 Relationship Between Device and Link Power States. .007</div></div></div><div><div><div></div></div></div><div><div><div>16-17 Link Power State Characteristics . .. 608</div></div></div><div><div><div></div></div></div><div><div><div>16-18 8 Active State Power Management Control Field Definition. . .610</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="113" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c37"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>17</mn></mrow><mo>−</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> Introduction to Major Hot-Plug Software Elements.. 6.655</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="53" id="mark-f15bee97-be30-46bf-a769-e6d3e854aa05" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>17-2 Major Hot-Plug Hardware Elements. 6.656</div></div></div><div><div><div></div></div></div><div><div><div>17-3 Behavior and Meaning of the Slot Attention Indicator. 6.665</div></div></div><div><div><div></div></div></div><div><div><div>17-4 Behavior and Meaning of the Power Indicator . . .666</div></div></div><div><div><div></div></div></div><div><div><div>17-5 Slot Capability Register Fields and Descriptions. ..671</div></div></div><div><div><div></div></div></div><div><div><div>17-6 Slot Control Register Fields and Descriptions. 6.673</div></div></div><div><div><div></div></div></div><div><div><div>17-7 Slot Status Register Fields and Descriptions. ..675</div></div></div><div><div><div></div></div></div><div><div><div>17-8 The Primitives. .682</div></div></div><div><div><div></div></div></div><div><div><div>18-1 PCI Express Connector Pinout. . . 689</div></div></div><div><div><div></div></div></div><div><div><div>18-2 PCI Express Connector Auxiliary Signals. . 693</div></div></div><div><div><div></div></div></div><div><div><div>18-3 Power Supply Requirements .701</div></div></div><div><div><div></div></div></div><div><div><div>18-4 Add-in Card Power Dissipation. ..702</div></div></div><div><div><div></div></div></div><div><div><div>18-5 Card Interoperability. ..703</div></div></div><div><div><div></div></div></div><div><div><div>20 - 1 Enhanced Configuration Mechanism Memory-Mapped IO Address Range .. 73</div></div></div><div><div><div></div></div></div><div><div><div>21 - 1 Capability Register's Device/Port Type Field Encoding. .753</div></div></div><div><div><div></div></div></div><div><div><div>22-1 Defined Class Codes ..775</div></div></div><div><div><div></div></div></div><div><div><div>22-2 BIST Register Bit Assignment . . .779</div></div></div><div><div><div></div></div></div><div><div><div>22-3 Currently-Assigned Capability IDs ..781</div></div></div><div><div><div></div></div></div><div><div><div>22 - 4 Command Register. .786</div></div></div><div><div><div></div></div></div><div><div><div>22 - 5 Status Register. ...789</div></div></div><div><div><div></div></div></div><div><div><div>22-6 Bridge Command Register Bit Assignment. .833</div></div></div><div><div><div></div></div></div><div><div><div>22-7 Bridge Control Register Bit Assignment .836</div></div></div><div><div><div></div></div></div><div><div><div>22 - 8 Bridge Primary Side Status Register .. .838</div></div></div><div><div><div></div></div></div><div><div><div>22 - 9 Bridge Secondary Side Status Register. ..841</div></div></div><div><div><div></div></div></div><div><div><div>22-10 AGP Status Register (Offset CAP_PTR + 4). 8.846</div></div></div><div><div><div></div></div></div><div><div><div>22-11 AGP Command Register (Offset CAP_PTR + 8). 8.87</div></div></div><div><div><div></div></div></div><div><div><div>22-12 Basic Format of VPD Data Structure. . 852</div></div></div><div><div><div></div></div></div><div><div><div>22-13 Format of the Identifier String Tag. . 853</div></div></div><div><div><div></div></div></div><div><div><div>22-14 Format of the VPD-R Descriptor . . 853</div></div></div><div><div><div></div></div></div><div><div><div>22-15 General Format of a Read or a Read/Write Keyword Entry . . 854</div></div></div><div><div><div></div></div></div><div><div><div>22-16 List of Read-Only VPD Keywords .854</div></div></div><div><div><div></div></div></div><div><div><div>22-17 Extended Capability (CP) Keyword Format. . 855</div></div></div><div><div><div></div></div></div><div><div><div>22-18 Format of Checksum Keyword. . . 855</div></div></div><div><div><div></div></div></div><div><div><div>22-19 Format of the VPD-W Descriptor. . 856</div></div></div><div><div><div></div></div></div><div><div><div>22-20 List of Read/Write VPD Keywords. . . 856</div></div></div><div><div><div></div></div></div><div><div><div>22-21 Example VPD List.. ..857</div></div></div><div><div><div></div></div></div><div><div><div>22-22 Slot Numbering Register Set. .859</div></div></div><div><div><div></div></div></div><div><div><div>22-23 Expansion Slot Register Bit Assignment. . . 864</div></div></div><div><div><div></div></div></div><div><div><div>23-1 PCI Expansion ROM Header Format . . 880</div></div></div><div><div><div></div></div></div><div><div><div>23-2 PC-Compatible Processor/Architecture Data Area In ROM Header. ..881</div></div></div><div><div><div></div></div></div><div><div><div>23-3 PCI Expansion ROM Data Structure Format. . . 882</div></div></div><div><div><div></div></div></div><div><div><div>24 - 1 PCI Express Capabilities Register . 899</div></div></div><div><div><div></div></div></div><div><div><div>24 - 2 Device Capabilities Register (read-only). . . 901</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="54" id="mark-999ff155-dde3-462a-9d79-94bf42a2005f" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>24 - 3 Device Control Register (read/write). . . 906</div></div></div><div><div><div></div></div></div><div><div><div>24 - 4 Device Status Register. ..910</div></div></div><div><div><div></div></div></div><div><div><div>24 - 5 Link Capabilities Register.. ..913</div></div></div><div><div><div></div></div></div><div><div><div>24 - 6 Link Control Register. .016</div></div></div><div><div><div></div></div></div><div><div><div>24 - 7 Link Status Register. 9</div></div></div><div><div><div></div></div></div><div><div><div>24 - 8 Slot Capabilities Register (all fields are HWInit) .. 921</div></div></div><div><div><div></div></div></div><div><div><div>24 - 9 Slot Control Register (all fields are RW). . . 924</div></div></div><div><div><div></div></div></div><div><div><div>24 - 10 Slot Status Register. ..926</div></div></div><div><div><div></div></div></div><div><div><div>24 - 11 Root Control Register (all fields are RW). .. 927</div></div></div><div><div><div></div></div></div><div><div><div>24 - 12 Root Status Register.. . . 929</div></div></div><div><div><div></div></div></div><div><div><div>24 - 13 Advanced Error Reporting Capability Register Set.. . 932</div></div></div><div><div><div></div></div></div><div><div><div>24 - 14 Port VC Capability Register 1 (Read-Only) .942</div></div></div><div><div><div></div></div></div><div><div><div>24 - 15 Port VC Capability Register 2 (Read-Only) 9.944</div></div></div><div><div><div></div></div></div><div><div><div>24 - 16 Port VC Control Register (Read-Write). ..945</div></div></div><div><div><div></div></div></div><div><div><div>24 - 17 Port VC Status Register (Read-Only). . 946</div></div></div><div><div><div></div></div></div><div><div><div>24 - 18 VC Resource Capability Register ..947</div></div></div><div><div><div></div></div></div><div><div><div>24 - 19 VC Resource Control Register (Read-Write) 9.949</div></div></div><div><div><div></div></div></div><div><div><div>24 - 20 VC Resource Status Register (Read-Only). ..951</div></div></div><div><div><div></div></div></div><div><div><div>D-1 Defined Class Codes .1019</div></div></div><div><div><div></div></div></div><div><div><div>D-2 Class Code 0 (PCI rev 1.0) . .1020</div></div></div><div><div><div></div></div></div><div><div><div>D-3 Class Code 1: Mass Storage Controllers .1020</div></div></div><div><div><div></div></div></div><div><div><div>D-4 Class Code 2: Network Controllers .1021</div></div></div><div><div><div></div></div></div><div><div><div>D-5 Class Code 3: Display Controllers .1022</div></div></div><div><div><div></div></div></div><div><div><div>D-6 Class Code 4: Multimedia Devices. .1022</div></div></div><div><div><div></div></div></div><div><div><div>D-7 Class Code 5: Memory Controllers 1022</div></div></div><div><div><div></div></div></div><div><div><div>D-8 Class Code 6: Bridge Devices .1023</div></div></div><div><div><div></div></div></div><div><div><div>D-9 Class Code 7: Simple Communications Controllers .1024</div></div></div><div><div><div></div></div></div><div><div><div>D-10 Class Code 8: Base System Peripherals .1026</div></div></div><div><div><div></div></div></div><div><div><div>D-11 Class Code 9: Input Devices .1027</div></div></div><div><div><div></div></div></div><div><div><div>D-12 Class Code A: Docking Stations . .1027</div></div></div><div><div><div></div></div></div><div><div><div>D-13 Class Code B: Processors .1028</div></div></div><div><div><div></div></div></div><div><div><div>D-14 Class Code C: Serial Bus Controllers .1028</div></div></div><div><div><div></div></div></div><div><div><div>D-15 Class Code D: Wireless Controllers. .1029</div></div></div><div><div><div></div></div></div><div><div><div>D-16 Class Code E: Intelligent IO Controllers. .1030</div></div></div><div><div><div></div></div></div><div><div><div>D-17 Class Code F: Satellite Communications Controllers. .1030</div></div></div><div><div><div></div></div></div><div><div><div>D-18 Class Code 10h: Encryption/Decryption Controllers .1030</div></div></div><div><div><div></div></div></div><div><div><div>D-19 Class Code 11h: Data Acquisition and Signal Processing Controllers . .1031</div></div></div><div><div><div></div></div></div><div><div><div>D-20 Definition of IDE Programmer's Interface Byte Encoding ..1031</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="55" id="mark-7b926a2e-e923-4766-bade-d21440ed5367" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Acknowledgments</div></div></h2><div><div><div></div></div></div><div><div><div>Thanks to those who made significant contributions to this book:</div></div></div><div><div><div></div></div></div><div><div><div>Joe Winkles - for this superb job of technical editing.</div></div></div><div><div><div></div></div></div><div><div><div>Jay Trodden - for his contribution in developing the chapter on Transaction Routing and Packet-Based Transactions.</div></div></div><div><div><div></div></div></div><div><div><div>Mike Jackson - for his contribution in preparing the Card Electromechanical chapter.</div></div></div><div><div><div></div></div></div><div><div><div>Dave Dzatko - for research and editing.</div></div></div><div><div><div></div></div></div><div><div><div>Special thanks to Agilent Technologies for supplying:</div></div></div><div><div><div></div></div></div><div><div><div>Appendix A: Test, Debug and Verification of PCI Express Designs by Gordon Getty, Agilent Technologies</div></div></div><div><div><div></div></div></div><div><div><div>Special thanks to PLX Technology for contributing two appendices:</div></div></div><div><div><div></div></div></div><div><div><div>Appendix B: Markets &amp; Applications for the PCI Express <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="114" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c4D"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mrow data-mjx-texclass="ORD"></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">TM</mi></mrow></mrow></mrow></msup></math></mjx-assistive-mml></mjx-container> Architecture Appendix C: Implementing Intelligent Adapters and Multi-Host Systems With PCI Express <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="115" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c4D"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mrow data-mjx-texclass="ORD"></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">TM</mi></mrow></mrow></mrow></msup></math></mjx-assistive-mml></mjx-container> Technology</div></div></div><div><div><div></div></div></div><div><div><div>Thanks also to the PCI SIG for giving permission to use some of the mechanical drawings from the specification.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="56" id="mark-b47d1b07-6dd8-4daa-a1f6-0a1f7f8c0378" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>The MindShare Architecture Series</div></div></h2><div><div><div></div></div></div><div><div><div>The MindShare Architecture book series currently includes the books listed in Table 1 below. The entire book series is published by Addison-Wesley.</div></div></div><div><div><div></div></div></div><div><div><div>Table 1: PC Architecture Book Series</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Category</th><th>Title</th><th>Edition</th><th>ISBN</th></tr></thead><tbody><tr><td rowspan="4">Processor Architecture</td><td>80486 System Architecture</td><td>3rd</td><td>0-201-40994-1</td></tr><tr><td>Pentium Processor System Architecture</td><td>2nd</td><td>0-201-40992-5</td></tr><tr><td>Pentium Pro and Pentium II System Architecture</td><td>2nd</td><td>0-201-30973-4</td></tr><tr><td>PowerPC System Architecture</td><td>1st</td><td>0-201-40990-9</td></tr><tr><td rowspan="8">Bus Architecture</td><td>PCI System Architecture</td><td>4th</td><td>0-201-30974-2</td></tr><tr><td>PCI-X System Architecture</td><td>1st</td><td>0-201-72682-3</td></tr><tr><td>EISA System Architecture</td><td>Out-of- print</td><td>0-201-40995-X</td></tr><tr><td>Firewire System Architecture: IEEE 1394a</td><td>2nd</td><td>0-201-48535-4</td></tr><tr><td>ISA System Architecture</td><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="116" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-c64"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>3</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">rd</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container></td><td>0-201-40996-8</td></tr><tr><td>Universal Serial Bus System Architecture 2.0</td><td>2nd</td><td>0-201-46137-4</td></tr><tr><td>HyperTransport System Architecture</td><td>1st</td><td>0-321-16845-3</td></tr><tr><td>PCI Express System Architecture</td><td>1st</td><td>0-321-15630-7</td></tr><tr><td>Network Architecture</td><td>Infiniband Network Architecture</td><td>1st</td><td>0-321-11765-4</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="57" id="mark-d1041813-11cc-43f4-ad38-c105bd326b7b" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 1: PC Architecture Book Series (Continued)</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Category</th><th>Title</th><th>Edition</th><th>ISBN</th></tr></thead><tbody><tr><td rowspan="5">Other Architectures</td><td>PCMCIA System Architecture: 16-Bit PC Cards</td><td>2nd</td><td>0-201-40991-7</td></tr><tr><td>CardBus System Architecture</td><td>1st</td><td>0-201-40997-6</td></tr><tr><td>Plug and Play System Architecture</td><td>1st</td><td>0-201-41013-3</td></tr><tr><td>Protected Mode Software Architecture</td><td>1st</td><td>0-201-55447-X</td></tr><tr><td>AGP System Architecture</td><td>1st</td><td>0-201-37964-3</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>Cautionary Note</div></div></h2><div><div><div></div></div></div><div><div><div>The reader should keep in mind that MindShare's book series often details rapidly evolving technologies, as is the case with PCI Express. This being the case, it should be recognized that the book is a "snapshot" of the state of the technology at the time the book was completed. We make every attempt to produce our books on a timely basis, but the next revision of the specification is not introduced in time to make necessary changes. This PCI Express book complies with revision 1.0a of the PCI Express <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="117" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c4D"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mrow data-mjx-texclass="ORD"></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">TM</mi></mrow></mrow></mrow></msup></math></mjx-assistive-mml></mjx-container> Base Specification released and trademarked by the PCI Special Interest Group. Several expansion card form-factor specifications are planned for PCI Express, but only the Electromechanical specification, revision 1.0 was released when this book was completed. However, the chapter covering the Card Electromechanical topic reviews several form-factors that were under development at the time of writing.</div></div></div><div><div><div></div></div></div><h2><div><div>Intended Audience</div></div></h2><div><div><div></div></div></div><div><div><div>This book is intended for use by hardware and software design and support personnel. The tutorial approach taken may also make it useful to technical personnel not directly involved design, verification, and other support functions.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="58" id="mark-354baaad-fbd1-4b9c-ab85-c2361d5561b1" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Prerequisite Knowledge</div></div></h2><div><div><div></div></div></div><div><div><div>It is recommended that the reader has a reasonable background in PC architecture, including experience or knowledge of an I/O bus and related protocol. Because PCI Express maintains several levels of compatibility with the original PCI design, critical background information regarding PCI has been incorporated into this book. However, the reader may find it beneficial to read the MindShare publication entitled PCI System Architecture, which focusses on and details the PCI architecture.</div></div></div><div><div><div></div></div></div><h2><div><div>Topics and Organization</div></div></h2><div><div><div></div></div></div><div><div><div>Topics covered in this book and the flow of the book are as follows:</div></div></div><div><div><div></div></div></div><div><div><div>Part 1: Background and Comprehensive Overview. Provides an architectural perspective of the PCI Express technology by comparing and contrasting it with the PCI and PCI-X buses. It also introduces the major features of the PCI Express architecture.</div></div></div><div><div><div></div></div></div><div><div><div>Part 2: PCI Express Transaction Protocol. Includes packet format and field definition and use, along with transaction and link layer functions.</div></div></div><div><div><div></div></div></div><div><div><div>Part 3: Physical Layer Description. Describes the physical layer functions, link training and initialization, reset, and electrical signaling.</div></div></div><div><div><div></div></div></div><div><div><div>Part 4: Power-Related Topics. Discusses Power Budgeting and Power Management.</div></div></div><div><div><div></div></div></div><div><div><div>Part 5: Optional Topics. Discusses the major features of PCI Express that are optional, including Hot Plug and Expansion Card implementation details.</div></div></div><div><div><div></div></div></div><div><div><div>Part 6: PCI Express Configuration. Discusses the configuration process, accessing configuration space, and details the content and use of all configuration registers.</div></div></div><div><div><div></div></div></div><div><div><div>Appendix:</div></div></div><div><div><div></div></div></div><div><ul><li>Test, Debug, and Verification</li></ul></div><div><div><div></div></div></div><div><ul><li>Markets &amp;Applications for the PCI Express <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="118" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c4D"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mrow data-mjx-texclass="ORD"></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">TM</mi></mrow></mrow></mrow></msup></math></mjx-assistive-mml></mjx-container> Architecture</li></ul></div><div><div><div></div></div></div><div><ul><li>Implementing Intelligent Adapters and Multi-Host Systems With PCI Express <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="119" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c4D"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mrow data-mjx-texclass="ORD"></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">TM</mi></mrow></mrow></mrow></msup></math></mjx-assistive-mml></mjx-container> Technology</li></ul></div><div><div><div></div></div></div><div><ul><li>PCI Express Class Codes</li></ul></div><div><div><div></div></div></div><div><ul><li>Legacy Support for Locking</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="59" id="mark-611e6a96-7e01-4a9b-90b2-21c773d1dea1" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Documentation Conventions</div></div></h2><div><div><div></div></div></div><div><div><div>This section defines the typographical convention used throughout this book.</div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express TM</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="120" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c4D"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mrow data-mjx-texclass="ORD"></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">TM</mi></mrow></mrow></mrow></msup></math></mjx-assistive-mml></mjx-container> is a trademark of the PCI SIG. This book takes the liberty of abbreviating PCI Express as "PCI-XP" primarily in illustration where limited space is an issue.</div></div></div><div><div><div></div></div></div><h2><div><div>Hexadecimal Notation</div></div></h2><div><div><div></div></div></div><div><div><div>All hex numbers are followed by a lower case "h." For example:</div></div></div><div><div><div></div></div></div><div><div><div>89F2BD02h</div></div></div><div><div><div></div></div></div><div><div><div>0111h</div></div></div><div><div><div></div></div></div><h2><div><div>Binary Notation</div></div></h2><div><div><div></div></div></div><div><div><div>All binary numbers are followed by a lower case "b." For example:</div></div></div><div><div><div></div></div></div><div><div><div>1000100111110010b</div></div></div><div><div><div></div></div></div><div><div><div>01b</div></div></div><div><div><div></div></div></div><h2><div><div>Decimal Notation</div></div></h2><div><div><div></div></div></div><div><div><div>Number without any suffix are decimal. When required for clarity, decimal numbers are followed by a lower case "d." Examples:</div></div></div><div><div><div></div></div></div><div><div><div>9</div></div></div><div><div><div></div></div></div><div><div><div>15</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="121" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c64"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>512</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">d</mi></mrow></math></mjx-assistive-mml></mjx-container></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="60" id="mark-1f1dd72f-3a34-49d1-ad73-59e1880a01ef" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Bits Versus Bytes Notation</div></div></h2><div><div><div></div></div></div><div><div><div>This book represents bit with lower case "b" and bytes with an upper case "B." For example:</div></div></div><div><div><div></div></div></div><div><div><div>Megabits/second <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="122" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">Mb</mi></mrow></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container></div></div></div><div><div><div></div></div></div><div><div><div>Megabytes/second <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="123" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MB</mi></mrow></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container></div></div></div><div><div><div></div></div></div><h2><div><div>Bit Fields</div></div></h2><div><div><div></div></div></div><div><div><div>Groups bits are represented with the high-order bits first followed by the low-order bits and enclosed by brackets. For example:</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="124" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c37"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3A"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo></mjx-mrow><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">[</mo><mrow data-mjx-texclass="ORD"><mn>7</mn><mo>:</mo><mn>0</mn></mrow><mo data-mjx-texclass="CLOSE">]</mo></mrow><mo>=</mo></math></mjx-assistive-mml></mjx-container> bits 0 through 7</div></div></div><div><div><div></div></div></div><h2><div><div>Active Signal States</div></div></h2><div><div><div></div></div></div><div><div><div>Signals that are active low are followed by #, as in PERST# and WAKE#. Active high signals have no suffix, such as POWERGOOD.</div></div></div><div><div><div></div></div></div><h2><div><div>Visit Our Web Site</div></div></h2><div><div><div></div></div></div><div><div><div>Our web site lists all of our courses and the delivery options available for each course:</div></div></div><div><div><div></div></div></div><div><ul><li>Information on MindShare courses:</li></ul></div><div><div><div></div></div></div><div><ul><li>Self-paced DVDs and CDs</li></ul></div><div><div><div></div></div></div><div><ul><li>Live web-delivered classes</li></ul></div><div><div><div></div></div></div><div><ul><li>Live on-site classes.</li></ul></div><div><div><div></div></div></div><div><ul><li>Free short courses on selected topics</li></ul></div><div><div><div></div></div></div><div><ul><li>Technical papers</li></ul></div><div><div><div></div></div></div><div><ul><li>Errata for a number of our books</li></ul></div><div><div><div></div></div></div><div><div><div>All of our books are listed and can be ordered in bound or e-book versions.</div></div></div><div><div><div></div></div></div><div><div><div>www.mindshare.com</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="61" id="mark-63c55984-1eea-46a3-8dd6-88c43ed62538" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><h2><div><div>We Want Your Feedback</div></div></h2><div><div><div></div></div></div><div><div><div>MindShare values you comments and suggestions. Contact us at:</div></div></div><div><div><div></div></div></div><div><div><div>Phone: (719) 487-1417 or within the U.S. (800) 633-1440</div></div></div><div><div><div></div></div></div><div><div><div>Fax: (719) 487-1434 (Fax)</div></div></div><div><div><div></div></div></div><div><div><div>Technical seminars: E-mail nancy@mindshare.com</div></div></div><div><div><div></div></div></div><div><div><div>Technical questions: E-mail don@mindshare.com or tom@mindshare.com</div></div></div><div><div><div></div></div></div><div><div><div>General information: E-mail info@mindshare.com</div></div></div><div><div><div></div></div></div><div><div><div>Mailing Address:</div></div></div><div><div><div></div></div></div><div><div><div>MindShare, Inc.</div></div></div><div><div><div></div></div></div><div><div><div>4285 Slash Pine Drive</div></div></div><div><div><div></div></div></div><div><div><div>Colorado Springs, CO 80908</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="62" id="mark-a9cbfa20-46b4-4081-920a-abb39e0f31c3" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Part One</div></div></div><div><div><div></div></div></div><div><div><div>The Big Picture 1</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="63" id="mark-45696055-e83c-4898-897f-37f40109adea" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Architectural  Perspective</div></div></h2><div><div><div></div></div></div><h2><div><div>This Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>This chapter describes performance advantages and key features of the PCI Express (PCI-XP) Link. To highlight these advantages, this chapter describes performance characteristics and features of predecessor buses such as PCI and PCI-X buses with the goal of discussing the evolution of PCI Express from these predecessor buses. The reader will be able to compare and contrast features and performance points of PCI, PCI-X and PCI Express buses. The key features of a PCI Express system are described. In addition, the chapter describes some examples of PCI Express system topologies.</div></div></div><div><div><div></div></div></div><h2><div><div>The Next Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>The next chapter describes in further detail the features of the PCI Express bus. It describes the layered architecture of a device design while providing a brief functional description of each layer. The chapter provides an overview of packet formation at a transmitter device, the transmission and reception of the packet over the PCI Express Link and packet decode at a receiver device.</div></div></div><div><div><div></div></div></div><h2><div><div>Introduction To PCI Express</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express is the third generation high performance I/O bus used to interconnect peripheral devices in applications such as computing and communication platforms. The first generation buses include the ISA, EISA, VESA, and Micro Channel buses, while the second generation buses include PCI, AGP, and PCI-X. PCI Express is an all encompassing I/O device interconnect bus that has applications in the mobile, desktop, workstation, server, embedded computing and communication platforms.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="64" id="mark-e417eeb7-a9bd-4239-acf2-589fe5d5316a" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>The Role of the Original PCI Solution</div></div></h2><div><div><div></div></div></div><h2><div><div>Don't Throw Away What is Good! Keep It</div></div></h2><div><div><div></div></div></div><div><div><div>The PCI Express architects have carried forward the most beneficial features from previous generation bus architectures and have also taken advantages of new developments in computer architecture.</div></div></div><div><div><div></div></div></div><div><div><div>For example, PCI Express employs the same usage model and load-store communication model as PCI and PCI-X. PCI Express supports familiar transactions such as memory read/write, IO read/write and configuration read/write transactions. The memory, IO and configuration address space model is the same as PCI and PCI-X address spaces. By maintaining the address space model, existing OSs and driver software will run in a PCI Express system without any modifications. In other words, PCI Express is software backwards compatible with PCI and PCI-X systems. In fact, a PCI Express system will boot an existing OS with no changes to current drivers and application programs. Even PCI/ACPI power management software will still run.</div></div></div><div><div><div></div></div></div><div><div><div>Like predecessor buses, PCI Express supports chip-to-chip interconnect and board-to-board interconnect via cards and connectors. The connector and card structure are similar to PCI and PCI-X connectors and cards. A PCI Express motherboard will have a similar form factor to existing FR4 ATX motherboards which is encased in the familiar PC package.</div></div></div><div><div><div></div></div></div><h2><div><div>Make Improvements for the Future</div></div></h2><div><div><div></div></div></div><div><div><div>To improve bus performance, reduce overall system cost and take advantage of new developments in computer design, the PCI Express architecture had to be significantly re-designed from its predecessor buses. PCI and PCI-X buses are multi-drop parallel interconnect buses in which many devices share one bus.</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express on the other hand implements a serial, point-to-point type interconnect for communication between two devices. Multiple PCI Express devices are interconnected via the use of switches which means one can practically connect a large number of devices together in a system. A point-to-point interconnect implies limited electrical load on the link allowing transmission and reception frequencies to scale to much higher numbers. Currently PCI Express transmission and reception data rate is <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="125" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c47"></mjx-c><mjx-c class="mjx-c62"></mjx-c><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c74"></mjx-c><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c63"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>2.5</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">Gbits</mi></mrow></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">sec</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> . A serial interconnect between two devices results in fewer pins per device package which reduces PCI Express chip and board design cost and reduces board design complexity. PCI Express performance is also highly scalable. This is achieved by implement-</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="65" id="mark-f0d704e8-40c7-48bb-ab72-657d96a4966d" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>ing scalable numbers for pins and signal Lanes per interconnect based on communication performance requirements for that interconnect.</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express implements switch-based technology to interconnect a large number of devices. Communication over the serial interconnect is accomplished using a packet-based communication protocol. Quality Of Service (QoS) features provide differentiated transmission performance for different applications. Hot Plug/Hot Swap support enables "always-on" systems. Advanced power management features allow one to design for low power mobile applications. RAS (Reliable, Available, Serviceable) error handling features make PCI Express suitable for robust high-end server applications. Hot plug, power management, error handling and interrupt signaling are accomplished in-band using packet based messaging rather than side-band signals. This keeps the device pin count low and reduces system cost.</div></div></div><div><div><div></div></div></div><div><div><div>The configuration address space available per function is extended to <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="126" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>4</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">KB</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> , allowing designers to define additional registers. However, new software is required to access this extended configuration register space.</div></div></div><div><div><div></div></div></div><h2><div><div>Looking into the Future</div></div></h2><div><div><div></div></div></div><div><div><div>In the future, PCI Express communication frequencies are expected to double and quadruple to 5 Gbits/sec and 10 Gbits/sec. Taking advantage of these frequencies will require Physical Layer re-design of a device with no changes necessary to the higher layers of the device design.</div></div></div><div><div><div></div></div></div><div><div><div>Additional mechanical form factors are expected. Support for a Server IO Module, Newcard (PC Card style), and Cable form factors are expected.</div></div></div><div><div><div></div></div></div><h2><div><div>Predecessor Buses Compared</div></div></h2><div><div><div></div></div></div><div><div><div>In an effort to compare and contrast features of predecessor buses, the next section of this chapter describes some of the key features of IO bus architectures defined by the PCI Special Interest Group (PCISIG). These buses, shown in Table 1-1 on page 12, include the PCI 33 MHz bus, PCI- 66 MHz bus, PCI-X 66 MHz/133 MHz buses, PCI-X 266/533 MHz buses and finally PCI Express.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="66" id="mark-d00d72b8-d78b-4b18-8dd5-fde2b8ce6371" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Table 1-1: Bus Specifications and Release Dates</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Bus Type</th><th>Specification Release</th><th>Date of Release</th></tr></thead><tbody><tr><td>PCI 33 MHz</td><td>2.0</td><td>1993</td></tr><tr><td>PCI 66 MHz</td><td>2.1</td><td>1995</td></tr><tr><td>PCI-X 66 MHz and 133 MHz</td><td>1.0</td><td>1999</td></tr><tr><td>PCI-X 266 MHz and 533 MHz</td><td>2.0</td><td>Q1, 2002</td></tr><tr><td>PCI Express</td><td>1.0</td><td>Q2, 2002</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>Author's Disclaimer</div></div></h2><div><div><div></div></div></div><div><div><div>In comparing these buses, it is not the authors' intention to suggest that any one bus is better than any other bus. Each bus architecture has its advantages and disadvantages. After evaluating the features of each bus architecture, a particular bus architecture may turn out to be more suitable for a specific application than another bus architecture. For example, it is the system designers responsibility to determine whether to implement a PCI-X bus or PCI Express for the I/ O interconnect in a high-end server design. Our goal in this chapter is to document the features of each bus architecture so that the designer can evaluate the various bus architectures.</div></div></div><div><div><div></div></div></div><h2><div><div>Bus Performances and Number of Slots Compared</div></div></h2><div><div><div></div></div></div><div><div><div>Table 1-2 on page 13 shows the various bus architectures defined by the PCISIG. The table shows the evolution of bus frequencies and bandwidths. As is obvious, increasing bus frequency results in increased bandwidth. However, increasing bus frequency compromises the number of electrical loads or number of connectors allowable on a bus at that frequency. At some point, for a given bus architecture, there is an upper limit beyond which one cannot further increase the bus frequency, hence requiring the definition of a new bus architecture.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="67" id="mark-d42d337a-4f71-4452-9cff-5dd0fca121e5" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Table 1-2: Comparison of Bus Frequency, Bandwidth and Number of Slots</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Bus Type</th><th>Clock Frequency</th><th>Peak Bandwidth *</th><th>Number of Card Slots per Bus</th></tr></thead><tbody><tr><td>PCI 32-bit</td><td>33 MHz</td><td>133 MBytes/sec</td><td>4-5</td></tr><tr><td>PCI 32-bit</td><td>66 MHz</td><td>266 MBytes/sec</td><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="127" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mo>−</mo><mn>2</mn></math></mjx-assistive-mml></mjx-container></td></tr><tr><td>PCI-X 32-bit</td><td>66 MHz</td><td>266 MBytes/sec</td><td>4</td></tr><tr><td>PCI-X 32-bit</td><td>133 MHz</td><td>533 MBytes/sec</td><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="128" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mo>−</mo><mn>2</mn></math></mjx-assistive-mml></mjx-container></td></tr><tr><td>PCI-X 32-bit</td><td>266 MHz effective</td><td>1066 MBytes/sec</td><td>1</td></tr><tr><td>PCI-X 32-bit</td><td>533 MHz effective</td><td>2131 MByte/sec</td><td>1</td></tr><tr><td colspan="4">* Double all these bandwidth numbers for 64-bit bus implementations</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>PCI Express Aggregate Throughput</div></div></h2><div><div><div></div></div></div><div><div><div>A PCI Express interconnect that connects two devices together is referred to as a Link. A Link consists of either <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="129" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c2C"></mjx-c></mjx-mo><mjx-texatom space="2" texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c2C"></mjx-c></mjx-mo><mjx-texatom space="2" texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c2C"></mjx-c></mjx-mo><mjx-texatom space="2" texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c2C"></mjx-c></mjx-mo><mjx-texatom space="2" texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c2C"></mjx-c></mjx-mo><mjx-texatom space="2" texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">x</mi></mrow><mn>1</mn><mo>,</mo><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">x</mi></mrow><mn>2</mn><mo>,</mo><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">x</mi></mrow><mn>4</mn><mo>,</mo><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">x</mi></mrow><mn>8</mn><mo>,</mo><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">x</mi></mrow><mrow data-mjx-texclass="ORD"><mn>12</mn></mrow><mo>,</mo><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">x</mi></mrow><mrow data-mjx-texclass="ORD"><mn>16</mn></mrow></math></mjx-assistive-mml></mjx-container> or <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="130" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">x</mi></mrow><mrow data-mjx-texclass="ORD"><mn>32</mn></mrow></math></mjx-assistive-mml></mjx-container> signal pairs in each direction. These signals are referred to as Lanes. A designer determines how many Lanes to implement based on the targeted performance benchmark required on a given Link.</div></div></div><div><div><div></div></div></div><div><div><div>Table 1-3 shows aggregate bandwidth numbers for various Link width implementations. As is apparent from this table, the peak bandwidth achievable with PCI Express is significantly higher than any existing bus today.</div></div></div><div><div><div></div></div></div><div><div><div>Let us consider how these bandwidth numbers are calculated. The transmission/reception rate is 2.5 Gbits/sec per Lane per direction. To support a greater degree of robustness during data transmission and reception, each byte of data transmitted is converted into a 10-bit code (via an <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="131" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> encoder in the transmitter device). In other words, for every Byte of data to be transmitted, 10-bits of encoded data are actually transmitted. The result is <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="132" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom><mjx-mi class="mjx-n"><mjx-c class="mjx-c25"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>25</mn></mrow><mi mathvariant="normal">%</mi></math></mjx-assistive-mml></mjx-container> additional overhead to transmit a byte of data. Table 1-3 accounts for this <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="133" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom><mjx-mi class="mjx-n"><mjx-c class="mjx-c25"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>25</mn></mrow><mi mathvariant="normal">%</mi></math></mjx-assistive-mml></mjx-container> loss in transmission performance.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="68" id="mark-11ef85ad-1cb8-4b65-9af9-04acbad2f859" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express implements a dual-simplex Link which implies that data is transmitted and received simultaneously on a transmit and receive Lane. The aggregate bandwidth assumes simultaneous traffic in both directions.</div></div></div><div><div><div></div></div></div><div><div><div>To obtain the aggregate bandwith numbers in Table 1-3 multiply 2.5 Gbits/sec by 2 (for each direction), then multiply by number of Lanes, and finally divide by 10-bits per Byte (to account for the 8-to-10 bit encoding).</div></div></div><div><div><div></div></div></div><div><div><div>Table 1-3: PCI Express Aggregate Throughput for Various Link Widths</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>PCI Express Link Width</th><th>x1</th><th>x2</th><th>x4</th><th>x8</th><th>x12</th><th>x16</th><th>x32</th></tr></thead><tbody><tr><td>Aggregate Band- width (GBytes/sec)</td><td>0.5</td><td>1</td><td>2</td><td>4</td><td>6</td><td>8</td><td>16</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>Performance Per Pin Compared</div></div></h2><div><div><div></div></div></div><div><div><div>As is apparent from Figure 1-1, PCI Express achieves the highest bandwidth per pin. This results in a device package with fewer pins and a motherboard implementation with few wires and hence overall reduced system cost per unit bandwidth.</div></div></div><div><div><div></div></div></div><div><div><div>In Figure 1-1, the first 7 bars are associated with PCI and PCI-X buses where we assume 84 pins per device. This includes 46 signal pins, interrupt and power management pins, error pins and the remainder are power and ground pins. The last bar associated with a x8 PCI Express Link assumes 40 pins per device which include 32 signal lines (8 differential pairs per direction) and the rest are power and ground pins.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="69" id="mark-34272505-1822-4f7f-b161-8cdd800d832d" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 1: Architectural Perspective</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 1-1: Comparison of Performance Per Pin for Various Buses</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_74.jpg?x=224&amp;y=441&amp;w=1001&amp;h=690"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="70" id="mark-a6bd7177-50f0-4dc2-86fa-c8d26a0d94b1" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>I/O Bus Architecture Perspective</div></div></h2><div><div><div></div></div></div><h2><div><div>33 MHz PCI Bus Based System</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 1-2 on page 17 is a 33 MHz PCI bus based system. The PCI system consists of a Host (CPU) bus-to-PCI bus bridge, also referred to as the North bridge. Associated with the North bridge is the system memory bus, graphics (AGP) bus,and a <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="134" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>33</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MHz</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> PCI bus. I/O devices share the PCI bus and are connected to it in a multi-drop fashion. These devices are either connected directly to the PCI bus on the motherboard or by way of a peripheral card plugged into a connector on the bus. Devices connected directly to the motherboard consume one electrical load while connectors are accounted for as 2 loads. A South bridge bridges the PCI bus to the ISA bus where slower, lower performance peripherals exist. Associated with the south bridge is a USB and IDE bus. A CD or hard disk is associated with the IDE bus. The South bridge contains an interrupt controller (not shown) to which interrupt signals from PCI devices are connected. The interrupt controller is connected to the CPU via an INTR signal or an APIC bus. The South bridge is the central resource that provides the source of reset, reference clock, and error reporting signals. Boot ROM exists on the ISA bus along with a Super IO chip, which includes keyboard, mouse, floppy disk controller and serial/parallel bus controllers. The PCI bus arbiter logic is included in the North bridge.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 1-3 on page 18 represents a typical PCI bus cycle. The PCI bus clock is 33 MHz. The address bus width is 32-bits (4GB memory address space), although PCI optionally supports 64-bit address bus. The data bus width is implemented as either 32-bits or 64-bits depending on bus performance requirement. The address and data bus signals are multiplexed on the same pins (AD bus) to reduce pin count. Command signals (C/BE#) encode the transaction type of the bus cycle that master devices initiate. PCI supports 12 transaction types that include memory, IO, and configuration read/write bus cycles. Control signals such as FRAME#, DEVSEL#, TRDY#, IRDY#, STOP# are handshake signals used during bus cycles. Finally, the PCI bus consists of a few optional error related signals, interrupt signals and power management signals. A PCI master device implements a minimum of 49 signals.</div></div></div><div><div><div></div></div></div><div><div><div>Any PCI master device that wishes to initiate a bus cycle first arbitrates for use of the PCI bus by asserting a request (REQ#) to the arbiter in the North bridge. After receiving a grant (GNT#) from the arbiter and checking that the bus is idle, the master device can start a bus cycle.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="71" id="mark-e5064886-6735-473f-819c-0800181dd295" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 1-2: 33 MHz PCI Bus Based Platform</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_76.jpg?x=222&amp;y=440&amp;w=999&amp;h=792"></div></div><div><div><div></div></div></div><h2><div><div>Electrical Load Limit of a 33 MHz PCI Bus</div></div></h2><div><div><div></div></div></div><div><div><div>The PCI specification theoretically supports 32 devices per PCI bus. This means that PCI enumeration software will detect and recognize up to 32 devices per bus. However, as a rule of thumb, a PCI bus can support a maximum of 10-12 electrical loads (devices) at <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="135" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>33</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MHz</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> . PCI implements a static clocking protocol with a clock period of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="136" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c6E"></mjx-c><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>30</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">ns</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> at <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="137" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>33</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MHz</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> .</div></div></div><div><div><div></div></div></div><div><div><div>PCI implements reflected-wave switching signal drivers. The driver drives a half signal swing signal on the rising edge of PCI clock. The signal propagates down the PCI bus transmission line and is reflected at the end of the transmission line where there is no termination. The reflection causes the half swing signal to double. The doubled (full signal swing) signal must settle to a steady state PCI Express System Architecture value with sufficient setup time prior to the next rising edge of PCI clock where receiving devices sample the signal. The total time from when a driver drives a signal until the receiver detects a valid signal (including propagation time and reflection delay plus setup time) must be less than the clock period of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="138" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c6E"></mjx-c><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>30</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">ns</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> .</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="72" id="mark-f824ebd6-0e29-4793-b619-a9350d2552bb" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 1-3: Typical PCI Burst Memory Read Bus Cycle</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_77.jpg?x=334&amp;y=551&amp;w=775&amp;h=878"></div></div><div><div><div></div></div></div><div><div><div>The more electrical loads on a bus, the longer it takes for the signal to propagate and double with sufficient setup to the next rising edge of clock. As mentioned earlier, a 33 MHz PCI bus meets signal timing with no more than 10-12 loads. Connectors on the PCI bus are counted as 2 loads because the connector is accounted for as one load and the peripheral card with a PCI device is the second load. As indicated in Table 1-2 on page 13 a 33 MHz PCI bus can be designed with a maximum of 4-5 connectors.</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="73" id="mark-76773816-f8ce-40ab-afdc-58246bd5f121" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Chapter 1: Architectural Perspective</div></div></h2><div><div><div></div></div></div><div><div><div>To connect any more than 10-12 loads in a system requires the implementation of a PCI-to-PCI bridge as shown in Figure 1-4. This permits an additional 10-12 loads to be connected on the secondary PCI bus 1. The PCI specification theoretically supports up to 256 buses in a system. This means that PCI enumeration software will detect and recognize up to <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="139" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c50"></mjx-c><mjx-c class="mjx-c43"></mjx-c><mjx-c class="mjx-c49"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>256</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">PCI</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> bridges per system.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 1-4: 33 MHz PCI Based System Showing Implementation of a PCI-to-PCI Bridge</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_78.jpg?x=223&amp;y=578&amp;w=995&amp;h=710"></div></div><div><div><div></div></div></div><div><div><div>PCI Transaction Model - Programmed IO</div></div></div><div><div><div></div></div></div><div><div><div>Consider an example in which the CPU communicates with a PCI peripheral such as an Ethernet device shown in Figure 1-5. Transaction 1 shown in the figure, which is initiated by the CPU and targets a peripheral device, is referred to as a programmed IO transaction. Software commands the CPU to initiate a memory or IO read/write bus cycle on the host bus targeting an address mapped in a PCI device's address space. The North bridge arbitrates for use of the PCI bus and when it wins ownership of the bus generates a PCI memory or IO read/write bus cycle represented in Figure 1-3 on page 18. During the first clock of this bus cycle (known as the address phase), all target devices decode PCI Express System Architecture</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="74" id="mark-82fa8423-6afc-4928-96a2-1f76bdc0fbdc" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>the address. One target (the Ethernet device in this example) decodes the address and claims the transaction. The master (North bridge in this case) communicates with the claiming target (Ethernet controller). Data is transferred between master and target in subsequent clocks after the address phase of the bus cycle. Either 4 bytes or 8 bytes of data are transferred per clock tick depending on the PCI bus width. The bus cycle is referred to as a burst bus cycle if data is transferred back-to-back between master and target during multiple data phases of that bus cycle. Burst bus cycles result in the most efficient use of PCI bus bandwidth.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 1-5: PCI Transaction Model</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_79.jpg?x=224&amp;y=697&amp;w=992&amp;h=775"></div></div><div><div><div></div></div></div><div><div><div>At <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="140" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>33</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MHz</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> and the bus width of 32-bits (4 Bytes),peak bandwidth achievable is 4 Bytes <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="141" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-cD7"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c42"></mjx-c><mjx-c class="mjx-c79"></mjx-c><mjx-c class="mjx-c74"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c63"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>×</mo><mrow data-mjx-texclass="ORD"><mn>33</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MHz</mi></mrow></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>133</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MBytes</mi></mrow></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">sec</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> . Peak bandwidth on a 64-bit bus is 266 Mbytes/sec. See Table 1-2 on page 13.</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="75" id="mark-4bf83bc3-7e78-4781-975a-96229e84be5a" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Efficiency of the PCI bus for data payload transport is in the order of 50%. Efficiency is defined as number of clocks during which data is transferred divided by the number of total clocks, times 100 . The lost performance is due to bus idle time between bus cycles, arbitration time, time lost in the address phase of a bus cycle, wait states during data phases, delays during transaction retries (not discussed yet), as well as latencies through PCI bridges.</div></div></div><div><div><div></div></div></div><h2><div><div>PCI Transaction Model Direct Memory Access (DMA)</div></div></h2><div><div><div></div></div></div><div><div><div>Data transfer between a PCI device and system memory is accomplished in two ways:</div></div></div><div><div><div></div></div></div><div><div><div>The first less efficient method uses programmed IO transfers as discussed in the previous section. The PCI device generates an interrupt to inform the CPU that it needs data transferred. The device interrupt service routine (ISR) causes the CPU to read from the PCI device into one of its own registers. The ISR then tells the CPU to write from its register to memory. Similarly, if data is to be moved from memory to the PCI device, the ISR tells the CPU to read from memory into its own register. The ISR then tells the CPU to write from its register to the PCI device. It is apparent that the process is very inefficient for two reasons. First, there are two bus cycles generated by the CPU for every data transfer, one to memory and one to the PCI device. Second, the CPU is busy transferring data rather than performing its primary function of executing application code.</div></div></div><div><div><div></div></div></div><div><div><div>The second more efficient method to transfer data is the DMA (direct memory access) method illustrated by Transaction 2 in Figure 1-5 on page 20, where the PCI device becomes a bus master. Upon command by a local application (software) which runs on a PCI peripheral or the PCI peripheral hardware itself, the PCI device may initiate a bus cycle to talk to memory. The PCI bus master device (SCSI device in this example) arbitrates for the PCI bus, wins ownership of the bus and initiates a PCI memory bus cycle. The North bridge which decodes the address acts as the target for the transaction. In the data phase of the bus cycle, data is transferred between the SCSI master and the North bridge target. The bridge in turn generates a DRAM bus cycle to communicate with system memory. The PCI peripheral generates an interrupt to inform the system software that the data transfer has completed. This bus master or DMA method of data transport is more efficient because the CPU is not involved in the data move and further only one burst bus cycle is generated to move a block of data.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="76" id="mark-891808c4-d81b-4af7-9580-623ba7d04cc4" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><h2><div><div>PCI Transaction Model Peer-to-Peer</div></div></h2><div><div><div></div></div></div><div><div><div>A Peer-to-peer transaction shown as Transaction 3 in Figure 1-5 on page 20 is the direct transfer of data between two PCI devices. A master that wishes to initiate a transaction, arbitrates, wins ownership of the bus and starts a transaction. A target PCI device that recognizes the address claims the bus cycle. For a write bus cycle, data is moved from master to target. For a read bus cycle, data is moved from target to master.</div></div></div><div><div><div></div></div></div><h2><div><div>PCI Bus Arbitration</div></div></h2><div><div><div></div></div></div><div><div><div>A PCI device that wishes to initiate a bus cycle arbitrates for use of the bus first. The arbiter implements an arbitration algorithm with which it decides who to grant the bus to next. The arbiter is able to grant the bus to the next requesting device while a bus cycle is in progress. This arbitration protocol is referred to as hidden bus arbitration. Hidden bus arbitration allows for more efficient hand over of the bus from one bus master device to another with only one idle clock between two bus cycles (referred to as back-to-back bus cycles). PCI protocol does not provide a standard mechanism by which system software or device drivers can configure the arbitration algorithm in order to provide for differentiated class of service for various applications.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 1-6: PCI Bus Arbitration</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_81.jpg?x=222&amp;y=1054&amp;w=996&amp;h=607"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="77" id="mark-90669bcd-f22c-4178-9060-9ddc3db77e69" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Chapter 1: Architectural Perspective</div></div></h2><div><div><div></div></div></div><h2><div><div>PCI Delayed Transaction Protocol</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Retry Protocol: When a PCI master initiates a transaction to access a target device and the target device is not ready, the target signals a transaction retry. This scenario is illustrated in Figure 1-7.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 1-7: PCI Transaction Retry Mechanism PCI Express System Architecture</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_82.jpg?x=224&amp;y=581&amp;w=988&amp;h=771"></div></div><div><div><div></div></div></div><div><div><div>Consider the following example in which the North bridge initiates a memory read transaction to read data from the Ethernet device. The Ethernet target claims the bus cycle. However, the Ethernet target does not immediately have the data to return to the North bridge master. The Ethernet device has two choices by which to delay the data transfer. The first is to insert wait-states in the data phase. If only a few wait-states are needed, then the data is still transferred efficiently. If however the target device requires more time (more than 16 clocks from the beginning of the transaction), then the second option the target has is to signal a retry with a signal called STOP#. A retry tells the master to end</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="78" id="mark-61c3cc6a-8e98-4422-b2ff-a99eff49c788" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>the bus cycle prematurely without transferring data. Doing so prevents the bus from being held for a long time in wait-states, which compromises the bus efficiency. The bus master that is retried by the target waits a minimum of 2 clocks and must once again arbitrate for use of the bus to re-initiate the identical bus cycle. During the time that the bus master is retried, the arbiter can grant the bus to other requesting masters so that the PCI bus is more efficiently utilized. By the time the retried master is granted the bus and it re-initiates the bus cycle, hopefully the target will claim the cycle and will be ready to transfer data. The bus cycle goes to completion with data transfer. Otherwise, if the target is still not ready, it retries the master's bus cycle again and the process is repeated until the master successfully transfers data.</div></div></div><div><div><div></div></div></div><div><div><div>PCI Disconnect Protocol: When a PCI master initiates a transaction to access a target device and if the target device is able to transfer at least one doubleword of data but cannot complete the entire data transfer, it disconnects the bus cycle at the point at which it cannot continue the data transfer. This scenario is illustrated in Figure 1-8. Chapter 1: Architectural Perspective</div></div></div><div><div><div></div></div></div><div><div><div>Figure 1-8: PCI Transaction Disconnect Mechanism</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_83.jpg?x=262&amp;y=941&amp;w=925&amp;h=709"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="79" id="mark-d5a02e92-6685-439f-afb6-cf4d52023827" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Consider the following example in which the North bridge initiates a burst memory read transaction to read data from the Ethernet device. The Ethernet target device claims the bus cycle and transfers some data, but then runs out of data to transfer. The Ethernet device has two choices to delay the data transfer. The first option is to insert wait-states during the current data phase while waiting for additional data to arrive. If the target needs to insert only a few wait-states, then the data is still transferred efficiently. If however the target device requires more time (the PCI specification allows maximum of 8 clocks in the data phase), then the target device must signal a disconnect. To do this the target asserts STOP# in the middle of the bus cycle to tell the master to end the bus cycle prematurely. A disconnect results in some data is transferred, while a retry does not. Disconnect frees the bus from long periods of wait states. The disconnected master waits a minimum of 2 clocks before once again arbitrating for use of the bus and continuing the bus cycle at the disconnected address. During the time that the bus master is disconnected, the arbiter may grant the bus to other requesting masters so that the PCI bus is utilized more efficiently. By the time the disconnected master is granted the bus and continues the bus cycle, hopefully the target is ready to continue the data transfer until it is completed. Otherwise, the target once again retries or disconnects the master's bus cycle and the process is repeated until the master successfully transfers all its data.</div></div></div><div><div><div></div></div></div><h2><div><div>PCI Interrupt Handling</div></div></h2><div><div><div></div></div></div><div><div><div>Central to the PCI interrupt handling protocol is the interrupt controller shown in Figure 1-9. PCI devices use one-of-four interrupt signals (INTA#, INTB#, INTC#, INTD#) to trigger an interrupt request to the interrupt controller. In turn, the interrupt controller asserts INTR to the CPU. If the architecture supports an APIC (Advanced Programmable Interrupt Controller) then it sends an APIC message to the CPU as opposed to asserting the INTR signal. The interrupted CPU determines the source of the interrupt, saves its state and services the device that generated the interrupt. Interrupts on PCI INTx# signals are sharable. This allows multiple devices to generate their interrupts on the same interrupt signal. OS software has the overhead to determine which one of the devices sharing the interrupt signal generated the interrupt. This is accomplished by polling the Interrupt Pending bit mapped in a device's memory space. Doing so incurs additional latency in servicing the interrupting device.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="80" id="mark-35315f90-e618-458c-9d2c-f5eeb1872592" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 1-9: PCI Interrupt Handling</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_85.jpg?x=221&amp;y=424&amp;w=995&amp;h=777"></div></div><div><div><div></div></div></div><h2><div><div>PCI Error Handling</div></div></h2><div><div><div></div></div></div><div><div><div>PCI devices are optionally designed to detect address and data phase parity errors during transactions. Even parity is generated on the PAR signal during each bus cycle's address and data phases. The device that receives the address or data during a bus cycle uses the parity signal to determine if a parity error has occurred due to noise on the PCI bus. If a device detects an address phase parity error, it asserts SERR#. If a device detects a data phase parity error, it asserts PERR#. The PERR# and SERR# signals are connected to the error logic (in the South bridge) as shown in Figure 1-10 on page 27. In many systems, the error logic asserts the NMI signal (non-maskable interrupt signal) to the CPU upon detecting PERR# or SERR#. This interrupt results in notification of a parity error and the system shuts down (We all know the blue screen of death). Kind of draconian don't you agree?</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="81" id="mark-5bc2b6b0-96f9-4601-a4d2-be4e0d7cf9d3" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 1: Architectural Perspective</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 1-10: PCI Error Handling Protocol</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_86.jpg?x=219&amp;y=424&amp;w=1002&amp;h=730"></div></div><div><div><div></div></div></div><div><div><div>Unfortunately, PCI error detection and reporting is not robust. PCI errors are fatal uncorrectable errors that many times result in system shutdown. Further, errors are detectable as long as an odd number of signals are affected by noise. Given the poor PCI error detection protocol and error handling policies, many system designs either disable or do not support error checking and reporting.</div></div></div><div><div><div></div></div></div><h2><div><div>PCI Address Space Map</div></div></h2><div><div><div></div></div></div><div><div><div>PCI architecture supports 3 address spaces shown in Figure 1-11. These are the memory, IO and configuration address spaces. The memory address space goes up to <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="142" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c47"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>4</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">GB</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> for systems that support 32-bit memory addressing and optionally up to <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="143" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c45"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>16</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">EB</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> (exabytes) for systems that support 64-bit memory addressing. PCI supports up to <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="144" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c47"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>4</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">GB</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> of IO address space,however,many platforms limit IO space to <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="145" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>64</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">KB</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> due to X86 CPUs only supporting <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="146" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>64</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">KB</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> of IO address space. PCI devices are configured to map to a configurable region within either the memory or IO address space.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="82" id="mark-b2c9f151-a30d-453f-9de9-2d31148635da" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 1-11: Address Space Mapping</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_87.jpg?x=224&amp;y=450&amp;w=997&amp;h=755"></div></div><div><div><div></div></div></div><div><div><div>PCI device configuration registers map to a third space called configuration address space. Each PCI function may have up to 256 Bytes of configuration address space. The configuration address space is 16 MBytes. This is calculated by multiplying 256 Bytes, by 8 functions per device, by 32 devices per bus, by 256 buses per system. An <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="147" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-cD7"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>×</mo><mrow data-mjx-texclass="ORD"><mn>86</mn></mrow></math></mjx-assistive-mml></mjx-container> CPU can access memory or IO address space but does not support configuration address space directly. Instead, CPUs access PCI configuration space indirectly by indexing through an IO mapped Address Port and Data Port in the host bridge (North bridge or MCH). The Address Port is located at IO address CF8h-CFBh and the Data Port is mapped to location CFCh-CFFh.</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="83" id="mark-7b1aa727-aa84-4f6d-bb35-2c5c2f451e12" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Chapter 1: Architectural Perspective</div></div></h2><div><div><div></div></div></div><h2><div><div>PCI Configuration Cycle Generation</div></div></h2><div><div><div></div></div></div><div><div><div>PCI configuration cycle generation involves two steps.</div></div></div><div><div><div></div></div></div><div><div><div>Step 1: The CPU generates an IO write to the Address Port at IO address CF8h in the North bridge. The data written to the Address Port is the configuration register address to be accessed.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 1-12: PCI Configuration Cycle Generation</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_88.jpg?x=222&amp;y=630&amp;w=996&amp;h=732"></div></div><div><div><div></div></div></div><div><div><div>Step 2: The CPU either generates an IO read or IO write to the Data Port at location CFCh in the North bridge. The North bridge in turn then generates either a configuration read or configuration write transaction on the PCI bus.</div></div></div><div><div><div></div></div></div><div><div><div>The address for the configuration transaction address phase is obtained from the contents of the Address register. During the configuration bus cycle, one of the point-to-point IDSEL signals shown in Figure 1-12 on page 29 is asserted to select the device whose register is being accessed. That PCI target device claims the configuration cycle and fulfills the request.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="84" id="mark-dd6a7121-b61a-4990-aea8-b4dab469b69f" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Function Configuration Register Space</div></div></h2><div><div><div></div></div></div><div><div><div>Each PCI device contains up to 256 Bytes of configuration register space. The first 64 bytes are configuration header registers and the remainding 192 Bytes are device specific registers. The header registers are configured at boot time by the Boot ROM configuration firmware and by the OS. The device specific registers are configured by the device's device driver that is loaded and executed by the OS at boot time.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 1-13: 256 Byte PCI Function Configuration Register Space</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_89.jpg?x=247&amp;y=675&amp;w=966&amp;h=773"></div></div><div><div><div></div></div></div><div><div><div>Within the header space, the Base Address registers are one of the most important registers configured by the 'Plug and Play' configuration software. It is via these registers that software assigns a device its memory and/or IO address space within the system's memory and IO address space. No two devices are assigned the same address range, thus ensuring the 'plug and play' nature of the PCI system.</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="85" id="mark-cbc132d6-64d7-4b13-96e1-faea7ae30a91" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Programming Model</div></div></h2><div><div><div></div></div></div><div><div><div>Software instructions may cause the CPU to generate memory or IO read/write bus cycles. The North bridge decodes the address of the resulting CPU bus cycles, and if the address maps to PCI address space, the bridge in turn generates a PCI memory or IO read/write bus cycle. A target device on the PCI bus claims the cycle and completes the transfer. In summary, the CPU communicates with any PCI device via the North bridge, which generates PCI memory or IO bus cycles on the behalf of the CPU.</div></div></div><div><div><div></div></div></div><div><div><div>An intelligent PCI device that includes a local processor or bus master state machine (typically intelligent IO cards) can also initiate PCI memory or IO transactions on the PCI bus. These masters can communicate directly with any other devices, including system memory associated with the North bridge.</div></div></div><div><div><div></div></div></div><div><div><div>A device driver executing on the CPU configures the device-specific configuration register space of an associated PCI device. A configured PCI device that is bus master capable can initiate its own transactions, which allows it to communicate with any other PCI target device including system memory associated with the North bridge.</div></div></div><div><div><div></div></div></div><div><div><div>The CPU can access configuration space as described in the previous section.</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express architecture assumes the identical programming model as the PCI programming model described above. In fact, current OSs written for PCI systems can boot a PCI Express system. Current PCI device drivers will initialize PCI Express devices without any driver changes. PCI configuration and enumeration firmware will function unmodified on a PCI Express system.</div></div></div><div><div><div></div></div></div><h2><div><div>Limitations of a 33 MHz PCI System</div></div></h2><div><div><div></div></div></div><div><div><div>As indicated in Table 1-2 on page 13, peak bandwidth achievable on a 64-bit 33 MHz PCI bus is <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="148" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>266</mn></mrow></math></mjx-assistive-mml></mjx-container> Mbytes/sec. Current high-end workstation and server applications require greater bandwidth.</div></div></div><div><div><div></div></div></div><div><div><div>Applications such as gigabit Ethernet and high performance disc transfers in RAID and SCSI configurations require greater bandwidth capability than the 33 MHz PCI bus offers.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="86" id="mark-5679101a-199c-4c98-8db8-00452a54f10b" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><h2><div><div>Latest Generation of Intel PCI Chipsets</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 1-14 shows an example of a later generation Intel PCI chipset. The two shaded devices are NOT the North bridge and South bridge shown in earlier diagrams. Instead, one device is the Memory Controller Hub (MCH) and the other is the IO Controller Hub (ICH). The two chips are connected by a proprietary Intel high throughput, low pin count bus called the Hub Link.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 1-14: Latest Generation of PCI Chipsets</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_91.jpg?x=224&amp;y=634&amp;w=991&amp;h=669"></div></div><div><div><div></div></div></div><div><div><div>The ICH includes the South bridge functionality but does not support the ISA bus. Other buses associated with ICH include LPC (low pin count) bus, AC'97, Ethernet, Boot ROM, IDE, USB, SMbus and finally the PCI bus. The advantage of this architecture over previous architectures is that the IDE, USB, Ethernet and audio devices do not transfer their data through the PCI bus to memory as is the case with earlier chipsets. Instead they do so through the Hub Link. Hub Link is a higher performance bus compared to PCI. In other words, these devices bypass the PCI bus when communicating with memory. The result is improved performance.</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="87" id="mark-7564972e-0f54-4b0b-a82b-b7dbb2cc712f" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Chapter 1: Architectural Perspective</div></div></h2><div><div><div></div></div></div><h2><div><div>66 MHz PCI Bus Based System</div></div></h2><div><div><div></div></div></div><div><div><div>High end systems that require better IO bandwidth implement a <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="149" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>66</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MHz</mi></mrow></mrow><mrow data-mjx-texclass="ORD"><mn>64</mn></mrow></math></mjx-assistive-mml></mjx-container> -bit PCI buses. This PCI bus supports peak data transfer rate of 533 MBytes/sec.</div></div></div><div><div><div></div></div></div><div><div><div>The PCI 2.1 specification released in 1995 added 66MHz PCI support.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 1-15 shows an example of a <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="150" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>66</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MHz</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> PCI bus based system. This system has similar features to that described in Figure 1-14 on page 32. However, the MCH chip in this example supports two additional Hub Link buses that connect to P64H (PCI 64-bit Hub) bridge chips, providing access to the 64-bit, 66 MHz buses. These buses each support 1 connector in which a high-end peripheral card may be installed. PCI Express System Architecture</div></div></div><div><div><div></div></div></div><div><div><div>Figure 1-15: 66 MHz PCI Bus Based Platform</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_92.jpg?x=220&amp;y=902&amp;w=1002&amp;h=724"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="88" id="mark-bddaad7f-3e9e-48f4-93ed-244866ebed46" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Limitations of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="151" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c50"></mjx-c><mjx-c class="mjx-c43"></mjx-c><mjx-c class="mjx-c6C"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>66</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MHz</mi></mrow></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">PCl</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> bus</div></div></h2><div><div><div></div></div></div><div><div><div>The PCI clock period at <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="152" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>66</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MHz</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> is <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="153" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c6E"></mjx-c><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>15</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">ns</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> . Recall that PCI supports reflected-wave signaling drivers that are weaker drivers, which have slower rise and fall times as compared to incident-wave signaling drivers. It is a challenge to design a <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="154" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>66</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MHz</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> device or system that satisfies the signal timing requirements.</div></div></div><div><div><div></div></div></div><div><div><div>A <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="155" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>66</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MHz</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> PCI based motherboard is routed with shorter signal traces to ensure shorter signal propagation delays. In addition, the bus is loaded with fewer loads in order to ensure faster signal rise and fall times. Taking into account typical board impedances and minimum signal trace lengths, it is possible to interconnect a maximum of four to five <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="156" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>66</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MHz</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> PCI devices. Only one or two connectors may be connected on a <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="157" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>66</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MHz</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> PCI bus. This is a significant limitation for a system which requires multiple devices interconnected.</div></div></div><div><div><div></div></div></div><div><div><div>The solution requires the addition of PCI bridges and hence multiple buses to interconnect devices. This solution is expensive and consumes additional board real estate. In addition, transactions between devices on opposite sides of a bridge complete with greater latency because bridges implement delayed transactions. This requires bridges to retry all transactions that must cross to the other side (with the exception of memory writes which are posted).</div></div></div><div><div><div></div></div></div><h2><div><div>Limitations of PCI Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>The maximum frequency achievable with the PCI architecture is <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="158" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>66</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MHz</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> . This is a result of the static clock method of driving and latching signals and because reflected-wave signaling is used.</div></div></div><div><div><div></div></div></div><div><div><div>PCI bus efficiency is in the order of 50% or <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="159" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-mi class="mjx-n"><mjx-c class="mjx-c25"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>60</mn></mrow><mi mathvariant="normal">%</mi></math></mjx-assistive-mml></mjx-container> . Some of the factors that contribute towards this reduced efficiency are listed below.</div></div></div><div><div><div></div></div></div><div><div><div>The PCI specification allows master and target devices to insert wait-states during data phases of a bus cycle. Slow devices will add wait-states which reduces the efficiency of bus cycles.</div></div></div><div><div><div></div></div></div><div><div><div>PCI bus cycles do not indicate transfer size. This makes buffer management within master and target devices inefficient.</div></div></div><div><div><div></div></div></div><div><div><div>Delayed transactions on PCI are handled inefficiently. When a master is retried, it guesses when to try again. If the master tries too soon, the target may retry the transaction again. If the master waits too long to retry, the latency to complete a data transfer is increased. Similarly, if a target disconnects a transaction the master must guess when to resume the bus cycle at a later time.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="89" id="mark-5800cbdc-26aa-43a8-bb70-1ea3701b0143" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>All PCI bus master accesses to system memory result in a snoop access to the CPU cache. Doing so results in additional wait states during PCI bus master accesses of system memory. The North bridge or MCH must assume all system memory address space is cachable even though this may not be the case. PCI bus cycles provide no mechanism by which to indicate an access to non-cach-able memory address space.</div></div></div><div><div><div></div></div></div><div><div><div>PCI architecture observes strict ordering rules as defined by the specification. Even if a PCI application does not require observation of these strict ordering rules, PCI bus cycles do not provide a mechanism to allow relaxed ordering rule. Observing relaxed ordering rules allows bus cycles (especially those that cross a bridge) to complete with reduced latency.</div></div></div><div><div><div></div></div></div><div><div><div>PCI interrupt handling architecture is inefficient especially because multiple devices share a PCI interrupt signal. Additional software latency is incurred while software discovers which device or devices that share an interrupt signal actually generated the interrupt.</div></div></div><div><div><div></div></div></div><div><div><div>The processor's NMI interrupt input is asserted when a PCI parity or system error is detected. Ultimately the system shuts down when an error is detected. This is a severe response. A more appropriate response might be to detect the error and attempt error recovery. PCI does not require error recovery features, nor does it support an extensive register set for documenting a variety of detectable errors.</div></div></div><div><div><div></div></div></div><div><div><div>These limitations above have been resolved in the next generation bus architectures, namely PCI-X and PCI Express.</div></div></div><div><div><div></div></div></div><h2><div><div>66 MHz and 133 MHz PCI-X 1.0 Bus Based Platforms</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 1-16 on page 36 is an example of an Intel 7500 server chipset based system. This chipset has similarities to the <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="160" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c58"></mjx-c><mjx-c class="mjx-c58"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">XX</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> chipset described earlier. MCH and ICH chips are connected via a Hub Link 1.0 bus. Associated with ICH is a 32-bit <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="161" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>33</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MHz</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> PCI bus. The 7500 MCH chip includes 3 additional high performance Hub Link 2.0 ports. These Hub Link ports are connected to 3 Hub Link-to-PCI-X Hub 2 bridges (P64H2). Each P64H2 bridge supports 2 PCI-X buses that can run at frequencies up to <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="162" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>133</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MHz</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> . Hub Link 2.0 Links can sustain the higher bandwidth requirements for PCI-X traffic that targets system memory.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="90" id="mark-2dfe4ad9-5234-4470-a622-6d962137010e" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_95.jpg?x=219&amp;y=376&amp;w=1005&amp;h=804"></div></div><div><div><div></div></div></div><h2><div><div>PCI-X Features</div></div></h2><div><div><div></div></div></div><div><div><div>The PCI-X bus is a higher frequency, higher performance, higher efficiency bus compared to the PCI bus.</div></div></div><div><div><div></div></div></div><div><div><div>PCI-X devices can be plugged into PCI slots and vice-versa. PCI-X and PCI slots employ the same connector format. Thus, PCI-X is 100% backwards compatible to PCI from both a hardware and software standpoint. The device drivers, OS, and applications that run on a PCI system also run on a PCI-X system.</div></div></div><div><div><div></div></div></div><div><div><div>PCI-X signals are registered. A registered signal requires smaller setup time to sample the signal as compared with a non-registered signal employed in PCI. Also, PCI-X devices employ PLLs that are used to pre-drive signals with smaller clock-to-out time. The time gained from reduced setup time and clock-to-out time is used towards increased clock frequency capability and the ability to sup-</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="91" id="mark-a1ca30b2-b328-484b-ab78-df050db2c530" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 1: Architectural Perspective</div></div></h2><div><div><div></div></div></div><div><div><div>port more devices on the bus at a given frequency compared to PCI. PCI-X supports 8-10 loads or 4 connectors at <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="163" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>66</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MHz</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> and 3-4 loads or 1-2 connectors at <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="164" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>133</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MHz</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> .</div></div></div><div><div><div></div></div></div><div><div><div>The peak bandwidth achievable with 64-bit 133 MHz PCI-X is 1064 MBytes/sec.</div></div></div><div><div><div></div></div></div><div><div><div>Following the first data phase, the PCI-X bus does not allow wait states during subsequent data phases.</div></div></div><div><div><div></div></div></div><div><div><div>Most PCI-X bus cycles are burst cycles and data is generally transferred in blocks of no less than 128 Bytes. This results in higher bus utilization. Further, the transfer size is specified in the attribute phase of PCI-X transactions. This allows for more efficient device buffer management. Figure 1-17 is an example of a PCI-X burst memory read transaction.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 1-17: Example PCI-X Burst Memory Read Bus Cycle</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_96.jpg?x=222&amp;y=889&amp;w=1000&amp;h=547"></div></div><div><div><div></div></div></div><div><div><div>PCI-X Requester/Completer Split Transaction Model. Consider an example of the split transaction protocol supported by PCI-X for delaying transactions. This protocol is illustrated in Figure 1-18. A requester initiates a read transaction. The completer that claims the bus cycles may be unable to return the requested data immediately. Rather than signaling a retry as would be the case in PCI protocol, the completer memorizes the transaction (address, transac-</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="92" id="mark-76b05eef-415f-4c09-bb4e-9505dde9ebe9" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>tion type, byte count, requester ID are memorized) and signals a split response. This prompts the requester to end the bus cycle, and the bus goes idle. The PCI- <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="165" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c58"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">X</mi></mrow></math></mjx-assistive-mml></mjx-container> bus is now available for other transactions,resulting in more efficient bus utilization. Meanwhile, the requester simply waits for the completer to supply it the requested data at a later time. Once the completer has gathered the requested data, it then arbitrates and obtains bus ownership and initiates a split completion bus cycle during which it returns the requested data. The requester claims the split completion bus cycle and accepts the data from the completer.</div></div></div><div><div><div></div></div></div><div><div><div>The split completion bus cycle is very much like a write bus cycle. Exactly two bus transactions are needed to complete the entire data transfer. In between these two bus transactions (the read request and the split completion transaction) the bus is utilized for other transactions. The requester also receives the requested data in a very efficient manner.</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express architecture employs a similar transaction protocol.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 1-18: PCI-X Split Transaction Protocol</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_97.jpg?x=224&amp;y=904&amp;w=994&amp;h=502"></div></div><div><div><div></div></div></div><div><div><div>These performance enhancement features described so far contribute towards an increased transfer efficiency of 85% for PCI-X as compared to 50%-60% with PCI protocol.</div></div></div><div><div><div></div></div></div><div><div><div>PCI-X devices must support Message Signaled Interrupt (MSI) architecture, which is a more efficient architecture than the legacy interrupt architecture described in the PCI architecture section. To generate an interrupt request, a</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="93" id="mark-4487a1c8-1d20-43f3-b311-4a4bf7a3efca" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>PCI-X devices initiates a memory write transaction targeting the Host (North) bridge. The data written is a unique interrupt vector associated with the device generating the interrupt. The Host bridge interrupts the CPU and the vector is delivered to the CPU in a platform specific manner. With this vector, the CPU is immediately able to run an interrupt service routine to service the interrupting device. There is no software overhead in determining which device generated the interrupt. Also, unlike in the PCI architecture, no interrupt pins are required.</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express architecture implements the MSI protocol, resulting in reduced interrupt servicing latency and elimination of interrupt signals.</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express architecture also supports the RO bit and NS bit feature with the result that those transactions with either <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="166" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4E"></mjx-c><mjx-c class="mjx-c53"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">NS</mi></mrow></mrow><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> or <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="167" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c52"></mjx-c><mjx-c class="mjx-c4F"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">RO</mi></mrow></mrow><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> complete with better performance than transactions with <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="168" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4E"></mjx-c><mjx-c class="mjx-c53"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">NS</mi></mrow></mrow><mo>=</mo><mn>0</mn></math></mjx-assistive-mml></mjx-container> or <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="169" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c52"></mjx-c><mjx-c class="mjx-c4F"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">RO</mi></mrow></mrow><mo>=</mo><mn>0</mn></math></mjx-assistive-mml></mjx-container> . PCI transactions by definition assume <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="170" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4E"></mjx-c><mjx-c class="mjx-c53"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">NS</mi></mrow></mrow><mo>=</mo><mn>0</mn></math></mjx-assistive-mml></mjx-container> and <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="171" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c52"></mjx-c><mjx-c class="mjx-c4F"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">RO</mi></mrow></mrow><mo>=</mo><mn>0</mn></math></mjx-assistive-mml></mjx-container> .</div></div></div><div><div><div></div></div></div><div><ul><li>NS - No Snoop (NS) may be used when accessing system memory. PCI-X bus masters can use the NS bit to indicate whether the region of memory being accessed is cachable <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="172" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4E"></mjx-c><mjx-c class="mjx-c53"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">NS</mi></mrow></mrow><mo>=</mo><mn>0</mn></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> or not <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="173" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4E"></mjx-c><mjx-c class="mjx-c53"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">NS</mi></mrow></mrow><mo>=</mo><mn>1</mn></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> . For those transactions with <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="174" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4E"></mjx-c><mjx-c class="mjx-c53"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">NS</mi></mrow></mrow><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> ,the Host bridge does not snoop the processor cache. The result is improved performance during accesses to non-cachable memory.</li></ul></div><div><div><div></div></div></div><div><ul><li>RO - Relaxed Ordering (RO) allows transactions that do not have any order of completion requirements to complete more efficiently. We will not get into the details here. Suffice it to say that transactions with the RO bit set can complete on the bus in any order with respect to other transactions that are pending completion.</li></ul></div><div><div><div></div></div></div><div><div><div>The PCI-X 2.0 specification released in Q1 2002 was designed to further increase the bandwidth capability of PCI-X bus. This bus is described next.</div></div></div><div><div><div></div></div></div><h2><div><div>DDR and QDR PCI-X 2.0 Bus Based Platforms</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 1-19 shows a hypothetical PCI-X 2.0 system. This diagram is the author's best guess as to what a PCI-X 2.0 system will look like. PCI-X 2.0 devices and connectors are <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="175" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-mi class="mjx-n"><mjx-c class="mjx-c25"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>100</mn></mrow><mi mathvariant="normal">%</mi></math></mjx-assistive-mml></mjx-container> hardware and software backwards compatible with PCI-X 1.0 as well as PCI devices and connectors. A PCI-X 2.0 bus supports either Dual Data Rate (DDR) or Quad Data Rate (QDR) data transport using a PCI-X 133 <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="176" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MHz</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> clock and strobes that are phase shifted to provide the necessary clock edges.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="94" id="mark-0134e9ab-b07c-4243-9270-060ff599dac4" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_99.jpg?x=222&amp;y=407&amp;w=999&amp;h=648"></div></div><div><div><div></div></div></div><div><div><div>A design requiring greater than <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="177" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c47"></mjx-c><mjx-c class="mjx-c42"></mjx-c><mjx-c class="mjx-c79"></mjx-c><mjx-c class="mjx-c74"></mjx-c><mjx-c class="mjx-c65"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c63"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">GByte</mi></mrow></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">sec</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> bus bandwidth can implement the DDR or QDR protocol. As indicated in Table 1-2 on page 13, PCI-X 2.0 peak bandwidth capability is <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="178" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c42"></mjx-c><mjx-c class="mjx-c79"></mjx-c><mjx-c class="mjx-c74"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c63"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>4256</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MBytes</mi></mrow></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">sec</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> for a 64-bit <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="179" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>533</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MHz</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> effective PCI-X bus. With the aid of a strobe clock, data is transferred two times or four times per 133 MHz clock.</div></div></div><div><div><div></div></div></div><div><div><div>PCI-X 2.0 devices also support ECC generation and checking. This allows auto-correction of single bit errors and detection and reporting of multi-bit errors. Error handling is more robust than PCI and PCI-X 1.0 systems making this bus more suited for high-performance, robust, non-stop server applications.</div></div></div><div><div><div></div></div></div><div><div><div>Some noteworthy points to remember are that with very fast signal timing, it is only possible to support one connector on the PCI-X 2.0 bus. This implies that a PCI-X 2.0 bus essentially becomes a point-to-point connection with no multidrop capability as with its predecessor buses.</div></div></div><div><div><div></div></div></div><div><div><div>PCI-X 2.0 bridges are essentially switches with one primary bus and one or more downstream secondary buses as shown in Figure 1-19 on page 40.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="95" id="mark-18ad16ac-21b9-464e-8a46-8b5b7f3a3157" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 1: Architectural Perspective</div></div></h2><div><div><div></div></div></div><h2><div><div>The PCI Express Way</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express provides a high-speed, high-performance, point-to-point, dual simplex, differential signaling Link for interconnecting devices. Data is transmitted from a device on one set of signals, and received on another set of signals.</div></div></div><div><div><div></div></div></div><h2><div><div>The Link A Point-to-Point Interconnect</div></div></h2><div><div><div></div></div></div><div><div><div>As shown in Figure 1-20, a PCI Express interconnect consists of either a x1, x2, x4, x8, x12, x16 or x32 point-to-point Link. A PCI Express Link is the physical connection between two devices. A Lane consists of signal pairs in each direction. A <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="180" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-cD7"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>×</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> Link consists of 1 Lane or 1 differential signal pair in each direction for a total of 4 signals. A x32 Link consists of 32 Lanes or 32 signal pairs for each direction for a total of 128 signals. The Link supports a symmetric number of Lanes in each direction. During hardware initialization, the Link is initialized for Link width and frequency of operation automatically by the devices on opposite ends of the Link. No OS or firmware is involved during Link level initialization.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 1-20: PCI Express Link</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_100.jpg?x=223&amp;y=1059&amp;w=992&amp;h=269"></div></div><div><div><div></div></div></div><h2><div><div>Differential Signaling</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express devices employ differential drivers and receivers at each port. Figure 1-21 shows the electrical characteristics of a PCI Express signal. A positive voltage difference between the D+ and D- terminals implies Logical 1. A negative voltage difference between <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="181" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c44"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">D</mi></mrow><mo>+</mo></math></mjx-assistive-mml></mjx-container> and <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="182" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c44"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">D</mi></mrow></math></mjx-assistive-mml></mjx-container> - implies a Logical 0 . No voltage difference between <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="183" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c44"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">D</mi></mrow><mo>+</mo></math></mjx-assistive-mml></mjx-container> and <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="184" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c44"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">D</mi></mrow></math></mjx-assistive-mml></mjx-container> - means that the driver is in the high-impedance tristate condition, which is referred to as the electrical-idle and low-power state of the Link.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="96" id="mark-42e232d4-d8bb-4a8c-a057-8a7f693c38c2" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>The PCI Express Differential Peak-to-Peak signal voltage at the transmitter ranges from <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="185" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c56"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c56"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>800</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">mV</mi></mrow></mrow><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>1200</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">mV</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> ,while the differential peak voltage is one-half these values. The common mode voltage can be any voltage between <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="186" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c56"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">V</mi></mrow></math></mjx-assistive-mml></mjx-container> and <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="187" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c56"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>3.6</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">V</mi></mrow></math></mjx-assistive-mml></mjx-container> . The differential driver is DC isolated from the differential receiver at the opposite end of the Link by placing a capacitor at the driver side of the Link. Two devices at opposite ends of a Link may support different DC common mode voltages. The differential impedance at the receiver is matched with the board impedance to prevent reflections from occurring.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 1-21: PCI Express Differential Signal</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_101.jpg?x=222&amp;y=664&amp;w=997&amp;h=285"></div></div><div><div><div></div></div></div><h2><div><div>Switches Used to Interconnect Multiple Devices</div></div></h2><div><div><div></div></div></div><div><div><div>Switches are implemented in systems requiring multiple devices to be interconnected. Switches can range from a 2-port device to an n-port device, where each port connects to a PCI Express Link. The specification does not indicate a maximum number of ports a switch can implement. A switch may be incorporated into a Root Complex device (Host bridge or North bridge equivalent), resulting in a multi-port root complex. Figure 1-23 on page 52 and Figure 1-25 on page 54 are examples of PCI Express systems showing multi-ported devices such as the root complex or switches.</div></div></div><div><div><div></div></div></div><h2><div><div>Packet Based Protocol</div></div></h2><div><div><div></div></div></div><div><div><div>Rather than bus cycles we are familiar with from PCI and PCI-X architectures, PCI Express encodes transactions using a packet based protocol. Packets are transmitted and received serially and byte striped across the available Lanes of the Link. The more Lanes implemented on a Link the faster a packet is transmitted and the greater the bandwidth of the Link. The packets are used to support the split transaction protocol for non-posted transactions. Various types of packets such as memory read and write requests, IO read and write requests, configuration read and write requests, message requests and completions are defined. Chapter 1: Architectural Perspective</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="97" id="mark-2d56ccfd-b433-4399-999e-f28f3029242d" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Bandwidth and Clocking</div></div></h2><div><div><div></div></div></div><div><div><div>As is apparent from Table 1-3 on page 14, the aggregate bandwidth achievable with PCI Express is significantly higher than any bus available today. The PCI Express 1.0 specification supports 2.5 Gbits/sec/lane/direction transfer rate.</div></div></div><div><div><div></div></div></div><div><div><div>No clock signal exists on the Link. Each packet to be transmitted over the Link consists of bytes of information. Each byte is encoded into a 10-bit symbol. All symbols are guaranteed to have one-zero transitions. The receiver uses a PLL to recover a clock from the 0-to-1 and 1-to-0 transitions of the incoming bit stream.</div></div></div><div><div><div></div></div></div><h2><div><div>Address Space</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express supports the same address spaces as PCI: memory, IO and configuration address spaces. In addition, the maximum configuration address space per device function is extended from 256 Bytes to 4 KBytes. New OS, drivers and applications are required to take advantage of this additional configuration address space. Also, a new messaging transaction and address space provides messaging capability between devices. Some messages are PCI Express standard messages used for error reporting, interrupt and power management messaging. Other messages are vendor defined messages.</div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express Transactions</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express supports the same transaction types supported by PCI and PCI-X. These include memory read and memory write, I/O read and I/O write, configuration read and configuration write. In addition, PCI Express supports a new transaction type called Message transactions. These transactions are encoded using the packet-based PCI Express protocol described later.</div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express Transaction Model</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express transactions can be divided into two categories. Those transactions that are non-posted and those that are posted. Non-posted transactions, such as memory reads, implement a split transaction communication model similar to the PCI-X split transaction protocol. For example, a requester device transmits a non-posted type memory read request packet to a completer. The completer returns a completion packet with the read data to the requester. Posted transactions, such as memory writes, consist of a memory write packet transmitted uni-directionally from requester to completer with no completion packet returned from completer to requester.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="98" id="mark-2b4fbe2e-7522-4f71-b340-7045165c8d84" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Error Handling and Robustness of Data Transfer</div></div></h2><div><div><div></div></div></div><div><div><div>CRC fields are embedded within each packet transmitted. One of the CRC fields supports a Link-level error checking protocol whereby each receiver of a packet checks for Link-level CRC errors. Packets transmitted over the Link in error are recognized with a CRC error at the receiver. The transmitter of the packet is notified of the error by the receiver. The transmitter automatically retries sending the packet (with no software involvement), hopefully resulting in auto-correction of the error.</div></div></div><div><div><div></div></div></div><div><div><div>In addition, an optional CRC field within a packet allows for end-to-end data integrity checking required for high availability applications.</div></div></div><div><div><div></div></div></div><div><div><div>Error handling on PCI Express can be as rudimentary as PCI level error handling described earlier or can be robust enough for server-level requirements. A rich set of error logging registers and error reporting mechanisms provide for improved fault isolation and recovery solutions required by RAS (Reliable, Available, Serviceable) applications.</div></div></div><div><div><div></div></div></div><h2><div><div>Quality of Service (QoS), Traffic Classes (TCs) and Virtual  Channels (VCs)</div></div></h2><div><div><div></div></div></div><div><div><div>The Quality of Service feature of PCI Express refers to the capability of routing packets from different applications through the fabric with differentiated priorities and deterministic latencies and bandwidth. For example, it may be desirable to ensure that Isochronous applications, such as video data packets, move through the fabric with higher priority and guaranteed bandwidth, while control data packets may not have specific bandwidth or latency requirements.</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express packets contain a Traffic Class (TC) number between 0 and 7 that is assigned by the device's application or device driver. Packets with different TCs can move through the fabric with different priority, resulting in varying performances. These packets are routed through the fabric by utilizing virtual channel (VC) buffers implemented in switches, endpoints and root complex devices.</div></div></div><div><div><div></div></div></div><div><div><div>Each Traffic Class is individually mapped to a Virtual Channel (a VC can have several TCs mapped to it, but a TC cannot be mapped to multiple VCs). The TC in each packet is used by the transmitting and receiving ports to determine which VC buffer to drop the packet into. Switches and devices are configured to arbitrate and prioritize between packets from different VCs before forwarding. This arbitration is referred to as VC arbitration. In addition, packets arriving at different ingress ports are forwarded to their own VC buffers at the egress port. These transactions are prioritized based on the ingress port number when being Chapter 1: Architectural Perspective</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="99" id="mark-75cbd5a9-8f7e-411d-b69a-52fbd3dea420" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>merged into a common VC output buffer for delivery across the egress link. This arbitration is referred to as Port arbitration.</div></div></div><div><div><div></div></div></div><div><div><div>The result is that packets with different TC numbers could observe different performance when routed through the PCI Express fabric.</div></div></div><div><div><div></div></div></div><h2><div><div>Flow Control</div></div></h2><div><div><div></div></div></div><div><div><div>A packet transmitted by a device is received into a VC buffer in the receiver at the opposite end of the Link. The receiver periodically updates the transmitter with information regarding the amount of buffer space it has available. The transmitter device will only transmit a packet to the receiver if it knows that the receiving device has sufficient buffer space to hold the next transaction. The protocol by which the transmitter ensures that the receiving buffer has sufficient space available is referred to as flow control. The flow control mechanism guarantees that a transmitted packet will be accepted by the receiver, baring error conditions. As such, the PCI Express transaction protocol does not require support of packet retry (unless an error condition is detected in the receiver), thereby improving the efficiency with which packets are forwarded to a receiver via the Link.</div></div></div><div><div><div></div></div></div><h2><div><div>MSI Style Interrupt Handling Similar to PCI-X</div></div></h2><div><div><div></div></div></div><div><div><div>Interrupt handling is accomplished in-band via PCI-X-like MSI protocol. PCI Express device use a memory write packet to transmit an interrupt vector to the root complex host bridge device, which in-turn interrupts the CPU. PCI Express devices are required to implement the MSI capability register block. PCI Express also supports legacy interrupt handling in-band by encoding interrupt signal transitions (for INTA#, INTB#, INTC# and INTD#) using Message transactions. Only endpoint devices that must support legacy functions and PCI Express-to-PCI bridges are allowed to support legacy interrupt generation.</div></div></div><div><div><div></div></div></div><h2><div><div>Power Management</div></div></h2><div><div><div></div></div></div><div><div><div>The PCI Express fabric consumes less power because the interconnect consists of fewer signals that have smaller signal swings. Each device's power state is individually managed. PCI/PCI Express power management software determines the power management capability of each device and manages it individually in a manner similar to PCI. Devices can notify software of their current power state, as well as power management software can propagate a wake-up event through the fabric to power-up a device or group of devices. Devices can also signal a wake-up event using an in-band mechanism or a side-band signal. PCI Express System Architecture</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="100" id="mark-869977bc-d63e-4613-9924-87c01713b628" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>With no software involvement, devices place a Link into a power savings state after a time-out when they recognize that there are no packets to transmit over the Link. This capability is referred to as Active State power management.</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express supports device power states: D0, D1, D2, D3-Hot and D3-Cold, where D0 is the full-on power state and D3-Cold is the lowest power state.</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express also supports the following Link power states: L0, L0s, L1, L2 and <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="188" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4C"></mjx-c></mjx-mi></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">L</mi></mrow><mn>3</mn></math></mjx-assistive-mml></mjx-container> ,where <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="189" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4C"></mjx-c></mjx-mi></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">L</mi></mrow><mn>0</mn></math></mjx-assistive-mml></mjx-container> is the full-on Link state and <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="190" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4C"></mjx-c></mjx-mi></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">L</mi></mrow><mn>3</mn></math></mjx-assistive-mml></mjx-container> is the Link-Off power state.</div></div></div><div><div><div></div></div></div><h2><div><div>Hot Plug Support</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express supports hot plug and surprise hot unplug without usage of sideband signals. Hot plug interrupt messages, communicated in-band to the root complex, trigger hot plug software to detect a hot plug or removal event. Rather than implementing a centralized hot plug controller as exists in PCI platforms, the hot plug controller function is distributed to the port logic associated with a hot plug capable port of a switch or root complex. 2 colored LEDs, a Manually-operated Retention Latch (MRL), MRL sensor, attention button, power control signal and PRSNT2# signal are some of the elements of a hot plug capable port.</div></div></div><div><div><div></div></div></div><h2><div><div>PCI Compatible Software Model</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express employs the same programming model as PCI and PCI-X systems described earlier in this chapter. The memory and IO address space remains the same as PCI/PCI-X. The first 256 Bytes of configuration space per PCI Express function is the same as PCI/PCI-X device configuration address space, thus ensuring that current OSs and device drivers will run on a PCI Express system. PCI Express architecture extends the configuration address space to <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="191" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>4</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">KB</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> per functional device. Updated OSs and device drivers are required to take advantage and access this additional configuration address space.</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express configuration model supports two mechanisms:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">PCI compatible configuration model which is <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="192" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-mi class="mjx-n"><mjx-c class="mjx-c25"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>100</mn></mrow><mi mathvariant="normal">%</mi></math></mjx-assistive-mml></mjx-container> compatible with existing OSs and bus enumeration and configuration software for PCI/PCI-X systems.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">PCI Express enhanced configuration mechanism which provides access to additional configuration space beyond the first 256 Bytes and up to 4 KBytes per function.</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="101" id="mark-927fd418-000b-47ee-9d2e-de76e5c7baf9" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Mechanical Form Factors</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express architecture supports multiple platform interconnects such as chip-to-chip, board-to-peripheral card via PCI-like connectors and Mini PCI Express form factors for the mobile market. Specifications for these are fully defined. See "Add-in Cards and Connectors" on page 685 for details on PCI Express peripheral card and connector definition.</div></div></div><div><div><div></div></div></div><div><div><div>PCI-like Peripheral Card and Connector. Currently, x1, x4, x8 and x16 PCI-like connectors are defined along with associated peripheral cards. Desktop computers implementing PCI Express can have the same look and feel as current computers with no changes required to existing system form factors. PCI Express motherboards can have an ATX-like motherboard form factor.</div></div></div><div><div><div></div></div></div><div><div><div>Mini PCI Express Form Factor. Mini PCI Express connector and add-in card implements a subset of signals that exist on a standard PCI Express connector and add-in card. The form factor, as the name implies, is much smaller. This form factor targets the mobile computing market. The Mini PCI Express slot supports <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="193" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-cD7"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>×</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> PCI Express signals including power management signals. In addition, the slot supports LED control signals, a USB interface and an SMBus interface. The Mini PCI Express module is similar but smaller than a PC Card.</div></div></div><div><div><div></div></div></div><h2><div><div>Mechanical Form Factors Pending Release</div></div></h2><div><div><div></div></div></div><div><div><div>As of May 2003, specifications for two new form factors have not been released. Below is a summary of publicly available information about these form factors.</div></div></div><div><div><div></div></div></div><div><div><div>NEWCARD Form Factor. Another new module form factor that will service both mobile and desktop markets is the NEWCARD form factor. This is a PCMCIA PC card type form factor, but of nearly half the size that will support <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="194" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-cD7"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>×</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> PCI Express signals including power management signals. In addition,the slot supports USB and SMBus interfaces. There are two size form factors defined, a narrower version and a wider version though the thickness and depth remain the same. Although similar in appearance to Mini PCI Express Module, this is a different form factor.</div></div></div><div><div><div></div></div></div><div><div><div>Server IO Module (SIOM) Form Factor. These are a family of modules that target the workstation and server market. They are designed with future support of larger PCI Express Lane widths and higher frequency bit rates beyond 2.5 Gbits/s Generation 1 transmission rates. Four form factors are under consideration. The base module with single- and double-width modules. Also, the full height with single- and double-width modules. PCI Express System Architecture</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="102" id="mark-6c8d95c3-91d3-4801-aeb8-83fcde6f17a7" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express Topology</div></div></h2><div><div><div></div></div></div><div><div><div>Major components in the PCI Express system shown in Figure 1-22 include a root complex, switches, and endpoint devices.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 1-22: PCI Express Topology</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_107.jpg?x=221&amp;y=580&amp;w=1000&amp;h=683"></div></div><div><div><div></div></div></div><div><div><div>The Root Complex denotes the device that connects the CPU and memory subsystem to the PCI Express fabric. It may support one or more PCI Express ports. The root complex in this example supports 3 ports. Each port is connected to an endpoint device or a switch which forms a sub-hierarchy. The root complex generates transaction requests on the behalf of the CPU. It is capable of initiating configuration transaction requests on the behalf of the CPU. It generates both memory and IO requests as well as generates locked transaction requests on the behalf of the CPU. The root complex as a completer does not respond to locked requests. Root complex transmits packets out of its ports and receives packets on its ports which it forwards to memory. A multi-port root complex may also route packets from one port to another port but is NOT required by the specification to do so.</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="103" id="mark-e6c95823-5b18-4123-b933-d09a8e8fad45" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Root complex implements central resources such as: hot plug controller, power management controller, interrupt controller, error detection and reporting logic. The root complex initializes with a bus number, device number and function number which are used to form a requester ID or completer ID. The root complex bus, device and function numbers initialize to all 0 s.</div></div></div><div><div><div></div></div></div><div><div><div>A Hierarchy is a fabric of all the devices and Links associated with a root complex that are either directly connected to the root complex via its port(s) or indirectly connected via switches and bridges. In Figure 1-22 on page 48, the entire PCI Express fabric associated with the root is one hierarchy.</div></div></div><div><div><div></div></div></div><div><div><div>A Hierarchy Domain is a fabric of devices and Links that are associated with one port of the root complex. For example in Figure 1-22 on page 48, there are 3 hierarchy domains.</div></div></div><div><div><div></div></div></div><div><div><div>Endpoints are devices other than root complex and switches that are requesters or completers of PCI Express transactions. They are peripheral devices such as Ethernet, USB or graphics devices. Endpoints initiate transactions as a requester or respond to transactions as a completer. Two types of endpoints exist, PCI Express endpoints and legacy endpoints. Legacy Endpoints may support IO transactions. They may support locked transaction semantics as a completer but not as a requester. Interrupt capable legacy devices may support legacy style interrupt generation using message requests but must in addition support MSI generation using memory write transactions. Legacy devices are not required to support 64-bit memory addressing capability. PCI Express Endpoints must not support IO or locked transaction semantics and must support MSI style interrupt generation. PCI Express endpoints must support 64-bit memory addressing capability in prefetchable memory address space, though their non-prefetchable memory address space is permitted to map the below 4GByte boundary. Both types of endpoints implement Type 0 PCI configuration headers and respond to configuration transactions as completers. Each endpoint is initialized with a device ID (requester ID or completer ID) which consists of a bus number, device number, and function number. Endpoints are always device 0 on a bus.</div></div></div><div><div><div></div></div></div><div><div><div>Multi-Function Endpoints. Like PCI devices, PCI Express devices may support up to 8 functions per endpoint with at least one function number 0 . However, a PCI Express Link supports only one endpoint numbered device 0 .</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express-to-PCI(-X) Bridge is a bridge between PCI Express fabric and a PCI or PCI-X hierarchy. PCI Express System Architecture</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="104" id="mark-d803a0d4-755f-4d0b-8d44-39eeaedeadf6" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>A Requester is a device that originates a transaction in the PCI Express fabric. Root complex and endpoints are requester type devices.</div></div></div><div><div><div></div></div></div><div><div><div>A Completer is a device addressed or targeted by a requester. A requester reads data from a completer or writes data to a completer. Root complex and endpoints are completer type devices.</div></div></div><div><div><div></div></div></div><div><div><div>A Port is the interface between a PCI Express component and the Link. It consists of differential transmitters and receivers. An Upstream Port is a port that points in the direction of the root complex. A Downstream Port is a port that points away from the root complex. An endpoint port is an upstream port. A root complex port(s) is a downstream port. An Ingress Port is a port that receives a packet. An Egress Port is a port that transmits a packet.</div></div></div><div><div><div></div></div></div><div><div><div>A Switch can be thought of as consisting of two or more logical PCI-to-PCI bridges, each bridge associated with a switch port. Each bridge implements configuration header 1 registers. Configuration and enumeration software will detect and initialize each of the header 1 registers at boot time. A 4 port switch shown in Figure 1-22 on page 48 consists of 4 virtual bridges. These bridges are internally connected via a non-defined bus. One port of a switch pointing in the direction of the root complex is an upstream port. All other ports pointing away from the root complex are downstream ports.</div></div></div><div><div><div></div></div></div><div><div><div>A switch forwards packets in a manner similar to PCI bridges using memory, IO or configuration address based routing. Switches must forward all types of transactions from any ingress port to any egress port. Switches forward these packets based on one of three routing mechanisms: address routing, ID routing, or implicit routing. The logical bridges within the switch implement PCI configuration header 1. The configuration header contains memory and IO base and limit address registers as well as primary bus number, secondary bus number and subordinate bus number registers. These registers are used by the switch to aid in packet routing and forwarding.</div></div></div><div><div><div></div></div></div><div><div><div>Switches implement two arbitration mechanisms, port arbitration and VC arbitration, by which they determine the priority with which to forward packets from ingress ports to egress ports. Switches support locked requests.</div></div></div><div><div><div></div></div></div><h2><div><div>Enumerating the System</div></div></h2><div><div><div></div></div></div><div><div><div>Standard PCI Plug and Play enumeration software can enumerate a PCI Express system. The Links are numbered in a manner similar to the PCI depth first search enumeration algorithm. An example of the bus numbering is shown in Figure 1-22 on page 48. Each PCI Express Link is equivalent to a logical PCI</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="105" id="mark-ee7b1eda-13a9-499f-91b4-0572dd5e987f" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>bus. In other words, each Link is assigned a bus number by the bus enumerating software. A PCI Express endpoint is device 0 on a PCI Express Link of a given bus number. Only one device (device 0) exists per PCI Express Link. The internal bus within a switch that connects all the virtual bridges together is also numbered. The first Link associated with the root complex is number bus 1. Bus 0 is an internal virtual bus within the root complex. Buses downstream of a PCI Express-to-PCI(-X) bridge are enumerated the same way as in a PCI(-X) system.</div></div></div><div><div><div></div></div></div><div><div><div>Endpoints and PCI(-X) devices may implement up to 8 functions per device. Only 1 device is supported per PCI Express Link though PCI(-X) buses may theoretically support up to 32 devices per bus. A system could theoretically include up to 256 PCI Express Link and PCI(-X) buses.</div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Block Diagram</div></div></h2><div><div><div></div></div></div><h2><div><div>Low Cost PCI Express Chipset</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 1-23 on page 52 is a block diagram of a low cost PCI Express based system. As of the writing of this book (April 2003) no real life PCI Express chipset architecture designs were publicly disclosed. The author describes here a practical low cost PCI Express chipset whose architecture is based on existing non-PCI Express chipset architectures. In this solution, AGP which connects MCH to a graphics controller in earlier MCH designs (see Figure 1-14 on page 32) is replaced with a PCI Express Link. The Hub Link that connects MCH to ICH is replaced with a PCI Express Link. And in addition to a PCI bus associated with ICH, the ICH chip supports 4 PCI Express Links. Some of these Links can connect directly to devices on the motherboard and some can be routed to connectors where peripheral cards are installed.</div></div></div><div><div><div></div></div></div><div><div><div>The CPU can communicate with PCI Express devices associated with ICH as well as the PCI Express graphics controller. PCI Express devices can communicate with system memory or the graphics controller associated with MCH. PCI devices may also communicate with PCI Express devices and vice versa. In other words, the chipset supports peer-to-peer packet routing between PCI Express endpoints and PCI devices, memory and graphics. It is yet to be determined if the first generation PCI Express chipsets, will support peer-to-peer packet routing between PCI Express endpoints. Remember that the specification does not require the root complex to support peer-to-peer packet routing between the multiple Links associated with the root complex.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="106" id="mark-8ed4fa23-c656-4376-a483-d1bd6a35d119" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>This design does not require the use of switches if the number of PCI Express devices to be connected does not exceed the number of Links available in this design.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 1-23: Low Cost PCI Express System</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_111.jpg?x=221&amp;y=569&amp;w=997&amp;h=691"></div></div><div><div><div></div></div></div><h2><div><div>Another Low Cost PCI Express Chipset</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 1-24 on page 53 is a block diagram of another low cost PCI Express system. In this design, the Hub Link connects the root complex to an ICH device. The ICH device may be an existing design which has no PCI Express Link associated with it. Instead, all PCI Express Links are associated with the root complex. One of these Links connects to a graphics controller. The other Links directly connect to PCI Express endpoints on the motherboard or connect to PCI Express endpoints on peripheral cards inserted in slots.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="107" id="mark-5117cf3b-c2f1-4914-a5bd-c412319e1e56" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 1-24: Another Low Cost PCI Express System</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_112.jpg?x=223&amp;y=454&amp;w=998&amp;h=825"></div></div><div><div><div></div></div></div><h2><div><div>High-End Server System</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 1-25 shows a more complex system requiring a large number of devices connected together. Multi-port switches are a necessary design feature to accomplish this. To support PCI or PCI-X buses, a PCI Express-to-PCI(-X) bridge is connected to one switch port. PCI Express packets can be routed from any device to any other device because switch support peer-to-peer packet routing (Only multi-port root complex devices are not required to support peer-to-peer functionality).</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="108" id="mark-59a307dd-b998-4ba2-ad80-4815d86ca4e9" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 1-25: PCI Express High-End Server System</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_113.jpg?x=218&amp;y=436&amp;w=1011&amp;h=681"></div></div><div><div><div></div></div></div><h2><div><div>PCI Express Specifications</div></div></h2><div><div><div></div></div></div><div><div><div>As of the writing of this book (May 2003) the following are specifications released by the PCISIG.</div></div></div><div><div><div></div></div></div><div><ul><li>PCI Express 1.0a Base Specification released Q2, 2003</li></ul></div><div><div><div></div></div></div><div><ul><li>PCI Express 1.0a Card Electomechanical Specification released Q2, 2002</li></ul></div><div><div><div></div></div></div><div><ul><li>PCI Express 1.0 Base Specification released Q2, 2002</li></ul></div><div><div><div></div></div></div><div><ul><li>PCI Express 1.0 Card Electomechanical Specification released Q2, 2002</li></ul></div><div><div><div></div></div></div><div><ul><li>Mini PCI Express 1.0 Specification released Q2, 2003</li></ul></div><div><div><div></div></div></div><div><div><div>As of May 2003, the specifications pending release are: the PCI Express-to-PCI Bridge specification, Server IO Module specification, Cable specification, Backplane specification, updated Mini PCI Express specification, and NEWCARD specification. 2</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="109" id="mark-d200adaf-cec7-420f-a281-b519edff50ad" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Architecture  Overview</div></div></h2><div><div><div></div></div></div><h2><div><div>Previous Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>The previous chapter described performance advantages and key features of the PCI Express (PCI-XP) Link. To highlight these advantages, the chapter described performance characteristics and features of predecessor buses such as PCI and PCI-X buses with the goal of discussing the evolution of PCI Express from these predecessor buses. It compared and contrasted features and performance points of PCI, PCI-X and PCI Express buses. The key features of a PCI Express system were described. The chapter in addition described some examples of PCI Express system topologies.</div></div></div><div><div><div></div></div></div><h2><div><div>This Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>This chapter is an introduction to the PCI Express data transfer protocol. It describes the layered approach to PCI Express device design while describing the function of each device layer. Packet types employed in accomplishing data transfers are described without getting into packet content details. Finally, this chapter outlines the process of a requester initiating a transaction such as a memory read to read data from a completer across a Link.</div></div></div><div><div><div></div></div></div><h2><div><div>The Next Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>The next chapter describes how packets are routed through a PCI Express fabric consisting of switches. Packets are routed based on a memory address, IO address, device ID or implicitly.</div></div></div><div><div><div></div></div></div><h2><div><div>Introduction to PCI Express Transactions</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express employs packets to accomplish data transfers between devices. A root complex can communicate with an endpoint. An endpoint can communicate with a root complex. An endpoint can communicate with another endpoint. Communication involves the transmission and reception of packets called Transaction Layer packets (TLPs).</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="110" id="mark-9d38cf8e-7403-4059-9ddf-3c09a09b4729" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express transactions can be grouped into four categories:</div></div></div><div><div><div></div></div></div><div><div><div>1) memory, 2) IO, 3) configuration, and 4) message transactions. Memory, IO and configuration transactions are supported in PCI and PCI-X architectures, but the message transaction is new to PCI Express. Transactions are defined as a series of one or more packet transmissions required to complete an information transfer between a requester and a completer. Table 2-1 is a more detailed list of transactions. These transactions can be categorized into non-posted transactions and posted transactions.</div></div></div><div><div><div></div></div></div><div><div><div>Table 2-1: PCI Express Non-Posted and Posted Transactions</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Transaction Type</th><th>Non-Posted or Posted</th></tr></thead><tbody><tr><td>Memory Read</td><td>Non-Posted</td></tr><tr><td>Memory Write</td><td>Posted</td></tr><tr><td>Memory Read Lock</td><td>Non-Posted</td></tr><tr><td>IO Read</td><td>Non-Posted</td></tr><tr><td>IO Write</td><td>Non-Posted</td></tr><tr><td>Configuration Read (Type 0 and Type 1)</td><td>Non-Posted</td></tr><tr><td>Configuration Write (Type 0 and Type 1)</td><td>Non-Posted</td></tr><tr><td>Message</td><td>Posted</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div>For Non-posted transactions, a requester transmits a TLP request packet to a completer. At a later time, the completer returns a TLP completion packet back to the requester. Non-posted transactions are handled as split transactions similar to the PCI-X split transaction model described on page 37 in Chapter 1. The purpose of the completion TLP is to confirm to the requester that the completer has received the request TLP. In addition, non-posted read transactions contain data in the completion TLP. Non-Posted write transactions contain data in the write request TLP.</div></div></div><div><div><div></div></div></div><div><div><div>For Posted transactions, a requester transmits a TLP request packet to a completer. The completer however does NOT return a completion TLP back to the requester. Posted transactions are optimized for best performance in completing the transaction at the expense of the requester not having knowledge of successful reception of the request by the completer. Posted transactions may or may not contain data in the request TLP.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="111" id="mark-ad9d0bb8-4f96-4401-98e2-775aa3c1118e" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express Transaction Protocol</div></div></h2><div><div><div></div></div></div><div><div><div>Table 2-2 lists all of the TLP request and TLP completion packets. These packets are used in the transactions referenced in Table 2-1. Our goal in this section is to describe how these packets are used to complete transactions at a system level and not to describe the packet routing through the PCI Express fabric nor to describe packet contents in any detail.</div></div></div><div><div><div></div></div></div><div><div><div>Table 2-2: PCI Express TLP Packet Types</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>TLP Packet Types</th><th>Abbreviated Name</th></tr></thead><tbody><tr><td>Memory Read Request</td><td>MRd</td></tr><tr><td>Memory Read Request - Locked access</td><td>MRdLk</td></tr><tr><td>Memory Write Request</td><td>MWr</td></tr><tr><td>IO Read</td><td>IORd</td></tr><tr><td>IO Write</td><td>IOWr</td></tr><tr><td>Configuration Read (Type 0 and Type 1)</td><td>CfgRd0, CfgRd1</td></tr><tr><td>Configuration Write (Type 0 and Type 1)</td><td>CfgWr0, CfgWr1</td></tr><tr><td>Message Request without Data</td><td>Msg</td></tr><tr><td>Message Request with Data</td><td>MsgD</td></tr><tr><td>Completion without Data</td><td>Cpl</td></tr><tr><td>Completion with Data</td><td>CplD</td></tr><tr><td>Completion without Data - associated with Locked Memory Read Requests</td><td>CplLk</td></tr><tr><td>Completion with Data - associated with Locked Memory Read Requests</td><td>CplDLk</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="112" id="mark-7cfc4c22-8f9a-42cf-8382-b047b7d5100f" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><h2><div><div>Non-Posted Read Transactions</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 2-1 shows the packets transmitted by a requester and completer to complete a non-posted read transaction. To complete this transfer, a requester transmits a non-posted read request TLP to a completer it intends to read data from. Non-posted read request TLPs include memory read request (MRd), IO read request (IORd), and configuration read request type 0 or type 1 (CfgRd0, CfgRd1) TLPs. Requesters may be root complex or endpoint devices (endpoints do not initiate configuration read/write requests however).</div></div></div><div><div><div></div></div></div><div><div><div>The request TLP is routed through the fabric of switches using information in the header portion of the TLP. The packet makes its way to a targeted completer. The completer can be a root complex, switches, bridges or endpoints.</div></div></div><div><div><div></div></div></div><div><div><div>When the completer receives the packet and decodes its contents, it gathers the amount of data specified in the request from the targeted address. The completer creates a single completion TLP or multiple completion TLPs with data (CplD) and sends it back to the requester. The completer can return up to 4 KBytes of data per CplD packet.</div></div></div><div><div><div></div></div></div><div><div><div>The completion packet contains routing information necessary to route the packet back to the requester. This completion packet travels through the same path and hierarchy of switches as the request packet.</div></div></div><div><div><div></div></div></div><div><div><div>Requesters uses a tag field in the completion to associate it with a request TLP of the same tag value it transmitted earlier. Use of a tag in the request and completion TLPs allows a requester to manage multiple outstanding transactions.</div></div></div><div><div><div></div></div></div><div><div><div>If a completer is unable to obtain requested data as a result of an error, it returns a completion packet without data <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="195" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c43"></mjx-c><mjx-c class="mjx-c70"></mjx-c><mjx-c class="mjx-c6C"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">Cpl</mi></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> and an error status indication. The requester determines how to handle the error at the software layer.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="113" id="mark-f13f5226-5cec-4a0d-9593-4105b58c6358" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 2-1: Non-Posted Read Transaction Protocol</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_118.jpg?x=365&amp;y=460&amp;w=741&amp;h=430"></div></div><div><div><div></div></div></div><div><div><div>Legend:</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="196" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mover><mjx-over style="padding-bottom: 0.18em; margin-bottom: -0.248em;"><mjx-mo class="mjx-n"><mjx-stretchy-h class="mjx-c2013" style="width: 7.157em;"><mjx-ext><mjx-c></mjx-c></mjx-ext></mjx-stretchy-h></mjx-mo></mjx-over><mjx-base><mjx-mrow><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c52"></mjx-c><mjx-c class="mjx-c64"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c6F"></mjx-c><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-c79"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-mrow></mjx-base></mjx-mover></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mover><mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MRd</mi></mrow></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">Memory</mi></mrow></mrow></mrow><mo accent="true">―</mo></mover></math></mjx-assistive-mml></mjx-container> Read Request</div></div></div><div><div><div></div></div></div><div><div><div>IORd <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="197" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow></math></mjx-assistive-mml></mjx-container> Read Request</div></div></div><div><div><div></div></div></div><div><div><div>CfgRd0 = Type 0 Configuration Read Request</div></div></div><div><div><div></div></div></div><div><div><div>CfgRd1 = Type 1 Configuration Read Request</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="198" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c43"></mjx-c><mjx-c class="mjx-c70"></mjx-c><mjx-c class="mjx-c49"></mjx-c><mjx-c class="mjx-c44"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">CpID</mi></mrow></mrow><mo>=</mo></math></mjx-assistive-mml></mjx-container> Completion with data for normal completion of MRd,IORd,CfgRd0,CfgRd1</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="199" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c43"></mjx-c><mjx-c class="mjx-c70"></mjx-c><mjx-c class="mjx-c6C"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">Cpl</mi></mrow></mrow><mo>=</mo></math></mjx-assistive-mml></mjx-container> Completion without data for error completion of MRd,IORd,CfgRd0,CfgRd1</div></div></div><div><div><div></div></div></div><h2><div><div>Non-Posted Read Transaction for Locked Requests</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 2-2 on page 60 shows packets transmitted by a requester and completer to complete a non-posted locked read transaction. To complete this transfer, a requester transmits a memory read locked request (MRdLk) TLP. The requester can only be a root complex which initiates a locked request on the behalf of the CPU. Endpoints are not allowed to initiate locked requests.</div></div></div><div><div><div></div></div></div><div><div><div>The locked memory read request TLP is routed downstream through the fabric of switches using information in the header portion of the TLP. The packet makes its way to a targeted completer. The completer can only be a legacy endpoint. The entire path from root complex to the endpoint (for TCs that map to VC0) is locked including the ingress and egress port of switches in the pathway.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="114" id="mark-78c8a39a-5455-4ebe-b200-93fac7b649a9" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_119.jpg?x=399&amp;y=392&amp;w=820&amp;h=407"></div></div><div><div><div></div></div></div><div><div><div>Legend:</div></div></div><div><div><div></div></div></div><div><div><div>MRdLk = Memory Read Lock Request</div></div></div><div><div><div></div></div></div><div><div><div>CpIDLk = Locked normal Completion with data for normal completion of MRdLk</div></div></div><div><div><div></div></div></div><div><div><div>CplLk = Locked error Completion without data for error completion of MRdLk</div></div></div><div><div><div></div></div></div><div><div><div>When the completer receives the packet and decodes its contents, it gathers the amount of data specified in the request from the targeted address. The completer creates one or more locked completion TLP with data (CplDLk) along with a completion status. The completion is sent back to the root complex requester via the path and hierarchy of switches as the original request.</div></div></div><div><div><div></div></div></div><div><div><div>The CplDLk packet contains routing information necessary to route the packet back to the requester. Requesters uses a tag field in the completion to associate it with a request TLP of the same tag value it transmitted earlier. Use of a tag in the request and completion TLPs allows a requester to manage multiple outstanding transactions.</div></div></div><div><div><div></div></div></div><div><div><div>If the completer is unable to obtain the requested data as a result of an error, it returns a completion packet without data (CpILk) and an error status indication within the packet. The requester who receives the error notification via the CplLk TLP must assume that atomicity of the lock is no longer guaranteed and thus determine how to handle the error at the software layer.</div></div></div><div><div><div></div></div></div><div><div><div>The path from requester to completer remains locked until the requester at a later time transmits an unlock message to the completer. The path and ingress/ egress ports of a switch that the unlock message passes through are unlocked.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="115" id="mark-1400be82-8110-4189-9e21-318d13712c66" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 2: Architecture Overview</div></div></h2><div><div><div></div></div></div><h2><div><div>Non-Posted Write Transactions</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 2-3 on page 61 shows the packets transmitted by a requester and completer to complete a non-posted write transaction. To complete this transfer, a requester transmits a non-posted write request TLP to a completer it intends to write data to. Non-posted write request TLPs include IO write request (IOWr), configuration write request type 0 or type 1 (CfgWr0, CfgWr1) TLPs. Memory write request and message requests are posted requests. Requesters may be a root complex or endpoint device (though not for configuration write requests).</div></div></div><div><div><div></div></div></div><div><div><div>Figure 2-3: Non-Posted Write Transaction Protocol</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_120.jpg?x=220&amp;y=760&amp;w=983&amp;h=648"></div></div><div><div><div></div></div></div><div><div><div>A request packet with data is routed through the fabric of switches using information in the header of the packet. The packet makes its way to a completer.</div></div></div><div><div><div></div></div></div><div><div><div>When the completer receives the packet and decodes its contents, it accepts the data. The completer creates a single completion packet without data (Cpl) to confirm reception of the write request. This is the purpose of the completion. PCI Express System Architecture</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="116" id="mark-399bda5e-cff6-41d3-ab7c-0ae533ce3122" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>The completion packet contains routing information necessary to route the packet back to the requester. This completion packet will propagate through the same hierarchy of switches that the request packet went through before making its way back to the requester. The requester gets confirmation notification that the write request did make its way successfully to the completer.</div></div></div><div><div><div></div></div></div><div><div><div>If the completer is unable to successfully write the data in the request to the final destination or if the write request packet reaches the completer in error, then it returns a completion packet without data <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="200" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c43"></mjx-c><mjx-c class="mjx-c70"></mjx-c><mjx-c class="mjx-c6C"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">Cpl</mi></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> but with an error status indication. The requester who receives the error notification via the Cpl TLP determines how to handle the error at the software layer.</div></div></div><div><div><div></div></div></div><h2><div><div>Posted Memory Write Transactions</div></div></h2><div><div><div></div></div></div><div><div><div>Memory write requests shown in Figure 2-4 are posted transactions. This implies that the completer returns no completion notification to inform the requester that the memory write request packet has reached its destination successfully. No time is wasted in returning a completion, thus back-to-back posted writes complete with higher performance relative to non-posted transactions.</div></div></div><div><div><div></div></div></div><div><div><div>The write request packet which contains data is routed through the fabric of switches using information in the header portion of the packet. The packet makes its way to a completer. The completer accepts the specified amount of data within the packet. Transaction over.</div></div></div><div><div><div></div></div></div><div><div><div>If the write request is received by the completer in error, or is unable to write the posted write data to the final destination due to an internal error, the requester is not informed via the hardware protocol. The completer could log an error and generate an error message notification to the root complex. Error handling software manages the error.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="117" id="mark-1e2bcf15-e51e-464b-b5f1-b432f895aa5c" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 2: Architecture Overview</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 2-4: Posted Memory Write Transaction Protocol</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_122.jpg?x=296&amp;y=440&amp;w=923&amp;h=377"></div></div><div><div><div></div></div></div><div><div><div>Legend:</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="201" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mover><mjx-over style="padding-bottom: 0.18em; margin-bottom: -0.248em;"><mjx-mo class="mjx-n"><mjx-stretchy-h class="mjx-c2013" style="width: 2.337em;"><mjx-ext><mjx-c></mjx-c></mjx-ext></mjx-stretchy-h></mjx-mo></mjx-over><mjx-base><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c57"></mjx-c><mjx-c class="mjx-c72"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-base></mjx-mover><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mover><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MWr</mi></mrow></mrow><mo accent="true">―</mo></mover><mo>=</mo></math></mjx-assistive-mml></mjx-container> Memory Write Request. No completions for this transaction</div></div></div><div><div><div></div></div></div><h2><div><div>Posted Message Transactions</div></div></h2><div><div><div></div></div></div><div><div><div>Message requests are also posted transactions as pictured in Figure 2-5 on page 64. There are two categories of message request TLPs, Msg and MsgD. Some message requests propagate from requester to completer, some are broadcast requests from the root complex to all endpoints, some are transmitted by an endpoint to the root complex. Message packets may be routed to completer(s) based on the message's address, device ID or routed implicitly. Message request routing is covered in Chapter 3.</div></div></div><div><div><div></div></div></div><div><div><div>The completer accepts any data that may be contained in the packet (if the packet is MsgD) and/or performs the task specified by the message.</div></div></div><div><div><div></div></div></div><div><div><div>Message request support eliminates the need for side-band signals in a PCI Express system. They are used for PCI style legacy interrupt signaling, power management protocol, error signaling, unlocking a path in the PCI Express fabric, slot power support, hot plug protocol, and vender defined purposes.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="118" id="mark-591f17b7-6235-4c14-9255-84c7ed1a4265" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_123.jpg?x=212&amp;y=359&amp;w=1009&amp;h=802"></div></div><div><div><div></div></div></div><h2><div><div>Some Examples of Transactions</div></div></h2><div><div><div></div></div></div><div><div><div>This section describes a few transaction examples showing packets transmitted between requester and completer to accomplish a transaction. The examples consist of a memory read, IO write, and Memory write.</div></div></div><div><div><div></div></div></div><h2><div><div>Memory Read Originated by CPU, Targeting an Endpoint</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 2-6 shows an example of packet routing associated with completing a memory read transaction. The root complex on the behalf of the CPU initiates a non-posted memory read from the completer endpoint shown. The root complex transmits an MRd packet which contains amongst other fields, an address, TLP type, requester ID (of the root complex) and length of transfer (in doublewords) field. Switch A which is a 3 port switch receives the packet on its upstream port. The switch logically appears like a 3 virtual bridge device connected by an internal bus. The logical bridges within the switch contain memory and IO base and limit address registers within their configuration space similar to PCI bridges. The MRd packet address is decoded by the switch and compared with the base/limit address range registers of the two downstream logical bridges. The switch internally forwards the MRd packet from the upstream ingress port to the correct downstream port (the left port in this example). The MRd packet is forwarded to switch B. Switch B decodes the address in a similar manner. Assume the MRd packets is forwarded to the right-hand port so that the completer endpoint receives the MRd packet. PCI Express System Architecture</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="119" id="mark-b0d0cffb-e6b2-4c56-92e2-cc8019e5e5ab" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 2-6: Non-Posted Memory Read Originated by CPU and Targeting an Endpoint</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_124.jpg?x=222&amp;y=783&amp;w=996&amp;h=676"></div></div><div><div><div></div></div></div><div><div><div>The completer decodes the contents of the header within the MRd packet, gathers the requested data and returns a completion packet with data (CplD). The header portion of the completion TLP contains the requester ID copied from the original request TLP. The requester ID is used to route the completion packet back to the root complex.</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="120" id="mark-ec87cb5e-fca6-41d8-956e-5fdd88bd3167" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>The logical bridges within Switch B compares the bus number field of the requester ID in the CplD packet with the secondary and subordinate bus number configuration registers. The CplD packet is forwarded to the appropriate port (in this case the upstream port). The CpID packet moves to Switch A which forwards the packet to the root complex. The requester ID field of the completion TLP matches the root complex's ID. The root complex checks the completion status (hopefully "successful completion") and accepts the data. This data is returned to the CPU in response to its pending memory read transaction.</div></div></div><div><div><div></div></div></div><h2><div><div>Memory Read Originated by Endpoint, Targeting System  Memory</div></div></h2><div><div><div></div></div></div><div><div><div>In a similar manner, the endpoint device shown in Figure 2-7 on page 67 initiates a memory read request (MRd). This packet contains amongst other fields in the header, the endpoint's requester ID, targeted address and amount of data requested. It forwards the packet to Switch B which decodes the memory address in the packet and compares it with the memory base/limit address range registers within the virtual bridges of the switch. The packet is forwarded to Switch A which decodes the address in the packet and forwards the packet to the root complex completer.</div></div></div><div><div><div></div></div></div><div><div><div>The root complex obtains the requested data from system memory and creates a completion TLP with data (CplD). The bus number portion of the requester ID in the completion TLP is used to route the packet through the switches to the endpoint.</div></div></div><div><div><div></div></div></div><div><div><div>A requester endpoint can also communicate with another peer completer endpoint. For example an endpoint attached to switch B can talk to an endpoint connected to switch <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="202" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c43"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">C</mi></mrow></math></mjx-assistive-mml></mjx-container> . The request TLP is routed using an address. The completion is routed using bus number. Multi-port root complex devices are not required to support port-to-port packet routing. In which case, peer-to-peer transactions between endpoints associated with two different ports of the root complex is not supported.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="121" id="mark-90cebd20-b879-44bd-b5ee-f0083903a3f0" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 2-7: Non-Posted Memory Read Originated by Endpoint and Targeting Memory</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_126.jpg?x=222&amp;y=436&amp;w=997&amp;h=570"></div></div><div><div><div></div></div></div><h2><div><div>IO Write Initiated by CPU, Targeting an Endpoint</div></div></h2><div><div><div></div></div></div><div><div><div>IO requests can only be initiated by a root complex or a legacy endpoint. PCI Express endpoints do not initiate IO transactions. IO transactions are intended for legacy support. Native PCI Express devices are not prohibited from implementing IO space, but the specification states that a PCI Express Endpoint must not depend on the operating system allocating I/O resources that are requested.</div></div></div><div><div><div></div></div></div><div><div><div>IO requests are routed by switches in a similar manner to memory requests. Switches route IO request packets by comparing the IO address in the packet with the IO base and limit address range registers in the virtual bridge configuration space associated with a switch</div></div></div><div><div><div></div></div></div><div><div><div>Figure 2-8 on page 68 shows routing of packets associated with an IO write transaction. The CPU initiates an IO write on the Front Side Bus (FSB). The write contains a target IO address and up to 4 Bytes of data. The root complex creates an IO Write request TLP (IOWr) using address and data from the CPU transaction. It uses its own requester ID in the packet header. This packet is routed through switch <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="203" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c41"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">A</mi></mrow></math></mjx-assistive-mml></mjx-container> and <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="204" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">B</mi></mrow></math></mjx-assistive-mml></mjx-container> . The completer endpoint returns a completion without data (Cpl) and completion status of 'successful completion' to confirm the reception of good data from the requester.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="122" id="mark-8789dbef-0e29-470a-a2ca-a92d29f0cf76" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 2-8: IO Write Transaction Originated by CPU, Targeting Legacy Endpoint</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_127.jpg?x=223&amp;y=459&amp;w=998&amp;h=683"></div></div><div><div><div></div></div></div><h2><div><div>Memory Write Transaction Originated by CPU and Targeting  an Endpoint</div></div></h2><div><div><div></div></div></div><div><div><div>Memory write (MWr) requests (and message requests Msg or MsgD) are posted transactions. This implies that the completer does not return a completion. The MWr packet is routed through the PCI Express fabric of switches in the same manner as described for memory read requests. The requester root complex can write up to <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="205" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c><mjx-c class="mjx-c42"></mjx-c><mjx-c class="mjx-c79"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>4</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">KBy</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> tes of data with one MWr packet.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 2-9 on page 69 shows a memory write transaction originated by the CPU. The root complex creates a MWr TLP on behalf of the CPU using target address and data from the CPU FSB transaction. This packet is routed through switch A and B. The packet reaches the endpoint and the transaction is complete.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="123" id="mark-b259f6c1-1648-4c65-9182-a50107f56588" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 2-9: Memory Write Transaction Originated by CPU, Targeting Endpoint</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_128.jpg?x=223&amp;y=456&amp;w=995&amp;h=656"></div></div><div><div><div></div></div></div><h2><div><div>PCI Express Device Layers</div></div></h2><div><div><div></div></div></div><h2><div><div>Overview</div></div></h2><div><div><div></div></div></div><div><div><div>The PCI Express specification defines a layered architecture for device design as shown in Figure 2-10 on page 70. The layers consist of a Transaction Layer, a Data Link Layer and a Physical layer. The layers can be further divided vertically into two, a transmit portion that processes outbound traffic and a receive portion that processes inbound traffic. However, a device design does not have to implement a layered architecture as long as the functionality required by the specification is supported. PCI Express System Architecture</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="124" id="mark-1183afff-4c6c-4dc2-b276-51ed4648963a" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 2-10: PCI Express Device Layers</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_129.jpg?x=234&amp;y=497&amp;w=975&amp;h=892"></div></div><div><div><div></div></div></div><div><div><div>The goal of this section is to describe the function of each layer and to describe the flow of events to accomplish a data transfer. Packet creation at a transmitting device and packet reception and decoding at a receiving device are also explained.</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="125" id="mark-ff6bfe02-4d82-4e45-b83e-e8af3aff029d" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Transmit Portion of Device Layers</div></div></h2><div><div><div></div></div></div><div><div><div>Consider the transmit portion of a device. Packet contents are formed in the Transaction Layer with information obtained from the device core and application. The packet is stored in buffers ready for transmission to the lower layers. This packet is referred to as a Transaction Layer Packet (TLP) described in the earlier section of this chapter. The Data Link Layer concatenates to the packet additional information required for error checking at a receiver device. The packet is then encoded in the Physical layer and transmitted differentially on the Link by the analog portion of this Layer. The packet is transmitted using the available Lanes of the Link to the receiving device which is its neighbor.</div></div></div><div><div><div></div></div></div><h2><div><div>Receive Portion of Device Layers</div></div></h2><div><div><div></div></div></div><div><div><div>The receiver device decodes the incoming packet contents in the Physical Layer and forwards the resulting contents to the upper layers. The Data Link Layer checks for errors in the incoming packet and if there are no errors forwards the packet up to the Transaction Layer. The Transaction Layer buffers the incoming TLPs and converts the information in the packet to a representation that can be processed by the device core and application.</div></div></div><div><div><div></div></div></div><h2><div><div>Device Layers and their Associated Packets</div></div></h2><div><div><div></div></div></div><div><div><div>Three categories of packets are defined, each one is associated with one of the three device layers. Associated with the Transaction Layer is the Transaction Layer Packet (TLP). Associated with the Data Link Layer is the Data Link Layer Packet (DLLP). Associated with the Physical Layer is the Physical Layer Packet (PLP). These packets are introduced next.</div></div></div><div><div><div></div></div></div><h2><div><div>Transaction Layer Packets (TLPs)</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express transactions employ TLPs which originate at the Transaction Layer of a transmitter device and terminate at the Transaction Layer of a receiver device. This process is represented in Figure 2-11 on page 72. The Data Link Layer and Physical Layer also contribute to TLP assembly as the TLP moves through the layers of the transmitting device. At the other end of the Link where a neighbor receives the TLP, the Physical Layer, Data Link Layer and Transaction Layer disassemble the TLP.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="126" id="mark-44e25305-6a9b-4b99-84ed-bca962e97c6b" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_131.jpg?x=268&amp;y=388&amp;w=908&amp;h=667"></div></div><div><div><div></div></div></div><div><div><div>TLP Packet Assembly. A TLP that is transmitted on the Link appears as shown in Figure 2-12 on page 73.</div></div></div><div><div><div></div></div></div><div><div><div>The software layer/device core sends to the Transaction Layer the information required to assemble the core section of the TLP which is the header and data portion of the packet. Some TLPs do not contain a data section. An optional End-to-End CRC (ECRC) field is calculated and appended to the packet. The ECRC field is used by the ultimate targeted device of this packet to check for CRC errors in the header and data portion of the TLP.</div></div></div><div><div><div></div></div></div><div><div><div>The core section of the TLP is forwarded to the Data Link Layer which then appends a sequence ID and another LCRC field. The LCRC field is used by the neighboring receiver device at the other end of the Link to check for CRC errors in the core section of the TLP plus the sequence ID. The resultant TLP is forwarded to the Physical Layer which concatenates a Start and End framing character of 1 byte each to the packet. The packet is encoded and differentially transmitted on the Link using the available number of Lanes.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="127" id="mark-04169127-86a5-4d5e-9601-2800ac5bc0ae" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 2: Architecture Overview</div></div></h2><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_132.jpg?x=221&amp;y=385&amp;w=994&amp;h=772"></div></div><div><div><div></div></div></div><div><div><div>TLP Packet Disassembly. A neighboring receiver device receives the incoming TLP bit stream. As shown in Figure 2-13 on page 74 the received TLP is decoded by the Physical Layer and the Start and End frame fields are stripped. The resultant TLP is sent to the Data Link Layer. This layer checks for any errors in the TLP and strips the sequence ID and LCRC field. Assume there are no LCRC errors, then the TLP is forwarded up to the Transaction Layer. If the receiving device is a switch, then the packet is routed from one port of the switch to an egress port based on address information contained in the header portion of the TLP. Switches are allowed to check for ECRC errors and even report the errors it finds and error. However, a switch is not allowed to modify the ECRC that way the targeted device of this TLP will detect an ECRC error if there is such an error.</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="128" id="mark-c5d6a44d-e900-4e88-8439-1cd7c1bd2102" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>The ultimate targeted device of this TLP checks for ECRC errors in the header and data portion of the TLP. The ECRC field is stripped, leaving the header and data portion of the packet. It is this information that is finally forwarded to the Device Core/Software Layer.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 2-13: TLP Disassembly</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_133.jpg?x=223&amp;y=527&amp;w=995&amp;h=748"></div></div><div><div><div></div></div></div><h2><div><div>Data Link Layer Packets (DLLPs)</div></div></h2><div><div><div></div></div></div><div><div><div>Another PCI Express packet called DLLP originates at the Data Link Layer of a transmitter device and terminates at the Data Link Layer of a receiver device. This process is represented in Figure 2-14 on page 75. The Physical Layer also contributes to DLLP assembly and disassembly as the DLLP moves from one device to another via the PCI Express Link.</div></div></div><div><div><div></div></div></div><div><div><div>DLLPs are used for Link Management functions including TLP acknowledgement associated with the ACK/NAK protocol, power management, and exchange of Flow Control information.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="129" id="mark-a41e1e2c-905f-4ea1-95bd-45b8291202e2" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>DLLPs are transferred between Data Link Layers of the two directly connected components on a Link. DLLPs do not pass through switches unlike TLPs which do travel through the PCI Express fabric. DLLPs do not contain routing information. These packets are smaller in size compared to TLPs, 8 bytes to be precise.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 2-14: DLLP Origin and Destination</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_134.jpg?x=265&amp;y=580&amp;w=913&amp;h=596"></div></div><div><div><div></div></div></div><div><div><div>DLLP Assembly. The DLLP shown in Figure 2-15 on page 76 originates at the Data Link Layer. There are various types of DLLPs some of which include Flow Control DLLPs (FCx), acknowledge/ no acknowledge DLLPs which confirm reception of TLPs (ACK and NAK), and power management DLLPs (PMx). A DLLP type field identifies various types of DLLPs. The Data Link Layer appends a 16-bit CRC used by the receiver of the DLLP to check for CRC errors in the DLLP.</div></div></div><div><div><div></div></div></div><div><div><div>The DLLP content along with a 16-bit CRC is forwarded to the Physical Layer which appends a Start and End frame character of 1 byte each to the packet. The packet is encoded and differentially transmitted on the Link using the available number of Lanes.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="130" id="mark-c3a242e6-5987-4902-8ab1-428a9cebc384" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_135.jpg?x=446&amp;y=371&amp;w=546&amp;h=546"></div></div><div><div><div></div></div></div><div><div><div>DLLP Disassembly. The DLLP is received by Physical Layer of a receiving device. The received bit stream is decoded and the Start and End frame fields are stripped as depicted in Figure 2-16. The resultant packet is sent to the Data Link Layer. This layer checks for CRC errors and strips the CRC field. The Data Link Layer is the destination layer for DLLPs and it is not forwarded up to the Transaction Layer.</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_135.jpg?x=446&amp;y=1165&amp;w=553&amp;h=501"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="131" id="mark-83d91747-9530-4486-951b-d2bf58a50073" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Physical Layer Packets (PLPs)</div></div></h2><div><div><div></div></div></div><div><div><div>Another PCI Express packet called PLP originates at the Physical Layer of a transmitter device and terminates at the Physical Layer of a receiver device. This process is represented in Figure 2-17 on page 77. The PLP is a very simple packet that starts with a 1 byte COM character followed by 3 or more other characters that define the PLP type as well as contain other information. The PLP is a multiple of 4 bytes in size, an example of which is shown in Figure 2-18 on page 78. The specification refers to this packet as the Ordered-Set. PLPs do not contain any routing information. They are not routed through the fabric and do not propagate through a switch.</div></div></div><div><div><div></div></div></div><div><div><div>Some PLPs are used during the Link Training process described in "Ordered-Sets Used During Link Training and Initialization" on page 504. Another PLP is used for clock tolerance compensation. PLPs are used to place a Link into the electrical idle low power state or to wake up a link from this low power state.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 2-17: PLP Origin and Destination</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_136.jpg?x=257&amp;y=943&amp;w=929&amp;h=662"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="132" id="mark-065580d2-5c41-42a5-8059-54c15f2a82b5" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 2-18: PLP or Ordered-Set Structure</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_137.jpg?x=486&amp;y=541&amp;w=502&amp;h=94"></div></div><div><div><div></div></div></div><h2><div><div>Function of Each PCI Express Device Layer</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 2-19 on page 79 is a more detailed block diagram of a PCI Express Device's layers. This block diagram is used to explain key functions of each layer and explain the function of each layer as it relates to generation of outbound traffic and response to inbound traffic. The layers consist of Device Core/Software Layer, Transaction Layer, Data Link Layer and Physical Layer.</div></div></div><div><div><div></div></div></div><h2><div><div>Device Core / Software Layer</div></div></h2><div><div><div></div></div></div><div><div><div>The Device Core consists of, for example, the root complex core logic or an endpoint core logic such as that of an Ethernet controller, SCSI controller, USB controller, etc. To design a PCI Express endpoint, a designer may reuse the Device Core logic from a PCI or PCI-X core logic design and wrap around it the PCI Express layered design described in this section.</div></div></div><div><div><div></div></div></div><div><div><div>Transmit Side. The Device Core logic in conjunction with local software provides the necessary information required by the PCI Express device to generate TLPs. This information is sent via the Transmit interface to the Transaction Layer of the device. Example of information transmitted to the Transaction Layer includes: transaction type to inform the Transaction Layer what type of TLP to generate, address, amount of data to transfer, data, traffic class, message index etc.</div></div></div><div><div><div></div></div></div><div><div><div>Receive Side. The Device Core logic is also responsible to receive information sent by the Transaction Layer via the Receive interface. This information includes: type of TLP received by the Transaction Layer, address, amount of data received, data, traffic class of received TLP, message index, error conditions etc.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="133" id="mark-62b2a5fc-b674-4de8-a86e-63cc5af96c89" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Transaction Layer</div></div></h2><div><div><div></div></div></div><div><div><div>The transaction Layer shown in Figure 2-19 is responsible for generation of outbound TLP traffic and reception of inbound TLP traffic. The Transaction Layer supports the split transaction protocol for non-posted transactions. In other words, the Transaction Layer associates an inbound completion TLP of a given tag value with an outbound non-posted request TLP of the same tag value transmitted earlier.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 2-19: Detailed Block Diagram of PCI Express Device's Layers</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_138.jpg?x=223&amp;y=715&amp;w=992&amp;h=914"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="134" id="mark-d41b0ac2-595d-4891-8bf1-02e7a556b485" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>The transaction layer contains virtual channel buffers (VC Buffers) to store outbound TLPs that await transmission and also to store inbound TLPs received from the Link. The flow control protocol associated with these virtual channel buffers ensures that a remote transmitter does not transmit too many TLPs and cause the receiver virtual channel buffers to overflow. The Transaction Layer also orders TLPs according to ordering rules before transmission. It is this layer that supports the Quality of Service (QoS) protocol.</div></div></div><div><div><div></div></div></div><div><div><div>The Transaction Layer supports 4 address spaces: memory address, IO address, configuration address and message space. Message packets contain a message.</div></div></div><div><div><div></div></div></div><div><div><div>Transmit Side. The Transaction Layer receives information from the Device Core and generates outbound request and completion TLPs which it stores in virtual channel buffers. This layer assembles Transaction Layer Packets (TLPs). The major components of a TLP are: Header, Data Payload and an optional ECRC (specification also uses the term Digest) field as shown in Figure 2-20.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 2-20: TLP Structure at the Transaction Layer</div></div></div><div><div><div></div></div></div><div><div><div>Transaction Layer Packet (TLP)</div></div></div><div><div><div></div></div></div><div><div><div>Header Data Rayload ECRC</div></div></div><div><div><div></div></div></div><div><div><div>The Header is 3 doublewords or 4 doublewords in size and may include information such as; Address, TLP type, transfer size, requester ID/completer ID, tag, traffic class, byte enables, completion codes, and attributes (including "no snoop" and "relaxed ordering" bits). The TLP types are defined in Table 2-2 on page 57.</div></div></div><div><div><div></div></div></div><div><div><div>The address is a 32-bit memory address or an extended 64-bit address for memory requests. It is a 32-bit address for IO requests. For configuration transactions the address is an ID consisting of Bus Number, Device Number and Function Number plus a configuration register address of the targeted register. For completion TLPs, the address is the requester ID of the device that originally made the request. For message transactions the address used for routing is the destination device's ID consisting of Bus Number, Device Number and Function Number of the device targeted by the message request. Message requests could also be broadcast or routed implicitly by targeting the root complex or an upstream port.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="135" id="mark-89fc3e00-3813-4fc9-8b69-be281db6beb1" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>The transfer size or length field indicates the amount of data to transfer calculated in doublewords (DWs). The data transfer length can be between 1 to 1024 DWs. Write request TLPs include data payload in the amount indicated by the length field of the header. For a read request TLP, the length field indicates the amount of data requested from a completer. This data is returned in one or more completion packets. Read request TLPs do not include a data payload field. Byte enables specify byte level address resolution.</div></div></div><div><div><div></div></div></div><div><div><div>Request packets contain a requester ID (bus#, device#, function #) of the device transmitting the request. The tag field in the request is memorized by the completer and the same tag is used in the completion.</div></div></div><div><div><div></div></div></div><div><div><div>A bit in the Header (TD = TLP Digest) indicates whether this packet contains an ECRC field also referred to as Digest. This field is 32-bits wide and contains an End-to-End CRC (ECRC). The ECRC field is generated by the Transaction Layer at time of creation of the outbound TLP. It is generated based on the entire TLP from first byte of header to last byte of data payload (with the exception of the EP bit, and bit 0 of the Type field. These two bits are always considered to be a 1 for the ECRC calculation). The TLP never changes as it traverses the fabric (with the exception of perhaps the two bits mentioned in the earlier sentence). The receiver device checks for an ECRC error that may occur as the packet moves through the fabric.</div></div></div><div><div><div></div></div></div><div><div><div>Receiver Side. The receiver side of the Transaction Layer stores inbound TLPs in receiver virtual channel buffers. The receiver checks for CRC errors based on the ECRC field in the TLP. If there are no errors, the ECRC field is stripped and the resultant information in the TLP header as well as the data payload is sent to the Device Core.</div></div></div><div><div><div></div></div></div><div><div><div>Flow Control. The Transaction Layer ensures that it does not transmit a TLP over the Link to a remote receiver device unless the receiver device has virtual channel buffer space to accept TLPs (of a given traffic class). The protocol for guaranteeing this mechanism is referred to as the "flow control" protocol. If the transmitter device does not observe this protocol, a transmitted TLP will cause the receiver virtual channel buffer to overflow. Flow control is automatically managed at the hardware level and is transparent to software. Software is only involved to enable additional buffers beyond the default set of virtual channel buffers (referred to as VC 0 buffers). The default buffers are enabled automatically after Link training, thus allowing TLP traffic to flow through the fabric immediately after Link training. Configuration transactions use the default virtual channel buffers and can begin immediately after the Link training process. Link training process is described in Chapter 14, entitled "Link Initialization &amp; Training," on page 499.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="136" id="mark-27213756-ab4c-4756-b70c-af2f906f8a48" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Refer to Figure 2-21 on page 82 for an overview of the flow control process. A receiver device transmits DLLPs called Flow Control Packets (FCx DLLPs) to the transmitter device on a periodic basis. The FCx DLLPs contain flow control credit information that updates the transmitter regarding how much buffer space is available in the receiver virtual channel buffer. The transmitter keeps track of this information and will only transmit TLPs out of its Transaction Layer if it knows that the remote receiver has buffer space to accept the transmitted TLP.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 2-21: Flow Control Process</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_141.jpg?x=222&amp;y=665&amp;w=994&amp;h=533"></div></div><div><div><div></div></div></div><div><div><div>Quality of Service (QoS). Consider Figure 2-22 on page 83 in which the video camera and SCSI device shown need to transmit write request TLPs to system DRAM. The camera data is time critical isochronous data which must reach memory with guaranteed bandwidth otherwise the displayed image will appear choppy or unclear. The SCSI data is not as time sensitive and only needs to get to system memory correctly without errors. It is clear that the video data packet should have higher priority when routed through the PCI Express fabric, especially through switches. QoS refers to the capability of routing packets from different applications through the fabric with differentiated priorities and deterministic latencies and bandwidth. PCI and PCI-X systems do not support QoS capability.</div></div></div><div><div><div></div></div></div><div><div><div>Consider this example. Application driver software in conjunction with the OS assigns the video data packets a traffic class of 7 (TC7) and the SCSI data packet a traffic class of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="206" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn></math></mjx-assistive-mml></mjx-container> (TC0). These TC numbers are embedded in the TLP header. Configuration software uses TC/VC mapping device configuration registers to map TC0 related TLPs to virtual channel 0 buffers (VC0) and TC7 related TLPs to virtual channel 7 buffers (VC7). PCI Express System Architecture</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="137" id="mark-83354589-3a04-4281-a73b-e9eac3aa72c8" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 2-22: Example Showing QoS Capability of PCI Express</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_142.jpg?x=219&amp;y=568&amp;w=1005&amp;h=691"></div></div><div><div><div></div></div></div><div><div><div>As TLPs from these two applications (video and SCSI applications) move through the fabric, the switches post incoming packets moving upstream into their respective VC buffers (VC0 and VC7). The switch uses a priority based arbitration mechanism to determine which of the two incoming packets to forward with greater priority to a common egress port. Assume VC7 buffer contents are configured with higher priority than VC0. Whenever two incoming packets are to be forwarded to one upstream port, the switch will always pick the VC7 packet, the video data, over the VC0 packet, the SCSI data. This guarantees greater bandwidth and reduced latency for video data compared to SCSI data.</div></div></div><div><div><div></div></div></div><div><div><div>A PCI Express device that implements more than one set of virtual channel</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="138" id="mark-174c3873-0cd5-43e6-8bc5-e73262895943" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>buffers has the ability to arbitrate between TLPs from different VC buffers. VC buffers have configurable priorities. Thus traffic flowing through the system in different VC buffers will observe differentiated performances. The arbitration mechanism between TLP traffic flowing through different VC buffers is referred to as VC arbitration.</div></div></div><div><div><div></div></div></div><div><div><div>Also, multi-port switches have the ability to arbitrate between traffic coming in on two ingress ports but using the same VC buffer resource on a common egress port. This configurable arbitration mechanism between ports supported by switches is referred to as Port arbitration.</div></div></div><div><div><div></div></div></div><div><div><div>Traffic Classes (TCs) and Virtual Channels (VCs). TC is a TLP header field transmitted within the packet unmodified end-to-end through the fabric. Local application software and system software based on performance requirements decides what TC label a TLP uses. VCs are physical buffers that provide a means to support multiple independent logical data flows over the physical Link via the use of transmit and receiver virtual channel buffers.</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express devices may implement up to <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="207" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c56"></mjx-c><mjx-c class="mjx-c43"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">VC</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> buffers (VC0-VC7). The TC field is a 3-bit field that allows differentiation of traffic into 8 traffic classes (TC0-TC7). Devices must implement VC0. Similarly, a device is required to support TC0 (best effort general purpose service class). The other optional TCs may be used to provide differentiated service through the fabric. Associated with each implemented VC ID, a transmit device implements a transmit buffer and a receive device implements a receive buffer.</div></div></div><div><div><div></div></div></div><div><div><div>Devices or switches implement TC-to-VC mapping logic by which a TLP of a given TC number is forwarded through the Link using a particular VC numbered buffer. PCI Express provides the capability of mapping multiple TCs onto a single VC, thus reducing device cost by means of providing limited number of VC buffer support. TC/VC mapping is configured by system software through configuration registers. It is up to the device application software to determine TC label for TLPs and TC/VC mapping that meets performance requirements. In its simplest form TC/VC mapping registers can be configured with a one-to-one mapping of TC to VC.</div></div></div><div><div><div></div></div></div><div><div><div>Consider the example illustrated in Figure 2-23 on page 85. The TC/VC mapping registers in Device A are configured to map, TLPs with TC[2:0] to VC0 and TLPs with TC[7:3] to VC1. The TC/VC mapping registers in receiver Device B must also be configured identically as Device A. The same numbered VC buffers are enabled both in transmitter Device A and receiver Device B.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="139" id="mark-1bac99df-50d9-45dd-af0b-27dc5934c72e" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>If Device A needs to transmit a TLP with TC label of 7 and another packet with TC label of 0 , the two packets will be placed in VC1 and VC0 buffers, respectively. The arbitration logic arbitrates between the two VC buffers. Assume VC1 buffer is configured with higher priority than VC0 buffer. Thus, Device A will forward the TC7 TLPs in VC1 to the Link ahead of the TC0 TLPs in VC0.</div></div></div><div><div><div></div></div></div><div><div><div>When the TLPs arrive in Device B, the TC/VC mapping logic decodes the TC label in each TLP and places the TLPs in their associated VC buffers.</div></div></div><div><div><div></div></div></div><div><div><div>In this example, TLP traffic with TC[7:3] label will flow through the fabric with higher priority than TC[2:0] traffic. Within each TC group however, TLPs will flow with equal priority.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 2-23: TC Numbers and VC Buffers</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_144.jpg?x=231&amp;y=810&amp;w=982&amp;h=435"></div></div><div><div><div></div></div></div><div><div><div>Port Arbitration and VC Arbitration. The goals of arbitration support in the Transaction Layer are:</div></div></div><div><div><div></div></div></div><div><ul><li>To provide differentiated services between data flows within the fabric.</li></ul></div><div><div><div></div></div></div><div><ul><li>To provide guaranteed bandwidth with deterministic and smallest end-to-end transaction latency.</li></ul></div><div><div><div></div></div></div><div><div><div>Packets of different TCs are routed through the fabric of switches with different priority based on arbitration policy implemented in switches. Packets coming in from ingress ports heading towards a particular egress port compete for use of that egress port.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="140" id="mark-b9e67770-1c0a-454e-a6b6-c435ee9fe8bb" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Switches implement two types of arbitration for each egress port: Port Arbitration and VC Arbitration. Consider Figure 2-24 on page 86.</div></div></div><div><div><div></div></div></div><div><div><div>Port arbitration is arbitration between two packets arriving on different ingress ports but that map to the same virtual channel (after going through TC-to-VC mapping) of the common egress port. The port arbiter implements round-robin, weighted round-robin or programmable time-based round-robin arbitration schemes selectable through configuration registers.</div></div></div><div><div><div></div></div></div><div><div><div>VC arbitration takes place after port arbitration. For a given egress port, packets from all VCs compete to transmit on the same egress port. VC arbitration resolves the order in which TLPs in different VC buffers are forwarded on to the Link. VC arbitration policies supported include, strict priority, round-robin and weighted round-robin arbitration schemes selectable through configuration registers.</div></div></div><div><div><div></div></div></div><div><div><div>Independent of arbitration, each VC must observe transaction ordering and flow control rules before it can make pending TLP traffic visible to the arbitration mechanism.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 2-24: Switch Implements Port Arbitration and VC Arbitration Logic</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_145.jpg?x=223&amp;y=985&amp;w=998&amp;h=456"></div></div><div><div><div></div></div></div><div><div><div>Endpoint devices and a root complex with only one port do not support port arbitration. They only support VC arbitration in the Transaction Layer.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="141" id="mark-5e207c6b-cfaf-4917-8c28-99f917e63c3b" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Transaction Ordering. PCI Express protocol implements PCI/PCI-X compliant producer-consumer ordering model for transaction ordering with provision to support relaxed ordering similar to PCI-X architecture. Transaction ordering rules guarantee that TLP traffic associated with a given traffic class is routed through the fabric in the correct order to prevent potential deadlock or live-lock conditions from occurring. Traffic associated with different TC labels have no ordering relationship. Chapter 8, entitled "Transaction Ordering," on page 315 describes these ordering rules.</div></div></div><div><div><div></div></div></div><div><div><div>The Transaction Layer ensures that TLPs for a given TC are ordered correctly with respect to other TLPs of the same TC label before forwarding to the Data Link Layer and Physical Layer for transmission.</div></div></div><div><div><div></div></div></div><div><div><div>Power Management. The Transaction Layer supports ACPI/PCI power management, as dictated by system software. Hardware within the Transaction Layer autonomously power manages a device to minimize power during full-on power states. This automatic power management is referred to as Active State Power Management and does not involve software. Power management software associated with the OS power manages a device's power states though power management configuration registers. Power management is described in Chapter 16.</div></div></div><div><div><div></div></div></div><div><div><div>Configuration Registers. A device's configuration registers are associated with the Transaction Layer. The registers are configured during initialization and bus enumeration. They are also configured by device drivers and accessed by runtime software/OS. Additionally, the registers store negotiated Link capabilities, such as Link width and frequency. Configuration registers are described in Part 6 of the book.</div></div></div><div><div><div></div></div></div><h2><div><div>Data Link Layer</div></div></h2><div><div><div></div></div></div><div><div><div>Refer to Figure 2-19 on page 79 for a block diagram of a device's Data Link Layer. The primary function of the Data Link Layer is to ensure data integrity during packet transmission and reception on each Link. If a transmitter device sends a TLP to a remote receiver device at the other end of a Link and a CRC error is detected, the transmitter device is notified with a NAK DLLP. The transmitter device automatically replays the TLP. This time hopefully no error occurs. With error checking and automatic replay of packets received in error, PCI Express ensures very high probability that a TLP transmitted by one device will make its way to the final destination with no errors. This makes PCI Express ideal for low error rate, high-availability systems such as servers.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="142" id="mark-2464324b-3d7f-4341-890e-6d1d10fde696" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Transmit Side. The Transaction Layer must observe the flow control mechanism before forwarding outbound TLPs to the Data Link Layer. If sufficient credits exist, a TLP stored within the virtual channel buffer is passed from the Transaction Layer to the Data Link Layer for transmission.</div></div></div><div><div><div></div></div></div><div><div><div>Consider Figure 2-25 on page 88 which shows the logic associated with the ACK-NAK mechanism of the Data Link Layer. The Data Link Layer is responsible for TLP CRC generation and TLP error checking. For outbound TLPs from transmit Device A, a Link CRC (LCRC) is generated and appended to the TLP. In addition, a sequence ID is appended to the TLP. Device A's Data Link Layer preserves a copy of the TLP in a replay buffer and transmits the TLP to Device B. The Data Link Layer of the remote Device B receives the TLP and checks for CRC errors.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 2-25: Data Link Layer Replay Mechanism</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_147.jpg?x=228&amp;y=814&amp;w=988&amp;h=841"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="143" id="mark-f5f6d79d-5e9b-4f47-be8e-04e31f822da1" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>If there is no error, the Data Link Layer of Device B returns an ACK DLLP with a sequence ID to Device A. Device A has confirmation that the TLP has reached Device B (not necessarily the final destination) successfully. Device A clears its replay buffer of the TLP associated with that sequence ID.</div></div></div><div><div><div></div></div></div><div><div><div>If on the other hand a CRC error is detected in the TLP received at the remote Device B, then a NAK DLLP with a sequence ID is returned to Device A. An error has occurred during TLP transmission. Device A's Data Link Layer replays associated TLPs from the replay buffer. The Data Link Layer generates error indications for error reporting and logging mechanisms.</div></div></div><div><div><div></div></div></div><div><div><div>In summary, the replay mechanism uses the sequence ID field within received ACK/NAK DLLPs to associate it with outbound TLPs stored in the replay buffer. Reception of ACK DLLPs cause the replay buffer to clear TLPs from the buffer. Receiving NAK DLLPs cause the replay buffer to replay associated TLPs.</div></div></div><div><div><div></div></div></div><div><div><div>For a given TLP in the replay buffer, if the transmitter device receives a NAK 4 times and the TLP is replayed 3 additional times as a result, then the Data Link Layer logs the error, reports a correctable error, and re-trains the Link.</div></div></div><div><div><div></div></div></div><div><div><div>Receive Side. The receive side of the Data Link Layer is responsible for LCRC error checking on inbound TLPs. If no error is detected, the device schedules an ACK DLLP for transmission back to the remote transmitter device. The receiver strips the TLP of the LCRC field and sequence ID.</div></div></div><div><div><div></div></div></div><div><div><div>If a CRC error is detected, it schedules a NAK to return back to the remote transmitter. The TLP is eliminated.</div></div></div><div><div><div></div></div></div><div><div><div>The receive side of the Data Link Layer also receives ACKs and NAKs from a remote device. If an ACK is received the receive side of the Data Link layer informs the transmit side to clear an associated TLP from the replay buffer. If a NAK is received, the receive side causes the replay buffer of the transmit side to replay associated TLPs.</div></div></div><div><div><div></div></div></div><div><div><div>The receive side is also responsible for checking the sequence ID of received TLPs to check for dropped or out-of-order TLPs.</div></div></div><div><div><div></div></div></div><div><div><div>Data Link Layer Contribution to TLPs and DLLPs. The Data Link Layer concatenates a 12-bit sequence ID and 32-bit LCRC field to an outbound TLP that arrives from the Transaction Layer. The resultant TLP is shown in Figure 2-26 on page 90 . The sequence ID is used to associate a copy of the outbound TLP stored in the replay buffer with a received ACK/NAK DLLP inbound from a neighboring remote device. The ACK/NAK DLLP confirms arrival of the outbound TLP in the remote device.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="144" id="mark-4d017416-1259-4b47-b608-2a67b568764c" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>The 32-bit LCRC is calculated based on all bytes in the TLP including the sequence ID.</div></div></div><div><div><div></div></div></div><div><div><div>A DLLP shown in Figure 2-26 on page 90 is a 4 byte packet with a 16-bit CRC field. The 8-bit DLLP Type field indicates various categories of DLLPs. These include: ACK, NAK, Power Management related DLLPs (PM_Enter_L1, PM_Enter_L23, PM_Active_State_Request_L1, PM_Request_Ack) and Flow Control related DLLPs (InitFC1-P, InitFC1-NP, InitFC1-Cpl, InitFC2-P, InitFC2-NP, InitFC2-Cpl, UpdateFC-P, UpdateFC-NP, UpdateFC-Cpl). The 16-bit CRC is calculated using all 4 bytes of the DLLP. Received DLLPs which fail the CRC check are discarded. The loss of information from discarding a DLLP is self repairing such that a successive DLLP will supersede any information lost. ACK and NAK DLLPs contain a sequence ID field (shown as Misc. field in Figure 2-26) used by the device to associate an inbound ACK/NAK DLLP with a stored copy of a TLP in the replay buffer.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 2-26: TLP and DLLP Structure at the Data Link Layer</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_149.jpg?x=222&amp;y=931&amp;w=997&amp;h=309"></div></div><div><div><div></div></div></div><div><div><div>Non-Posted Transaction Showing ACK-NAK Protocol. Next the steps required to complete a memory read request between a requester and a completer on the far end of a switch are described. Figure 2-27 on page 91 shows the activity on the Link to complete this transaction:</div></div></div><div><div><div></div></div></div><div><div><div>Step 1a: Requester transmits a memory read request TLP (MRd). Switch receives the MRd TLP and checks for CRC error using the LCRC field in the MRd TLP.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="145" id="mark-b91dd99e-4ece-46aa-87b0-449d71ed208e" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Step 1b: If no error then switch returns ACK DLLP to requester. Requester discards copy of the TLP from its replay buffer.</div></div></div><div><div><div></div></div></div><div><div><div>Step 2a: Switch forwards the MRd TLP to the correct egress port using memory address for routing. Completer receives MRd TLP. Completer checks for CRC errors in received MRd TLP using LCRC.</div></div></div><div><div><div></div></div></div><div><div><div>Step 2b: If no error then completer returns ACK DLLP to switch. Switch discards copy of the MRd TLP from its replay buffer.</div></div></div><div><div><div></div></div></div><div><div><div>Step 3a: Completer checks for CRC error using optional ECRC field in MRd TLP. Assume no End-to-End error. Completer returns Completion (CplD) with Data TLP whenever it has the requested data. Switch receives CplD TLP and checks for CRC error using LCRC.</div></div></div><div><div><div></div></div></div><div><div><div>Step 3b: If no error then switch returns ACK DLLP to completer. Completer discards copy of the CplD TLP from its replay buffer.</div></div></div><div><div><div></div></div></div><div><div><div>Step 4a: Switch decodes Requester ID field in CplD TLP and routes the packet to the correct egress port. Requester receives CplD TLP. Requester checks for CRC errors in received CplD TLP using LCRC.</div></div></div><div><div><div></div></div></div><div><div><div>Step 4b: If no error then requester returns ACK DLLP to switch. Switch discards copy of the CplD TLP from its replay buffer. Requester determines if there is error in CplD TLP using CRC field in optional ECRC field. Assume no End-to-End error. Requester checks completion error code in CplD. Assume completion code of 'Successful Completion'. To associate the completion with the original request, requester matches tag in CplD with original tag of MRd request. Requester accepts data.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 2-27: Non-Posted Transaction on Link</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_150.jpg?x=252&amp;y=1279&amp;w=969&amp;h=369"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="146" id="mark-3be0339a-fcbb-4d4c-8739-497422be240f" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Posted Transaction Showing ACK-NAK Protocol. Below are the steps involved in completing a memory write request between a requester and a completer on the far end of a switch. Figure 2-28 on page 92 shows the activity on the Link to complete this transaction:</div></div></div><div><div><div></div></div></div><div><div><div>Step 1a: Requester transmits a memory write request TLP (MWr) with data. Switch receives MWr TLP and checks for CRC error with LCRC field in the TLP.</div></div></div><div><div><div></div></div></div><div><div><div>Step 1b: If no error then switch returns ACK DLLP to requester. Requester discards copy of the TLP from its replay buffer.</div></div></div><div><div><div></div></div></div><div><div><div>Step 2a: Switch forwards the MWr TLP to the correct egress port using memory address for routing. Completer receives MWr TLP. Completer checks for CRC errors in received MRd TLP using LCRC.</div></div></div><div><div><div></div></div></div><div><div><div>Step 2b: If no error then completer returns ACK DLLP to switch. Switch discards copy of the MWr TLP from its replay buffer. Completer checks for CRC error using optional digest field in MWr TLP. Assume no End-to-End error. Completer accepts data. There is no completion associated with this transaction.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 2-28: Posted Transaction on Link</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_151.jpg?x=225&amp;y=986&amp;w=988&amp;h=340"></div></div><div><div><div></div></div></div><div><div><div>Other Functions of the Data Link Layer. Following power-up or Reset, the flow control mechanism described earlier is initialized by the Data Link Layer. This process is accomplished automatically at the hardware level and has no software involvement.</div></div></div><div><div><div></div></div></div><div><div><div>Flow control for the default virtual channel VC0 is initialized first. In addition, when additional VCs are enabled by software, the flow control initialization process is repeated for each newly enabled VC. Since VC0 is enabled before all other VCs, no TLP traffic will be active prior to initialization of VC0.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="147" id="mark-40f90058-f58d-4ece-ae84-73ad74430205" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Physical Layer</div></div></h2><div><div><div></div></div></div><div><div><div>Refer to Figure 2-19 on page 79 for a block diagram of a device's Physical Layer. Both TLP and DLLP type packets are sent from the Data Link Layer to the Physical Layer for transmission over the Link. Also, packets are received by the Physical Layer from the Link and sent to the Data Link Layer.</div></div></div><div><div><div></div></div></div><div><div><div>The Physical Layer is divided in two portions, the Logical Physical Layer and the Electrical Physical Layer. The Logical Physical Layer contains digital logic associated with processing packets before transmission on the Link, or processing packets inbound from the Link before sending to the Data Link Layer. The Electrical Physical Layer is the analog interface of the Physical Layer that connects to the Link. It consists of differential drivers and receivers for each Lane.</div></div></div><div><div><div></div></div></div><div><div><div>Transmit Side. TLPs and DLLPs from the Data Link Layer are clocked into a buffer in the Logical Physical Layer. The Physical Layer frames the TLP or DLLP with a Start and End character. The symbol is a framing code byte which a receiver device uses to detect the start and end of a packet. The Start and End characters are shown appended to a TLP and DLLP in Figure 2-29 on page 94. The diagram shows the size of each field in a TLP or DLLP.</div></div></div><div><div><div></div></div></div><div><div><div>The transmit logical sub-block conditions the received packet from the Data Link Layer into the correct format for transmission. Packets are byte striped across the available Lanes on the Link.</div></div></div><div><div><div></div></div></div><div><div><div>Each byte of a packet is then scrambled with the aid of Linear Feedback Shift Register type scrambler. By scrambling the bytes, repeated bit patterns on the Link are eliminated, thus reducing the average EMI noise generated.</div></div></div><div><div><div></div></div></div><div><div><div>The resultant bytes are encoded into a <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="208" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> code by the <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="209" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> encoding logic. The primary purpose of encoding <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="210" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> characters to <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="211" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> symbols is to create sufficient 1-to-0 and 0-to-1 transition density in the bit stream to facilitate recreation of a receive clock with the aid of a PLL at the remote receiver device. Note that data is not transmitted along with a clock. Instead, the bit stream contains sufficient transitions to allow the receiver device to recreate a receive clock.</div></div></div><div><div><div></div></div></div><div><div><div>The parallel-to-serial converter generates a serial bit stream of the packet on each Lane and transmits it differentially at <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="212" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c47"></mjx-c><mjx-c class="mjx-c62"></mjx-c><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c74"></mjx-c><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>2.5</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">Gbits</mi></mrow></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> .</div></div></div><div><div><div></div></div></div><div><div><div>Receive Side. The receive Electrical Physical Layer clocks in a packet arriving differentially on all Lanes. The serial bit stream of the packet is converted into a <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="213" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> parallel stream using the serial-to-parallel converter. The receiver logic also includes an elastic buffer which accommodates for clock frequency</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="148" id="mark-1e7fd343-8dd9-46bb-97ad-36985c85496a" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>variation between a transmit clock with which the packet bit stream is clocked into a receiver and the receiver clock. The 10b symbol stream is decoded back to the <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="214" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> representation of each symbol with the <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="215" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> decoder. The <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="216" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> characters are de-scrambled. The Byte unstriping logic, re-creates the original packet stream transmitted by the remote device.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 2-29: TLP and DLLP Structure at the Physical Layer</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_153.jpg?x=228&amp;y=593&amp;w=984&amp;h=428"></div></div><div><div><div></div></div></div><div><div><div>Link Training and Initialization. An additional function of the Physical Layer is Link initialization and training. Link initialization and training is a Physical Layer controlled process that configures and initializes each Link for normal operation. This process is automatic and does not involve software. The following are determined during the Link initialization and training process:</div></div></div><div><div><div></div></div></div><div><ul><li>Link width</li></ul></div><div><div><div></div></div></div><div><ul><li>Link data rate</li></ul></div><div><div><div></div></div></div><div><ul><li>Lane reversal</li></ul></div><div><div><div></div></div></div><div><ul><li>Polarity inversion.</li></ul></div><div><div><div></div></div></div><div><ul><li>Bit lock per Lane</li></ul></div><div><div><div></div></div></div><div><ul><li>Symbol lock per Lane</li></ul></div><div><div><div></div></div></div><div><ul><li>Lane-to-Lane de-skew within a multi-Lane Link.</li></ul></div><div><div><div></div></div></div><div><div><div>Link width. Two devices with a different number of Lanes per Link may be connected. E.g. one device has <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="217" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">x</mi></mrow><mn>2</mn></math></mjx-assistive-mml></mjx-container> port and it is connected to a device with <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="218" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">x</mi></mrow><mn>4</mn></math></mjx-assistive-mml></mjx-container> port. After initialization the Physical Layer of both devices determines and sets the Link width to the minimum Lane width of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="219" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-cD7"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>×</mo><mn>2</mn></math></mjx-assistive-mml></mjx-container> . Other Link negotiated behaviors include Lane reversal and splitting of ports into multiple Links.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="149" id="mark-d57f0660-d531-4811-9840-6acf80ecc825" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Lane reversal if necessary is an optional feature. Lanes are numbered. A designer may not wire the correct Lanes of two ports correctly. In which case training allows for the Lane numbers to be reversed so that the Lane numbers of adjacent ports on each end of the Link match up. Part of the same process may allow for a multi-Lane Link to be split into multiple Links.</div></div></div><div><div><div></div></div></div><div><div><div>Polarity inversion. The D+ and D- differential pair terminals for two devices may not be connected correctly. In which case the training sequence receiver reverses the polarity on the differential receiver.</div></div></div><div><div><div></div></div></div><div><div><div>Link data rate. Training is completed at data rate of 2.5 Gbit/s. In the future, higher data rates of 5 Gbit/s and 10 Gbit/s will be supported. During training, each node advertises its highest data rate capability. The Link is initialized with the highest common frequency that devices at opposite ends of a Link support.</div></div></div><div><div><div></div></div></div><div><div><div>Lane-to-Lane De-skew. Due to Link wire length variations and different driver/receiver characteristics on a multi-Lane Link, bit streams on each Lane will arrive at a receiver skewed with respect to other Lanes. The receiver circuit must compensate for this skew by adding/removing delays on each Lane. Relaxed routing rules allow Link wire lengths in the order of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="220" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-script style="vertical-align: 0.393em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-var"><mjx-c class="mjx-c2032"></mjx-c></mjx-mi><mjx-mi class="mjx-var"><mjx-c class="mjx-c2032"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-msup space="3"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-script style="vertical-align: 0.393em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-var"><mjx-c class="mjx-c2032"></mjx-c></mjx-mi><mjx-mi class="mjx-var"><mjx-c class="mjx-c2032"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mrow data-mjx-texclass="ORD"><mn>20</mn></mrow><mrow data-mjx-texclass="ORD"><mi data-mjx-alternate="1">′</mi><mi data-mjx-alternate="1">′</mi></mrow></msup><mo>−</mo><msup><mrow data-mjx-texclass="ORD"><mn>30</mn></mrow><mrow data-mjx-texclass="ORD"><mi data-mjx-alternate="1">′</mi><mi data-mjx-alternate="1">′</mi></mrow></msup></math></mjx-assistive-mml></mjx-container> .</div></div></div><div><div><div></div></div></div><div><div><div>Link Power Management. The normal power-on operation of a Link is called the L0 state. Lower power states of the Link in which no packets are transmitted or received are L0s, L1, L2 and L3 power states. The L0s power state is automatically entered when a time-out occurs after a period of inactivity on the Link. Entering and exiting this state does not involve software and the exit latency is the shortest. L1 and L2 are lower power states than L0s, but exit latencies are greater. The L3 power state is the full off power state from which a device cannot generate a wake up event.</div></div></div><div><div><div></div></div></div><h2><div><div>Reset. Two types of reset are supported:</div></div></h2><div><div><div></div></div></div><div><ul><li>Cold/warm reset also called a Fundamental Reset which occurs following a device being powered-on (cold reset) or due to a reset without circulating power (warm reset).</li></ul></div><div><div><div></div></div></div><div><ul><li>Hot reset sometimes referred to as protocol reset is an in-band method of propagating reset. Transmission of an ordered-set is used to signal a hot reset. Software initiates hot reset generation.</li></ul></div><div><div><div></div></div></div><div><div><div>On exit from reset (cold, warm, or hot), all state machines and configuration registers (hot reset does not reset sticky configuration registers) are initialized.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="150" id="mark-07bdb853-705b-4e92-9165-e2248a4443bb" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Electrical Physical Layer. The transmitter of one device is AC coupled to the receiver of another device at the opposite end of the Link as shown in Figure 2-30. The AC coupling capacitor is between <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="221" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c37"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c6E"></mjx-c><mjx-c class="mjx-c46"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>75</mn></mrow><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>200</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">nF</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> . The transmitter DC common mode voltage is established during Link training and initialization. The DC common mode impedance is typically <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="222" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c6F"></mjx-c><mjx-c class="mjx-c68"></mjx-c><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>50</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">ohms</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> while the differential impedance is 100 ohms typical. This impedance is matched with a standard FR4 board.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 2-30: Electrical Physical Layer Showing Differential Transmitter and Receiver</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_155.jpg?x=228&amp;y=633&amp;w=990&amp;h=582"></div></div><div><div><div></div></div></div><h2><div><div>Example of a Non-Posted Memory Read Transaction</div></div></h2><div><div><div></div></div></div><div><div><div>Let us put our knowledge so far to describe the set of events that take place from the time a requester device initiates a memory read request, until it obtains the requested data from a completer device. Given that such a transaction is a non-posted transaction, there are two phases to the read process. The first phase is the transmission of a memory read request TLP from requester to completer. The second phase is the reception of a completion with data from the completer.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="151" id="mark-44a310ff-510f-4412-8687-31a8b3719a7c" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Memory Read Request Phase</div></div></h2><div><div><div></div></div></div><div><div><div>Refer to Figure 2-31. The requester Device Core or Software Layer sends the following information to the Transaction Layer:</div></div></div><div><div><div></div></div></div><div><div><div>32-bit or 64-bit memory address, transaction type of memory read request, amount of data to read calculated in doublewords, traffic class if other than TC0, byte enables, attributes to indicate if 'relaxed ordering' and 'no snoop' attribute bits should be set or clear. PCI Express System Architecture</div></div></div><div><div><div></div></div></div><div><div><div>Figure 2-31: Memory Read Request Phase</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_156.jpg?x=220&amp;y=757&amp;w=995&amp;h=715"></div></div><div><div><div></div></div></div><div><div><div>The Transaction layer uses this information to build a MRd TLP. The exact TLP packet format is described in a later chapter. A 3 DW or 4 DW header is created depending on address size (32-bit or 64-bit). In addition, the Transaction Layer adds its requester ID (bus#, device#, function#) and an 8-bit tag to the header. It sets the TD (transaction digest present) bit in the TLP header if a 32-bit</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="152" id="mark-ec672132-1ce3-4eb9-999e-35266e9303b5" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>End-to-End CRC is added to the tail portion of the TLP. The TLP does not have a data payload. The TLP is placed in the appropriate virtual channel buffer ready for transmission. The flow control logic confirms there are sufficient "credits" available (obtained from the completer device) for the virtual channel associated with the traffic class used.</div></div></div><div><div><div></div></div></div><div><div><div>Only then the memory read request TLP is sent to the Data Link Layer. The Data Link Layer adds a 12-bit sequence ID and a 32-bit LCRC which is calculated based on the entire packet. A copy of the TLP with sequence ID and LCRC is stored in the replay buffer.</div></div></div><div><div><div></div></div></div><div><div><div>This packet is forwarded to the Physical Layer which tags on a Start symbol and an End symbol to the packet. The packet is byte striped across the available Lanes, scrambled and 10 bit encoded. Finally the packet is converted to a serial bit stream on all Lanes and transmitted differentially across the Link to the neighbor completer device.</div></div></div><div><div><div></div></div></div><div><div><div>The completer converts the incoming serial bit stream back to <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="223" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> symbols while assembling the packet in an elastic buffer. The <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="224" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> symbols are converted back to bytes and the bytes from all Lanes are de-scrambled and un-striped. The Start and End symbols are detected and removed. The resultant TLP is sent to the Data Link Layer.</div></div></div><div><div><div></div></div></div><div><div><div>The completer Data Link Layer checks for LCRC errors in the received TLP and checks the Sequence ID for missing or out-of-sequence TLPs. Assume no error. The Data Link Layer creates an ACK DLLP which contains the same sequence ID as contained in the memory read request TLP received. A 16-bit CRC is added to the ACK DLLP. The DLLP is sent back to the Physical Layer which transmits the ACK DLLP to the requester.</div></div></div><div><div><div></div></div></div><div><div><div>The requester Physical Layer reformulates the ACK DLLP and sends it up to the Data Link Layer which evaluates the sequence ID and compares it with TLPs stored in the replay buffer. The stored memory read request TLP associated with the ACK received is discarded from the replay buffer. If a NAK DLLP was received by the requester instead, it would re-send a copy of the stored memory read request TLP.</div></div></div><div><div><div></div></div></div><div><div><div>In the mean time the Data Link Layer of the completer strips the sequence ID and LCRC field from the memory read request TLP and forwards it to the Transaction Layer.</div></div></div><div><div><div></div></div></div><div><div><div>The Transaction Layer receives the memory read request TLP in the appropriate virtual channel buffer associated with the TC of the TLP. The Transaction layer checks for ECRC error. It forwards the contents of the header (address, Chapter 2: Architecture Overview</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="153" id="mark-a01e75d8-19b8-4521-94f7-eb578df9ccbe" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>requester ID, memory read transaction type, amount of data requested, traffic class etc.) to the completer Device Core/Software Layer.</div></div></div><div><div><div></div></div></div><h2><div><div>Completion with Data Phase</div></div></h2><div><div><div></div></div></div><div><div><div>Refer to Figure 2-32 on page 99 during the following discussion. To service the memory read request, the completer Device Core/Software Layer sends the following information to the Transaction Layer:</div></div></div><div><div><div></div></div></div><div><div><div>Requester ID and Tag copied from the original memory read request, transaction type of completion with data (CplD), requested amount of data with data length field, traffic class if other than TC0, attributes to indicate if 'relaxed ordering' and 'no snoop' bits should be set or clear (these bits are copied from the original memory read request). Finally, a completion status of successful completion (SC) is sent. PCI Express System Architecture</div></div></div><div><div><div></div></div></div><div><div><div>Figure 2-32: Completion with Data Phase</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_158.jpg?x=222&amp;y=929&amp;w=996&amp;h=700"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="154" id="mark-09d4d71a-4823-4b1c-9238-ead12c9e5a91" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>The Transaction layer uses this information to build a CpID TLP. The exact TLP packet format is described in a later chapter. A 3 DW header is created. In addition, the Transaction Layer adds its own completer ID to the header. The TD (transaction digest present) bit in the TLP header is set if a 32-bit End-to-End CRC is added to the tail portion of the TLP. The TLP includes the data payload. The flow control logic confirms sufficient "credits" are available (obtained from the requester device) for the virtual channel associated with the traffic class used.</div></div></div><div><div><div></div></div></div><div><div><div>Only then the CplD TLP is sent to the Data Link Layer. The Data Link Layer adds a 12-bit sequence ID and a 32-bit LCRC which is calculated based on the entire packet. A copy of the TLP with sequence ID and LCRC is stored in the replay buffer.</div></div></div><div><div><div></div></div></div><div><div><div>This packet is forwarded to the Physical Layer which tags on a Start symbol and an End symbol to the packet. The packet is byte striped across the available Lanes, scrambled and 10 bit encoded. Finally the CplD packet is converted to a serial bit stream on all Lanes and transmitted differentially across the Link to the neighbor requester device.</div></div></div><div><div><div></div></div></div><div><div><div>The requester converts the incoming serial bit stream back to 10 bymbols while assembling the packet in an elastic buffer. The <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="225" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> symbols are converted back to bytes and the bytes from all Lanes are de-scrambled and un-striped. The Start and End symbols are detected and removed. The resultant TLP is sent to the Data Link Layer.</div></div></div><div><div><div></div></div></div><div><div><div>The Data Link Layer checks for LCRC errors in the received CplD TLP and checks the Sequence ID for missing or out-of-sequence TLPs. Assume no error. The Data Link Layer creates an ACK DLLP which contains the same sequence ID as contained in the CplD TLP received. A 16-bit CRC is added to the ACK DLLP. The DLLP is sent back to the Physical Layer which transmits the ACK DLLP to the completer.</div></div></div><div><div><div></div></div></div><div><div><div>The completer Physical Layer reformulates the ACK DLLP and sends it up to the Data Link Layer which evaluates the sequence ID and compares it with TLPs stored in the replay buffer. The stored CpID TLP associated with the ACK received is discarded from the replay buffer. If a NAK DLLP was received by the completer instead, it would re-send a copy of the stored CplD TLP.</div></div></div><div><div><div></div></div></div><div><div><div>In the mean time, the requester Transaction Layer receives the CplD TLP in the appropriate virtual channel buffer mapped to the TLP TC. The Transaction Layer uses the tag in the header of the CplD TLP to associate the completion with the original request. Transaction layer checks for ECRC error. It forwards</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="155" id="mark-f06358e2-8725-4431-942b-4bfae3e26f43" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 2: Architecture Overview</div></div></h2><div><div><div></div></div></div><div><div><div>the header contents and data payload including the Completion Status to the requester Device Core/Software Layer. Memory read transaction DONE.</div></div></div><div><div><div></div></div></div><h2><div><div>Hot Plug</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express supports native hot-plug though hot-plug support in a device is not mandatory. Some of the elements found in a PCI Express hot plug system are:</div></div></div><div><div><div></div></div></div><div><ul><li>Indicators which show the power and attention state of the slot.</li></ul></div><div><div><div></div></div></div><div><ul><li>Manually-operated Retention Latch (MRL) that holds add-in cards in place.</li></ul></div><div><div><div></div></div></div><div><ul><li>MRL Sensor that allow the port and system software to detect the MRL being opened.</li></ul></div><div><div><div></div></div></div><div><ul><li>Electromechanical Interlock which prevents removal of add-in cards while slot is powered.</li></ul></div><div><div><div></div></div></div><div><ul><li>Attention Button that allows user to request hot-plug operations.</li></ul></div><div><div><div></div></div></div><div><ul><li>Software User Interface that allows user to request hot-plug operations.</li></ul></div><div><div><div></div></div></div><div><ul><li>Slot Numbering for visual identification of slots.</li></ul></div><div><div><div></div></div></div><div><div><div>When a port has no connection or a removal event occurs, the port transmitter moves to the electrical high impedance detect state. The receiver remains in the electrical low impedance state.</div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express Performance and Data Transfer Efficiency</div></div></h2><div><div><div></div></div></div><div><div><div>As of May 2003, no realistic performance and efficiency numbers were available. However, Table 2-3 shows aggregate bandwidth numbers for various Link widths after factoring the overhead of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="226" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> encoding.</div></div></div><div><div><div></div></div></div><div><div><div>Table 2-3: PCI Express Aggregate Throughput for Various Link Widths</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>PCI Express Link Width</th><th>x1</th><th>x2</th><th>x4</th><th>x8</th><th>x12</th><th>x16</th><th>x32</th></tr></thead><tbody><tr><td>Aggregate Band- width (GBytes/sec)</td><td>0.5</td><td>1</td><td>2</td><td>4</td><td>6</td><td>8</td><td>16</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div>DLLPs are 2 doublewords in size. The ACK/NAK and flow control protocol utilize DLLPs, but it is not expected that these DLLPs will use up a significant portion of the bandwidth.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="156" id="mark-40d6cd4a-a8ae-41be-88fe-191c91132175" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>The remainder of the bandwidth is available for TLPs. Between 6-7 doublewords of the TLP is overhead associated with Start and End framing symbols, sequence ID, TLP header, ECRC and LCRC fields. The remainder of the TLP contains between 0-1024 doublewords of data payload. It is apparent that the bus efficiency is significantly low if small size packets are transmitted. The efficiency numbers are very high if TLPs contain significant amounts of data payload.</div></div></div><div><div><div></div></div></div><div><div><div>Packets can be transmitted back-to-back without the Link going idle. Thus the Link can be 100% utilized.</div></div></div><div><div><div></div></div></div><div><div><div>The switch does not introduce any arbitration overhead when forwarding incoming packets from multiple ingress ports to one egress port. However, it is yet to be seen what the effect is of the Quality of Service protocol on actual bandwidth numbers for given applications.</div></div></div><div><div><div></div></div></div><div><div><div>There is overhead associated with the split transaction protocol, especially for read transactions. For a read request TLP, the data payload is contained in the completion. This factor has to be accounted for when determining the effective performance of the bus. Posted write transactions improve the efficiency of the fabric.</div></div></div><div><div><div></div></div></div><div><div><div>Switches support cut-through mode. That is to say that an incoming packet can be immediately forwarded to an egress port for transmission without the switch having to buffer up the packet. The latency for packet forwarding through a switch can be very small allowing packets to travel from one end of the PCI Express fabric to another end with very small latency.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="157" id="mark-fe617a0a-c2eb-4d0f-9fb0-934c10b2eab5" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Part Two</div></div></div><div><div><div></div></div></div><h2><div><div>Transaction Protocol</div></div></h2><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="158" id="mark-7d5a7948-2ce7-41ba-a793-629949a6749e" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h1><div><div>Address Spaces &amp;  Transaction Routing</div></div></h1><div><div><div></div></div></div><h2><div><div>The Previous Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>The previous chapter introduced the PCI Express data transfer protocol. It described the layered approach to PCI Express device design while describing the function of each device layer. Packet types employed in accomplishing data transfers were described without getting into packet content details. Finally, this chapter outlined the process of a requester initiating a transaction such as a memory read to read data from a completer across a Link.</div></div></div><div><div><div></div></div></div><h2><div><div>This Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>This chapter describes the general concepts of PCI Express transaction routing and the mechanisms used by a device in deciding whether to accept, forward, or reject a packet arriving at an ingress port. Because Data Link Layer Packets (DLLPs) and Physical Layer ordered set link traffic are never forwarded, the emphasis here is on Transaction Layer Packet (TLP) types and the three routing methods associated with them: address routing, ID routing, and implicit routing. Included is a summary of configuration methods used in PCI Express to set up PCI-compatible plug-and-play addressing within system IO and memory maps, as well as key elements in the PCI Express packet protocol used in making routing decisions.</div></div></div><div><div><div></div></div></div><h2><div><div>The Next Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>The next chapter details the two major classes of packets are Transaction Layer Packets (TLPs), and Data Link Layer Packets (DLLPs). The use and format of each TLP and DLLP packet type is covered, along with definitions of the field within the packets.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="159" id="mark-185c34c2-53e4-4939-9136-b20b3d354a8f" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><h2><div><div>Introduction</div></div></h2><div><div><div></div></div></div><div><div><div>Unlike shared-bus architectures such as PCI and PCI-X, where traffic is visible to each device and routing is mainly a concern of bridges, PCI Express devices are dependent on each other to accept traffic or forward it in the direction of the ultimate recipient.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 3-1: Multi-Port PCI Express Devices Have Routing Responsibilities</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_165.jpg?x=231&amp;y=645&amp;w=991&amp;h=968"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="160" id="mark-6937a397-af4e-486b-9e8f-5428e5b9c976" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Chapter 3: Address Spaces &amp; Transaction Routing</div></div></h2><div><div><div></div></div></div><div><div><div>As illustrated in Figure 3-1 on page 106, a PCI Express topology consists of independent, point-to-point links connecting each device with one or more neighbors. As traffic arrives at the inbound side of a link interface (called the ingress port), the device checks for errors, then makes one of three decisions:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">Accept the traffic and use it internally.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">Forward the traffic to the appropriate outbound (egress) port.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">Reject the traffic because it is neither the intended target nor an interface to it (note that there are also other reasons why traffic may be rejected)</li></ol></div><div><div><div></div></div></div><h2><div><div>Receivers Check For Three Types of Link Traffic</div></div></h2><div><div><div></div></div></div><div><div><div>Assuming a link is fully operational, the physical layer receiver interface of each device is prepared to monitor the logical idle condition and detect the arrival of the three types of link traffic: Ordered Sets, DLLPs, and TLPs. Using control (K) symbols which accompany the traffic to determine framing boundaries and traffic type, PCI Express devices then make a distinction between traffic which is local to the link vs. traffic which may require routing to other links (e.g. TLPs). Local link traffic, which includes Ordered Sets and Data Link Layer Packets (DLLPs), isn't forwarded and carries no routing information. Transaction Layer Packets (TLPs) can and do move from link to link, using routing information contained in the packet headers.</div></div></div><div><div><div></div></div></div><h2><div><div>Multi-port Devices Assume the Routing Burden</div></div></h2><div><div><div></div></div></div><div><div><div>It should be apparent in Figure 3-1 on page 106 that devices with multiple PCI Express ports are responsible for handling their own traffic as well as forwarding other traffic between ingress ports and any enabled egress ports. Also note that while peer-peer transaction support is required of switches, it is optional for a multi-port Root Complex. It is up to the system designer to account for peer-to-peer traffic when selecting devices and laying out a motherboard.</div></div></div><div><div><div></div></div></div><h2><div><div>Endpoints Have Limited Routing Responsibilities</div></div></h2><div><div><div></div></div></div><div><div><div>It should also be apparent in Figure 3-1 on page 106 that endpoint devices have a single link interface and lack the ability to route inbound traffic to other links. For this reason, and because they don't reside on shared busses, endpoints never expect to see ingress port traffic which is not intended for them (this is different than shared-bus <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="227" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c50"></mjx-c><mjx-c class="mjx-c43"></mjx-c><mjx-c class="mjx-c49"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mrow space="2"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c58"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">PCI</mi></mrow></mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">X</mi></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> ,where devices commonly decode addresses</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="161" id="mark-abb0e71b-d86a-4b72-ad6c-28fcb43575e7" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>and commands not targeting them). Endpoint routing is limited to accepting or rejecting transactions presented to them.</div></div></div><div><div><div></div></div></div><h2><div><div>System Routing Strategy Is Programmed</div></div></h2><div><div><div></div></div></div><div><div><div>Before transactions can be generated by a requester, accepted by the completer, and forwarded by any devices in the path between the two, all devices must be configured to enforce the system transaction routing scheme. Routing is based on traffic type, system memory and IO address assignments, etc. In keeping with PCI plug-and-play configuration methods, each PCI express device is discovered, memory and IO address resources are assigned to them, and switch/ bridge devices are programmed to forward transactions on their behalf. Once routing is programmed, bus mastering and target address decoding are enabled. Thereafter, devices are prepared to generate, accept, forward, or reject transactions as necessary.</div></div></div><div><div><div></div></div></div><h2><div><div>Two Types of Local Link Traffic</div></div></h2><div><div><div></div></div></div><div><div><div>Local traffic occurs between the transmit interface of one device and the receive interface of its neighbor for the purpose of managing the link itself. This traffic is never forwarded or flow controlled; when sent, it must be accepted. Local traffic is further classified as Ordered Sets exchanged between the Physical Layers of two devices on a link or Data Link Layer packets (DLLPs) exchanged between the Data Link Layers of the two devices.</div></div></div><div><div><div></div></div></div><h2><div><div>Ordered Sets</div></div></h2><div><div><div></div></div></div><div><div><div>These are sent by each physical layer transmitter to the physical layer of the corresponding receiver to initiate link training, compensate for clock tolerance, or transition a link to and from the Electrical Idle state. As indicated in Table 3-1 on page 109, there are five types of Ordered Sets.</div></div></div><div><div><div></div></div></div><div><div><div>Each ordered set is constructed of 10-bit control (K) symbols that are created within the physical layer. These symbols have a common name as well as a alph-numeric code that defines the 10 bits pattern of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="228" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> and <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="229" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> ,of which they are comprised. For example, the SKP (Skip) symbol has a 10-bit value represented as K28.0.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="162" id="mark-41a1c4a0-6ebc-4ce3-a138-3a5eb0204c37" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 3: Address Spaces &amp; Transaction Routing</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 3-2 on page 110 illustrates the transmission of Ordered Sets. Note that each ordered set is fixed in size, consisting of 4 or 16 characters. Again, the receiver is required to consume them as they are sent. Note that the COM control symbol (K28.5) is used to indicate the start of any ordered set.</div></div></div><div><div><div></div></div></div><div><div><div>Refer to the "8b/10b Encoding" on page 419 for a thorough discussion of Ordered Sets.</div></div></div><div><div><div></div></div></div><div><div><div>Table 3-1: Ordered Set Types</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Ordered Set Type</th><th>Symbols</th><th>Purpose</th></tr></thead><tbody><tr><td>Fast Training Sequence (FTS)</td><td>COM, 3 FTS</td><td>Quick synchronization of bit stream when leaving L0s power state.</td></tr><tr><td>Training Sequence One (TS1)</td><td>COM, Lane ID, 14 more</td><td>Used in link training, to align and synchronize the incoming bit stream at startup, convey reset, other func- tions.</td></tr><tr><td>Training Sequence Two (TS2)</td><td>COM, Lane ID, 14 more</td><td>See TS1.</td></tr><tr><td>Electrical Idle (IDLE)</td><td>COM, 3 IDL</td><td>Indicates that link should be brought to a lower power state (L0s, L1, L2).</td></tr><tr><td>Skip</td><td>COM, 3 SKP</td><td>Inserted periodically to compensate for clock tolerances.</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="163" id="mark-f4c7b6fc-4f88-429f-aa72-708e9cde46d5" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Figure 3-2: PCI Express Link Local Traffic: Ordered Sets</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_169.jpg?x=253&amp;y=396&amp;w=937&amp;h=1062"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="164" id="mark-8eaa056e-2a58-4b67-ad2a-25b0cd579246" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Data Link Layer Packets (DLLPs)</div></div></h2><div><div><div></div></div></div><div><div><div>The other type of local traffic sent by a device transmit interface to the corresponding receiver of the device attached to it are Data Link Layer Packets (DLLPs). These are also used in link management, although they are sourced at the device Data Link Layer rather that the Physical Layer. The main functions of DLLPs are to facilitate Link Power Management, TLP Flow Control, and the acknowledgement of successful TLP delivery across the link.</div></div></div><div><div><div></div></div></div><div><div><div>Table 3-2: Data Link Layer Packet (DLLP) Types</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>DLLP</th><th>Purpose</th></tr></thead><tbody><tr><td>Acknowledge (Ack)</td><td>Receiver Data Link Layer sends Ack to indicate that no CRC or other errors have been encountered in received TLP(s). Transmitter retains copy of TLPs until Ack’d</td></tr><tr><td>No Acknowledge (Nak)</td><td>Receiver Data Link Layer sends Nak to indicate that a TLP was received with a CRC or other error. All TLPs remaining in the transmitter's Retry Buffer must be resent, in the original order.</td></tr><tr><td>PM_Enter_L1; PM_Enter_L23</td><td>Following a software configuration space access to cause a device power management event, a downstream device requests entry to link L1 or Level 2-3 state</td></tr><tr><td>PM_Active_State_Req_L1</td><td>Downstream device autonomously requests L1 Active State</td></tr><tr><td>PM_Request_Ack</td><td>Upstream device acknowledges transition to L1 State</td></tr><tr><td>Vendor-Specific DLLP</td><td>Reserved for vendor-specific purposes</td></tr><tr><td>InitFC1-P InitFC1-NP InitFC1-Cpl</td><td>Flow Control Initialization Type One DLLP awarding posted (P), nonposted (NP), or completion (Cpl) flow control credits.</td></tr><tr><td>InitFC2-P InitFC2-NP InitFC2-Cpl</td><td>Flow Control Initialization Type Two DLLP confirming award of InitFC1 posted (P), nonposted (NP), or com- pletion (Cpl) flow control credits.</td></tr><tr><td>UpdateFC-P UpdateFC-NP UpdateFC-Cpl</td><td>Flow Control Credit Update DLLP awarding posted (P), nonposted (NP), or completion (Cpl) flow control cred- its.</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="165" id="mark-8d1e1f78-3641-4ef0-bb0f-12bd6240c314" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>As described in Table 3-2 on page 111 and shown in Figure 3-3 on page 112, there are three major types of DLLPs: Ack/Nak, Power Management (several variants), and Flow Control. In addition, a vendor-specific DLLP is permitted in the specification. Each DLLP is 8 bytes, including a Start Of DLLP (SDP) byte, 2- byte CRC, and an End Of Packet (END) byte in addition to the 4 byte DLLP core (which includes the type field and any required attributes).</div></div></div><div><div><div></div></div></div><div><div><div>Figure 3-3: PCI Express Link Local Traffic: DLLPs</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_171.jpg?x=267&amp;y=641&amp;w=907&amp;h=943"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="166" id="mark-7f9a1862-9bbd-49d2-bc31-53c71b038d71" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Chapter 3: Address Spaces &amp; Transaction Routing</div></div></h2><div><div><div></div></div></div><div><div><div>Note that unlike Ordered Sets, DLLPs always carry a 16-bit CRC which is verified by the receiver before carrying out the required operation. If an error is detected by the receiver of a DLLP, it is dropped. Even though DLLPs are not acknowledged, time-out mechanisms built into the specification permit recovery from dropped DLLPs due to CRC errors.</div></div></div><div><div><div></div></div></div><div><div><div>Refer to "Data Link Layer Packets" on page 198 for a thorough discussion of Data Link Layer packets.</div></div></div><div><div><div></div></div></div><h2><div><div>Transaction Layer Packet Routing Basics</div></div></h2><div><div><div></div></div></div><div><div><div>The third class of link traffic originates in the Transaction Layer of one device and targets the Transaction Layer of another device. These Transaction Layer Packets (TLPs) are forwarded from one link to another as necessary, subject to the routing mechanisms and rules described in the following sections. Note that other chapters in this book describe additional aspects of Transaction Layer Packet handling, including Flow Control, Quality Of Service, Error Handling, Ordering rules, etc. The term transaction is used here to describe the exchange of information using Transaction Layer Packets. Because Ordered Sets and DLLPs carry no routing information and are not forwarded, the routing rules described in the following sections apply only to TLPs.</div></div></div><div><div><div></div></div></div><h2><div><div>TLPs Used to Access Four Address Spaces</div></div></h2><div><div><div></div></div></div><div><div><div>As transactions are carried out between PCI Express requesters and completers, four separate address spaces are used: Memory, IO, Configuration, and Message. The basic use of each address space is described in Table 3-3 on page 113.</div></div></div><div><div><div></div></div></div><div><div><div>Table 3-3: PCI Express Address Space And Transaction Types</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Address Space</th><th>Transaction Types</th><th>Purpose</th></tr></thead><tbody><tr><td>Memory</td><td>Read, Write</td><td>Transfer data to or from a location in the system memory map</td></tr><tr><td>IO</td><td>Read, Write</td><td>Transfer data to or from a location in the system IO map</td></tr><tr><td>Configuration</td><td>Read, Write</td><td>Transfer data to or from a location in the configuration space of a PCI-com- patible device.</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="167" id="mark-1b2bb5ec-3ab5-4f66-a38b-d36f4dbc482b" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 3-3: PCI Express Address Space And Transaction Types (Continued)</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Address Space</th><th>Transaction Types</th><th>Purpose</th></tr></thead><tbody><tr><td>Message</td><td>Baseline, Vendor-specific</td><td>General in-band messaging and event reporting (without consuming mem- ory or IO address resources)</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>Split Transaction Protocol Is Used</div></div></h2><div><div><div></div></div></div><div><div><div>Accesses to the four address spaces in PCI Express are accomplished using split-transaction requests and completions.</div></div></div><div><div><div></div></div></div><h2><div><div>Split Transactions: Better Performance, More Overhead</div></div></h2><div><div><div></div></div></div><div><div><div>The split transaction protocol is an improvement over earlier bus protocols (e.g. PCI) which made extensive use of bus wait-states or delayed transactions (retries) to deal with latencies in accessing targets. In PCI Express, the completion following a request is initiated by the completer only when it has data and/ or status ready for delivery. The fact that the completion is separated in time from the request which caused it also means that two separate TLPs are generated, with independent routing for the request TLP and the Completion TLP. Note that while a link is free for other activity in the time between a request and its subsequent completion, a split-transaction protocol involves some additional overhead as two complete TLPs must be generated to carry out a single transaction.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 3-4 on page 115 illustrates the request-completion phases of a PCI Express split transaction. This example represents an endpoint read from system memory.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="168" id="mark-16b2190b-da4a-4145-ac9d-4608b5dc7c47" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 3-4: PCI Express Transaction Request And Completion TLPs</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_174.jpg?x=217&amp;y=406&amp;w=1010&amp;h=882"></div></div><div><div><div></div></div></div><div><div><div>Write Posting: Sometimes a Completion Isn't Needed</div></div></div><div><div><div></div></div></div><div><div><div>To mitigate the penalty of the request-completion latency, messages and some write transactions in PCI Express are posted, meaning the write request (including data) is sent, and the transaction is over from the requester's perspective as soon as the request is sent out of the egress port; responsibility for delivery is now the problem of the next device. In a multi-level topology, this has the advantage of being much faster than waiting for the entire request-completion transit, but - as in all posting schemes - uncertainty exists concerning when (and if) the transaction completed successfully at the ultimate recipient.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="169" id="mark-9ccc410c-a9b0-4fd1-bef4-21255e32a4cd" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>In PCI Express, write posting to memory is considered acceptable in exchange for the higher performance. On the other hand, writes to IO and configuration space may change device behavior, and write posting is not permitted. A completion will always be sent to report status of the IO or configuration write operation.</div></div></div><div><div><div></div></div></div><div><div><div>Table 3-4 on page 116 lists PCI Express posted and non-posted transactions.</div></div></div><div><div><div></div></div></div><div><div><div>Table 3-4: PCI Express Posted and Non-Posted Transactions</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Request</th><th>How Request Is Handled</th></tr></thead><tbody><tr><td>Memory Write</td><td>All Memory Write requests are posted. No completion is expected or sent.</td></tr><tr><td>Memory Read Memory Read Lock</td><td>All memory read requests are non-posted. A completion with data (CplD or CplDLK) will be returned by the com- pleter with requested data and to report status of the mem- ory read</td></tr><tr><td>IO Write</td><td>All IO Write requests are non-posted. A completion without data (Cpl) will be returned by the completer to report status of the IO write operation.</td></tr><tr><td>IO Read</td><td>All IO read requests are non-posted. A completion with data (CplD) will be returned by the completer with requested data and to report status of the IO read operation.</td></tr><tr><td>Configuration Write Type 0 and Type 1</td><td>All Configuration Write requests are non-posted. A comple- tion without data (Cpl) will be returned by the completer to report status of the configuration space write operation.</td></tr><tr><td>Configuration Read Type 0 and Type 1</td><td>All configuration read requests are non-posted. A comple- tion with data (CplD) will be returned by the completer witl requested data and to report status of the read operation.</td></tr><tr><td>Message Message With Data</td><td>While the routing method varies, all message transactions are handled in the same manner as memory writes in that they are considered posted requests</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="170" id="mark-511e23f7-1fa0-4083-92a3-94e75da3ab19" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Chapter 3: Address Spaces &amp; Transaction Routing</div></div></h2><div><div><div></div></div></div><h2><div><div>Three Methods of TLP Routing</div></div></h2><div><div><div></div></div></div><div><div><div>All of the TLP variants, targeting any of the four address spaces, are routed using one of the three possible schemes: Address Routing, ID Routing, and Implicit Routing. Table 3-5 on page 117 summarizes the PCI Express TLP header type variants and the routing method used for each. Each of these is described in the following sections.</div></div></div><div><div><div></div></div></div><div><div><div>Table 3-5: PCI Express TLP Variants And Routing Options</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>TLP Type</th><th>Routing Method Used</th></tr></thead><tbody><tr><td>Memory Read (MRd), Memory Read Lock (MRdLk), Memory Write (MWr)</td><td>Address Routing</td></tr><tr><td>IO Read (IORd), IO Write (IOWr)</td><td>Address Routing</td></tr><tr><td>Configuration Read Type 0 (CfgRd0), Configuration Read Type 1 (CfgRd1) Configuration Write Type 0 (CfgWr0), Configuration Write Type 1(CfgWr1)</td><td>ID Routing</td></tr><tr><td>Message (Msg), Message With Data (MsgD)</td><td>Address Routing, ID Rout- ing, or Implicit routing</td></tr><tr><td>Completion (Cpl), Completion With Data (CplD)</td><td>ID Routing</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>PCI Express Routing Is Compatible with PCI</div></div></h2><div><div><div></div></div></div><div><div><div>As indicated in Table 3-5 on page 117, memory and IO transactions are routed through the PCI Express topology using address routing to reference system memory and IO maps, while configuration cycles use ID routing to reference the completer's (target's) logical position within the PCI-compatible bus topology (using Bus Number, Device Number, Function Number in place of a linear address). Both address routing and ID routing are completely compatible with routing methods used in the PCI and PCIX protocols when performing memory, IO, or configuration transactions. PCI Express completions also use the ID routing scheme. PCI Express System Architecture</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="171" id="mark-74d7f76d-adae-48d1-9118-740eedce3fe4" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express Adds Implicit Routing for Messages</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express adds the third routing method, implicit routing, which is an option when sending messages. In implicit routing, neither address or ID routing information applies; the packet is routed based on a code in the packet header indicating it is destined for device(s) with known, fixed locations (the Root Complex, the next receiver, etc.).</div></div></div><div><div><div></div></div></div><div><div><div>While limited in the cases it can support, implicit routing simplifies routing of messages. Note that messages may optionally use address or ID routing instead.</div></div></div><div><div><div></div></div></div><div><div><div>Why Were Messages Added to PCI Express Protocol? PCI and PCI-</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="230" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c58"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">X</mi></mrow></math></mjx-assistive-mml></mjx-container> protocols support load and store memory and IO read-write transactions, which have the following features:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">The transaction initiator drives out a memory or IO start address selecting a location within the desired target.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">The target claims the transaction based on decoding and comparing the transaction start address with ranges it has been programmed to respond to in its configuration space Base Address Registers.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">If the transaction involves bursting, then addresses are indexed after each data transfer.</li></ol></div><div><div><div></div></div></div><div><div><div>While PCI Express also supports load and store transactions with its memory and IO transactions, it adds in-band messages. The main reason for this is that the PCI Express protocol seeks to (and does) eliminate many of the sideband signals related to interrupts, error handling, and power management which are found in <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="231" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-n"><mjx-c class="mjx-c50"></mjx-c><mjx-c class="mjx-c43"></mjx-c><mjx-c class="mjx-c49"></mjx-c></mjx-mi><mjx-mrow space="2"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c58"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>PCI</mi><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">X</mi></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> -based systems. Elimination of signals is very important in an architecture with the scalability possible with PCI Express. It would not be efficient to design a PCI Express device with a two lane link and then saddle it with numerous additional signals to handle auxiliary functions.</div></div></div><div><div><div></div></div></div><div><div><div>The PCI Express protocol replaces most sideband signals with a variety of in-band packet types; some of these are conveyed as Data Link Layer packets (DLLPs) and some as Transaction Layer packets (TLPs).</div></div></div><div><div><div></div></div></div><div><div><div>How Implicit Routing Helps with Messages. One side effect of using in-band messages in place of hard-wired sideband signals is the problem of delivering the message to the proper recipient in a topology consisting of numerous point-to-point links. The PCI Express protocol provides maximum flexibility in routing message TLPs; they may use address routing, ID routing, or the third method, implicit routing. Implicit routing takes advantage of the fact that, due to their architecture, switches and other multi-port</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="172" id="mark-3682a32c-295d-4eb2-9c5d-d938f3ce4230" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 3: Address Spaces &amp; Transaction Routing</div></div></h2><div><div><div></div></div></div><div><div><div>devices have a fundamental sense of upstream and downstream, and where the Root Complex is to be found. Because of this, a message header can be routed implicitly with a simple code indicating that it is intended for the Root Complex, a broadcast downstream message, should terminate at the next receiver, etc.</div></div></div><div><div><div></div></div></div><div><div><div>The advantage of implicit routing is that it eliminates the need to assign a set of memory mapped addresses for all of the possible message variants and program all of the devices to use them.</div></div></div><div><div><div></div></div></div><h2><div><div>Header Fields Define Packet Format and Routing</div></div></h2><div><div><div></div></div></div><div><div><div>As depicted in Figure 3-5 on page 119, each Transaction Layer Packet contains a three or four double word (12 or 16 byte) header. Included in the 3DW or 4DW header are two fields, Type and Format (Fmt), which define the format of the remainder of the header and the routing method to be used on the entire TLP as it moves between devices in the PCI Express topology.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 3-5: Transaction Layer Packet Generic 3DW And 4DW Headers</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_178.jpg?x=358&amp;y=953&amp;w=736&amp;h=713"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="173" id="mark-555e2374-8688-4cba-a97e-fc03a2235b46" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Using TLP Header Information: Overview</div></div></h2><div><div><div></div></div></div><h2><div><div>General</div></div></h2><div><div><div></div></div></div><div><div><div>As TLPs arrive at an ingress port, they are first checked for errors at both the physical and data link layers of the receiver. Assuming there are no errors, TLP routing is performed; basic steps include:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">The TLP header Type and Format fields in the first DWord are examined to determine the size and format of the remainder of the packet.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">Depending on the routing method associated with the packet, the device will determine if it is the intended recipient; if so, it will accept (consume) the TLP. If it is not the recipient, and it is a multi-port device, it will forward the TLP to the appropriate egress port-subject to the rules for ordering and flow control for that egress port.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">If it is neither the intended recipient nor a device in the path to it, it will generally reject the packet as an Unsupported Request (UR).</li></ol></div><div><div><div></div></div></div><h2><div><div>Header Type/Format Field Encodings</div></div></h2><div><div><div></div></div></div><div><div><div>Table 3-6 on page 120 below summarizes the encodings used in TLP header Type and Format fields. These two fields, used together, indicate TLP format and routing to the receiver.</div></div></div><div><div><div></div></div></div><div><div><div>Table 3-6: TLP Header Type and Format Field Encodings</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>TLP</th><th>FMT[1:0]</th><th>TYPE [4:0]</th></tr></thead><tbody><tr><td>Memory Read Request (MRd)</td><td>00 = 3DW, no data 01 = 4DW, no data</td><td>0 0000</td></tr><tr><td>Memory Read Lock Request (MRdLk)</td><td>00 = 3DW, no data 01 = 4DW, no data</td><td>0 0001</td></tr><tr><td>Memory Write Request (MWr)</td><td>10 = 3DW, w/ data 11 = 4DW, w/ data</td><td>0 0000</td></tr><tr><td>IO Read Request (IORd)</td><td>00 = 3DW, no data</td><td>00010</td></tr><tr><td>IO Write Request (IOWr)</td><td>10 = 3DW, w/ data</td><td>0 0010</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="174" id="mark-119ae66f-5988-4e39-857a-4596ef982418" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Chapter 3: Address Spaces &amp; Transaction Routing</div></div></h2><div><div><div></div></div></div><div><div><div>Table 3-6: TLP Header Type and Format Field Encodings (Continued)</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>TLP</th><th>FMT[1:0]</th><th>TYPE [4:0]</th></tr></thead><tbody><tr><td>Config Type 0 Read Request (CfgRd0)</td><td>00 = 3DW, no data</td><td>0 0100</td></tr><tr><td>Config Type 0 Write Request (CfgWr0)</td><td>10 = 3DW, w/ data</td><td>0 0100</td></tr><tr><td>Config Type 1 Read Request (CfgRd1)</td><td>00 = 3DW, no data</td><td>0 0101</td></tr><tr><td>Config Type 1 Write Request (CfgWr1)</td><td>10 = 3DW, w/ data</td><td>0 0101</td></tr><tr><td>Message Request (Msg)</td><td>01 = 4DW, no data</td><td>1 0 RRR* (for RRR, see routing subfield)</td></tr><tr><td>Message Request W/Data (MsgD)</td><td>11 = 4DW, w/ data</td><td>1 0 RRR* (for RRR, see routing subfield)</td></tr><tr><td>Completion (Cpl)</td><td>00 = 3DW, no data</td><td>0 1010</td></tr><tr><td>Completion W/Data (CplD)</td><td>10 = 3DW, w/ data</td><td>0 1010</td></tr><tr><td>Completion-Locked (CplLk)</td><td>00 = 3DW, no data</td><td>0 1011</td></tr><tr><td>Completion W/Data (CplDLk)</td><td>10 = 3DW, w/ data</td><td>01011</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>Applying Routing Mechanisms</div></div></h2><div><div><div></div></div></div><div><div><div>Once configuration of the system routing strategy is complete and transactions are enabled, PCI Express devices decode inbound TLP headers and use corresponding fields in configuration space Base Address Registers, Base/Limit registers, and Bus Number registers to apply address, ID, and implicit routing to the packet. Note that there are actually two levels of decision: the device first determines if the packet targets an internal location; if not, and the device is a switch, it will evaluate the packet to see if it should be forwarded out of an egress port. A third possibility is that the packet has been received in error or is malformed; in this case, it will be handled as a receive error. There are a number of cases when this may happen, and a number of ways it may be handled. Refer to "PCI Express Error Checking Mechanisms" on page 356 for a description of error checking and handling. The following sections describe the basic features of each routing mechanism; we will assume no errors are encountered.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="175" id="mark-749d4bb0-5f58-42d6-82ad-ac93f197e2c7" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Address Routing</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express transactions using address routing reference the same system memory and IO maps that PCI and PCIX transactions do. Address routing is used to transfer data to or from memory, memory mapped IO, or IO locations. Memory transaction requests may carry either 32 bit addresses using the 3DW TLP header format, or 64 bit addresses using the 4DW TLP header format. IO transaction requests are restricted to 32 bits of address using the 3DW TLP header format, and should only target legacy devices.</div></div></div><div><div><div></div></div></div><h2><div><div>Memory and IO Address Maps</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 3-6 on page 122 depicts generic system memory and IO maps. Note that the size of the system memory map is a function of the range of addresses that devices are capable of generating (often dictated by the CPU address bus). As in PCI and PCI-X, PCI Express permits either 32 bit or 64 bit memory addressing. The size of the system IO map is limited to 32 bits (4GB), although in many systems only the lower <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="232" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>16</mn></mrow></math></mjx-assistive-mml></mjx-container> bits <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="233" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mn>64</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">KB</mi></mrow></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> are used.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 3-6: Generic System Memory And IO Address Maps</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_181.jpg?x=319&amp;y=1006&amp;w=806&amp;h=663"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="176" id="mark-3fc199a9-6cfb-4c34-9018-2d853fc42a90" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Chapter 3: Address Spaces &amp; Transaction Routing</div></div></h2><div><div><div></div></div></div><h2><div><div>Key TLP Header Fields in Address Routing</div></div></h2><div><div><div></div></div></div><div><div><div>If the Type field in a received TLP indicates address routing is to be used, then the Address Fields in the header are used to performing the routing check. There are two cases: 32-bit addresses and 64-bit addresses.</div></div></div><div><div><div></div></div></div><div><div><div>TLPs with 3DW, 32-Bit Address. For IO or a 32-bit memory requests, only 32 bits of address are contained in the header. Devices targeted with these TLPs will reside below the <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="234" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c47"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>4</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">GB</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> memory or IO address boundary. Figure 3-7 on page 123 depicts this case.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 3-7: 3DW TLP Header Address Routing Fields</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_182.jpg?x=345&amp;y=731&amp;w=752&amp;h=933"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="177" id="mark-f33ea1b8-ed36-4d36-9355-3d461df70a14" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>TLPs With 4DW, 64-Bit Address. For 64-bit memory requests, 64 bits of address are contained in the header. Devices targeted with these TLPs will reside above the <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="235" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c47"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>4</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">GB</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> memory boundary. Figure 3-8 on page 124 shows this case.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 3-8: 4DW TLP Header Address Routing Fields</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_183.jpg?x=352&amp;y=553&amp;w=747&amp;h=1021"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="178" id="mark-d9b0f49c-eff0-4f16-b778-76144af8ac6a" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Chapter 3: Address Spaces &amp; Transaction Routing</div></div></h2><div><div><div></div></div></div><h2><div><div>An Endpoint Checks an Address-Routed TLP</div></div></h2><div><div><div></div></div></div><div><div><div>If the Type field in a received TLP indicates address routing is to be used, then an endpoint device simply checks the address in the packet header against each of its implemented BARs in its Type 0 configuration space header. As it has only one link interface, it will either claim the packet or reject it. Figure 3-9 on page 125 illustrates this case.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 3-9: Endpoint Checks Routing Of An Inbound TLP Using Address Routing</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_184.jpg?x=223&amp;y=701&amp;w=998&amp;h=723"></div></div><div><div><div></div></div></div><h2><div><div>A Switch Receives an Address Routed TLP: Two Checks</div></div></h2><div><div><div></div></div></div><div><div><div>General. If the Type field in a received TLP indicates address routing is to be used, then a switch first checks to see if it is the intended completer. It compares the header address against target addresses programmed in its two BARs. If the address falls within the range, it consumes the packet. This</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="179" id="mark-80770d09-4b13-409f-8974-e0234c9af4a3" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>case is indicated by (1) in Figure 3-10 on page 126. If the header address field does not match a range programmed in a BAR, it then checks the Type 1 configuration space header for each downstream link. It checks the non-prefetchable memory (MMIO) and prefetchable Base/Limit registers if the transaction targets memory, or the I/O Base and Limt registers if the transaction targets I/O address space. This check is indicated by (2) in Figure 3- 10 on page 126.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 3-10: Switch Checks Routing Of An Inbound TLP Using Address Routing</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_185.jpg?x=223&amp;y=689&amp;w=998&amp;h=974"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="180" id="mark-81ce0142-ac30-4e4d-8e42-532ae8d1f5cb" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Other Notes About Switch Address-Routing. The following notes also apply to switch address routing:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">If the address-routed packet address falls in the range of one of its secondary bridge interface Base/Limit register sets, it will forward the packet downstream.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">If the address-routed packet was moving downstream (was received on the primary interface) and it does not map to any BAR or downstream link Base/Limit registers, it will be handled as an unsupported request on the primary link.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">Upstream address-routed packets are always forwarded to the upstream link if they do not target an internal location or another downstream link.</li></ol></div><div><div><div></div></div></div><h2><div><div>ID Routing</div></div></h2><div><div><div></div></div></div><div><div><div>ID routing is based on the logical position (Bus Number, Device Number, Function Number) of a device function within the PCI bus topology. ID routing is compatible with routing methods used in the PCI and PCIX protocols when performing Type 0 or Type 1 configuration transactions. In PCI Express, it is also used for routing completions and may be used in message routing as well.</div></div></div><div><div><div></div></div></div><h2><div><div>ID Bus Number, Device Number, Function Number Limits</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express supports the same basic topology limits as PCI and PCI-X:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">A maximum of 256 busses/links in a system. This includes busses created by bridges to other PCI-compatible protocols such as PCI, PCI-X, AGP, etc.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">A maximum of 32 devices per bus/link. Of course, While a PCI(X) bus or the internal bus of a switch may host more than one downstream bridge interface, external PCI Express links are always point-to-point with only two devices per link. The downstream device on an external link is device 0 .</li></ol></div><div><div><div></div></div></div><div><ul><li>A maximum of 8 internal functions per device.</li></ul></div><div><div><div></div></div></div><div><div><div>A significant difference in PCI Express over PCI is the provision for extending the amount of configuration space per function from 256 bytes to <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="236" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>4</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">KB</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> . Refer to the "Configuration Overview" on page 711 for a detailed description of the compatible and extended areas of PCI Express configuration space.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="181" id="mark-526e06bd-98fa-4e4c-b33e-15ca71fd0cb8" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Key TLP Header Fields in ID Routing</div></div></h2><div><div><div></div></div></div><div><div><div>If the Type field in a received TLP indicates ID routing is to be used, then the ID fields in the header are used to perform the routing check. There are two cases: ID routing with a 3DW header and ID routing with a 4DW header.</div></div></div><div><div><div></div></div></div><div><div><div>3DW TLP, ID Routing. Figure 3-11 on page 128 illustrates a TLP using ID routing and the 3DW header.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 3-11: 3DW TLP Header ID Routing Fields</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_187.jpg?x=343&amp;y=666&amp;w=754&amp;h=1008"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="182" id="mark-476c807e-0cd0-4ba3-8789-d44d388cced6" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>4DW TLP, ID Routing. Figure 3-12 on page 129 illustrates a TLP using ID routing and the 4DW header.</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_188.jpg?x=316&amp;y=509&amp;w=809&amp;h=1107"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="183" id="mark-05ca732b-d91f-43c7-b75f-39a1ad0ffaa7" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>An Endpoint Checks an ID-Routed TLP</div></div></h2><div><div><div></div></div></div><div><div><div>If the Type field in a received TLP indicates ID routing is to be used, then an endpoint device simply checks the ID field in the packet header against its own Bus Number, Device Number, and Function Number(s). In PCI Express, each device "captures" (and remembers) its own Bus Number and Device Number contained in TLP header bytes 8-9 each time a configuration write (Type 0) is detected on its primary link. At reset, all bus and device numbers in the system revert to 0 , so a device will not respond to transactions other than configuration cycles until at least one configuration write cycle (Type 0) has been performed. Note that the PCI Express protocol does not define a configuration space location where the device function is required to store the captured Bus Number and Device Number information, only that it must do it.</div></div></div><div><div><div></div></div></div><div><div><div>Once again, as it has only one link interface, an endpoint will either claim an ID-routed packet or reject it. Figure 3-11 on page 128 illustrates this case.</div></div></div><div><div><div></div></div></div><h2><div><div>A Switch Receives an ID-Routed TLP: Two Checks</div></div></h2><div><div><div></div></div></div><div><div><div>If the Type field in a received TLP indicates ID routing is to be used, then a switch first checks to see if it is the intended completer. It compares the header ID field against its own Bus Number, Device Number, and Function Number(s). This is indicated by (1) in Figure 3-13 on page 131. As in the case of an endpoint, a switch captures its own Bus Number and Device number each time a configuration write (Type 0) is detected on i's primary link interface. If the header ID agrees with the ID of the switch, it consumes the packet. If the ID field does not match i's own, it then checks the Secondary-Subordinate Bus Number registers in the configuration space for each downstream link. This check is indicated by (2) in Figure 3-13 on page 131.</div></div></div><div><div><div></div></div></div><h2><div><div>Other Notes About Switch ID Routing</div></div></h2><div><div><div></div></div></div><div><ol><li value="1">If the ID-routed packet matches the range of one of its secondary bridge interface Secondary-Subordinate registers, it will forward the packet downstream.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">If the ID-routed packet was moving downstream (was received on the primary interface) and it does not map to any downstream interface, it will be handled as an unsupported request on the primary link.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">Upstream ID-routed packets are always forwarded to the upstream link if they do not target an internal location or another downstream link.</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="184" id="mark-9c364e56-2c4e-4470-9fb3-bcaba63c32cc" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 3: Address Spaces &amp; Transaction Routing</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 3-13: Switch Checks Routing Of An Inbound TLP Using ID Routing</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_190.jpg?x=303&amp;y=424&amp;w=897&amp;h=695"></div></div><div><div><div></div></div></div><div><div><div>header is shown. Each link interface has its own.</div></div></div><div><div><div></div></div></div><h2><div><div>Implicit Routing</div></div></h2><div><div><div></div></div></div><div><div><div>Implicit routing is based on the intrinsic knowledge PCI Express devices are required to have concerning upstream and downstream traffic and the existence of a single PCI Express Root Complex at the top of the PCI Express topology. This awareness allows limited routing of packets without the need to assign and include addresses with certain message packets. Because the Root Complex generally implements power management and interrupt controllers, as well as system error handling, it is either the source or recipient of most PCI Express messages. PCI Express System Architecture</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="185" id="mark-d9eb0830-fcbc-4a66-83f4-9299858e4182" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Only Messages May Use Implicit Routing</div></div></h2><div><div><div></div></div></div><div><div><div>With the elimination of many sideband signals in the PCI Express protocol, alternate methods are required to inform the host system when devices need service with respect to interrupts, errors, power management, etc. PCI Express addresses this by defining a number of special TLPs which may be used as virtual wires in conveying sideband events. Message groups currently defined include:</div></div></div><div><div><div></div></div></div><div><ul><li>Power Management</li></ul></div><div><div><div></div></div></div><div><ul><li>INTx legacy interrupt signaling</li></ul></div><div><div><div></div></div></div><div><ul><li>Error signaling</li></ul></div><div><div><div></div></div></div><div><ul><li>Locked Transaction support</li></ul></div><div><div><div></div></div></div><div><ul><li>Hot Plug signaling</li></ul></div><div><div><div></div></div></div><div><ul><li>Vendor-specific messages</li></ul></div><div><div><div></div></div></div><div><ul><li>Slot Power Limit messages</li></ul></div><div><div><div></div></div></div><h2><div><div>Messages May Also Use Address or ID Routing</div></div></h2><div><div><div></div></div></div><div><div><div>In systems where all or some of this event traffic should target the system memory map or a logical location in the PCI bus topology, address routing and ID routing may be used in place of implicit routing. If address or ID routing is chosen for a message, then the routing mechanisms just described are applied in the same way as they would for other posted write packets.</div></div></div><div><div><div></div></div></div><h2><div><div>Routing Sub-Field in Header Indicates Routing Method</div></div></h2><div><div><div></div></div></div><div><div><div>As a message TLP moves between PCI Express devices, packet header fields indicate both that it is a message, and whether it should be routed using address, ID, or implicitly.</div></div></div><div><div><div></div></div></div><h2><div><div>Key TLP Header Fields in Implicit Routing</div></div></h2><div><div><div></div></div></div><div><div><div>If the Type field in a received message TLP indicates implicit routing is to be used, then the routing sub-field in the header is also used to determine the message destination when the routing check is performed. Figure 3-14 on page 133 illustrates a message TLP using implicit routing.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="186" id="mark-ca7bd239-9007-4e20-8afd-778357e62a4e" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 3-14: 4DW Message TLP Header Implicit Routing Fields</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_192.jpg?x=215&amp;y=404&amp;w=1013&amp;h=965"></div></div><div><div><div></div></div></div><h2><div><div>Message Type Field Summary</div></div></h2><div><div><div></div></div></div><div><div><div>Table 3-7 on page 134 summarizes the use of the TLP header Type field when a message is being sent. As shown, the upper two bits of the 5 bit Type field indicate the packet is a message, and the lower three bits are the routing sub-field which specify the routing method to apply. Note that the 4DW header is always used with message TLPs, regardless of the routing option selected.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="187" id="mark-7f20e0c0-88ca-425b-abc7-fdcf13fcbc02" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Table 3-7: Message Request Header Type Field Usage</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Type Field Bits</th><th>Description</th></tr></thead><tbody><tr><td>Bit 4:3</td><td>Defines the type of transaction: <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="237" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> = Message Transaction</td></tr><tr><td>Bit 2:0</td><td>Message Routing Subfield R[2:0], used to select message routing: - <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="238" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>000</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mo>=</mo></math></mjx-assistive-mml></mjx-container> Route to Root Complex - 001b = Use Address Routing - 010b = Use ID Routing - 011b = Route as a Broadcast Message from Root Complex - <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="239" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>100</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mo>=</mo></math></mjx-assistive-mml></mjx-container> Local message; terminate at receiver (INTx messages) - 101b = Gather &amp; route to Root Complex (PME_TO_Ack mes- sage)</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>An Endpoint Checks a TLP Routed Implicitly</div></div></h2><div><div><div></div></div></div><div><div><div>If the Type field in a received message TLP indicates implicit routing is to be used, then an endpoint device simply checks that the routing sub-field is appropriate for it. For example, an endpoint may accept a broadcast message or a message which terminates at the receiver; it won't accept messages which implicitly target the Root Complex.</div></div></div><div><div><div></div></div></div><h2><div><div>A Switch Receives a TLP Routed Implicitly</div></div></h2><div><div><div></div></div></div><div><div><div>If the Type field in a received message TLP indicates implicit routing is to be used, then a switch device simply considers the ingress port it arrived on and whether the routing sub-field code is appropriate for it. Some examples:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">The upstream link interface of a switch may legitimately receive a broadcast message routed implicitly from the Root Complex. If it does, it will forward it intact onto all downstream links. It should not see an implicitly routed broadcast message arrive on a downstream ingress port, and will handle this as a malformed TLP.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">The switch may accept messages indicating implicit routing to the root complex on secondary links; it will forward all of these upstream because it "knows" the location of the Root Complex is on its primary side. It would not accept messages routed implicitly to the Root Complex if they arrived on the primary link receive interface.</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="188" id="mark-dd4fe4da-2d35-4462-9b3b-e6eafe4b9510" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 3: Address Spaces &amp; Transaction Routing</div></div></h2><div><div><div></div></div></div><div><ol><li value="3">If the implicitly-routed message arrives on either upstream or downstream ingress ports, the switch may consume the packet if routing indicates it should terminate at receiver.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">If messages are routed using address or ID methods, a switch will simply perform normal address checks in deciding whether to accept or forward it.</li></ol></div><div><div><div></div></div></div><h2><div><div>Plug-And-Play Configuration of Routing Options</div></div></h2><div><div><div></div></div></div><div><div><div>PCI-compatible configuration space and PCI Express extended configuration space are covered in detail in the Part 6. For reference, the programming of three sets of configuration space registers related to routing is summarized here.</div></div></div><div><div><div></div></div></div><h2><div><div>Routing Configuration Is PCI-Compatible</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express supports the basic 256 byte PCI configuration space common to all compatible devices, including the Type 0 and Type 1 PCI configuration space header formats used by non-bridge and switch/bridge devices, respectively. Devices may implement basic PCI-equivalent functionality with no change to drivers or Operating System software.</div></div></div><div><div><div></div></div></div><h2><div><div>Two Configuration Space Header Formats: Type 0, Type 1</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express endpoint devices support a single PCI Express link and use the Type 0 (non-bridge) format header. Switch/bridge devices support multiple links, and implement a Type 1 format header for each link interface. Figure 3-15 on page 136 illustrates a PCI Express topology and the use of configuration space Type 0 and Type 1 header formats.</div></div></div><div><div><div></div></div></div><h2><div><div>Routing Registers Are Located in Configuration Header</div></div></h2><div><div><div></div></div></div><div><div><div>As with PCI, registers associated with transaction routing are located in the first 64 bytes (16 DW) of configuration space (referred to in PCI Express as the PCI 2.3 compatible header area). The three sets of registers of principal interest are:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">Base Address Registers (BARs) found in Type 0 and Type 1 headers.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">Three sets of Base/Limit Register pairs supported in the Type 1 header of switch/bridge devices.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">Three Bus Number Registers, also found in Type 1 headers of bridge/devices.</li></ol></div><div><div><div></div></div></div><div><div><div>Figure 3-16 on page 137 illustrates the Type 0 and Type 1 PCI Express Configuration Space header formats. Key routing registers are indicated.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="189" id="mark-9fa6e577-d929-4cbe-a7fa-a30c5a072637" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 3-15: PCI Express Devices And Type 0 And Type 1 Header Use Base Address Registers (BARs): Type 0, 1 Headers</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_195.jpg?x=350&amp;y=401&amp;w=745&amp;h=526"></div></div><div><div><div></div></div></div><h2><div><div>General</div></div></h2><div><div><div></div></div></div><div><div><div>The first of the configuration space registers related to routing are the Base Address Registers (BARs) These are marked "&lt;1" in Figure 3-16 on page 137, and are implemented by all devices which require system memory, IO, or memory mapped IO (MMIO) addresses allocated to them as targets. The location and use of BARs is compatible with PCI and PCI-X. As shown in Figure 3-16 on page 137, a Type 0 configuration space header has 6 BARs available for the device designer (at DW 4-9), while a Type 1 header has only two BARs (at DW 4-5).</div></div></div><div><div><div></div></div></div><div><div><div>After discovering device resource requirements, system software programs each BAR with start address for a range of addresses the device may respond to as a completer (target). Set up of BARs involves several things:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">The device designer uses a BAR to hard-code a request for an allocation of one block of prefetchable or non-prefetchable memory, or of IO addresses in the system memory or IO map. A pair of adjacent BARs are concatenated if a 64-bit memory request is being made.</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="190" id="mark-b1a33fbd-bc5f-4ed1-996c-4f3415d7d3de" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 3: Address Spaces &amp; Transaction Routing</div></div></h2><div><div><div></div></div></div><div><ol><li value="2">Hard-coded bits in the BAR include an indication of the request type, the size of the request, and whether the target device may be considered prefetchable (memory requests only).</li></ol></div><div><div><div></div></div></div><div><div><div>Figure 3-16: PCI Express Configuration Space Type 0 and Type 1 Headers PCI Express System Architecture</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_196.jpg?x=218&amp;y=515&amp;w=1006&amp;h=1130"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="191" id="mark-3dab3e0f-c0ca-41bd-b802-28d99e245db1" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>During enumeration, all PCI-compatible devices are discovered and the BARs are examined by system software to decode the request. Once the system memory and IO maps are established, software programs upper bits in implemented BARs with the start address for the block allocated to the target.</div></div></div><div><div><div></div></div></div><h2><div><div>BAR Setup Example One: 1MB, Prefetchable Memory Request</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 3-17 depicts the basic steps in setting up a BAR which is being used to track a <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="240" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MB</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> block of prefetchable addresses for a device residing in the system memory map. In the diagram, the BAR is shown at three points in the configuration process:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">The uninitialized BAR in Figure 3-17 is as it looks after power-up or a reset. While the designer has tied lower bits to indicate the request type and size, there is no requirement about how the upper bits (which are read-write) must come up in a BAR, so these bits are indicated with XXXXX. System software will first write all 1 's to the BAR to set all read-write bits <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="241" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> . Of course, the hard-coded lower bits are not affected by the configuration write.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">The second view of the BAR shown in Figure 3-17 is as it looks after configuration software has performed the write of all 1 's to it. The next step in configuration is a read of the BAR to check the request. Table 3-8 on page 140 summarizes the results of this configuration read.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">The third view of the BAR shown in Figure 3-17 on page 139 is as it looks after configuration software has performed another configuration write (Type 0) to program the start address for the block. In this example, the device start address is <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="242" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c47"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">GB</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> ,so bit 31 is written <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="243" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mrow space="2"><mjx-mo class="mjx-sop"><mjx-c class="mjx-c28 TEX-S1"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-msup><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c47"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom><mjx-mo class="mjx-sop"><mjx-c class="mjx-c29 TEX-S1"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><msup><mrow data-mjx-texclass="ORD"><mn>2</mn></mrow><mrow data-mjx-texclass="ORD"><mn>31</mn></mrow></msup><mo>=</mo><mn>2</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">GB</mi></mrow></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> and all other upper bits are written <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="244" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-msup space="4"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-var"><mjx-c class="mjx-c2032"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msup><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><msup><mrow data-mjx-texclass="ORD"><mn>0</mn></mrow><mrow data-mjx-texclass="ORD"><mi data-mjx-alternate="1">′</mi></mrow></msup><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> .</li></ol></div><div><div><div></div></div></div><div><div><div>At this point the configuration of the BAR is complete. Once software enables memory address decoding in the PCI command register, the device will claim memory transactions in the range <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="245" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c47"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">GB</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> to <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="246" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c47"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">GB</mi></mrow></mrow><mo>+</mo><mn>1</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MB</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> .</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="192" id="mark-1db2e7ba-5d61-471e-bc4d-7e3888020307" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 3: Address Spaces &amp; Transaction Routing</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 3-17: 32-Bit Prefetchable Memory BAR Set Up</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_198.jpg?x=227&amp;y=378&amp;w=991&amp;h=965"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="193" id="mark-77e41414-62b7-4a76-b2c5-e6328667fdfe" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Table 3-8: Results Of Reading The BAR after Writing All "1s" To It</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>BAR Bits</th><th>Meaning</th></tr></thead><tbody><tr><td>0</td><td>Read back as a " 0 ", indicating a memory request</td></tr><tr><td>2:1</td><td>Read back as 00b indicating the target only supports a 32 bit address decoder</td></tr><tr><td>3</td><td>Read back as a " 1 ", indicating request is for prefetchable memor)</td></tr><tr><td>19:4</td><td>All read back as " 0 ", used to help indicate the size of the request (also see bit 20)</td></tr><tr><td>31:20</td><td>All read back as " 1 " because software has not yet programmed the upper bits with a start address for the block. Note that because bit 20 was the first bit (above bit 3) to read back as written <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="247" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mo>=</mo><mn>1</mn></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> ; this indicates the memory request size is <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="248" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mrow space="2"><mjx-mo class="mjx-sop"><mjx-c class="mjx-c28 TEX-S1"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-msup><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom><mjx-mo class="mjx-sop"><mjx-c class="mjx-c29 TEX-S1"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MB</mi></mrow></mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><msup><mrow data-mjx-texclass="ORD"><mn>2</mn></mrow><mrow data-mjx-texclass="ORD"><mn>20</mn></mrow></msup><mo>=</mo><mn>1</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MB</mi></mrow></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> .</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>BAR Setup Example Two: 64-Bit, 64MB Memory Request</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 3-18 on page 141 depicts the basic steps in setting up a pair of BARs being used to track a <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="249" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>64</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MB</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> block of prefetchable addresses for a device residing in the system memory map. In the diagram, the BARs are shown at three points in the configuration process:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">The uninitialized BARs are as they look after power-up or a reset. The designer has hard-coded lower bits of the lower BAR to indicate the request type and size; the upper BAR bits are all read-write. System software will first write all 1 's to both BARs to set all read-write bits <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="250" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> . Of course,the hard-coded bits in the lower BAR are unaffected by the configuration write.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">The second view of the BARs in Figure 3-18 on page 141 shows them as they look after configuration software has performed the write of all 1 's to both. The next step in configuration is a read of the BARs to check the request. Table 3-9 on page 142 summarizes the results of this configuration read.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">The third view of the BAR pair Figure 3-18 on page 141 indicates conditions after configuration software has performed two configuration writes (Type <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="251" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn><mo stretchy="false">)</mo></math></mjx-assistive-mml></mjx-container> to program the two halves of the 64 bit start address for the block. In this example, the device start address is 16GB, so bit 1 of the Upper BAR (address bit 33 in the BAR pair) is written <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="252" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mrow space="2"><mjx-mo class="mjx-sop"><mjx-c class="mjx-c28 TEX-S1"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-msup><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c47"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom><mjx-mo class="mjx-sop"><mjx-c class="mjx-c29 TEX-S1"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><msup><mrow data-mjx-texclass="ORD"><mn>2</mn></mrow><mrow data-mjx-texclass="ORD"><mn>33</mn></mrow></msup><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>16</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">GB</mi></mrow></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> ; all other read-write bits in both BARs are written <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="253" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-msup space="4"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-var"><mjx-c class="mjx-c2032"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msup><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><msup><mrow data-mjx-texclass="ORD"><mn>0</mn></mrow><mrow data-mjx-texclass="ORD"><mi data-mjx-alternate="1">′</mi></mrow></msup><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> .</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="194" id="mark-8a30e6f5-e68a-4264-83d1-8ee2df36577b" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 3: Address Spaces &amp; Transaction Routing</div></div></h2><div><div><div></div></div></div><div><div><div>At this point the configuration of the BAR pair is complete. Once software enables memory address decoding in the PCI command register, the device will claim memory transactions in the range <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="254" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c47"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>16</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">GB</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> to <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="255" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c47"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>16</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">GB</mi></mrow></mrow><mo>+</mo><mrow data-mjx-texclass="ORD"><mn>64</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MB</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> .</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_200.jpg?x=220&amp;y=528&amp;w=1002&amp;h=1095"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="195" id="mark-c0c8fa2a-d5ac-42c7-a792-ac31efcab779" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Table 3-9: Results Of Reading The BAR Pair after Writing All "1s" To Both</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>BAR</th><th>BAR Bits</th><th>Meaning</th></tr></thead><tbody><tr><td>Lower</td><td>0</td><td>Read back as a " 0 ", indicating a memory request</td></tr><tr><td>Lower</td><td>2:1</td><td>Read back as 10 b indicating the target supports a 64 bit address decoder, and that the first BAR is concatenated with the next</td></tr><tr><td>Lower</td><td>3</td><td>Read back as a " 1 ", indicating request is for prefetchable mem- ory</td></tr><tr><td>Lower</td><td>25:4</td><td>All read back as " 0 ", used to help indicate the size of the request (also see bit 26)</td></tr><tr><td>Lower</td><td>31:26</td><td>All read back as "1" because software has not yet programmed the upper bits with a start address for the block. Note that because bit 26 was the first bit (above bit 3) to read back as writ ten <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="256" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mo>=</mo><mn>1</mn></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> ; this indicates the memory request size is <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="257" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mrow space="2"><mjx-mo class="mjx-sop"><mjx-c class="mjx-c28 TEX-S1"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-msup><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-texatom><mjx-mo class="mjx-n" style="vertical-align: 0.25em;"></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>64</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MB</mi></mrow></mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><msup><mrow data-mjx-texclass="ORD"><mn>2</mn></mrow><mrow data-mjx-texclass="ORD"><mn>26</mn></mrow></msup><mo>=</mo></mrow><mo data-mjx-texclass="CLOSE" fence="true" stretchy="true" symmetric="true"></mo></mrow></math></mjx-assistive-mml></mjx-container> 64MB).</td></tr><tr><td>Upper</td><td>31:0</td><td>All read back as "1". These bits will be used as the upper 32 bits of the 64-bit start address programmed by system software.</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>BAR Setup Example Three: 256-Byte IO Request</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 3-19 on page 143 depicts the basic steps in setting up a BAR which is being used to track a 256 byte block of IO addresses for a legacy PCI Express device residing in the system IO map. In the diagram, the BAR is shown at three points in the configuration process:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">The uninitialized BAR in Figure 3-19 is as it looks after power-up or a reset. System software first writes all 1 ’s to the BAR to set all read-write bits <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="258" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> . Of course, the hard-coded bits are unaffected by the configuration write.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">The second view of the BAR shown in Figure 3-19 on page 143 is as it looks after configuration software has performed the write of all 1 's to it. The next step in configuration is a read of the BAR to check the request. Table 3-10 on page 144 summarizes the results of this configuration read.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">The third view of the BAR shown Figure 3-19 on page 143 is as it looks after configuration software has performed another configuration write (Type 0) to program the start address for the IO block. In this example, the device start address is <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="259" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>16</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">KB</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> ,so bit 14 is written <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="260" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mrow space="2"><mjx-mo class="mjx-sop"><mjx-c class="mjx-c28 TEX-S1"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-msup><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom><mjx-mo class="mjx-sop"><mjx-c class="mjx-c29 TEX-S1"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><msup><mrow data-mjx-texclass="ORD"><mn>2</mn></mrow><mrow data-mjx-texclass="ORD"><mn>14</mn></mrow></msup><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>16</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">KB</mi></mrow></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> ; all other upper bits are written <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="261" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-msup space="4"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-var"><mjx-c class="mjx-c2032"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msup><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><msup><mrow data-mjx-texclass="ORD"><mn>0</mn></mrow><mrow data-mjx-texclass="ORD"><mi data-mjx-alternate="1">′</mi></mrow></msup><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> .</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="196" id="mark-ef083b1c-59c7-4b83-8435-36f7e61ec851" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 3: Address Spaces &amp; Transaction Routing</div></div></h2><div><div><div></div></div></div><div><div><div>At this point the configuration of the IO BAR is complete. Once software enables IO address decoding in the PCI command register, the device will claim IO transactions in the range <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="262" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>16</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">KB</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> to <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="263" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>16</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">KB</mi></mrow></mrow><mo>+</mo><mrow data-mjx-texclass="ORD"><mn>256</mn></mrow></math></mjx-assistive-mml></mjx-container> .</div></div></div><div><div><div></div></div></div><div><div><div>Figure 3-19: IO BAR Set Up</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_202.jpg?x=224&amp;y=575&amp;w=988&amp;h=822"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="197" id="mark-ec5d2005-adab-4abf-9701-6cdefd611b8e" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Table 3-10: Results Of Reading The IO BAR after Writing All "1s" To It</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>BAR Bits</th><th>Meaning</th></tr></thead><tbody><tr><td>0</td><td>Read back as a "1", indicating an IO request</td></tr><tr><td>1</td><td>Reserved. Tied low and read back as "0".</td></tr><tr><td>7:2</td><td>All read back as " 0 ", used to help indicate the size of the request (also see bit 8)</td></tr><tr><td>31:8</td><td>All read back as " 1 " because software has not yet programmed the upper bits with a start address for the block. Note that because bit 8 wa the first bit (above bit 1) to read back as written <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="264" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mo>=</mo><mn>1</mn></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> ; this indicates the IO request size is 256 bytes <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="265" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mrow><mjx-mo class="mjx-sop"><mjx-c class="mjx-c28 TEX-S1"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-msup><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom></mjx-texatom><mjx-mo class="mjx-sop"><mjx-c class="mjx-c29 TEX-S1"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><msup><mrow data-mjx-texclass="ORD"><mn>2</mn></mrow><mrow data-mjx-texclass="ORD"><mn>8</mn></mrow></msup><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>256</mn></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> .</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>Base/Limit Registers, Type 1 Header Only</div></div></h2><div><div><div></div></div></div><h2><div><div>General</div></div></h2><div><div><div></div></div></div><div><div><div>The second set of configuration registers related to routing are also found in Type 1 configuration headers and used when forwarding address-routed TLPs. Marked "&lt;2" in Figure 3-16 on page 137, these are the three sets of Base/Limit registers programmed in each bridge interface to enable a switch/bridge to claim and forward address-routed TLPs to a secondary bus. Three sets of Base/ Limit Registers are needed because transactions are handled differently (e.g. prefetching, write-posting, etc.) in the prefetchable memory, non-prefetchable memory (MMIO), and IO address domains. The Base Register in each pair establishes the start address for the community of downstream devices and the Limit Register defines the upper address for that group of devices. The three sets of Base/Limit Registers include:</div></div></div><div><div><div></div></div></div><div><ul><li>Prefetchable Memory Base and Limit Registers</li></ul></div><div><div><div></div></div></div><div><ul><li>Non-Prefetchable Memory Base and Limit Register</li></ul></div><div><div><div></div></div></div><div><ul><li>I/O Base and Limit Registers</li></ul></div><div><div><div></div></div></div><h2><div><div>Prefetchable Memory Base/Limit Registers</div></div></h2><div><div><div></div></div></div><div><div><div>The Prefetchable Memory Base/Limit registers are located at DW 9 and Prefetchable Memory Base/Limit Upper registers at DW 10-11 within the header 1. These registers track all downstream prefetchable memory devices. Either 32 bit or 64 bit addressing can be supported by these registers. If the</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="198" id="mark-21be8c56-de3d-4274-98f7-3cac52a68f71" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 3: Address Spaces &amp; Transaction Routing</div></div></h2><div><div><div></div></div></div><div><div><div>Upper Registers are not implemented, only 32 bits of memory addressing is available, and the TLP headers mapping to this space will be the 3DW format. If the Upper registers and system software maps the device above the <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="266" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c47"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>4</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">GB</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> boundary, TLPs accessing the device will carry the 4DW header format. In the example shown in Figure 3-20 on page 145, a 6GB prefetchable address range is being set up for the secondary link of a switch.</div></div></div><div><div><div></div></div></div><div><div><div>Register programming in the example shown in Figure 3-20 on page 145 is summarized in Table 3-11.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 3-20: 6GB, 64-Bit Prefetchable Memory Base/Limit Register Set Up</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_204.jpg?x=232&amp;y=759&amp;w=983&amp;h=755"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="199" id="mark-10b7b3d4-f455-4116-8c4b-9155abf42b34" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 3-11: 6 GB, 64-Bit Prefetchable Base/Limit Register Setup</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Register</th><th>Value</th><th>Use</th></tr></thead><tbody><tr><td>Prefetchable Memory Base</td><td>8001h</td><td>Upper 3 nibbles (800h) are used to pro- vide most significant 3 digits of the 32- bit Base Address for Prefetchable Mem- ory behind this switch. The lower 5 dig- its of the address are assumed to be 00000h. The least significant nibble of this register value (1h) indicates that a 64 bit address decoder is supported and that the Upper Base/Limit Registers are also used.</td></tr><tr><td>Prefetchable Memory Limit</td><td>FFF1h</td><td>Upper 3 nibbles (FFFh) are used to pro- vide most significant 3 digits of the 32- bit Limit Address for Prefetchable Mem- ory behind this switch. The lower 5 dig- its of the address are assumed to be FFFFFh. The least significant nibble of this register value (1h) indicates that a 64 bit address decoder is supported and that the Upper Base/Limit Registers are also used.</td></tr><tr><td>Prefetchable Memory Base Upper 32 Bits</td><td>00000001h</td><td>Upper 32 bits of the 64-bit Base address for Prefetchable Memory behind this switch.</td></tr><tr><td>Prefetchable Memory Limit Upper 32 Bits</td><td>00000002h</td><td>Upper 32 bits of the 64-bit Limit address for Prefetchable Memory behind this switch.</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>Non-Prefetchable Memory Base/Limit Registers</div></div></h2><div><div><div></div></div></div><div><div><div>Non-Prefetchable Memory Base/Limit (at DW 8). These registers are used to track all downstream non-prefetchable memory (memory mapped IO) devices. Non-prefetchable memory devices are limited to 32 bit addressing; TLPs targeting them always use the 3DW header format.</div></div></div><div><div><div></div></div></div><div><div><div>Register programming in the example shown in Figure 3-21 on page 147 is summarized in Table 3-12.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="200" id="mark-f3c273ba-be58-486c-940d-1135c098e162" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 3: Address Spaces &amp; Transaction Routing</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 3-21: 2MB, 32-Bit Non-Prefetchable Base/Limit Register Set Up</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_206.jpg?x=242&amp;y=405&amp;w=971&amp;h=878"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="201" id="mark-e59b3bf1-d53f-45e0-8ec9-0709bde09604" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 3-12: 2MB, 32-Bit Non-Prefetchable Base/Limit Register Setup</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Register</th><th>Value</th><th>Use</th></tr></thead><tbody><tr><td>Memory Base (Non-Prefetchable)</td><td>1210h</td><td>Upper 3 nibbles (121h) are used to pro- vide most significant 3 digits of the 32- bit Base Address for Non-Prefetchable Memory behind this switch. The lower 5 digits of the address are assumed to be <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="267" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>00000</mn></mrow></math></mjx-assistive-mml></mjx-container> h. The least significant nibble of this regis- ter value (0h) is reserved and should be set <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="268" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>0</mn></math></mjx-assistive-mml></mjx-container> .</td></tr><tr><td>Memory Limit (Non-Prefetchable)</td><td>1220h</td><td>Upper 3 nibbles (122h) are used to pro- vide most significant 3 digits of the 32- bit Limit Address for Prefetchable Mem- ory behind this switch. The lower 5 dig- its of the address are assumed to be FFFFFh. The least significant nibble of this register value (0h) is reserved and should be set = 0.</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>IO Base/Limit Registers</div></div></h2><div><div><div></div></div></div><div><div><div>IO Base/Limit (at DW 7) and IO Base/Limit Upper registers (at DW 12). These registers are used to track all downstream IO target devices. If the Upper Registers are used, then IO address space may be extended to a full 32 bits (4GB). If they are not implemented,then IO address space is limited to <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="269" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>16</mn></mrow></math></mjx-assistive-mml></mjx-container> bits <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="270" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mn>64</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">KB</mi></mrow></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> . In either case, TLPs targeting these IO devices always carry the 3DW header format.</div></div></div><div><div><div></div></div></div><div><div><div>Register programming in the example shown in Figure 3-22 on page 149 is summarized in Table 3-13 on page 150.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="202" id="mark-c4d8be41-b587-4623-949d-5d2bc35dfb48" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 3-22: IO Base/Limit Register Set Up</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_208.jpg?x=225&amp;y=392&amp;w=996&amp;h=955"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="203" id="mark-475cb042-2cbc-41da-b000-556dcdef75c4" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 3-13: 256 Byte IO Base/Limit Register Setup</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Register</th><th>Value</th><th>Use</th></tr></thead><tbody><tr><td>IO Base</td><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="271" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>21</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">h</mi></mrow></math></mjx-assistive-mml></mjx-container></td><td>Upper nibble (2h) specifies the most sig- nificant hex digit of the 32 bit IO Base address (the lower digits are 000h) The lower nibble (1h) indicates that the device supports 32 bit IO behind the bridge interface. This also means the device implements the Upper IO Base/ Limit register set, and those registers will be concatenated with Base/Limit.</td></tr><tr><td>IO Limit</td><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="272" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>41</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">h</mi></mrow></math></mjx-assistive-mml></mjx-container></td><td>Upper nibble (4h) specifies the most sig- nificant hex digit of the 32 bit IO Limit address (the lower digits are FFFh). The lower nibble (1h) indicates that the device supports 32 bit IO behind the bridge interface. This also means the device implements the Upper IO Base/ Limit register set, and those registers will be concatenated with Base/Limit.</td></tr><tr><td>IO Base Upper 16 Bits</td><td>0000h</td><td>Upper 16 bits of the 32-bit Base address for IO behind this switch.</td></tr><tr><td>IO Limit Upper 16 Bits</td><td>0000h</td><td>Upper 16 bits of the 32-bit Limit address for IO behind this switch.</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>Bus Number Registers, Type 1 Header Only</div></div></h2><div><div><div></div></div></div><div><div><div>The third set of configuration registers related to routing are used when forwarding ID-routed TLPs, including configuration cycles and completions and optionally messages. These are marked "&lt;3" in Figure 3-16 on page 137. As in PCI, a switch/bridge interface requires three registers: Primary Bus Number, Secondary Bus Number, and Subordinate bus number. The function of these registers is summarized here.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="204" id="mark-641b11ba-39cb-4099-8f27-e5fe9a39042f" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 3: Address Spaces &amp; Transaction Routing</div></div></h2><div><div><div></div></div></div><h2><div><div>Primary Bus Number</div></div></h2><div><div><div></div></div></div><div><div><div>The Primary Bus Number register contains the bus (link) number to which the upstream side of a bridge (switch) is connected. In PCI Express, the primary bus is the one in the direction of the Root Complex and host processor.</div></div></div><div><div><div></div></div></div><h2><div><div>Secondary Bus Number</div></div></h2><div><div><div></div></div></div><div><div><div>The Secondary Bus Number register contains the bus (link) number to which the downstream side of a bridge (switch) is connected.</div></div></div><div><div><div></div></div></div><h2><div><div>Subordinate Bus Number</div></div></h2><div><div><div></div></div></div><div><div><div>The Subordinate Bus Number register contains the highest bus (link) number on the downstream side of a bridge (switch). The Subordinate and Secondary Bus Number registers will contain the same value unless there is another bridge (switch) on the secondary side.</div></div></div><div><div><div></div></div></div><h2><div><div>A Switch Is a Two-Level Bridge Structure</div></div></h2><div><div><div></div></div></div><div><div><div>Because PCI does not natively support bridges with multiple downstream ports, PCI Express switch devices appear logically as two-level PCI bridge structures, consisting of a single bridge to the primary link and an internal PCI bus which hosts one or more virtual bridges to secondary interfaces. Each bridge interface has an independent Type 1 format configuration header with its own sets of Base/Limit Registers and Bus Number Registers. Figure 3-23 on page 152 illustrates the bus numbering associated with the external links and internal bus of a switch. Note that the secondary bus on the primary link interface is the internal virtual bus, and that the primary interface of all downstream link interfaces connect to the internal bus logically.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="205" id="mark-68c13c05-c90c-477d-8b4c-0d5c0e158fa6" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 3-23: Bus Number Registers In A Switch</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_211.jpg?x=215&amp;y=404&amp;w=1007&amp;h=752"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="206" id="mark-ba418f9f-1b40-4100-b5db-9fb3c2b4a9c9" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h1><div><div>4 Packet-Based  Transactions</div></div></h1><div><div><div></div></div></div><h2><div><div>The Previous Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>The previous chapter described the general concepts of PCI Express transaction routing and the mechanisms used by a device in deciding whether to accept, forward, or reject a packet arriving at an ingress port. Because Data Link Layer Packets (DLLPs) and Physical Layer ordered set link traffic are never forwarded, the emphasis here is on Transaction Layer Packet (TLP) types and the three routing methods associated with them: address routing, ID routing, and implicit routing. Included is a summary of configuration methods used in PCI Express to set up PCI-compatible plug-and-play addressing within system IO and memory maps, as well as key elements in the PCI Express packet protocol used in making routing decisions.</div></div></div><div><div><div></div></div></div><h2><div><div>This Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>Information moves between PCI Express devices in packets, and the two major classes of packets are Transaction Layer Packets (TLPs), and Data Link Layer Packets (DLLPs). The use, format, and definition of all TLP and DLLP packet types and their related fields are detailed in this chapter.</div></div></div><div><div><div></div></div></div><h2><div><div>The Next Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>The next chapter discusses the Ack/Nak Protocol that verifies the delivery of TLPs between each port as they travel between the requester and completer devices. This chapter details the hardware retry mechanism that is automatically triggered when a TLP transmission error is detected on a given link.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="207" id="mark-f675660a-ec7e-4760-9925-3f9c90bbe501" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Introduction to the Packet-Based Protocol</div></div></h2><div><div><div></div></div></div><div><div><div>The PCI Express protocol improves upon methods used by earlier busses (e.g. PCI) to exchange data and to signal system events. In addition to supporting basic memory, IO, and configuration read/write transactions, the links eliminate many sideband signals and replaces them with in-band messages.</div></div></div><div><div><div></div></div></div><div><div><div>With the exception of the logical idle indication and physical layer Ordered Sets, all information moves across an active PCI Express link in fundamental chunks called packets which are comprised of 10 bit control (K) and data (D) symbols. The two major classes of packets exchanged between two PCJ Express devices are high level Transaction Layer Packets (TLPs), and low-level link maintenance packets called Data Link Layer Packets (DLLPs). Collectively, the various TLPs and DLLPs allow two devices to perform memory, IO, and Configuration Space transactions reliably and use messages to initiate power management events, generate interrupts, report errors, etc. Figure 4-1 on page 155 depicts TLPs and DLLPs on a PCI Express link.</div></div></div><div><div><div></div></div></div><h2><div><div>Why Use A Packet-Based Transaction Protocol</div></div></h2><div><div><div></div></div></div><div><div><div>There are some distinct advantages in using a packet-based protocol, especially when it comes to data integrity. Three important aspects of PCI Express packet protocol help promote data integrity during link transmission:</div></div></div><div><div><div></div></div></div><h2><div><div>Packet Formats Are Weil Defined</div></div></h2><div><div><div></div></div></div><div><div><div>Some early bus protocols (e.g. PCI) allow transfers of indeterminate (and unlimited) size, making identification of payload boundaries impossible until the end of the transfer. In addition, an early transaction end might be signaled by either agent (e.g. target disconnect on a write or pre-emption of the initiator during a read), resulting in a partial transfer. In these cases, it is difficult for the sender of data to calculate and send a checksum or CRC covering an entire payload, when it may terminate unexpectedly. Instead, PCI uses a simple parity scheme which is applied and checked for each bus phase completed.</div></div></div><div><div><div></div></div></div><div><div><div>In contrast, each PCI Express packet has a known size and format, and the packet header-positioned at the beginning of each DLLP and TLP packet- indicates the packet type and presence of any optional fields. The size of each packet field is either fixed or defined by the packet type. The size of any data payload is conveyed in the TLP header Length field. Once a transfer commences, there are no early transaction terminations by the recipient. This structured</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="208" id="mark-8e1bc79f-d728-4818-8343-2a19f09f8e12" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>packet format makes it possible to insert additional information into the packet into prescribed locations, including framing symbols, CRC, and a packet sequence number (TLPs only).</div></div></div><div><div><div></div></div></div><div><div><div>Figure 4-1: TLP And DLLP Packets</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_214.jpg?x=228&amp;y=590&amp;w=988&amp;h=874"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="209" id="mark-70ff558a-a2c3-489a-be68-314f62b8ef7a" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Framing Symbols Indicate Packet Boundaries</div></div></h2><div><div><div></div></div></div><div><div><div>Each TLP and DLLP packet sent is framed with a Start and End control symbol, clearly defining the packet boundaries to the receiver. Note that the Start and End control (K) symbols appended to packets by the transmitting device are 10 bits each. This is a big improvement over PCI and PCI-X which use the assertion and de-assertion of a single FRAME# signal to indicate the beginning and end of a transaction. A glitch on the FRAME# signal (or any of the other PCI/PCIX control signals) could cause a target to misconstrue bus events. In contrast, a PCI Express receiver must properly decode a complete 10 bit symbol before concluding link activity is beginning or ending. Unexpected or unrecognized control symbols are handled as errors.</div></div></div><div><div><div></div></div></div><h2><div><div>CRC Protects Entire Packet</div></div></h2><div><div><div></div></div></div><div><div><div>Unlike the side-band parity signals used by PCI devices during the address and each data phase of a transaction, the in-band 16-bit or 32-bit PCI Express CRC value "protects" the entire packet (other than framing symbols). In addition to CRC, TLP packets also have a packet sequence number appended to them by the transmitter so that if an error is detected at the receiver, the specific packet(s) which were received in error may be resent. The transmitter maintains a copy of each TLP sent in a Retry Buffer until it is checked and acknowledged by the receiver. This TLP acknowledgement mechanism (sometimes referred to as the Ack/Nak protocol) forms the basis of link-level TLP error correction and is very important in deep topologies where devices may be many links away from the host in the event an error occurs and CPU intervention would otherwise be needed.</div></div></div><div><div><div></div></div></div><h2><div><div>Transaction Layer Packets</div></div></h2><div><div><div></div></div></div><div><div><div>In PCI Express terminology, high-level transactions originate at the device core of the transmitting device and terminate at the core of the receiving device. The Transaction Layer is the starting point in the assembly of outbound Transaction Layer Packets (TLPs), and the end point for disassembly of inbound TLPs at the receiver. Along the way, the Data Link Layer and Physical Layer of each device contribute to the packet assembly and disassembly as described below.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="210" id="mark-7280703f-0bb5-4260-9962-1281067c87c6" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>TLPs Are Assembled And Disassembled</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 4-2 on page 158 depicts the general flow of TLP assembly at the transmit side of a link and disassembly at the receiver. The key stages in Transaction Layer Packet protocol are listed below. The numbers correspond to those in Figure 4-2.</div></div></div><div><div><div></div></div></div><div><ol><li value="1">Device B's core passes a request for service to the PCI Express hardware interface. How this done is not covered by the PCI Express Specification, and is device-specific. General information contained in the request would include:</li></ol></div><div><div><div></div></div></div><div><ul><li>The PCI Express command to be performed</li></ul></div><div><div><div></div></div></div><div><ul><li>Start address or ID of target (if address routing or ID routing are used)</li></ul></div><div><div><div></div></div></div><div><ul><li>Transaction type (memory read or write, configuration cycle, etc.)</li></ul></div><div><div><div></div></div></div><div><ul><li>Data payload size (and the data to send, if any)</li></ul></div><div><div><div></div></div></div><div><ul><li>Virtual Channel/Traffic class information</li></ul></div><div><div><div></div></div></div><div><ul><li>Attributes of the transfer: No Snoop bit set?, Relaxed Ordering set?, etc.</li></ul></div><div><div><div></div></div></div><div><ol><li value="2">The Transaction Layer builds the TLP header, data payload, and digest based on the request from the core. Before sending a TLP to the Data Link Layer, flow control credits and ordering rules must be applied.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">When the TLP is received at the Data Link Layer, a Sequence Number is assigned and a Link CRC is calculated for the TLP (includes Sequence Number). The TLP is then passed on to the Physical Layer.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">At the Physical Layer, byte striping, scrambling, encoding, and serialization are performed. STP and END control (K) characters are appended to the packet. The packet is sent out on the transmit side of the link.</li></ol></div><div><div><div></div></div></div><div><ol><li value="5">At the Physical Layer receiver of Device A, de-serialization, framing symbol check, decoding, and byte un-striping are performed. Note that at the Physical Layer, the first level or error checking is performed (on the control codes).</li></ol></div><div><div><div></div></div></div><div><ol><li value="6">The Data Link Layer of the receiver calculates CRC and checks it against the received value. It also checks the Sequence Number of the TLP for violations. If there are no errors, it passes the TLP up to the Transaction Layer of the receiver. The information is decoded and passed to the core of Device A. The Data Link Layer of the receiver will also notify the transmitter of the success or failure in processing the TLP by sending an Ack or Nak DLLP to the transmitter. In the event of a Nak (No Acknowledge), the transmitter will re-send all TLPs in its Retry Buffer.</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="211" id="mark-04a3f8c1-f285-42c2-9033-dca48cd7d619" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_217.jpg?x=222&amp;y=386&amp;w=1003&amp;h=713"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="212" id="mark-07ea2825-1796-4674-b165-34f65d73637f" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Device Core Requests Access to Four Spaces</div></div></h2><div><div><div></div></div></div><div><div><div>Transactions are carried out between PCI Express requesters and completers, using four separate address spaces: Memory, IO, Configuration, and Message. (See Table 4-1.)</div></div></div><div><div><div></div></div></div><div><div><div>Table 4-1: PCI Express Address Space And Transaction Types</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Address Space</th><th>Transaction Types</th><th>Purpose</th></tr></thead><tbody><tr><td>Memory</td><td>Read, Write</td><td>Transfer data to or from a location in the system memory map. The proto- col also supports a locked memory read transaction</td></tr><tr><td>IO</td><td>Read, Write</td><td>Transfer data to or from a location in the system IO map. PCI Express IO address assignment to legacy devices. IO addressing is not permitted for Native PCI Express devices.</td></tr><tr><td>Configuration</td><td>Read, Write</td><td>Transfer data to or from a location in the configuration space of a PCI Express device. As in PCI, configura tion is used to discover device capa- bilities, program plug-and-play features, and check status using the 4KB PCI Express configuration space.</td></tr><tr><td>Message</td><td>Baseline, Vendor-specific</td><td>Provides in-band messaging and event reporting (without consuming memory or IO address resources). These are handled the same as posted write transactions.</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="213" id="mark-ea75bb08-87d2-4207-80c8-71f108cfc8a0" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>TLP Transaction Variants Defined</div></div></h2><div><div><div></div></div></div><div><div><div>In accessing the four address spaces, PCI Express Transaction Layer Packets (TLPs) carry a header field, called the Type field, which encodes the specific command variant to be used. Table 4-2 on page 160 summarizes the allowed transactions:</div></div></div><div><div><div></div></div></div><div><div><div>Table 4-2: TLP Header Type Field Defines Transaction Variant</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>TLP Type</th><th>Acronym</th></tr></thead><tbody><tr><td>Memory Read Request</td><td>(MRd)</td></tr><tr><td>Memory Read Lock Request</td><td>(MRdLk)</td></tr><tr><td>Memory Write Request</td><td>(MWr)</td></tr><tr><td>IO Read Request</td><td>(IORd)</td></tr><tr><td>IO Write Request</td><td>(IOWr)</td></tr><tr><td>Config Type 0 Read Request</td><td>(CfgRd0)</td></tr><tr><td>Config Type 0 Write Request</td><td>(CfgWr0)</td></tr><tr><td>Config Type 1 Read Request</td><td>(CfgRd1)</td></tr><tr><td>Config Type 1 Write Request</td><td>(CfgWr1)</td></tr><tr><td>Message Request</td><td>(Msg)</td></tr><tr><td>Message Request W/Data</td><td>(MsgD)</td></tr><tr><td>Completion</td><td>(Cpl)</td></tr><tr><td>Completion W/Data</td><td>(CplD)</td></tr><tr><td>Completion-Locked</td><td>(CplLk)</td></tr><tr><td>Completion W/Data</td><td>(CplDLk)</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="214" id="mark-0cee9042-03b4-48db-bd80-478a7f84b588" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>TLP Structure</div></div></h2><div><div><div></div></div></div><div><div><div>The basic usage of each component of a Transaction Layer Packet is defined in Table 4-3 on page 161.</div></div></div><div><div><div></div></div></div><div><div><div>Table 4-3: TLP Header Type Field Defines Transaction Variant</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>TLP Component</th><th>Protocol Layer</th><th>Component Use</th></tr></thead><tbody><tr><td>Header</td><td>Transaction Layer</td><td>3DW or 4DW (12 or 16 bytes) in size. Format varies with type, but Header defines transaction parame- ters: - Transaction type - Intended recipient address, ID, etc. - Transfer size (if any), Byte Enables - Ordering attribute - Cache coherency attribute - Traffic Class</td></tr><tr><td>Data</td><td>Transaction Layer</td><td>Optional field. 0-1024 DW Payload, which may be further qualified with Byte Enables to get byte address and byte transfer size resolution.</td></tr><tr><td>Digest</td><td>Transaction Layer</td><td>Optional field. If present, always 1 DW in size. Used for end-to-end CRC (ECRC) and data poisoning.</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>Generic TLP Header Format</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 4-3 on page 162 illustrates the format and contents of a generic TLP 3DW header. In this section, fields common to nearly all transactions are summarized. In later sections, header format differences associated with the specific transaction types are covered.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="215" id="mark-7a124507-31e5-4918-bae4-8ab38f018401" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_221.jpg?x=225&amp;y=388&amp;w=991&amp;h=658"></div></div><div><div><div></div></div></div><h2><div><div>Generic Header Field Summary</div></div></h2><div><div><div></div></div></div><div><div><div>Table 4-4 on page 163 summarizes the size and use of each of the generic TLP header fields. Note that fields marked " <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="273" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c52"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">R</mi></mrow></math></mjx-assistive-mml></mjx-container> " in Figure 4-3 on page 162 are reserved and should be set <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="274" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>0</mn></math></mjx-assistive-mml></mjx-container> .</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="216" id="mark-2632433d-c55e-4720-b26e-b8d6204bfbc8" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Table 4-4: Generic Header Field Summary</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Header Field</th><th>Header Location</th><th>Field Use</th></tr></thead><tbody><tr><td>Length [9:0]</td><td>Byte 3 Bit 7:0 Byte 2 Bit 1:0</td><td>TLP data payload transfer size, in DW. Maximum transfer size is 10 bits, <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="275" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c44"></mjx-c><mjx-c class="mjx-c57"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mrow space="2"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mrow data-mjx-texclass="ORD"><mn>2</mn></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow></msup><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>1024</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">DW</mi></mrow></mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mn>4</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">KB</mi></mrow></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> . Encod- ing: <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="276" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mrow><mjx-mo class="mjx-n"><mjx-stretchy-v class="mjx-c5B" style="height: 13.6em; vertical-align: -6.55em;"><mjx-beg><mjx-c></mjx-c></mjx-beg><mjx-ext><mjx-c></mjx-c></mjx-ext><mjx-end><mjx-c></mjx-c></mjx-end><mjx-mark></mjx-mark></mjx-stretchy-v></mjx-mo><mjx-mtable style="min-width: 0.5em;"><mjx-table><mjx-itable><mjx-mtr><mjx-mtd style="padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em; padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em; padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em; padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em; padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em; padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em; padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em; padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em; padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr></mjx-itable></mjx-table></mjx-mtable><mjx-mo class="mjx-n"><mjx-stretchy-v class="mjx-c5D" style="height: 13.6em; vertical-align: -6.55em;"><mjx-beg><mjx-c></mjx-c></mjx-beg><mjx-ext><mjx-c></mjx-c></mjx-ext><mjx-end><mjx-c></mjx-c></mjx-end><mjx-mark></mjx-mark></mjx-stretchy-v></mjx-mo></mjx-mrow><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D437 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44A TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">[</mo><mtable columnspacing="1em" rowspacing="4pt"><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>1</mn></mtd></mtr></mtable><mo data-mjx-texclass="CLOSE">]</mo></mrow><mi>b</mi><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>1</mn><mi>D</mi><mi>W</mi></mrow></math></mjx-assistive-mml></mjx-container> <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="277" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mrow><mjx-mo class="mjx-n"><mjx-stretchy-v class="mjx-c5B" style="height: 15em; vertical-align: -7.25em;"><mjx-beg><mjx-c></mjx-c></mjx-beg><mjx-ext><mjx-c></mjx-c></mjx-ext><mjx-end><mjx-c></mjx-c></mjx-end><mjx-mark></mjx-mark></mjx-stretchy-v></mjx-mo><mjx-mtable style="min-width: 0.5em;"><mjx-table><mjx-itable><mjx-mtr><mjx-mtd style="padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em; padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em; padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em; padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em; padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em; padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em; padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em; padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em; padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em; padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em;"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr></mjx-itable></mjx-table></mjx-mtable><mjx-mo class="mjx-n"><mjx-stretchy-v class="mjx-c5D" style="height: 15em; vertical-align: -7.25em;"><mjx-beg><mjx-c></mjx-c></mjx-beg><mjx-ext><mjx-c></mjx-c></mjx-ext><mjx-end><mjx-c></mjx-c></mjx-end><mjx-mark></mjx-mark></mjx-stretchy-v></mjx-mo></mjx-mrow><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D437 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44A TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">[</mo><mtable columnspacing="1em" rowspacing="4pt"><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>1</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mi>b</mi></mtd></mtr></mtable><mo data-mjx-texclass="CLOSE">]</mo></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>2</mn><mi>D</mi><mi>W</mi></mrow></math></mjx-assistive-mml></mjx-container> . 11 1111 1111b = 1023 DW <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="278" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c44"></mjx-c><mjx-c class="mjx-c57"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>000000000</mn><mi>b</mi></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>1024</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">DW</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container></td></tr><tr><td>Attr (Attributes)</td><td>Byte 2 Bit 5:4</td><td>Bit 5 = Relaxed ordering When set <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="279" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> ,PCI-X relaxed ordering is enabled for this TLP. If set = 0, then strict PCI ordering is used. Bit 4 = No Snoop When set <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="280" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> ,requester is indicating that no host cache coherency issues exist with respect to this TLP. System hardware is not required to cause processor cache snoop for coherency. When set <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="281" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>0</mn></math></mjx-assistive-mml></mjx-container> ,PCI -type cache snoop protection is required.</td></tr><tr><td>EP (Poisoned Data)</td><td>Byte 2 Bit 6</td><td>If set <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="282" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> ,the data accompanying this data should be considered invalid although the transaction is being allowed to complete normally.</td></tr><tr><td>TD (TLP Digest Field Present)</td><td>Byte 2 Bit 7</td><td>If set <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="283" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> ,the optional 1 DW TLP Digest field is included with this TLP that contains an ECRC value. Some rules: Presence of the Digest field must be checked by all receivers (using this bit). - A TLP with TD = 1, but no Digest field is handled as a Malformed TLP. - If a device supports checking ECRC and TD=1, it must perform the ECRC check. - If a device does not support checking ECRC (optional) at the ultimate destination, the device must ignore the digest.</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="217" id="mark-1e15d8d3-49dc-41f9-b01d-312357312162" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 4-4: Generic Header Field Summary</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Header Field</th><th>Header Location</th><th>Field Use</th></tr></thead><tbody><tr><td>TC (Traffic Class)</td><td>Byte 1 Bit 6:4</td><td>These three bits are used to encode the traffic class to be applied to this TLP and to the completion associ- ated with it (if any). 000b = Traffic Class 0 (Default) . . 111b = Traffic Class 7 TC 0 is the default class, and TC 1-7 are used in pro- viding differentiated services. See "Traffic Classes and Virtual Channels” on page 256 for additional information.</td></tr><tr><td>Type[4:0]</td><td>Byte 0 Bit 4:0</td><td>These 5 bits encode the transaction variant used with this TLP. The Type field is used with Fmt [1:0] field to specify transaction type, header size, and whether data payload is present. See below for additional information of Type/Fmt encoding for each transac- tion type.</td></tr><tr><td>Fmt[1:0] Format</td><td>Byte 0 Bit 6:5</td><td>These two bits encode information about header size and whether a data payload will be part of the TLP: 00b 3DW header, no data 01b 4DW header, no data 10b 3DW header, with data 11b 4DW header, with data See below for additional information of Type/Fmt encoding for each transaction type.</td></tr><tr><td>First DW Byte Enables</td><td>Byte 7 Bit 3:0</td><td>These four high-true bits map one-to-one to the bytes within the first double word of payload. Bit 3 = 1: Byte 3 in first DW is valid; otherwise not Bit 2 = 1: Byte 2 in first DW is valid; otherwise not Bit 1 = 1: Byte 1 in first DW is valid; otherwise not Bit <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="284" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> : Byte 0 in first DW is valid; otherwise not See below for details on Byte Enable use.</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="218" id="mark-56487108-460f-4022-9c8d-12a24e6f19f1" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 4-4: Generic Header Field Summary</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Header Field</th><th>Header Location</th><th>Field Use</th></tr></thead><tbody><tr><td>Last DW Byte Enables</td><td>Byte 7 Bit 7:4</td><td>These four high-true bits map one-to-one to the bytes within the last double word of payload. Bit <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="285" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c37"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>7</mn><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> : Byte 3 in last DW is valid; otherwise not Bit 6 = 1: Byte 2 in last DW is valid; otherwise not Bit 5 = 1: Byte 1 in last DW is valid; otherwise not Bit <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="286" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>4</mn><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> : Byte 0 in last DW is valid; otherwise not See below for details on Byte Enable use.</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>Header Type/Format Field Encodings</div></div></h2><div><div><div></div></div></div><div><div><div>Table 4-5 on page 165 summarizes the encodings used in TLP header Type and Format (Fmt) fields.</div></div></div><div><div><div></div></div></div><div><div><div>Table 4-5: TLP Header Type and Format Field Encodings</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>TLP</th><th>FMT[1:0]</th><th>TYPE [4:0]</th></tr></thead><tbody><tr><td>Memory Read Request (MRd)</td><td>00 = 3DW, no data 01 = 4DW, no data</td><td>0 0000</td></tr><tr><td>Memory Read Lock Request (MRdLk)</td><td>00 = 3DW, no data 01 = 4DW, no data</td><td>0 0001</td></tr><tr><td>Memory Write Request (MWr)</td><td>10 = 3DW, w/ data 11 = 4DW, w/ data</td><td>0 0000</td></tr><tr><td>IO Read Request (IORd)</td><td>00 = 3DW, no data</td><td>00010</td></tr><tr><td>IO Write Request (IOWr)</td><td>10 = 3DW, w/ data</td><td>0 0010</td></tr><tr><td>Config Type 0 Read Request (CfgRd0)</td><td>00 = 3DW, no data</td><td>0 0100</td></tr><tr><td>Config Type 0 Write Request (CfgWr0)</td><td>10 = 3DW, w/ data</td><td>0 0100</td></tr><tr><td>Config Type 1 Read Request (CfgRd1)</td><td>00 = 3DW, no data</td><td>0 0101</td></tr><tr><td>Config Type 1 Write Request (CfgWr1)</td><td>10 = 3DW, w/ data</td><td>0 0101</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="219" id="mark-6d229430-e1a2-4913-a24a-52c69abe7fa6" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 4-5: TLP Header Type and Format Field Encodings</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>TLP</th><th>FMT[1:0]</th><th>TYPE [4:0]</th></tr></thead><tbody><tr><td>Message Request (Msg)</td><td>01 = 4DW, no data</td><td>1 0 rrr* (for rrr, see routing subfield)</td></tr><tr><td>Message Request W/Data (MsgD)</td><td>11 = 4DW, w/ data</td><td>1 0rrr* (for rrr, see routing subfield)</td></tr><tr><td>Completion (Cpl)</td><td>00 = 3DW, no data</td><td>0 1010</td></tr><tr><td>Completion W/Data (CplD)</td><td>10 = 3DW, w/ data</td><td>01010</td></tr><tr><td>Completion-Locked (CplLk)</td><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="287" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c33"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c44"></mjx-c><mjx-c class="mjx-c57"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>00</mn></mrow><mo>=</mo><mn>3</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">DW</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> ,no data</td><td>01011</td></tr><tr><td>Completion W/Data (CplDLk)</td><td>10 = 3DW, w/ data</td><td>01011</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>The Digest and ECRC Field</div></div></h2><div><div><div></div></div></div><div><div><div>The digest field and End-to-End CRC (ECRC) is optional as is a device's ability to generate and check ECRC. If supported and enabled by software, devices must calculate and apply ECRC for all TLPs that the device originates. Also, devices that support ECRC checking must also support Advanced Error Reporting.</div></div></div><div><div><div></div></div></div><div><div><div>ECRC Generation and Checking. This book does not detail the algorithm and process of calculating ECRC, but is defined within the specification. ECRC covers all fields that do not change as the TLP is forwarded across the fabric. The ECRC includes all invariant fields of the TLP header and the data payload, if present. All variant fields are set to 1 for calculating the ECRC, include:</div></div></div><div><div><div></div></div></div><div><ul><li>Bit 0 of the Type field is variant - this bit changes when the transaction type is altered for a packet. For example, a configuration transaction being forwarded to a remote link (across one or more switches) begins as a type 1 configuration transaction. When the transaction reaches the destination link, it is converted to a type 0 configuration transaction by changing bit 0 of the type field.</li></ul></div><div><div><div></div></div></div><div><ul><li>Error/Poisoned (EP) bit - this bit can be set as a TLP traverses the fabric in the event that the data field associated with the packet has been corrupted. This is also referred to as error forwarding.</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="220" id="mark-b4976894-05cf-466e-b706-2b69fff2fe8c" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Who Can Check ECRC? The ECRC check is intended for the device that is the ultimate receipient of the TLP. Link CRC checking verifies that a TLP traverses a given link before being forwarded to the next link, but ECRC is intended to verify that the packet send has not been altered in its journey between the Requester and Completer. Switches in the path must maintain the integrity of the TD bit because corruption of TD will cause an error at the ultimate target device.</div></div></div><div><div><div></div></div></div><div><div><div>The specification makes two statements regarding a Switch's role in ECRC checking:</div></div></div><div><div><div></div></div></div><div><ul><li>A switch that supports ECRC checking performs this check on TLPs destined to a location within the Switch itself. "On all other TLPs a Switch must preserve the ECRC (forward it untouched) as an integral part of the TLP."</li></ul></div><div><div><div></div></div></div><div><ul><li>"Note that a Switch may perform ECRC checking on TLPs passing through the Switch. ECRC Errors detected by the Switch are reported in the same way any other device would report them, but do not alter the TLPs passage through the Switch."</li></ul></div><div><div><div></div></div></div><div><div><div>These statements may appear to contradict each other. However, the first statement does not explicitly state that an ECRC check cannot be made in the process of forwarding the TLP untouched. The second statement clarifies that it is possible for switches, as well as the ultimate target device, to check and report ECRC.</div></div></div><div><div><div></div></div></div><h2><div><div>Using Byte Enables</div></div></h2><div><div><div></div></div></div><div><div><div>As in the PCI protocol, PCI Express requires a mechanism for reconciling its DW addressing and data transfers with the need, at times, for byte resolution in transfer sizes and transaction start/end addresses. To achieve byte resolution, PCI Express makes use of the two Byte Enable fields introduced earlier in Figure 4-3 on page 162 and in Table 4-4 on page 163.</div></div></div><div><div><div></div></div></div><div><div><div>The First DW Byte Enable field and the Last DW Byte Enable fields allow the requester to qualify the bytes of interest within the first and last double words transferred; this has the effect of allowing smaller transfers than a full double word and offsetting the start and end addresses from DW boundaries.</div></div></div><div><div><div></div></div></div><h2><div><div>Byte Enable Rules.</div></div></h2><div><div><div></div></div></div><div><ol><li value="1">Byte enable bits are high true. A value of " 0 " indicates the corresponding byte in the data payload should not be written by the completer. A value of "1", indicates it should.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">If the valid data transferred is all within a single aligned double word, the PCI Express System Architecture Last DW Byte enable field must be <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="288" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>0000</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> .</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="221" id="mark-2a84ceaa-f9b2-4889-8b8f-b4abc2d30cc1" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><ol><li value="3">If the header Length field indicates a transfer is more than 1DW, the First DW Byte Enable must have at least one bit enabled.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">If the Length field indicates a transfer of 3DW or more, then neither the First DW Byte Enable field or the Last DW Byte Enable field may have discontinuous byte enable bits set. In these cases, the Byte Enable fields are only being used to offset the effective start address of a burst transaction.</li></ol></div><div><div><div></div></div></div><div><ol><li value="5">Discontinuous byte enable bit patterns in the First DW Byte enable field are allowed if the transfer is 1DW.</li></ol></div><div><div><div></div></div></div><div><ol><li value="6">Discontinuous byte enable bit patterns in both the First and Second DW Byte enable fields are allowed only if the transfer is Quadword aligned (2DWs).</li></ol></div><div><div><div></div></div></div><div><ol><li value="7">A write request with a transfer length of 1DW and no byte enables set is legal, but has no effect on the completer.</li></ol></div><div><div><div></div></div></div><div><ol><li value="8">If a read request of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="289" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c44"></mjx-c><mjx-c class="mjx-c57"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">DW</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> is done with no byte enable bits set,the completer returns a 1DW data payload of undefined data. This may be used as a Flush mechanism. Because of ordering rules, a flush may be used to force all previously posted writes to memory before the completion is returned.</li></ol></div><div><div><div></div></div></div><div><div><div>An example of byte enable use in this case is illustrated in Figure 4-4 on page 168. Note that the transfer length must extend from the first DW with any valid byte enabled to the last DW with any valid bytes enabled. Because the transfer is more than <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="290" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c44"></mjx-c><mjx-c class="mjx-c57"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">DW</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> ,the byte enables may only be used to specify the start address location (2d) and end address location (34d) of the transfer.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 4-4: Using First DW and Last DW Byte Enable Fields</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_227.jpg?x=323&amp;y=1151&amp;w=765&amp;h=500"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="222" id="mark-819e86d1-04d3-4050-bf34-2f8d6e2eec00" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Transaction Descriptor Fields</div></div></h2><div><div><div></div></div></div><div><div><div>As transactions move between requester and completer, it is important to uniquely identify a transaction, since many split transactions may be pending at any instant. To this end, the specification defines several important header fields that when used together form a unique Transaction Descriptor as illustrated in Figure 4-5.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 4-5: Transaction Descriptor Fields</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_228.jpg?x=225&amp;y=698&amp;w=975&amp;h=373"></div></div><div><div><div></div></div></div><div><div><div>While the Transaction Descriptor fields are not in adjacent header locations, collectively they describe key transaction attributes, including:</div></div></div><div><div><div></div></div></div><div><div><div>Transaction ID. This is comprised of the Bus, Device, and Function Number of the TLP requester AND the Tag field of the TLP.</div></div></div><div><div><div></div></div></div><div><div><div>Traffic Class. Traffic Class (TC 0 -7) is inserted in the TLP by the requester, and travels unmodified through the topology to the completer. At every link, Traffic Class is mapped to one of the available virtual channels.</div></div></div><div><div><div></div></div></div><div><div><div>Transaction Attributes. These consist of the Relaxed Ordering and No Snoop bits. These are also set by the requester and travel with the packet to the completer.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="223" id="mark-475c087d-798f-4821-bde4-177b90668701" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Additional Rules For TLPs With Data Payloads</div></div></h2><div><div><div></div></div></div><div><div><div>The following rules apply when a TLP includes a data payload.</div></div></div><div><div><div></div></div></div><div><ol><li value="1">The Length field refers to data payload only; the Digest field (if present) is not included in the Length.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">The first byte of data in the payload (immediately after the header) is always associated with the lowest (start) address.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">The Length field always represents an integral number of doublewords (DW) transferred. Partial doublewords are qualified using First and Last Byte Enable fields.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">The PCI Express specification states that when multiple transactions are returned by a completer in response to a single memory request, that each intermediate transaction must end on naturally-aligned 64 and 128 byte address boundaries for a root complex (this is termed the Read Completion Boundary, or RCB). All other devices must break such transactions at naturally-aligned 128 byte boundaries. This behavior promotes system performance related to cache lines.</li></ol></div><div><div><div></div></div></div><div><ol><li value="5">The Length field is reserved when sending message TLPs using the transaction Msg. The Length field is valid when sending the message with data variant MsgD.</li></ol></div><div><div><div></div></div></div><div><ol><li value="6">PCI Express supports load tuning of links. This means that the data payload of a TLP must not exceed the current value in the Max_Payload_Size field of the Device Control Register. Only write transactions have data payloads, so this restriction does not apply to reads. A receiver is required to check for violations of the Max_Payload_Size limit during writes; violations are handled as Malformed TLPs.</li></ol></div><div><div><div></div></div></div><div><ol><li value="7">Receivers also must check for discrepancies between the value in the Length field and the actual amount of data transferred in a TLP with data. Violations are also handled as Malformed TLPs.</li></ol></div><div><div><div></div></div></div><div><ol><li value="8">Requests must not mix combinations of start address and transfer length which will cause a memory space access to cross a <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="291" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>4</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">KB</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> boundary. While checking is optional in this case, receivers checking for violations of this rule will report it as a Malformed TLP.</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="224" id="mark-811bb6ca-9acb-44b0-815c-1592359b3233" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Building Transactions: TLP Requests &amp; Completions</div></div></h2><div><div><div></div></div></div><div><div><div>In this section, the format of 3DW and 4DW headers used to accomplish specific transaction types are described. Many of the generic fields described previously apply, but an emphasis is placed on the fields which are handled differently between transaction types.</div></div></div><div><div><div></div></div></div><h2><div><div>IO Requests</div></div></h2><div><div><div></div></div></div><div><div><div>While the PCI Express specification discourages the use of IO transactions, an allowance is made for legacy devices and software which may rely on a compatible device residing in the system IO map rather than the memory map. While the IO transactions can technically access a 32-bit IO range, in reality many systems (and CPUs) restrict IO access to the lower 16 bits ( <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="292" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>64</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">KB</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> ) of this range. Figure 4-6 on page 171 depicts the system IO map and the 16/32 bit address boundaries. PCI Express non-legacy devices are memory-mapped, and not permitted to make requests for IO address allocation in their configuration Base Address Registers.</div></div></div><div><div><div></div></div></div><h2><div><div>Figure 4-6: System IO Map</div></div></h2><div><div><div></div></div></div><div><div><div>The entire 32 bit I/O address (4GB) space may be accessed using the 3DW request header format.</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_230.jpg?x=296&amp;y=1211&amp;w=912&amp;h=266"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="225" id="mark-a9598c5a-a137-4360-b505-445362bc2426" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>IO Request Header Format. Figure 4-7 on page 172 depicts the format of the 3DW IO request header. Each field in the header is described in the section that follows.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 4-7: 3DW IO Request Header Format</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_231.jpg?x=223&amp;y=557&amp;w=990&amp;h=855"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="226" id="mark-573740e2-b80c-4ef0-9951-0e97aea52883" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Definitions Of IO Request Header Fields. Table 4-6 on page 173</div></div></div><div><div><div></div></div></div><div><div><div>describes the location and use of each field in an IO request header.</div></div></div><div><div><div></div></div></div><div><div><div>Table 4-6: IO Request Header Fields</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Field Name</th><th>Header Byte/Bit</th><th>Function</th></tr></thead><tbody><tr><td>Length 9:0</td><td>Byte 3 Bit 7:0 Byte 2 Bit 1:0</td><td>Indicates data payload size in DW. For IO requests, this field is always = 1. Byte Enables are used to qualify bytes within DW.</td></tr><tr><td>Attr 1:0 (Attributes)</td><td>Byte 2 Bit 5:4</td><td>Attribute 1: Relaxed Ordering Bit Attribute 0: No Snoop Bit Both of these bits are always <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="293" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>0</mn></math></mjx-assistive-mml></mjx-container> in IO requests.</td></tr><tr><td>EP</td><td>Byte 2 Bit 6</td><td>If <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="294" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> ,indicates the data payload (if present) is poisoned.</td></tr><tr><td>TD</td><td>Byte 2 Bit 7</td><td>If <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="295" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> ,indicates the presence of a digest field (1 DW) at the end of the TLP (preceding LCRC and END)</td></tr><tr><td>TC 2:0 (Transfer Class)</td><td>Byte 2 Bit 6:4</td><td>Indicates transfer class for the packet. TC is = 0 for all IO requests.</td></tr><tr><td>Type 4:0</td><td>Byte 0 Bit 4:0</td><td>TLP packet type field. Always set to 00010b for IO requests</td></tr><tr><td>Fmt 1:0 (Format)</td><td>Byte 0 Bit 6:5</td><td>Packet Format. IO requests are: 00b = IO Read (3DW without data) 10b = IO Write (3DW with data)</td></tr><tr><td>1st DW BE 3:0 (First DW Byte Enables)</td><td>Byte 7 Bit 3:0</td><td>These high true bits map one-to-one to qualify bytes within the DW pay- load. For IO requests, any bit combi- nation is valid (including none)</td></tr><tr><td>Last BE 3:0 (Last DW Byte Enables)</td><td>Byte 7 Bit 7:4</td><td>These high true bits map one-to-one to qualify bytes within the last DW transferred. For IO requests, these bits must be 0000b. (Single DW)</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="227" id="mark-f5acdc6b-a1b9-4301-94bb-b3c7cf7280ce" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 4-6: IO Request Header Fields</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Field Name</th><th>Header Byte/Bit</th><th>Function</th></tr></thead><tbody><tr><td>Tag 7:0</td><td>Byte 6 Bit 7:0</td><td>These bits are used to identify each outstanding request issued by the requester. As non-posted requests are sent, the next sequential tag is assigned. Default: only bits 4:0 are used (32 out- standing transactions at a time) If Extended Tag bit in PCI Express Control Register is set <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="296" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> ,then all 8 bits may be used (256 tags).</td></tr><tr><td>Requester ID 15:0</td><td>Byte 5 Bit 7:0 Byte 4 Bit 7:0</td><td>Identifies the requester so a comple- tion may be returned, etc. Byte 4, 7:0 = Bus Number Byte 5, 7:3 = Device Number Byte 5, 2:0 = Function Number</td></tr><tr><td>Address 31:2</td><td>Byte 8 Bit 7:2 Byte 7 Bit 7:0 Byte 6 Bit 7:0 Byte 5 Bit 7:0</td><td>The upper 30 bits of the 32-bit start address for the IO transfer. Note that the lower two bits of the 32 bit address are reserved (00b), forcing the start address to be DW aligned.</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>Memory Requests</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express memory transactions include two classes: Read Request/Completion and Write Request. Figure 4-8 on page 175 depicts the system memory map and the 3DW and 4DW memory request packet formats. When request memory data transfer it is important to remember that memory transactions are never permitted to cross <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="297" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>4</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">KB</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> boundaries.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="228" id="mark-9551b74b-1b8e-4399-a880-42b5a93bafc6" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 4-8: 3DW And 4DW Memory Request Header Formats</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_234.jpg?x=224&amp;y=446&amp;w=998&amp;h=938"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="229" id="mark-f7398bc9-2bdb-4bff-9002-209e55898fed" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Description of 3DW And 4DW Memory Request Header Fields.</div></div></div><div><div><div></div></div></div><div><div><div>The location and use of each field in a 4DW memory request header is listed in Table 4-7 on page 176.</div></div></div><div><div><div></div></div></div><div><div><div>Note: The difference between a 3DW header and a 4DW header is the location and size of the starting Address field:</div></div></div><div><div><div></div></div></div><div><ul><li>For a 3DW header (32 bit addressing): Address bits 31:2 are in Bytes 8-11, and 12-15 are not used.</li></ul></div><div><div><div></div></div></div><div><ul><li>For a 4DW header (64 bit addressing): Address bits 31:2 are in Bytes 12-15, and address bits 63:32 are in Bytes 8-11.</li></ul></div><div><div><div></div></div></div><div><div><div>Otherwise the header fields are the same.</div></div></div><div><div><div></div></div></div><div><div><div>Table 4-7: 4DW Memory Request Header Fields</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Field Name</th><th>Header Byte/Bit</th><th>Function</th></tr></thead><tbody><tr><td>Length [9:0]</td><td>Byte 3 Bit 7:0 Byte 2 Bit 1:0</td><td>TLP data payload transfer size, in DW. Maximum transfer size is 10 bits, <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="298" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mrow data-mjx-texclass="ORD"><mn>2</mn></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow></msup></math></mjx-assistive-mml></mjx-container> = 1024 DW (4KB). Encoding: <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="299" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mrow><mjx-mo class="mjx-n"><mjx-stretchy-v class="mjx-c5B" style="height: 15em; vertical-align: -7.25em;"><mjx-beg><mjx-c></mjx-c></mjx-beg><mjx-ext><mjx-c></mjx-c></mjx-ext><mjx-end><mjx-c></mjx-c></mjx-end><mjx-mark></mjx-mark></mjx-stretchy-v></mjx-mo><mjx-mtable style="min-width: 0.5em;"><mjx-table><mjx-itable><mjx-mtr><mjx-mtd style="padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em; padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em; padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em; padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em; padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em; padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em; padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em; padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em; padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em; padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em;"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr></mjx-itable></mjx-table></mjx-mtable><mjx-mo class="mjx-n"><mjx-stretchy-v class="mjx-c5D" style="height: 15em; vertical-align: -7.25em;"><mjx-beg><mjx-c></mjx-c></mjx-beg><mjx-ext><mjx-c></mjx-c></mjx-ext><mjx-end><mjx-c></mjx-c></mjx-end><mjx-mark></mjx-mark></mjx-stretchy-v></mjx-mo></mjx-mrow><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mrow space="4"><mjx-mo class="mjx-n"><mjx-stretchy-v class="mjx-c5B" style="height: 3.8em; vertical-align: -1.65em;"><mjx-beg><mjx-c></mjx-c></mjx-beg><mjx-ext><mjx-c></mjx-c></mjx-ext><mjx-end><mjx-c></mjx-c></mjx-end><mjx-mark></mjx-mark></mjx-stretchy-v></mjx-mo><mjx-mtable style="min-width: 1.048em;"><mjx-table><mjx-itable><mjx-mtr><mjx-mtd style="padding-bottom: 0.2em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em; padding-bottom: 0.2em;"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D437 TEX-I"></mjx-c></mjx-mi><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="padding-top: 0.2em;"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44A TEX-I"></mjx-c></mjx-mi><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr></mjx-itable></mjx-table></mjx-mtable><mjx-mo class="mjx-n"><mjx-stretchy-v class="mjx-c5D" style="height: 3.8em; vertical-align: -1.65em;"><mjx-beg><mjx-c></mjx-c></mjx-beg><mjx-ext><mjx-c></mjx-c></mjx-ext><mjx-end><mjx-c></mjx-c></mjx-end><mjx-mark></mjx-mark></mjx-stretchy-v></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">[</mo><mtable columnspacing="1em" rowspacing="4pt"><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>1</mn></mtd></mtr><mtr><mtd><mi>b</mi></mtd></mtr></mtable><mo data-mjx-texclass="CLOSE">]</mo></mrow><mo>=</mo><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">[</mo><mtable columnspacing="1em" rowspacing="4pt"><mtr><mtd><mn>1</mn></mtd></mtr><mtr><mtd><mi>D</mi></mtd></mtr><mtr><mtd><mi>W</mi></mtd></mtr></mtable><mo data-mjx-texclass="CLOSE">]</mo></mrow></math></mjx-assistive-mml></mjx-container> 00 0000 0010b = 2DW 11 1111 1111b = 1023 DW <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="300" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c44"></mjx-c><mjx-c class="mjx-c57"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>0000000000</mn><mi>b</mi></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>1024</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">DW</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container></td></tr><tr><td>Attr (Attributes)</td><td>Byte 2 Bit 5:4</td><td>Bit 5 = Relaxed ordering. When set <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="301" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c2C"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn><mo>,</mo></math></mjx-assistive-mml></mjx-container> PCI-X relaxed ordering is enabled for this TLP. If set <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="302" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>0</mn></math></mjx-assistive-mml></mjx-container> ,then strict PCI ordering is used. Bit 4 = No Snoop. When set <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="303" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> ,requester is indicating that no host cache coherency issues exist with respect to this TLP. System hardware is not required to cause pro- cessor cache snoop for coherency. When set <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="304" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>0</mn></math></mjx-assistive-mml></mjx-container> ,PCI -type cache snoop protection is required.</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="230" id="mark-e6cee691-9c13-4d7a-8633-dfe968752dac" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 4-7: 4DW Memory Request Header Fields</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Field Name</th><th>Header Byte/Bit</th><th>Function</th></tr></thead><tbody><tr><td>EP (Poisoned Data)</td><td>Byte 2 Bit 6</td><td>If set <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="305" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> ,the data accompanying this data should be considered invalid although the transaction is being allowed to complete normally.</td></tr><tr><td>TD (TLP Digest Field Present)</td><td>Byte 2 Bit 7</td><td>If set = 1, the optional 1 DW TLP Digest field is included with this TLP. Some rules: Presence of the Digest field must be checked by all receivers (using this bit) - A TLP with TD = 1, but no Digest field is handled as a Malformed TLP. - If a device supports checking ECRC and TD=1, it must perform the ECRC check. - If a device does not support check- ing ECRC (optional) at the ulti- mate destination, the device must ignore the digest field.</td></tr><tr><td>TC (Traffic Class)</td><td>Byte 1 Bit 6:4</td><td>These three bits are used to encode the traffic class to be applied to this TLP and to the completion associated with it (if any). 000b = Traffic Class 0 (Default) . . 111b = Traffic Class 7 TC 0 is the default class, and TC 1-7 are used in providing differentiated services. See“Traffic Classes and Vir- tual Channels” on page 256 for addi- tional information.</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="231" id="mark-657ed86e-7122-41a7-a7fe-753a53143a9e" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 4-7: 4DW Memory Request Header Fields</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Field Name</th><th>Header Byte/Bit</th><th>Function</th></tr></thead><tbody><tr><td>Type[4:0]</td><td>Byte 0 Bit 4:0</td><td>TLP packet Type field: <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="306" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>00000</mn></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">b</mi></mrow><mo>=</mo></math></mjx-assistive-mml></mjx-container> Memory Read or Write <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="307" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>00001</mn></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">b</mi></mrow><mo>=</mo></math></mjx-assistive-mml></mjx-container> Memory Read Locked Type field is used with Fmt [1:0] field to specify transaction type, header size, and whether data payload is present.</td></tr><tr><td>Fmt 1:0 (Format)</td><td>Byte 0 Bit 6:5</td><td>Packet Format: 00b = Memory Read (3DW w/o data) 10b = Memory Write (3DW w/ data) 01b = Memory Read (4DW w/o data 11b = Memory Write (4DW w/ data)</td></tr><tr><td>1st DW BE 3:0 (First DW Byte Enables)</td><td>Byte 7 Bit 3:0</td><td>These high true bits map one-to-one to qualify bytes within the DW pay- load.</td></tr><tr><td>Last BE 3:0 (Last DW Byte Enables)</td><td>Byte 7 Bit 7:4</td><td>These high true bits map one-to-one to qualify bytes within the last DW transferred.</td></tr><tr><td>Tag 7:0</td><td>Byte 6 Bit 7:0</td><td>These bits are used to identify each outstanding request issued by the requester. As non-posted requests are sent, the next sequential tag is assigned. Default: only bits 4:0 are used (32 out- standing transactions at a time) If Extended Tag bit in PCI Express Control Register is set <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="308" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> ,then all 8 bits may be used (256 tags).</td></tr><tr><td>Requester ID 15:0</td><td>Byte 5 Bit 7:0 Byte 4 Bit 7:0</td><td>Identifies the requester so a comple- tion may be returned, etc. Byte 4, 7:0 = Bus Number Byte 5, 7:3 = Device Number Byte 5, 2:0 = Function Number</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="232" id="mark-b78bfc65-1cb8-4b26-9e21-9397f28f5e49" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 4-7: 4DW Memory Request Header Fields</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Field Name</th><th>Header Byte/Bit</th><th>Function</th></tr></thead><tbody><tr><td>Address 31:2</td><td>Byte 15 Bit 7:2 Byte 14 Bit 7:0 Byte 13 Bit 7:0 Byte 12 Bit 7:0</td><td>The lower 32 bits of the 64 bit start address for the memory transfer. Note that the lower two bits of the 32 bit address are reserved (00b), forcing the start address to be DW aligned.</td></tr><tr><td>Address 63:32</td><td>Byte 11 Bit 7:2 Byte 10 Bit 7:0 Byte 9 Bit 7:0 Byte 8 Bit 7:0</td><td>The upper 32 bits of the 64-bit start address for the memory transfer.</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>Memory Request Notes. Features of memory requests include:</div></div></h2><div><div><div></div></div></div><div><ol><li value="1">Memory transfers are never permitted to cross a <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="309" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>4</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">KB</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> boundary.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">All memory mapped writes are posted, resulting in much higher performance.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">Either 32 bit or 64 bit addressing may be used. The 3DW header format supports 32 bit addresses and the 4DW header supports 64 bits.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">The full capability of burst transfers is available with a transfer length of 0- 1024 DW (0-4KB).</li></ol></div><div><div><div></div></div></div><div><ol><li value="5">Advanced PCI Express Quality of Service features, including up to 8 transfer classes and virtual channels may be implemented.</li></ol></div><div><div><div></div></div></div><div><ol><li value="6">The No Snoop attribute bit in the header may be set <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="310" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> ,relieving the system hardware from the burden of snooping processor caches when PCI Express transactions target main memory. Optionally, the bit may be deas-serted in the packet, providing PCI-like cache coherency protection.</li></ol></div><div><div><div></div></div></div><div><ol><li value="7">The Relaxed Ordering bit may also be set <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="311" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> ,permitting devices in the path between the packet and its destination to apply the relaxed ordering rules available in PCI-X. If deasserted, strong PCI producer-consumer ordering is enforced.</li></ol></div><div><div><div></div></div></div><h2><div><div>Configuration Requests</div></div></h2><div><div><div></div></div></div><div><div><div>To maintain compatibility with PCI, PCI Express supports both Type 0 and Type 1 configuration cycles. A Type 1 cycle propagates downstream until it reaches the bridge interface hosting the bus (link) that the target device resides on. The configuration transaction is converted on the destination link from Type 1 to Type 0 by the bridge. The bridge forwards and converts configuration cycles using previously programmed Bus Number registers that specify its primary,</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="233" id="mark-3cb0d0ac-732a-4071-bab1-8aa7d12bbaca" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>secondary, and subordinate buses. Refer to the "PCI-Compatible Configuration Mechanism" on page 723 for a discussion of routing these transactions.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 4-9 on page 180 illustrates a Type 1 configuration cycle making its way downstream. At the destination link, it is converted to Type 0 and claimed by the endpoint device. Note that unlike PCI, only one device (other than the bridge) resides on a link. For this reason, no IDSEL or other hardware indication is required to instruct the device to claim the Type 0 cycle; any Type 0 configuration cycle a device sees on its primary link will be claimed.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 4-9: 3DW Configuration Request And Header Format</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_239.jpg?x=220&amp;y=750&amp;w=998&amp;h=882"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="234" id="mark-888e6a19-6da4-45a5-bcff-1867ff3b710f" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Definitions Of Configuration Request Header Fields. Table 4-8 on</div></div></div><div><div><div></div></div></div><div><div><div>page 181 describes the location and use of each field in the configuration request header illustrated in Figure 4-9 on page 180.</div></div></div><div><div><div></div></div></div><div><div><div>Table 4-8: Configuration Request Header Fields</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Field Name</th><th>Header Byte/Bit</th><th>Function</th></tr></thead><tbody><tr><td>Length 9:0</td><td>Byte 3 Bit 7:0 Byte 2 Bit 1:0</td><td>Indicates data payload size in DW. For configuration requests, this field is always = 1. Byte Enables are used to qualify bytes within DW (any combi- nation is legal)</td></tr><tr><td>Attr 1:0 (Attributes)</td><td>Byte 2 Bit 5:4</td><td>Attribute 1: Relaxed Ordering Bit Attribute 0: No Snoop Bit Both of these bits are always <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="312" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>0</mn></math></mjx-assistive-mml></mjx-container> in configuration requests.</td></tr><tr><td>EP</td><td>Byte 2 Bit 6</td><td>If <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="313" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> ,indicates the data payload (if present) is poisoned.</td></tr><tr><td>TD</td><td>Byte 2 Bit 7</td><td>If <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="314" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> ,indicates the presence of a digest field (1 DW) at the end of the TLP (preceding LCRC and END)</td></tr><tr><td>TC 2:0 (Transfer Class)</td><td>Byte 2 Bit 6:4</td><td>Indicates transfer class for the packet. TC is = 0 for all Configuration requests.</td></tr><tr><td>Type 4:0</td><td>Byte 0 Bit 4:0</td><td>TLP packet type field. Set to: <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="315" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>00100</mn></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">b</mi></mrow><mo>=</mo></math></mjx-assistive-mml></mjx-container> Type 0 config request <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="316" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>00101</mn></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">b</mi></mrow><mo>=</mo></math></mjx-assistive-mml></mjx-container> Type 1 config request</td></tr><tr><td>Fmt 1:0 (Format)</td><td>Byte 0 Bit 6:5</td><td>Packet Format. Always a 3DW header <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="317" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>00</mn></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">b</mi></mrow><mo>=</mo></math></mjx-assistive-mml></mjx-container> configuration read (no data) <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="318" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mo>=</mo></math></mjx-assistive-mml></mjx-container> configuration write (with data)</td></tr><tr><td>1st DW BE 3:0 (First DW Byte Enables)</td><td>Byte 7 Bit 3:0</td><td>These high true bits map one-to-one to qualify bytes within the DW payload. For config requests, any bit combina- tion is valid (including none)</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="235" id="mark-b91c18cd-fa62-4a18-bb24-4fc6485c6096" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 4-8: Configuration Request Header Fields</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Field Name</th><th>Header Byte/Bit</th><th>Function</th></tr></thead><tbody><tr><td>Last BE 3:0 (Last DW Byte Enables)</td><td>Byte 7 Bit 7:4</td><td>These high true bits map one-to-one to qualify bytes within the last DW trans- ferred. For config requests, these bits must be 0000b. (Single DW)</td></tr><tr><td>Tag 7:0</td><td>Byte 6 Bit 7:0</td><td>These bits are used to identify each outstanding request issued by the requester. As non-posted requests are sent, the next sequential tag is assigned. Default: only bits 4:0 are used (32 out- standing transactions at a time) If Extended Tag bit in PCI Express Control Register is set <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="319" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> ,then all 8 bits may be used (256 tags).</td></tr><tr><td>Requester ID 15:0</td><td>Byte 5 Bit 7:0 Byte 4 Bit 7:0</td><td>Identifies the requester so a comple- tion may be returned, etc. Byte 4, 7:0 = Bus Number Byte 5, 7:3 = Device Number Byte 5, 2:0 = Function Number</td></tr><tr><td>Register Number</td><td>Byte 11 Bit 7:2</td><td>These bits provide the lower 6 bits of DW configuration space offset. The Register Number is used in conjunc- tion with Ext Register Number to pro- vide the full 10 bits of offset needed for the 1024 DW (4096 byte) PCI Express configuration space.</td></tr><tr><td>Ext Register Number (Extended Register Number)</td><td>Byte 10 Bit 3:0</td><td>These bits provide the upper 4 bits of DW configuration space offset. The Ext Register Number is used in conjunc- tion with Register Number to provide the full 10 bits of offset needed for the 1024 DW (4096 byte) PCI Express con- figuration space. For compatibility, this field can be set <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="320" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>0</mn></math></mjx-assistive-mml></mjx-container> ,and only the lower 64DW (256 bytes will be seen) when indexing the Register Number.</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="236" id="mark-137bb5a8-3460-4268-a50d-5b75207afd0b" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 4-8: Configuration Request Header Fields</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Field Name</th><th>Header Byte/Bit</th><th>Function</th></tr></thead><tbody><tr><td>Completer ID 15:0</td><td>Byte 9 Bit 7:0 Byte 8 Bit 7:0</td><td>Identifies the completer being accessed with this configuration cycle. The Bus and Device numbers in this field are "captured" by the device on each con- figuration Type 0 write. Byte 8, 7:0 = Bus Number Byte 9, 7:3 = Device Number Byte 9, 2:0 = Function Number</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div>Configuration Request Notes. Configuration requests always use the 3DW header format and are routed by the contents of the ID field.</div></div></div><div><div><div></div></div></div><div><div><div>All devices "capture" the Bus Number and Device Number information provided by the upstream device during each Type 0 configuration write cycle. Information is contained in Byte 8-9 (Completer ID) of configuration request.</div></div></div><div><div><div></div></div></div><h2><div><div>Completions</div></div></h2><div><div><div></div></div></div><div><div><div>Completions are returned following each non-posted request:</div></div></div><div><div><div></div></div></div><div><ul><li>Memory Read request may result in completion with data (CplD)</li></ul></div><div><div><div></div></div></div><div><ul><li>IO Read request may result in a completion with or without data (CplD)</li></ul></div><div><div><div></div></div></div><div><ul><li>IO Write request may result in a completion without data (Cpl)</li></ul></div><div><div><div></div></div></div><div><ul><li>Configuration Read request may result in a completion with data (CplD)</li></ul></div><div><div><div></div></div></div><div><ul><li>Configuration Write request may result in a completion without data (Cpl)</li></ul></div><div><div><div></div></div></div><div><div><div>Many of the fields in the completion must have the same values as the associated request, including Traffic Class, Attribute bits, and the original Requester ID which is used to route the completion back to the original requester. Figure 4-10 on page 184 depicts a completion returning after a non-posted request, as well as the 3DW completion header format.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="237" id="mark-5e3d08eb-e4d0-4130-949d-2646ca652a79" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 4-10: 3DW Completion Header Format</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_243.jpg?x=223&amp;y=444&amp;w=999&amp;h=876"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="238" id="mark-2cb4c4dd-e93f-4e0e-ae3a-a1dda2254b9d" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Definitions Of Completion Header Fields. Table 4-9 on page 185</div></div></div><div><div><div></div></div></div><div><div><div>describes the location and use of each field in a completion header.</div></div></div><div><div><div></div></div></div><div><div><div>Table 4-9: Completion Header Fields</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Field Name</th><th>Header Byte/Bit</th><th>Function</th></tr></thead><tbody><tr><td>Length 9:0</td><td>Byte 3 Bit 7:0 Byte 2 Bit 1:0</td><td>Indicates data payload size in DW. For completions, this field reflects the size of the data payload associated with this completion.</td></tr><tr><td>Attr 1:0 (Attributes)</td><td>Byte 2 Bit 5:4</td><td>Attribute 1: Relaxed Ordering Bit Attribute 0: No Snoop Bit For a completion, both of these bits are set to same state as in the request.</td></tr><tr><td>EP</td><td>Byte 2 Bit 6</td><td>If <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="321" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> ,indicates the data payload is poi- soned.</td></tr><tr><td>TD</td><td>Byte 2 Bit 7</td><td>If <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="322" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> ,indicates the presence of a digest field (1 DW) at the end of the TLI (preceding LCRC and END)</td></tr><tr><td>TC 2:0 (Transfer Class)</td><td>Byte 2 Bit 6:4</td><td>Indicates transfer class for the packet. For a completion, TC is set to same value as in the request.</td></tr><tr><td>Type 4:0</td><td>Byte 0 Bit 4:0</td><td>TLP packet type field. Always set to <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="323" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>01010</mn></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> for a completion.</td></tr><tr><td>Fmt 1:0 (Format)</td><td>Byte 0 Bit 6:5</td><td>Packet Format. Always a 3DW header <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="324" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>00</mn></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">b</mi></mrow><mo>=</mo></math></mjx-assistive-mml></mjx-container> Completion without data (Cpl) <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="325" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">b</mi></mrow><mo>=</mo></math></mjx-assistive-mml></mjx-container> Completion with data (CplD)</td></tr><tr><td>Byte Count</td><td>Byte 7 Bit 7:0 Byte 6 Bit 3:0</td><td>This is the remaining byte count until a read request is satisfied. Generally, it is derived from the original request Length field. See “Data Returned For Read Requests:" on page 188 for special cases caused by multiple completions.</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="239" id="mark-5ce39307-db88-47a0-a26c-95c2f18930e8" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 4-9: Completion Header Fields</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Field Name</th><th>Header Byte/Bit</th><th>Function</th></tr></thead><tbody><tr><td>BCM (Byte Count Modified)</td><td>Byte 6 Bit 4</td><td>Set <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="326" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> only by PCI-X completers. Indi- cates that the byte count field (see previ- ous field) reflects the first transfer payload rather than total payload remaining. See “Using The Byte Count Modified Bit” on page 188.</td></tr><tr><td>CS 2:0 (Completion Status Code)</td><td>Byte 6 Bit 7:5</td><td>These bits encoded by the completer to indicate success in fulfilling the request <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="327" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c53"></mjx-c><mjx-c class="mjx-c75"></mjx-c><mjx-c class="mjx-c63"></mjx-c><mjx-c class="mjx-c63"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c73"></mjx-c><mjx-c class="mjx-c73"></mjx-c><mjx-c class="mjx-c66"></mjx-c><mjx-c class="mjx-c75"></mjx-c><mjx-c class="mjx-c6C"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c43"></mjx-c><mjx-c class="mjx-c6F"></mjx-c><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c70"></mjx-c><mjx-c class="mjx-c6C"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c74"></mjx-c><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c6F"></mjx-c><mjx-c class="mjx-c6E"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mrow space="2"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c53"></mjx-c><mjx-c class="mjx-c43"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>000</mn></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">b</mi></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">Successful</mi></mrow></mrow><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">Completion</mi></mrow></mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">SC</mi></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="328" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c55"></mjx-c><mjx-c class="mjx-c6E"></mjx-c><mjx-c class="mjx-c73"></mjx-c><mjx-c class="mjx-c75"></mjx-c><mjx-c class="mjx-c70"></mjx-c><mjx-c class="mjx-c70"></mjx-c><mjx-c class="mjx-c6F"></mjx-c><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-c74"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c64"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c52"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c71"></mjx-c><mjx-c class="mjx-c75"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c73"></mjx-c><mjx-c class="mjx-c74"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mrow space="2"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c55"></mjx-c><mjx-c class="mjx-c52"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>001</mn></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">b</mi></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">Unsupported</mi></mrow></mrow><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">Request</mi></mrow></mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">UR</mi></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> 010b = Config Req Retry Status (CR S) <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="329" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>100</mn></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> = Completer abort. (CA) others: reserved. See “Summary of Completion Status Codes:” on page 187.</td></tr><tr><td>Completer ID 15:0</td><td>Byte 5 Bit 7:0 Byte 4 Bit 7:0</td><td>Identifies the completer. While not needed for routing a completion, this information may be useful if debugging bus traffic. Byte 4 7:0 = Completer Bus # Byte 5 7:3 = Completer Dev # Byte 5 2:0 = Completer Function #</td></tr><tr><td>Lower Address 6:0</td><td>Byte 11 Bit 6:0</td><td>The lower 7 bits of address for the first enabled byte of data returned with a read. Calculated from request Length and Byte enables, it is used to determine next legal Read Completion Boundary. See “Calculating Lower Address Field” on page 187.</td></tr><tr><td>Tag 7:0</td><td>Byte 10 Bit 7:0</td><td>These bits are set to reflect the Tag received with the request. The requester uses them to associate inbound comple- tion with an outstanding request.</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="240" id="mark-745c68a2-b83a-466d-b4e2-5680a361be75" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 4-9: Completion Header Fields</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Field Name</th><th>Header Byte/Bit</th><th>Function</th></tr></thead><tbody><tr><td>Requester ID 15:0</td><td>Byte 9 Bit 7:0 Byte 8 Bit 7:0</td><td>Copied from the request into this field to be used in routing the completion back to the original requester. Byte 4, 7:0 = Requester Bus # Byte 5, 7:3 = Requester Device # Byte 5, 2:0 = Requester Function #</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div>Summary of Completion Status Codes: (Refer to Completion Status field in table Table 4-9 on page 185).</div></div></div><div><div><div></div></div></div><div><ul><li>000b (SC) Successful Completion code indicates the original request completed properly at the target.</li></ul></div><div><div><div></div></div></div><div><ul><li>001b (UR) Unsupported Request code indicates original request failed at the target because it targeted an unsupported address, carried an unsupported address or request, etc. This is handled as an uncorrectable error. See the "Unsupported Request" on page 365 for details.</li></ul></div><div><div><div></div></div></div><div><ul><li>010b (CRS) Configuration Request Retry Status indicates target was temporarily off-line and the attempt should be retried. (e.g. initialization delay after reset, etc.).</li></ul></div><div><div><div></div></div></div><div><ul><li>100b (CA) Completer Abort code indicates that completer is off-line due to an error (much like target abort in PCI). The error will be logged and handled as an uncorrectable error.</li></ul></div><div><div><div></div></div></div><div><div><div>Calculating The Lower Address Field (Byte 11, bits 7:0): Refer to the Lower Address field in Table 4-9 on page 185. The Lower Address field is set up by the completer during completions with data (CplD) to reflect the address of the first enabled byte of data being returned in the completion payload. This must be calculated in hardware by considering both the DW start address and the byte enable pattern in the First DW Byte Enable field provided in the original request. Basically, the address is an offset from the DW start address:</div></div></div><div><div><div></div></div></div><div><ul><li>If the First DW Byte Enable field is 1111b, all bytes are enabled in the first DW and the offset is 0 . The byte start address is <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="330" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo></math></mjx-assistive-mml></mjx-container> DW start address.</li></ul></div><div><div><div></div></div></div><div><ul><li>If the First DW Byte Enable field is <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="331" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>1110</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> ,the upper three bytes are enabled in the first DW and the offset is 1 . The byte start address is <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="332" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo></math></mjx-assistive-mml></mjx-container> DW start address +1 . PCI Express System Architecture</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="241" id="mark-c2047181-e724-4f0e-b0d7-0054184b7e11" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><ul><li>If the First DW Byte Enable field is 1100b, the upper two bytes are enabled in the first DW and the offset is 2 . The byte start address is <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="333" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo></math></mjx-assistive-mml></mjx-container> DW start address + 2.</li></ul></div><div><div><div></div></div></div><div><ul><li>If the First DW Byte Enable field is 1000b, only the upper byte is enabled in the first DW and the offset is 3 . The byte start address is <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="334" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo></math></mjx-assistive-mml></mjx-container> DW start address + 3.</li></ul></div><div><div><div></div></div></div><div><div><div>Once calculated, the lower 7 bits are placed in the Lower Address field of the completion header in the event the start address was not aligned on a Read Completion Boundary (RCB) and the read completion must break off at the first RCB. Knowledge of the RCB is necessary because breaking a transaction must be done on RCBs which are based on start address-not transfer size.</div></div></div><div><div><div></div></div></div><div><div><div>Using The Byte Count Modified Bit. Refer to the Byte Count Modified Bit in Table 4-9 on page 185. This bit is only set by a PCI-X completer (e.g. a bridge from PCI Express to PCI-X) in a particular circumstance. Rules for its assertion include:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">It is only set <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="335" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> by a PCI-X completer if a read request is going to be broken into multiple completions</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">The BCM bit is only set for the first completion of the series. It is set to indicate that the first completion contains a Byte Count field that reflects the first completion payload rather than the total remaining (as it would in normal PCI Express protocol). The receiver then recognizes that the completion will be followed by others to satisfy the original request as required.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">For the second and any other completions in the series, the BCM bit must be deasserted and the Byte Count field will reflect the total remaining count-- just as in normal PCI Express protocol.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">PCI Express devices receiving completions with the BCM bit set must interpret this case properly.</li></ol></div><div><div><div></div></div></div><div><ol><li value="5">The Lower Address field is set up by the completer during completions with data (CplD) to reflect the address of the first enabled byte of data being returned</li></ol></div><div><div><div></div></div></div><h2><div><div>Data Returned For Read Requests:</div></div></h2><div><div><div></div></div></div><div><ol><li value="1">Completions for read requests may be broken into multiple completions, but total data transfer must equal size of original request</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">Completions for multiple requests may not be combined</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">IO and Configuration reads are always 1 DW, so will always be satisfied with a single completion</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">A completion with a Status Code other than SC (successful completion) terminates a transaction.</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="242" id="mark-ff0cdf50-377d-43aa-ac78-3f2d7438898a" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><ol><li value="5">The Read Completion Boundary (RCB) must be observed when handling a read request with multiple completions. The RCB is 64 bytes or 128 bytes for the root complex; the value used should be visible in a configuration register.</li></ol></div><div><div><div></div></div></div><div><ol><li value="6">Bridges and endpoints may implement a bit for selecting the RCB size (64 or 128 bytes) under software control.</li></ol></div><div><div><div></div></div></div><div><ol><li value="7">Completions that do not cross an aligned RCB boundary must complete in one transfer.</li></ol></div><div><div><div></div></div></div><div><ol><li value="8">Multiple completions for a single read request must return data in increasing address order.</li></ol></div><div><div><div></div></div></div><h2><div><div>Receiver Completion Handling Rules:</div></div></h2><div><div><div></div></div></div><div><ol><li value="1">A completion received without a match to an outstanding request is an Unexpected Completion. It will be handled as an error.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">Completions with a completion status other than Successful Completion (SC) or Configuration Request Retry Status (CRS) will be handled as an error and buffer space associated with them will be released.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">When the Root Complex receivers a CRS status during a configuration cycle, its handling of the event is not defined except after reset (when a period is defined when it must allow it).</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">If CRS is received for a request other than configuration, it is handled as a Malformed TLP.</li></ol></div><div><div><div></div></div></div><div><ol><li value="5">Completions received with status <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="336" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo></math></mjx-assistive-mml></mjx-container> a reserved code alias to Unsupported Requests.</li></ol></div><div><div><div></div></div></div><div><ol><li value="6">If a read completion is received with a status other than Successful Completion (SC), no data is received with the completion and a CPI (or CpILk) is returned in place of a CplD (or CplDLk).</li></ol></div><div><div><div></div></div></div><div><ol><li value="7">In the event multiple completions are being returned for a read request, a completion status other than Successful Completion (SC) immediately ends the transaction. Device handling of data received prior to the error is implementation-specific.</li></ol></div><div><div><div></div></div></div><div><ol><li value="8">In maintaining compatibility with PCI, a Root Complex may be required to synthesize a read value of a "1 's" when a configuration cycle ends with a completion indicating an Unsupported Request. (This is analogous to master aborts which occur when PCI enumeration probes devices which are not in the system).</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="243" id="mark-16b33818-d084-41ab-a2bb-f94022faac65" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><h2><div><div>Message Requests</div></div></h2><div><div><div></div></div></div><div><div><div>Message requests replace many of the interrupt, error, and power management sideband signals used on earlier bus protocols. All message requests use the 4DW header format, and are handled much the same as posted memory write transactions. Messages may be routed using address, ID, or implicit routing. The routing subfield in the packet header indicates the routing method to apply, and which additional header registers are in use (address registers, etc.). Figure 4-11 on page 190 depicts the message request header format.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 4-11: 4DW Message Request Header Format</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_249.jpg?x=220&amp;y=710&amp;w=1002&amp;h=861"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="244" id="mark-8a23354f-53aa-472f-aaf9-11bd2674a06e" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Definitions Of Message Request Header Fields. Table 4-10 on page 191 describes the location and use of each field in a message request header.</div></div></div><div><div><div></div></div></div><div><div><div>Table 4-10: Message Request Header Fields</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Field Name</th><th>Header Byte/Bit</th><th>Function</th></tr></thead><tbody><tr><td>Length 9:0</td><td>Byte 3 Bit 7:0 Byte 2 Bit 1:0</td><td>Indicates data payload size in DW. For message requests, this field is always 0 (no data) or 1 (one DW of data)</td></tr><tr><td>Attr 1:0 (Attributes)</td><td>Byte 2 Bit 5:4</td><td>Attribute 1: Relaxed Ordering Bit Attribute 0: No Snoop Bit Both of these bits are always <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="337" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>0</mn></math></mjx-assistive-mml></mjx-container> in message requests.</td></tr><tr><td>EP</td><td>Byte 2 Bit 6</td><td>If <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="338" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> ,indicates the data payload (if present) is poisoned.</td></tr><tr><td>TD</td><td>Byte 2 Bit 7</td><td>If <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="339" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> ,indicates the presence of a digest field (1 DW) at the end of the TLP (preceding LCRC and END)</td></tr><tr><td>TC 2:0 (Transfer Class)</td><td>Byte 2 Bit 6:4</td><td>Indicates transfer class for the packet. TC is = 0 for all message requests.</td></tr><tr><td>Type 4:0</td><td>Byte 0 Bit 4:0</td><td>TLP packet type field. Set to: Bit 4:3: <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="340" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c73"></mjx-c><mjx-c class="mjx-c67"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">b</mi></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">Msg</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> Bit 2:0 (Message Routing Subfield) <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="341" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>000</mn></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> = Routed to Root Complex <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="342" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>001</mn></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">b</mi></mrow><mo>=</mo></math></mjx-assistive-mml></mjx-container> Routed by address <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="343" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>010</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mo>=</mo></math></mjx-assistive-mml></mjx-container> Routed by ID <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="344" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>011</mn></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">b</mi></mrow><mo>=</mo></math></mjx-assistive-mml></mjx-container> Root Complex Broadcast Msg <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="345" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>100</mn></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">b</mi></mrow><mo>=</mo></math></mjx-assistive-mml></mjx-container> Local; terminate at receiver <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="346" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>101</mn></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">b</mi></mrow><mo>=</mo></math></mjx-assistive-mml></mjx-container> Gather/route to Root Complex 0thers = reserved</td></tr><tr><td>Fmt 1:0 (Format)</td><td>Byte 0 Bit 6:5</td><td>Packet Format. Always a 4DW header <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="347" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>01</mn></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> = message request without data 11b = message request with data</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="245" id="mark-5b6f5131-0f68-4c1b-b25c-edb6d421b4c8" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 4-10: Message Request Header Fields</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Field Name</th><th>Header Byte/Bit</th><th>Function</th></tr></thead><tbody><tr><td>Message Code 7:0</td><td>Byte 7 Bit 7:0</td><td>This field contains the code indicating the type of message being sent. 0000 0000b = Unlock Message <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="348" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c78"></mjx-c><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c78"></mjx-c><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>0001</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">xx</mi></mrow></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">xx</mi></mrow></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">b</mi></mrow><mo>=</mo></math></mjx-assistive-mml></mjx-container> Power Mgmt Message 0010 0xxxb = INTx Message 0011 00xxb = Error Message 0100 xxxxb = Hot Plug Message 0101 0000b = Slot Power Message 0111 111xb = Vendor Type 0 Message 0111 1111b = Vendor Type 1 Message</td></tr><tr><td>Tag 7:0</td><td>Byte 6 Bit 7:0</td><td>As all message requests are posted, no tag is assigned to them. These bits should be <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="349" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>0</mn></math></mjx-assistive-mml></mjx-container> .</td></tr><tr><td>Requester ID 15:0</td><td>Byte 5 Bit 7:0 Byte 4 Bit 7:0</td><td>Identifies the requester sending the message. Byte 4, 7:0 = Requester Bus # Byte 5, 7:3 = Requester Device # Byte 5, 2:0 = Requester Function #</td></tr><tr><td>Address 31:2</td><td>Byte 11 Bit 7:2 Byte 10 Bit 7:0 Byte 9 Bit 7:0 Byte 8 Bit 7:0</td><td>If address routing was selected for the message (see Type 4:0 field above), then this field contains the lower part of the 64-bit starting address. Other- wise, this field is not used.</td></tr><tr><td>Address 63:32</td><td>Byte 15 Bit 7:2 Byte 14 Bit 7:0 Byte 13 Bit 7:0 Byte 12 Bit 7:0</td><td>If address routing was selected for the message (see Type 4:0 field above), then this field contains the upper 32 bits of the 64 bit starting address. Oth- erwise, this field is not used.</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="246" id="mark-597c9b0e-bfe3-4d57-b5c5-3eae5f62943a" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Message Notes: The following tables specify the message coding used for each of the seven message groups, and is based on the message code field listed in Table 4-10 on page 191. The defined groups include:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">INTx Interrupt Signaling</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">Power Management</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">Error Signaling</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">Lock Transaction Support</li></ol></div><div><div><div></div></div></div><div><ol><li value="5">Slot Power Limit Support</li></ol></div><div><div><div></div></div></div><div><ol><li value="6">Vendor Defined Messages</li></ol></div><div><div><div></div></div></div><div><ol><li value="7">Hot Plug Signaling</li></ol></div><div><div><div></div></div></div><div><div><div>INTx Interrupt Signaling. While many devices are capable of using the PCI 2.3 Message Signaled Interrupt (MSI) method of delivering interrupts, some devices may not support it. PCI Express defines a virtual wire alternative in which devices simulate the assertion and deassertion of the INTx (INTA-INTD) interrupt signals seen in PCI-based systems. Basically, a message is sent to inform the upstream device an interrupt has been asserted. After servicing, the device which sent the interrupt sends a second message indicating the virtual interrupt signal is being released. Refer to the "Message Signaled Interrupts" on page 331 for details. Table 4-11 summarizes the INTx message coding at the packet level.</div></div></div><div><div><div></div></div></div><div><div><div>Table 4-11: INTx Interrupt Signaling Message Coding</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>INTx Message</th><th>Message Code 7:0</th><th>Routing 2:0</th></tr></thead><tbody><tr><td>Assert_INTA</td><td>0010 0000b</td><td>100b</td></tr><tr><td>Assert_INTB</td><td>0010 0001b</td><td>100b</td></tr><tr><td>Assert_INTC</td><td>0010 0010b</td><td>100b</td></tr><tr><td>Assert_INTD</td><td>0010 0011b</td><td>100b</td></tr><tr><td>Deassert_INTA</td><td>0010 0100b</td><td>100b</td></tr><tr><td>Deassert_INTB</td><td>0010 0101b</td><td>100b</td></tr><tr><td>Deassert_INTC</td><td>0010 0110b</td><td>100b</td></tr><tr><td>Deassert_INTD</td><td>0010 0111b</td><td>100b</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="247" id="mark-cb6a0a2e-a436-47e0-a5f3-4ed63dbf725e" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><h2><div><div>Other INTx Rules:</div></div></h2><div><div><div></div></div></div><div><ol><li value="1">The INTx Message type does not include a data payload. The Length field is reserved.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">Assert_INTx and Deassert_INTx are only issued by upstream ports. Checking violations of this rule is optional. If checked, a TLP violation is handled as a Malformed TLP.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">These messages are required to use the default traffic class, TC0. Receivers must check for violation of this rule (handled as Malformed TLPs).</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">Components at both ends of the link must track the current state of the four virtual interrupts. If the logical state of one of the interrupts changes at the upstream port, the port must send the appropriate INTx message to the downstream port on the same link.</li></ol></div><div><div><div></div></div></div><div><ol><li value="5">INTx signaling is disabled when the Interrupt Disable bit of the Command Register is set <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="350" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> (just as it would be if physical interrupt lines are used).</li></ol></div><div><div><div></div></div></div><div><ol><li value="6">If any virtual INTx signals are active when the Interrupt Disable bit is set in the device, the device must transmit a corresponding Deassert_INTx message onto the link.</li></ol></div><div><div><div></div></div></div><div><ol><li value="7">Switches must track the state of the four INTx signals independently for each downstream port and combine the states for the upstream link.</li></ol></div><div><div><div></div></div></div><div><ol><li value="8">The Root Complex must track the state of the four INTx lines independently and convert them into system interrupts in a system-specific way.</li></ol></div><div><div><div></div></div></div><div><ol><li value="9">Because of switches in the path, the Requester ID in an INTx message may be the last transmitter, not the original requester.</li></ol></div><div><div><div></div></div></div><div><div><div>Power Management Messages. PCI Express is compatible with PCI power management, and adds the PCI Express active link management mechanism. Refer to Chapter 16, entitled "Power Management," on page 567 for a description of power management. Table 4-12 on page 194 summarizes the four power management message types.</div></div></div><div><div><div></div></div></div><div><div><div>Table 4-12: Power Management Message Coding</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Power Management Message</th><th>Message Code 7:0</th><th>Routing 2:0</th></tr></thead><tbody><tr><td>PM_Active_State_Nak</td><td>0001 0100b</td><td>100b</td></tr><tr><td>PM_PME</td><td>0001 1000b</td><td>000b</td></tr><tr><td>PM_Turn_Off</td><td>0001 1001b</td><td>011b</td></tr><tr><td>PME_TO_Ack</td><td>0001 1011b</td><td>101b</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="248" id="mark-6aa44453-073f-4ec9-a9b3-9f49648e613d" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Other Power Management Message Rules:</div></div></h2><div><div><div></div></div></div><div><ol><li value="1">Power Management Message type does not include a data payload. The Length field is reserved.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">These messages are required to use the default traffic class, TC0. Receivers must check for violation of this rule (handled as Malformed TLPs).</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">PM_PME is sent upstream by component requesting event.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">PM_Turn_Off is broadcast downstream</li></ol></div><div><div><div></div></div></div><div><ol><li value="5">PME_TO_Ack is sent upstream by endpoint. For switch with devices attached to multiple downstream ports, this message won't be sent upstream until all it is first received from all downstream ports.</li></ol></div><div><div><div></div></div></div><div><div><div>Error Messages. Error messages are sent upstream by enabled devices that detect correctable, non-fatal uncorrectable, and fatal non-correctable errors. The device detecting the error is defined by the Requester ID field in the message header. Table 4-13 on page 195 describes the three error message types.</div></div></div><div><div><div></div></div></div><div><div><div>Table 4-13: Error Message Coding</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Error Message</th><th>Message Code 7:0</th><th>Routing 2:0</th></tr></thead><tbody><tr><td>ERR_COR</td><td>0011 0000b</td><td>000b</td></tr><tr><td>ERR_NONFATAL</td><td>0011 0001b</td><td>000b</td></tr><tr><td>ERR_FATAL</td><td>0011 0011b</td><td>000b</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>Other Error Signaling Message Rules:</div></div></h2><div><div><div></div></div></div><div><ol><li value="1">These messages are required to use the default traffic class, TC0. Receivers must check for violation of this rule (handled as Malformed TLPs).</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">This message type does not include a data payload. The Length field is reserved.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">The Root Complex converts error messages into system-specific events.</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="249" id="mark-bfdbb7b4-310a-46e2-9153-0901c451667a" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Unlock Message. The Unlock message is sent to a completer to release it from lock as part of the PCI Express Locked Transaction sequence. Table 4-14 on page 196 summarizes the coding for this message.</div></div></div><div><div><div></div></div></div><div><div><div>Table 4-14: Unlock Message Coding</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Unlock Message</th><th>Message Code 7:0</th><th>Routing 2:0</th></tr></thead><tbody><tr><td>Unlock</td><td>0000 0000b</td><td>011b</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>Other Unlock Message Rules:</div></div></h2><div><div><div></div></div></div><div><ol><li value="1">These messages are required to use the default traffic class, TC0. Receivers must check for violation of this rule (handled as Malformed TLPs).</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">This message type does not include a data payload. The Length field is reserved.</li></ol></div><div><div><div></div></div></div><div><div><div>Slot Power Limit Message. This message is sent from a downstream switch or Root Complex port to the upstream port of the device attached to it. It conveys a slot power limit which the downstream device then copies into the Device Capabilities Register for its upstream port. Table 4-15 summarizes the coding for this message.</div></div></div><div><div><div></div></div></div><div><div><div>Table 4-15: Slot Power Limit Message Coding</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Unlock Message</th><th>Message Code 7:0</th><th>Routing 2:0</th></tr></thead><tbody><tr><td>Set_Slot_Power_Limit</td><td>0101 0000b</td><td>100b</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>Other Set_Slot_Power_Limit Message Rules:</div></div></h2><div><div><div></div></div></div><div><ol><li value="1">These messages are required to use the default traffic class, TC0. Receivers must check for violation of this rule (handled as Malformed TLPs).</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">This message type carries a data payload of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="351" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c44"></mjx-c><mjx-c class="mjx-c57"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">DW</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> . The Length field is set <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="352" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo></math></mjx-assistive-mml></mjx-container> 1. Only the lower 10 bits of the 32-bit data payload is used for slot power scaling; the upper bits in the data payload must be set <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="353" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>0</mn></math></mjx-assistive-mml></mjx-container> .</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">This message is sent automatically anytime the link transitions to DL_Up status or if a configuration write to the Slot Capabilities Register occurs when the Data Link Layer reports DL_Up status.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">If a card in a slot consumes less power than the power limit specified for the card/form factor, it may ignore the message.</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="250" id="mark-0b7881a3-094f-4ccb-986f-e00441694d5f" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Hot Plug Signaling Message. These messages are passed between downstream ports of switches and Root Ports that support Hot Plug Event signaling. Table 4-16 summarizes the Hot Plug message types.</div></div></div><div><div><div></div></div></div><div><div><div>Table 4-16: Hot Plug Message Coding</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Error Message</th><th>Message Code 7:0</th><th>Routing 2:0</th></tr></thead><tbody><tr><td>Attention_Indicator_On</td><td>0100 0001b</td><td>100b</td></tr><tr><td>Attention_Indicator_Blink</td><td>0100 0011b</td><td>100b</td></tr><tr><td>Attention_Indicator_Off</td><td>0100 0000b</td><td>100b</td></tr><tr><td>Power_Indicator_On</td><td>0100 0101b</td><td>100b</td></tr><tr><td>Power_Indicator_Blink</td><td>0100 0111b</td><td>100b</td></tr><tr><td>Power_Indicator_Off</td><td>0100 0100b</td><td>100b</td></tr><tr><td>Attention_Button_Pressed</td><td>0100 1000b</td><td>100b</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>Other Hot Plug Message Rules:</div></div></h2><div><div><div></div></div></div><div><ul><li>The Attention and Power indicator messages are all driven by the switch/ root complex port to the card.</li></ul></div><div><div><div></div></div></div><div><ul><li>The Attention Button message is driven upstream by a slot device that implements a switch.</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="251" id="mark-43aa9ea7-51de-43e4-9657-d35182cc6f5f" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><h2><div><div>Data Link Layer Packets</div></div></h2><div><div><div></div></div></div><div><div><div>The primary responsibility of the PCI Express Data Link Layer is to assure that integrity is maintained when TLPs move between two devices. It also has link initialization and power management responsibilities, including tracking of the link state and passing messages and status between the Transaction Layer above and the Physical Layer below.</div></div></div><div><div><div></div></div></div><div><div><div>In performing its role, the Data Link Layer exchanges traffic with its neighbor using Data Link Layer Packets (DLLPs). DLLPs originate and terminate at the Data Link Layer of each device, without involvement of the Transaction Layer. DLLPs and TLPs are interleaved on the link. Figure 4-12 on page 198 depicts the transmission of a DLLP from one device to another.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 4-12: Data Link Layer Sends A DLLP</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_257.jpg?x=218&amp;y=894&amp;w=1007&amp;h=699"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="252" id="mark-65e8b733-3337-4fdf-bbbc-28dbb18c3a4c" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Types Of DLLPs</div></div></h2><div><div><div></div></div></div><div><div><div>There are three important groups of DLLPs used in managing a link:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">TLP Acknowledgement Ack/Nak DLLPs</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">Power Management DLLPs</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">Flow Control Packet DLLPs</li></ol></div><div><div><div></div></div></div><div><div><div>In addition, the specification defines a vendor-specific DLLP.</div></div></div><div><div><div></div></div></div><h2><div><div>DLLPs Are Local Traffic</div></div></h2><div><div><div></div></div></div><div><div><div>DLLPs have a simple packet format. Unlike TLPs, they carry no target information because they are used for nearest-neighbor communications only.</div></div></div><div><div><div></div></div></div><h2><div><div>Receiver handling of DLLPs</div></div></h2><div><div><div></div></div></div><div><div><div>The following rules apply when a DLLP is sent from transmitter to receiver:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">As DLLPs arrive at the receiver, they are immediately processed. They cannot be flow controlled.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">All received DLLPs are checked for errors. This includes a control symbol check at the Physical Layer after deserialization, followed by a CRC check at the receiver Data Link Layer. A 16 bit CRC is calculated and sent with the packet by the transmitter; the receiver calculates its own DLLP checksum and compares it to the received value.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">Any DLLPs that fail the CRC check are discarded. There are several reportable errors associated with DLLPs.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">Unlike TLPs, the is no acknowledgement protocol for DLLPs. The PCI Express specification has time-out mechanisms which are intended to allow recovery from lost or discarded DLLPs.</li></ol></div><div><div><div></div></div></div><div><ol><li value="5">Assuming no errors occur, the DLLP type is determined and it is passed to the appropriate internal logic:</li></ol></div><div><div><div></div></div></div><div><ul><li>Power Management DLLPs are passed to the device power management logic</li></ul></div><div><div><div></div></div></div><div><ul><li>Flow Control DLLPs are passed to the Transaction Layer so credits may be updated.</li></ul></div><div><div><div></div></div></div><div><ul><li>Ack/Nak DLLPs are routed to the Data Link Layer transmit interface so TLPs in the retry buffer may be discarded or resent.</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="253" id="mark-8ad439a3-4396-40ef-858d-4f1fd14048e1" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Sending A Data Link Layer Packet</div></div></h2><div><div><div></div></div></div><div><div><div>DLLPs are assembled on the transmit side and disassembled on the receiver side of a link. These packets originate at the Data Link Layer and are passed to the Physical Layer. There, framing symbols are added before the packet is sent. Figure 4-13 on page 200 depicts a generic DLLP in transit from Device B to Device A.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 4-13: Generic Data Link Layer Packet Format</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_259.jpg?x=220&amp;y=726&amp;w=998&amp;h=854"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="254" id="mark-a79329c2-b4d6-42cd-ab86-d8ab6ca1007c" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Chapter 4: Packet-Based Transactions</div></div></h2><div><div><div></div></div></div><h2><div><div>Fixed DLLP Packet Size: 8 Bytes</div></div></h2><div><div><div></div></div></div><div><div><div>All Data Link Layer Packets consist of the following components:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">A 1 DW core (4 bytes) consisting of the one byte Type field and three additional bytes of attributes. The attributes vary with the DLLP type.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">A 16 bit CRC value which is calculated based on the DW core contents, then appended to it.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">These 6 bytes are then passed to the Physical Layer where a Start Of DLLP (SDP) control symbol and an End Of Packet (END) control symbol are added to it. Before transmission, the Physical Layer encodes the 8 bytes of information into eight 10-bit symbols for transmission to the receiver.</li></ol></div><div><div><div></div></div></div><div><div><div>Note that there is never a data payload with a DLLP; all information of interest is carried in the Type and Attribute fields.</div></div></div><div><div><div></div></div></div><h2><div><div>DLLP Packet Types</div></div></h2><div><div><div></div></div></div><div><div><div>The three groups of DLLPs are defined with a number of variants. Table 4-17 summarizes each variant as well as their DLLP Type field coding.</div></div></div><div><div><div></div></div></div><div><div><div>Table 4-17: DLLP Packet Types</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>DLLP Type</th><th>Type Field Encoding</th><th>Purpose</th></tr></thead><tbody><tr><td>Ack (TLP Acknowledge)</td><td>0000 0000b</td><td>TLP transmission integrity</td></tr><tr><td>Nak (TLP No Acknowledge)</td><td>0001 0000b</td><td>TLP transmission integrity</td></tr><tr><td>PM_Enter_L1</td><td>0010 0000b</td><td>Power Management</td></tr><tr><td>PM_Enter_L23</td><td>0010 0001b</td><td>Power Management</td></tr><tr><td>PM_Active_State_Request_L1</td><td>0010 0011b</td><td>Power Management</td></tr><tr><td>PM_Request_Ack</td><td>0010 0100b</td><td>Power Management</td></tr><tr><td>Vendor Specific</td><td>0011 0000b</td><td>Vendor</td></tr><tr><td>InitFC1-P<mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="354" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c78"></mjx-c><mjx-c class="mjx-c78"></mjx-c><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c56"></mjx-c><mjx-c class="mjx-c43"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mi class="mjx-n"><mjx-c class="mjx-c23"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">xxx</mi></mrow></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">VC</mi></mrow></mrow><mi mathvariant="normal">#</mi></math></mjx-assistive-mml></mjx-container></td><td>0100 0xxxb</td><td>TLP Flow Control</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="255" id="mark-14b48482-7a6e-4f72-8601-bd3d525165f8" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 4-17: DLLP Packet Types</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th colspan="2">DLLP Type</th><th>Type Field Encoding</th><th>Purpose</th></tr></thead><tbody><tr><td>InitFC1-NP</td><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="355" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c78"></mjx-c><mjx-c class="mjx-c78"></mjx-c><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c56"></mjx-c><mjx-c class="mjx-c43"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mi class="mjx-n"><mjx-c class="mjx-c23"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">xxx</mi></mrow></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">VC</mi></mrow></mrow><mi mathvariant="normal">#</mi></math></mjx-assistive-mml></mjx-container></td><td>0101 0xxxb</td><td>TLP Flow Control</td></tr><tr><td>InitFC1-Cpl</td><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="356" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c78"></mjx-c><mjx-c class="mjx-c78"></mjx-c><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c56"></mjx-c><mjx-c class="mjx-c43"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mi class="mjx-n"><mjx-c class="mjx-c23"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">xxx</mi></mrow></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">VC</mi></mrow></mrow><mi mathvariant="normal">#</mi></math></mjx-assistive-mml></mjx-container></td><td>0110 0xxxb</td><td>TLP Flow Control</td></tr><tr><td>InitFC2-P</td><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="357" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c78"></mjx-c><mjx-c class="mjx-c78"></mjx-c><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c56"></mjx-c><mjx-c class="mjx-c43"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mi class="mjx-n"><mjx-c class="mjx-c23"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">xxx</mi></mrow></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">VC</mi></mrow></mrow><mi mathvariant="normal">#</mi></math></mjx-assistive-mml></mjx-container></td><td>1100 0xxxb</td><td>TLP Flow Control</td></tr><tr><td>InitFC2-NP</td><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="358" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c78"></mjx-c><mjx-c class="mjx-c78"></mjx-c><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c56"></mjx-c><mjx-c class="mjx-c43"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mi class="mjx-n"><mjx-c class="mjx-c23"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">xxx</mi></mrow></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">VC</mi></mrow></mrow><mi mathvariant="normal">#</mi></math></mjx-assistive-mml></mjx-container></td><td>1101 0xxxb</td><td>TLP Flow Control</td></tr><tr><td>InitFC2-Cpl</td><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="359" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c78"></mjx-c><mjx-c class="mjx-c78"></mjx-c><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c56"></mjx-c><mjx-c class="mjx-c43"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mi class="mjx-n"><mjx-c class="mjx-c23"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">xxx</mi></mrow></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">VC</mi></mrow></mrow><mi mathvariant="normal">#</mi></math></mjx-assistive-mml></mjx-container></td><td>1110 0xxxb</td><td>TLP Flow Control</td></tr><tr><td>UpdateFC-P</td><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="360" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c78"></mjx-c><mjx-c class="mjx-c78"></mjx-c><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c56"></mjx-c><mjx-c class="mjx-c43"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mi class="mjx-n"><mjx-c class="mjx-c23"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">xxx</mi></mrow></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">VC</mi></mrow></mrow><mi mathvariant="normal">#</mi></math></mjx-assistive-mml></mjx-container></td><td>1000 0xxxb</td><td>TLP Flow Control</td></tr><tr><td>UpdateFC-NP</td><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="361" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c78"></mjx-c><mjx-c class="mjx-c78"></mjx-c><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c56"></mjx-c><mjx-c class="mjx-c43"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mi class="mjx-n"><mjx-c class="mjx-c23"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">xxx</mi></mrow></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">VC</mi></mrow></mrow><mi mathvariant="normal">#</mi></math></mjx-assistive-mml></mjx-container></td><td>1001 0xxxb</td><td>TLP Flow Control</td></tr><tr><td>UpdateFC-Cpl</td><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="362" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c78"></mjx-c><mjx-c class="mjx-c78"></mjx-c><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c56"></mjx-c><mjx-c class="mjx-c43"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mi class="mjx-n"><mjx-c class="mjx-c23"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">xxx</mi></mrow></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">VC</mi></mrow></mrow><mi mathvariant="normal">#</mi></math></mjx-assistive-mml></mjx-container></td><td>1010 0xxxb</td><td>TLP Flow Control</td></tr><tr><td colspan="2">Reserved</td><td>Others</td><td>Reserved</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>Ack Or Nak DLLP Packet Format</div></div></h2><div><div><div></div></div></div><div><div><div>The format of the DLLP used by a receiver to Ack or Nak the delivery of a TLP is illustrated in Figure 4-14.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 4-14: Ack Or Nak DLLP Packet Format</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_261.jpg?x=230&amp;y=1280&amp;w=989&amp;h=351"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="256" id="mark-6a586ab2-38f3-42d4-a984-8f291b7374e3" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Definitions Of Ack Or Nak DLLP Fields. Table 4-18 describes the</div></div></div><div><div><div></div></div></div><div><div><div>fields contained in an Ack or Nak DLLP.</div></div></div><div><div><div></div></div></div><div><div><div>Table 4-18: Ack or Nak DLLP Fields</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Field Name</th><th>Header Byte/Bit</th><th>DLLP Function</th></tr></thead><tbody><tr><td>AckNak_Seq_Num [11:0]</td><td>Byte 3 Bit 7:0 Byte 2 Bit 3:0</td><td>For an ACK DLLP: - For good TLPs received with Sequence Number = NEXT_RCV_SEQ count (count before incrementing), use NEXT_RCV_SEQ count - 1 (count after incrementing minus <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="363" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn></math></mjx-assistive-mml></mjx-container> ). - For TLP received with Sequence Num- ber earlier than NEXT_RCV_SEQ count (duplicate TLP), use NEXT_RCV_SEQ count - 1 For a NAK DLLP: - Associated with a TLP that failed the CRC check, use NEXT_RCV_SEQ count -  <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="364" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn></math></mjx-assistive-mml></mjx-container> . - For a TLP received with Sequence Number later than NEXT_RCV_SEQ count, use NEXT_RCV_SEQ count - 1. Upon receipt, the transmitter will purge TLPs with equal to and earlier Sequence Numbers and replay the remainder TLPs.</td></tr><tr><td>Type 7:0</td><td>Byte 0 Bit 7:0</td><td>Indicates the type of DLLP. For the Ack/ Nak DLLPs: - 00000000b = ACK DLLP. - 0001 0000b = NAK DLLP.</td></tr><tr><td>16-bit CRC</td><td>Byte 5 Bit 7:0 Byte 4 Bit 7:0</td><td>16-bit CRC used to protect the contents of this DLLP. Calculation is made on Bytes 0- 3 of the ACK/NAK.</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="257" id="mark-2c6d3aaa-ad52-4fa8-be9b-c489a76badfb" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><h2><div><div>Power Management DLLP Packet Format</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express power management DLLPs and TLPs replace most signals associated with power management state changes. The format of the DLLP used for power management is illustrated in Figure 4-15.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 4-15: Power Management DLLP Packet Format</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_263.jpg?x=231&amp;y=648&amp;w=984&amp;h=349"></div></div><div><div><div></div></div></div><h2><div><div>Definitions Of Power Management DLLP Fields.</div></div></h2><div><div><div></div></div></div><div><div><div>Table 4-19</div></div></div><div><div><div></div></div></div><div><div><div>describes the fields contained in a Power Management DLLP.</div></div></div><div><div><div></div></div></div><div><div><div>Table 4-19: Power Management DLLP Fields</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Field Name</th><th>Header Byte/Bit</th><th>DLLP Function</th></tr></thead><tbody><tr><td>Type 7:0</td><td>Byte 0 Bit 7:0</td><td>This field indicates type of DLLP. For the Power Man- agement DLLPs: 0010 0000b = PM_Enter_L1 0010 0001b = PM_Enter_L2 0010 0011b = PM_Active_State_Request 0010 0100b = PM_Request_Ack</td></tr><tr><td>Link CRC</td><td>Byte 5 Bit 7:0 Byte 4 Bit 7:0</td><td>16 Bit CRC sent to protect the contents of this DLLP. Calculation is made on Bytes 0-3, regardless of whether fields are used.</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="258" id="mark-23799b8e-1fe9-4f0c-88d8-c1b4c9ef2679" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Chapter 4: Packet-Based Transactions</div></div></h2><div><div><div></div></div></div><h2><div><div>Flow Control Packet Format</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express eliminates many of the inefficiencies of earlier bus protocols through the use of a credit-based flow control scheme. This topic is covered in detail in Chapter 7, entitled "Flow Control," on page 285. Three slightly different DLLPs are used to initialize the credits and to update them as receiver buffer space becomes available. The two flow control initialization packets are referred to as InitFC1 and InitFC2. The Update DLLP is referred to as UpdateFC.</div></div></div><div><div><div></div></div></div><div><div><div>The generic DLLP format for all three flow control DLLP variants is illustrated in Figure 4-16 on page 205.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 4-16: Flow Control DLLP Packet Format</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_264.jpg?x=240&amp;y=835&amp;w=953&amp;h=338"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="259" id="mark-fd143e36-de01-4dcc-8dae-4c813256f840" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Definitions Of Flow Control DLLP Fields. Table 4-20 on page 206</div></div></div><div><div><div></div></div></div><div><div><div>describes the fields contained in a flow control DLLP.</div></div></div><div><div><div></div></div></div><div><div><div>Table 4-20: Flow Control DLLP Fields</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Field Name</th><th>Header Byte/Bit</th><th>DLLP Function</th></tr></thead><tbody><tr><td>DataFC 11:0</td><td>Byte 3 Bit 7:0 Byte 2 Bit 3:0</td><td>This field contains the credits associated with data storage. Data credits are in units of 16 bytes per credit, and are applied to the flow control counter for the virtual channel indicated in <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="365" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c56"></mjx-c></mjx-mi></mjx-texatom><mjx-mrow space="2"><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3A"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">V</mi></mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">[</mo><mrow data-mjx-texclass="ORD"><mn>2</mn><mo>:</mo><mn>0</mn></mrow><mo data-mjx-texclass="CLOSE">]</mo></mrow></math></mjx-assistive-mml></mjx-container> ,and for the traffic type indicated by the code in Byte 0 , Bits 7:4.</td></tr><tr><td>HdrFC 11:0</td><td>Byte 2 Bit 7:6 Byte 1 Bit 5:0</td><td>This field contains the credits associated with header storage. Data credits are in units of 1 header (including digest) per credit, and are applied to the flow control counter for the virtual channel indicated in <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="366" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c56"></mjx-c></mjx-mi></mjx-texatom><mjx-mrow space="2"><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3A"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">V</mi></mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">[</mo><mrow data-mjx-texclass="ORD"><mn>2</mn><mo>:</mo><mn>0</mn></mrow><mo data-mjx-texclass="CLOSE">]</mo></mrow></math></mjx-assistive-mml></mjx-container> ,and for the traffic type indicated by the code in Byte 0, Bits 7:4.</td></tr><tr><td>VC [2:0]</td><td>Byte 0 Bit 2:0</td><td>This field indicates the virtual channel (VC 0-7) receiving the credits.</td></tr><tr><td>Type 3:0</td><td>Byte 0 Bit 7:4</td><td>This field contains a code indicating the type of FC DLLP: 0100b = InitFC1-P (Posted Requests) 0101b = InitFC1-NP (Non-Posted Requests 0110b = InitFC1-Cpl (Completions) 0101b = InitFC2-P (Posted Requests) 1101b = InitFC2-NP (Non-Posted Requests) 1110b = InitFC2-Cpl <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="367" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c43"></mjx-c><mjx-c class="mjx-c6F"></mjx-c><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c70"></mjx-c><mjx-c class="mjx-c6C"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c74"></mjx-c><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c6F"></mjx-c><mjx-c class="mjx-c6E"></mjx-c><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">Completions</mi></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> 1000b = UpdateFC-P (Posted Requests) 1001b = UpdateFC-NP (Non-Posted Requests) <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="368" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c55"></mjx-c><mjx-c class="mjx-c70"></mjx-c><mjx-c class="mjx-c64"></mjx-c><mjx-c class="mjx-c61"></mjx-c><mjx-c class="mjx-c74"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c46"></mjx-c><mjx-c class="mjx-c43"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>1010</mn></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">b</mi></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">UpdateFC</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> - <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="369" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c43"></mjx-c><mjx-c class="mjx-c70"></mjx-c><mjx-c class="mjx-c6C"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mrow space="2"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c43"></mjx-c><mjx-c class="mjx-c6F"></mjx-c><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c70"></mjx-c><mjx-c class="mjx-c6C"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c74"></mjx-c><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c6F"></mjx-c><mjx-c class="mjx-c6E"></mjx-c><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">Cpl</mi></mrow></mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">Completions</mi></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container></td></tr><tr><td>Link CRC</td><td>Byte 5 Bit 7:0 Byte 4 Bit 7:0</td><td>16 Bit CRC sent to protect the contents of this DLLP. Calculation is made on Bytes 0-3, regardless of whether fields are used.</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="260" id="mark-90b535ad-8214-4917-9fd0-f1438cad7648" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Chapter 4: Packet-Based Transactions</div></div></h2><div><div><div></div></div></div><h2><div><div>Vendor Specific DLLP Format</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express reserves a DLLP type for vendor specific use. Only the Type code is defined. The Vendor DLLP is illustrated in Figure 4-17.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 4-17: Vendor Specific DLLP Packet Format</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_266.jpg?x=226&amp;y=625&amp;w=982&amp;h=325"></div></div><div><div><div></div></div></div><div><div><div>Definitions Of Vendor Specific DLLP Fields. Table 4-21 on page 207</div></div></div><div><div><div></div></div></div><div><div><div>describes the fields contained in a Vendor-Specific DLLP 5</div></div></div><div><div><div></div></div></div><div><div><div>Table 4-21: Vendor-Specific DLLP Fields</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Field Name</th><th>Header Byte/Bit</th><th>DLLP Function</th></tr></thead><tbody><tr><td>Type 3:0</td><td>Byte 0 Bit 7:4</td><td>This field contains a code indicating the Vendor- specific DLLP: 0011 0000b = Vendor specific DLLP</td></tr><tr><td>Link CRC</td><td>Byte 5 Bit 7:0 Byte 4 Bit 7:0</td><td>16 Bit CRC sent to protect the contents of this DLLP. Calculation is made on Bytes 0-3, regardless of whether fields are used.</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="261" id="mark-a52bff4b-eae1-4488-a3e2-78920bd8bf71" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>ACKINAK  Protocol</div></div></h2><div><div><div></div></div></div><h2><div><div>The Previous Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>Information moves between PCI Express devices in packets. The two major classes of packets are Transaction Layer Packets (TLPs), and Data Link Layer Packets (DLLPs). The use, format, and definition of all TLP and DLLP packet types and their related fields were detailed in that chapter.</div></div></div><div><div><div></div></div></div><h2><div><div>This Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>This chapter describes a key feature of the Data Link Layer: 'reliable' transport of TLPs from one device to another device across the Link. The use of ACK DLLPs to confirm reception of TLPs and the use of NAK DLLPs to indicate error reception of TLPs is explained. The chapter describes the rules for replaying TLPs in the event that a NAK DLLP is received.</div></div></div><div><div><div></div></div></div><h2><div><div>The Next Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>The next chapter discusses Traffic Classes, Virtual Channels, and Arbitration that support Quality of Service concepts in PCI Express implementations. The concept of Quality of Service in the context of PCI Express is an attempt to predict the bandwidth and latency associated with the flow of different transaction streams traversing the PCI Express fabric. The use of QoS is based on application-specific software assigning Traffic Class (TC) values to transactions, which define the priority of each transaction as it travels between the Requester and Completer devices. Each TC is mapped to a Virtual Channel (VC) that is used to manage transaction priority via two arbitration schemes called port and VC arbitration. PCI Express System Architecture</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="262" id="mark-12d9dc18-3b8d-42dc-b9d8-db5f93c098e6" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Reliable Transport of TLPs Across Each Link</div></div></h2><div><div><div></div></div></div><div><div><div>The function of the Data Link Layer (shown in Figure 5-1 on page 210) is two</div></div></div><div><div><div></div></div></div><div><div><div>fold:</div></div></div><div><div><div></div></div></div><div><ul><li>'Reliable' transport of TLPs from one device to another device across the Link.</li></ul></div><div><div><div></div></div></div><div><ul><li>The receiver's Transaction Layer should receive TLPs in the same order that the transmitter sent them. The Data Link Layer must preserve this order despite any occurrence of errors that require TLPs to be replayed (retried).</li></ul></div><div><div><div></div></div></div><div><div><div>Figure 5-1: Data Link Layer</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_269.jpg?x=227&amp;y=814&amp;w=991&amp;h=796"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="263" id="mark-05311f0f-8ecc-4437-b4f0-48ab9174df65" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>The ACK/NAK protocol associated with the Data Link Layer is described with the aid of Figure 5-2 on page 211 which shows sub-blocks with greater detail. For every TLP that is sent from one device (Device A) to another (Device B) across one Link, the receiver checks for errors in the TLP (using the TLP's LCRC field). The receiver Device B notifies transmitter Device A on good or bad reception of TLPs by returning an ACK or a NAK DLLP. Reception of an ACK DLLP by the transmitter indicates that the receiver has received one or more TLP(s) successfully. Reception of a NAK DLLP by the transmitter indicates that the receiver has received one or more TLP(s) in error. Device A which receives a NAK DLLP then re-sends associated TLP(s) which will hopefully, arrive at the receiver successfully without error.</div></div></div><div><div><div></div></div></div><div><div><div>The error checking capability in the receiver and the transmitter's ability to resend TLPs if a TLP is not received correctly is the core of the ACK/NAK protocol described in this chapter.</div></div></div><div><div><div></div></div></div><div><div><div>Definition: As used in this chapter, the term Transmitter refers to the device that sends TLPs.</div></div></div><div><div><div></div></div></div><div><div><div>Definition: As used in this chapter, the term Receiver refers to the device that receives TLPs. PCI Express System Architecture</div></div></div><div><div><div></div></div></div><div><div><div>Figure 5-2: Overview of the ACK/NAK Protocol</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_270.jpg?x=221&amp;y=1022&amp;w=998&amp;h=647"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="264" id="mark-2032b017-7f1c-47e2-95d5-b1f1acf2822f" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Elements of the ACK/NAK Protocol</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 5-3 is a block diagram of a transmitter and a remote receiver connected via a Link. The diagram shows all of the major Data Link Layer elements associated with reliable TLP transfer from the transmitter's Transaction Layer to the receiver's Transaction Layer. Packet order is maintained by the transmitter's and receiver's Transaction Layer.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 5-3: Elements of the ACK/NAK Protocol</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_271.jpg?x=222&amp;y=723&amp;w=1002&amp;h=744"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="265" id="mark-e5cec21f-300f-4172-8f55-45dbee80e7be" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Transmitter Elements of the ACK/NAK Protocol</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 5-4 on page 215 illustrates the transmitter Data Link Layer elements associated with processing of outbound TLPs and inbound ACK/NAK DLLPs.</div></div></div><div><div><div></div></div></div><h2><div><div>Replay Buffer</div></div></h2><div><div><div></div></div></div><div><div><div>The replay buffer stores TLPs with all fields including the Data Link Layer-related Sequence Number and LCRC fields. The TLPs are saved in the order of arrival from the Transaction Layer before transmission. Each TLP in the Replay Buffer contains a Sequence Number which is incrementally greater than the sequence number of the previous TLP in the buffer.</div></div></div><div><div><div></div></div></div><div><div><div>When the transmitter receives acknowledgement via an ACK DLLP that TLPs have reached the receiver successfully, it purges the associated TLPs from the Replay Buffer. If, on the other hand, the transmitter receives a NAK DLLP, it replays (i.e., re-transmits) the contents of the buffer.</div></div></div><div><div><div></div></div></div><h2><div><div>NEXT_TRANSMIT_SEQ Counter</div></div></h2><div><div><div></div></div></div><div><div><div>This counter generates the Sequence Number assigned to each new transmitted TLP. The counter is a 12-bit counter that is initialized to 0 at reset, or when the Data Link Layer is in the inactive state. It increments until it reaches 4095 and then rolls over to 0 (i.e., it is a modulo 4096 counter).</div></div></div><div><div><div></div></div></div><h2><div><div>LCRC Generator</div></div></h2><div><div><div></div></div></div><div><div><div>The LCRC Generator provides a 32-bit LCRC for the TLP. The LCRC is calculated using all fields of the TLP including the Header, Data Payload, ECRC and Sequence Number. The receiver uses the TLP's LCRC field to check for a CRC error in the received TLP.</div></div></div><div><div><div></div></div></div><h2><div><div>REPLAY_NUM Count</div></div></h2><div><div><div></div></div></div><div><div><div>This 2-bit counter stores the number of replay attempts following either reception of a NAK DLLP, or a REPLAY_TIMER time-out. When the REPLAY_NUM count rolls over from <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="370" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>11</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> to <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="371" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>00</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> ,the Data Link Layer triggers a Physical Layer Link-retrain (see the description of the LTSSM recovery state on page 532). It waits for completion of re-training before attempting to transmit TLPs once again. The REPLAY_NUM counter is initialized to <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="372" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>00</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> at reset,or when the Data Link Layer is inactive. It is also reset whenever an ACK is received, indicating that forward progress is being made in transmitting TLPs.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="266" id="mark-bec30c19-6ead-47cf-ba64-b241d01dbfc5" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>REPLAY_TIMER Count</div></div></h2><div><div><div></div></div></div><div><div><div>The REPLAY_TIMER is used to measure the time from when a TLP is transmitted until an associated ACK or NAK DLLP is received. The REPLAY_TIMER is started (or restarted, if already running) when the last Symbol of any TLP is sent. It restarts from 0 each time that there are outstanding TLPs in the Replay Buffer and an ACK DLLP is received that references a TLP still in the Replay Buffer. It resets to 0 and holds when there are no outstanding TLPs in the Replay Buffer, or until restart conditions are met for each NAK received (except during a replay), or when the REPLAY_TIMER expires. It is not advanced (i.e., its value remains fixed) during Link re-training.</div></div></div><div><div><div></div></div></div><h2><div><div>ACKD_SEQ Count</div></div></h2><div><div><div></div></div></div><div><div><div>This 12-bit register tracks or stores the Sequence Number of the most recently received ACK or NAK DLLP. It is initialized to all 1s at reset, or when the Data Link Layer is inactive. This register is updated with the AckNak_Seq_Num [11:0] field of a received ACK or NAK DLLP. The ACKD_SEQ count is compared with the NEXT_TRANSMIT_SEQ count.</div></div></div><div><div><div></div></div></div><div><div><div>IF (NEXT_TRANSMIT_SEQ - ACKD_SEQ) mod 4096 ≥ 2048 THEN</div></div></div><div><div><div></div></div></div><div><div><div>New TLPs from Transaction Layer are not accepted by Data Link Layer until this equation is no longer true. In addition, a Data Link Layer protocol error which is a fatal uncorrectable error is reported. This error condition occurs if there is a separation greater than 2047 between NEXT_TRANSMIT_SEQ and ACKD_SEQ. i.e, a separation greater than 2047 between the sequence number of a TLP being transmitted and that of a TLP in the replay buffer that receives an ACK or NAK DLLP.</div></div></div><div><div><div></div></div></div><div><div><div>Also, the ACKD_SEQ count is used to check for forward progress made in transmitting TLPs. If no forward progress is made after 3 additional replay attempts, the Link in re-trained.</div></div></div><div><div><div></div></div></div><h2><div><div>DLLP CRC Check</div></div></h2><div><div><div></div></div></div><div><div><div>This block checks for CRC errors in DLLPs returned from the receiver. Good DLLPs are further processed. If a DLLP CRC error is detected, the DLLP is discarded and an error reported. No further action is taken.</div></div></div><div><div><div></div></div></div><div><div><div>Definition: The Data Link Layer is in the inactive state when the Physical Layer reports that the Link is non-operational or nothing is connected to the Port. The Physical Layer is in the non-operational state when the Link Training and Status State Machine (LTSSM) is in the Detect, Polling, Configuration, Disabled, Reset or Loopback states during which LinkUp <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="373" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>0</mn></math></mjx-assistive-mml></mjx-container> (see Chapter 14 on ’Link Initialization and Training'). While in the inactive state, the Data Link Layer state machines are initialized to their default values and the Replay Buffer is cleared. The Data Link Layer exits the inactive state when the Physical Layer reports LinkUp <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="374" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> and the Link Disable bit of the Link Control register <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="375" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>0</mn></math></mjx-assistive-mml></mjx-container> .</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="267" id="mark-74d0f6f0-65ff-4445-b948-11d8516e6d9d" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 5-4: Transmitter Elements Associated with the ACK/NAK Protocol</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_274.jpg?x=232&amp;y=599&amp;w=989&amp;h=1068"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="268" id="mark-7d5b86e6-900a-4425-a471-5191ef170406" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Receiver Elements of the ACK/NAK Protocol</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 5-5 on page 218 illustrates the receiver Data Link Layer elements associated with processing of inbound TLPs and outbound ACK/NAK DLLPs.</div></div></div><div><div><div></div></div></div><h2><div><div>Receive Buffer</div></div></h2><div><div><div></div></div></div><div><div><div>The receive buffer temporarily stores received TLPs while TLP CRC and Sequence Number checks are performed. If there are no errors, the TLP is processed and transferred to the receiver's Transaction Layer. If there are errors associated with the TLP, it is discarded and a NAK DLLP may be scheduled (more on this later in this chapter). If the TLP is a duplicate TLP (more on this later in this chapter), it is discarded and an ACK DLLP is scheduled. If the TLP is a 'nullified' TLP, it is discarded and no further action is taken (see "Switch Cut-Through Mode" on page 248).</div></div></div><div><div><div></div></div></div><h2><div><div>LCRC Error Check</div></div></h2><div><div><div></div></div></div><div><div><div>This block checks for LCRC errors in the received TLP using the TLP's 32-bit LCRC field.</div></div></div><div><div><div></div></div></div><h2><div><div>NEXT_RCV_SEQ Count</div></div></h2><div><div><div></div></div></div><div><div><div>The 12-bit NEXT_RCV_SEQ counter keeps track of the next expected TLP's Sequence Number. This counter is initialized to 0 at reset, or when the Data Link Layer is inactive. This counter is incremented once for each good TLP received that is forwarded to the Transaction Layer. The counter rolls over to 0 after reaching a value of 4095 . The counter is not incremented for TLPs received with CRC error, nullified TLPs, or TLPs with an incorrect Sequence Number.</div></div></div><div><div><div></div></div></div><h2><div><div>Sequence Number Check</div></div></h2><div><div><div></div></div></div><div><div><div>After the CRC error check, this block verifies that a received TLP's Sequence Number matches the NEXT_RCV_SEQ count.</div></div></div><div><div><div></div></div></div><div><ul><li>If the TLP's Sequence Number <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="376" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo></math></mjx-assistive-mml></mjx-container> NEXT_RCV_SEQ count,the TLP is accepted, processed and forwarded to the Transaction Layer. NEXT_RCV_SEQ count is incremented. The receiver continues to process inbound TLPs and does not have to return an ACK DLLP until the ACKNAK_LATENCY_TIMER expires or exceeds its set value.</li></ul></div><div><div><div></div></div></div><div><ul><li>If the TLP's Sequence Number is an earlier Sequence Number than NEXT_RCV_SEQ count and with a separation of no more than 2048 from NEXT_RCV_SEQ count, the TLP is a duplicate TLP. It is discarded and an ACK DLLP is scheduled for return to the transmitter.</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="269" id="mark-4c617bc9-8f7f-44ec-903c-914477692e2b" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><ul><li>If the TLP's Sequence Number is a later Sequence Number than NEXT_RCV_SEQ count, or for any other case other than the above two conditions, the TLP is discarded and a NAK DLLP may be scheduled (more on this later) for return to the transmitter.</li></ul></div><div><div><div></div></div></div><h2><div><div>NAK_SCHEDULED Flag</div></div></h2><div><div><div></div></div></div><div><div><div>The NAK_SCHEDULED flag is set when the receiver schedules a NAK DLLP to return to the remote transmitter. It is cleared when the receiver sees the first TLP associated with the replay of a previously-Nak'd TLP. The specification is unclear about whether the receiver should schedule additional NAK DLLP for bad TLPs received while the NAK_SCHEDULED flag is set. It is the authors' interpretation that the receiver must not schedule the return of additional NAK DLLPs for subsequently received TLPs while the NAK_SCHEDULED flag remains set.</div></div></div><div><div><div></div></div></div><h2><div><div>ACKNAK_LATENCY_TIMER</div></div></h2><div><div><div></div></div></div><div><div><div>The ACKNAK_LATENCY_TIMER monitors the elapsed time since the last ACK or NAK DLLP was scheduled to be returned to the remote transmitter. The receiver uses this timer to ensure that it processes TLPs promptly and returns an ACK or a NAK DLLP when the timer expires or exceeds its set value. The timer value is set based on a formula described in "Receivers ACKNAK_LATENCY_TIMER" on page 237.</div></div></div><div><div><div></div></div></div><h2><div><div>ACK/NAK DLLP Generator</div></div></h2><div><div><div></div></div></div><div><div><div>This block generates the ACK or NAK DLLP upon command from the LCRC or Sequence Number check block. The ACK or NAK DLLP contains an AckNak_Seq_Num[11:0] field obtained from the NEXT_RCV_SEQ counter. ACK or NAK DLLPs contain a AckNak_Seq_Num[11:0] value equal to NEXT_RCV_SEQ count - 1.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="270" id="mark-823cf854-d4b6-4231-b056-90b81fb3e8c1" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 5-5: Receiver Elements Associated with the ACK/NAK Protocol</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_277.jpg?x=223&amp;y=440&amp;w=992&amp;h=1096"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="271" id="mark-267311c0-0b65-4306-bba6-01851b11c786" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>ACK/NAK DLLP Format</div></div></h2><div><div><div></div></div></div><div><div><div>The format of an ACK or NAK DLLP is illustrated in Figure 5-6 on page 219. Table 5-6 describes the ACK or NAK DLLP Fields.</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_278.jpg?x=218&amp;y=551&amp;w=1006&amp;h=351"></div></div><div><div><div></div></div></div><div><div><div>Table 5-1: Ack or Nak DLLP Fields</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Field Name</th><th>Header Byte/Bit</th><th>DLLP Function</th></tr></thead><tbody><tr><td>AckNak_Seq_Num [11:0]</td><td>Byte 3 Bit 7:0 Byte 2 Bit 3:0</td><td>For an ACK DLLP: - For good TLPs received with Sequence Number  <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="377" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo></math></mjx-assistive-mml></mjx-container>  NEXT_RCV_SEQ count (count before incrementing), use NEXT_RCV_SEQ count - 1 (count after incrementing minus 1). - For TLP received with Sequence Num- ber earlier than NEXT_RCV_SEQ count (duplicate TLP), use NEXT_RCV_SEQ count - 1. For a NAK DLLP: - Associated with a TLP that fails the CRC check, use NEXT_RCV_SEQ count - 1. - For a TLP received with Sequence Num- ber later than NEXT_RCV_SEQ count, use NEXT_RCV_SEQ count - 1. Upon receipt, the transmitter will purge TLPs with equal to and earlier Sequence Numbers and replay the remainder TLPs.</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="272" id="mark-187f2be7-18e7-47e6-996c-20ac1ba0ddfd" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 5-1: Ack or Nak DLLP Fields (Continued)</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Field Name</th><th>Header Byte/Bit</th><th>DLLP Function</th></tr></thead><tbody><tr><td>Type 7:0</td><td>Byte 0 Bit 7:0</td><td>Indicates the type of DLLP. For the Ack/ Nak DLLPs: - 00000000b = ACK DLLP. - 00010000b = NAK DLLP.</td></tr><tr><td>16-bit CRC</td><td>Byte 5 Bit 7:0 Byte 4 Bit 7:0</td><td>16-bit CRC used to protect the contents of this DLLP. Calculation is made on Bytes 0-3 of the ACK/NAK.</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>ACK/NAK Protocol Details</div></div></h2><div><div><div></div></div></div><div><div><div>This section describes the detailed transmitter and receiver behavior in processing TLPs and ACK/NAK DLLPs. The examples demonstrate flow of TLPs from transmitter to the remote receiver in both the normal non-error case, as well as the error cases.</div></div></div><div><div><div></div></div></div><h2><div><div>Transmitter Protocol Details</div></div></h2><div><div><div></div></div></div><div><div><div>This section delves deeper into the ACK/NAK protocol. Consider the transmit side of a device's Data Link Layer shown in Figure 5-4 on page 215.</div></div></div><div><div><div></div></div></div><h2><div><div>Sequence Number</div></div></h2><div><div><div></div></div></div><div><div><div>Before a transmitter sends TLPs delivered by the Transaction Layer, the Data Link Layer appends a 12-bit Sequence Numbers to each TLP. The Sequence Number is generated by the 12-bit NEXT_TRANSMIT_SEQ counter. The counter is initialized to 0 at reset, or when the Data Link Layer is in the inactive state. It increments after each new TLP is transmitted until it reaches its maximum value of 4095 , and then rolls over to 0 . For each new TLP sent, the transmitter appends the Sequence Number from the NEXT_TRANSMIT_SEQ counter.</div></div></div><div><div><div></div></div></div><div><div><div>Keep in mind that an incremented Sequence Number does not necessarily mean a greater Sequence Number (since the counter rolls over when after it reaches a maximum value of 4095).</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="273" id="mark-51fd8814-c856-4d1b-9a24-30f82980de3d" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>32-Bit LCRC</div></div></h2><div><div><div></div></div></div><div><div><div>The transmitter also appends a 32-bit LCRC (Link CRC) calculated based on TLP contents which include the Header, Data Payload, ECRC and Sequence Number.</div></div></div><div><div><div></div></div></div><h2><div><div>Replay (Retry) Buffer</div></div></h2><div><div><div></div></div></div><div><div><div>General. Before a device transmits a TLP, it stores a copy of the TLP in a buffer associated with the Data Link Layer referred to as the Replay Buffer (the specification uses the term Retry Buffer). Each buffer entry stores a complete TLP with all of its fields including the Header (up to 16 bytes), an optional Data Payload (up to <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="378" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>4</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">KB</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> ),an optional ECRC (up to four bytes),the Sequence Number (12-bits wide, but occupies two bytes) and the LCRC field (four bytes). The buffer size is unspecified. The buffer should be big enough to store transmitted TLPs that have not yet been acknowledged via ACK DLLPs.</div></div></div><div><div><div></div></div></div><div><div><div>When the transmitter receives an ACK DLLP, it purges from the Replay Buffer TLPs with equal to or earlier Sequence Numbers than the Sequence Number received with the ACK DLLPs.</div></div></div><div><div><div></div></div></div><div><div><div>When the transmitter receives NAK DLLPs, it purges the Replay Buffer of TLPs with Sequence Numbers that are equal to or earlier than the Sequence Number that arrives with the NAK and replays (re-transmits) TLPs of later Sequence Numbers (the remainder TLPs in the Replay Buffer). This implies that a NAK DLLP inherently acknowledges TLPs with equal to or earlier Sequence Numbers than the AckNak_Seq_Num[11:0] of the NAK DLLP and replays the remainder TLPs in the Replay Buffer. Efficient replay strategies are discussed later.</div></div></div><div><div><div></div></div></div><div><div><div>Replay Buffer Sizing. The Replay Buffer should be large enough so that, under normal operating conditions, TLP transmissions are not throttled due to a Replay Buffer full condition. To determine what buffer size to implement, one must consider the following:</div></div></div><div><div><div></div></div></div><div><ul><li>ACK DLLP delivery Latency from the receiver.</li></ul></div><div><div><div></div></div></div><div><ul><li>Delays cause by the physical Link interconnect and the Physical Layer implementations.</li></ul></div><div><div><div></div></div></div><div><ul><li>Receiver L0s exit latency to L0. i.e., the buffer should ideally be big enough to hold TLPs while the Link which is in L0s is returned to L0.</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="274" id="mark-52f8615f-3f92-42fb-aacb-f8c098a65139" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><h2><div><div>Transmitter's Response to an ACK DLLP</div></div></h2><div><div><div></div></div></div><div><div><div>General. If the transmitter receives an ACK DLLP, it has positive confirmation that its transmitted TLP(s) have reached the receiver successfully. The transmitter associates the Sequence Number contained in the ACK DLLP with TLP entries contained in the Replay Buffer.</div></div></div><div><div><div></div></div></div><div><div><div>A single ACK DLLP returned by the receiver Device B may be used to acknowledge multiple TLPs. It is not necessary that every TLP transmitted must have a corresponding ACK DLLP returned by the remote receiver. This is done to conserve bandwidth by reducing the ACK DLLP traffic on the bus. The receiver gathers multiple TLPs and then collectively acknowledges them with one ACK DLLP that corresponds to the last received good TLP. In InfiniBand, this is referred to as ACK coalescing.</div></div></div><div><div><div></div></div></div><div><div><div>The transmitter's response to reception of an ACK DLLP include:</div></div></div><div><div><div></div></div></div><div><ul><li>Load ACKD_SEQ register with AckNak_Seq_Num[11:0] of the ACK DLLP.</li></ul></div><div><div><div></div></div></div><div><ul><li>Reset the REPLAY_NUM counter and REPLAY_TIMER to 0.</li></ul></div><div><div><div></div></div></div><div><ul><li>Purge the Replay Buffer as described below.</li></ul></div><div><div><div></div></div></div><div><div><div>Purging the Replay Buffer. An ACK DLLP of a given Sequence Number (contained in the AckNak_Seq_Num[11:0] field) acknowledges the receipt of a TLP with that Sequence Number in the transmitter Replay Buffer, PLUS all TLPs with earlier Sequence Numbers. In other words, an ACK DLLP with a given Sequence Number not only acknowledges a specific TLP in the Replay Buffer (the one with that Sequence Number), but it also acknowledges TLPs of earlier (logically lower) Sequence Numbers. The transmitter purges the Replay Buffer of all TLPs acknowledged by the ACK DLLP.</div></div></div><div><div><div></div></div></div><h2><div><div>Examples of Transmitter ACK DLLP Processing</div></div></h2><div><div><div></div></div></div><div><div><div>Example 1. Consider Figure 5-7 on page 223, with the emphasis on the transmitter Device A.</div></div></div><div><div><div></div></div></div><div><ol><li value="1">Device A transmits TLPs with Sequence Numbers 3, 4, 5, 6, 7 where TLP 3 is the first TLP sent and TLP 7 is the last TLP sent.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">Device B receives TLPs with Sequence Numbers 3, 4, 5 in that order. TLP 6, 7 are still en route.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">Device B performs the error checks and collectively acknowledges good receipt of TLPs 3, 4, 5 with the return of an ACK DLLP with a Sequence Number of 5.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">Device A receives ACK 5.</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="275" id="mark-31ff528a-3989-4a34-ab6c-435ccee9ad51" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><ol><li value="5">Device A purges TLP 3, 4, 5 from the Replay Buffer.</li></ol></div><div><div><div></div></div></div><div><ol><li value="6">When Device B receives TLP 6,7, steps 3 through 5 may be repeated for those packets as well.</li></ol></div><div><div><div></div></div></div><div><div><div>Figure 5-7: Example 1 that Shows Transmitter Behavior with Receipt of an ACK DLLP</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_282.jpg?x=224&amp;y=500&amp;w=991&amp;h=693"></div></div><div><div><div></div></div></div><div><div><div>Example 2. Consider Figure 5-8, with the emphasis on the transmitter Device A.</div></div></div><div><div><div></div></div></div><div><ol><li value="1">Device A transmits TLPs with Sequence Numbers 4094, 4095, 0, 1, 2 where TLP 4094 is the first TLP sent and TLP 2 is the last TLP sent.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">Device B receives TLPs with Sequence Numbers 4094, 4095, 0, 1 in that order. TLP 2 is still en route.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">Device B performs the error checks and collectively acknowledges good receipt of TLPs 4094, 4095, 0, 1 with the return of an ACK DLLP with a Sequence Number of 1.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">Device A receives ACK 1.</li></ol></div><div><div><div></div></div></div><div><ol><li value="5">Device A purges TLP 4094, 4095, 0, 1 from the Replay Buffer.</li></ol></div><div><div><div></div></div></div><div><ol><li value="6">When Device B ultimately receives TLP 2, steps 3 through 5 may be repeated for TLP 2.</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="276" id="mark-f21c6a1b-8538-4a80-89ec-0150f0d53376" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 5-8: Example 2 that Shows Transmitter Behavior with Receipt of an ACK DLLP</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_283.jpg?x=226&amp;y=417&amp;w=989&amp;h=669"></div></div><div><div><div></div></div></div><h2><div><div>Transmitter's Response to a NAK DLLP</div></div></h2><div><div><div></div></div></div><div><div><div>A NAK DLLP received by the transmitter implies that a TLP transmitted at an earlier time was received by the receiver in error. The transmitter first purges from the Replay Buffer any TLP with Sequence Numbers equal to or earlier than the NAK DLLP's AckNak_Seq_Num[11:0]. It then replays (retries) the remainder TLPs starting with the TLP with Sequence Number immediately after the AckNak_Seq_Num[11:0] of the NAK DLLP until the newest TLP. In addition, the transmitter's response to reception of a NAK DLLP include:</div></div></div><div><div><div></div></div></div><div><ul><li>Reset REPLAY_NUM and REPLAY_TIMER to 0 only if the NAK DLLP's AckNak_Seq_Num[11:0] is later than the current ACKD_SEQ value (forward progress is made in transmitting TLPs).</li></ul></div><div><div><div></div></div></div><div><ul><li>Load ACKD_SEQ register with AckNak_Seq_Num[11:0] of the NAK DLLP.</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="277" id="mark-92ca6615-3a38-427f-b5b0-0cf21af6a609" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>TLP Replay</div></div></h2><div><div><div></div></div></div><div><div><div>When a Replay becomes necessary, the transmitter blocks the delivery of new TLPs by the Transaction Layer. It then replays (re-sends or retries) the contents of the Replay Buffer starting with the earliest TLP first (of Sequence Number <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="379" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo></math></mjx-assistive-mml></mjx-container> AckNak_Seq_Num[11:0] + 1) until the remainder of the Replay Buffer is replayed. After the replay event, the Data Link Layer unblocks acceptance of new TLPs from the Transaction Layer. The transmitter continues to save the TLPs just replayed until they are finally acknowledged at a later time.</div></div></div><div><div><div></div></div></div><h2><div><div>Efficient TLP Replay</div></div></h2><div><div><div></div></div></div><div><div><div>ACK DLLPs or NAK DLLPs received during replay must be processed. This means that the transmitter must process the DLLPs and, at the very least, store them until the replay is finished. After replay is complete, the transmitter evaluates the ACK or NAK DLLPs and performs the appropriate processing.</div></div></div><div><div><div></div></div></div><div><div><div>A more efficient design might begin processing the ACK/NAK DLLPs while the transmitter is still in the act of replaying. By doing so, newly received ACK DLLPs are used to purge the Replay Buffer even while replay is in progress. If another NAK DLLP is received in the meantime, at the very least, the TLPs that were acknowledged have been purged and would not be replayed.</div></div></div><div><div><div></div></div></div><div><div><div>During replay, if multiple ACK DLLPs are received, the ACK DLLP received last with the latest Sequence Number can collapse earlier ACK DLLPs of earlier Sequence Numbers. During the replay, the transmitter can concurrently purge TLPs of Sequence Number equal to and earlier than the AckNak_Seq_Num[11:0] of the last received ACK DLLP.</div></div></div><div><div><div></div></div></div><h2><div><div>Example of Transmitter NAK DLLP Processing</div></div></h2><div><div><div></div></div></div><div><div><div>Consider Figure 5-9 on page 226, with focus on transmitter Device A.</div></div></div><div><div><div></div></div></div><div><ol><li value="1">Device A transmits TLPs with Sequence Number 4094, 4095, 0, 1, and 2, where TLP 4094 is the first TLP sent and TLP 2 is the last TLP sent.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">Device B receives TLPs 4094, 4095, and 0 in that order. TLP 1, 2 are still en route.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">Device B receives TLP 4094 with no error and hence NEXT_RCV_SEQ count increments to 4095</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">Device B receives TLP 4095 with a CRC error.</li></ol></div><div><div><div></div></div></div><div><ol><li value="5">Device B schedules the return of a NAK DLLP with Sequence Number 4094 (NEXT_RCV_SEQ count - 1).</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="278" id="mark-f928a8fb-22b3-4d48-b191-4e5f164ca44c" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><ol><li value="6">Device A receives NAK 4094 and blocks acceptance of new TLPs from its Transaction Layer until replay completes.</li></ol></div><div><div><div></div></div></div><div><ol><li value="7">Device A first purges TLP 4094 (and earlier TLPs; none in this example).</li></ol></div><div><div><div></div></div></div><div><ol><li value="8">Device A then replays TLPs 4095, 0, 1, and 2, but does not purge them.</li></ol></div><div><div><div></div></div></div><div><div><div>Figure 5-9: Example that Shows Transmitter Behavior on Receipt of a NAK DLLP</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_285.jpg?x=229&amp;y=569&amp;w=986&amp;h=639"></div></div><div><div><div></div></div></div><div><div><div>Repeated Replay of TLPs. Each time the transmitter receives a NAK DLLP, it replays the Replay Buffer contents. The transmitter uses a 2-bit Replay Number counter, referred to as the REPLAY_NUM counter, to keep track of the number of replay events. Reception of a NAK DLLP increments REPLAY_NUM. This counter is initialized to 0 at reset, or when the Data Link Layer is inactive. It is also reset if an ACK or NAK DLLP is received with a later Sequence Number than that contained in the ACKD_SEQ register. As long as forward progress is made in transmitting TLPs the REPLAY_NUM counter resets. When a fourth NAK is received, indicating no forward progress has been made after several tries, the counter rolls over to zero. The transmitter will not replay the TLPs a fourth time but instead it signals a replay number rollover error. The device assumes that the Link is non-functional or that there is a Physical Layer problem at either the transmitter or receiver end.</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="279" id="mark-fefb4f58-5b22-46de-9f6e-261898488560" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>What Happens After the Replay Number Rollover? A transmitter's Data Link Layer triggers the Physical Layer to re-train the Link. The Physical Layer Link Training and Status State Machine (LTSSM) enters the Recovery State (see "Recovery State" on page 532). The Replay Number Rollover error bit is set ("Advanced Correctable Error Handling" on page 384) in the Advanced Error Reporting registers (if implemented). The Replay Buffer contents are preserved and the Data Link Layer is not initialized by the retraining process. Upon Physical Layer re-training exit, assuming that the problem has been cleared, the transmitter resumes the same replay process again. Hopefully, the TLPs can be re-sent successfully on this attempt.</div></div></div><div><div><div></div></div></div><div><div><div>The specification does not address a device's handling of repeated re-train attempts. The author recommends that a device track the number of re-train attempts. After a re-train rollover the device could signal a Data Link Layer protocol error indicating the severity as an Uncorrectable Fatal Error.</div></div></div><div><div><div></div></div></div><h2><div><div>Transmitter's Replay Timer</div></div></h2><div><div><div></div></div></div><div><div><div>The transmitter implements a REPLAY_TIMER to measure the time from when a TLP is transmitted until the transmitter receives an associated ACK or NAK DLLP from the remote receiver. A formula (described below) determines the timer's expiration period. Timer expiration triggers a replay event and the REPLAY_NUM count increments. A time-out may arise if an ACK or NAK DLLP is lost en route, or because of an error in the receiver that prevents it from returning an ACK or NAK DLLP. Timer-related rules are:</div></div></div><div><div><div></div></div></div><div><ul><li>The Timer starts (if not already started) when the last symbol of any TLP is transmitted.</li></ul></div><div><div><div></div></div></div><div><ul><li>The Timer is reset to 0 and restarted when:</li></ul></div><div><div><div></div></div></div><div><ul><li>A Replay event occurs and the last symbol of the first TLP is replayed. - For each ACK DLLP received, as long as there are unacknowledged TLPs in the Replay Buffer,</li></ul></div><div><div><div></div></div></div><div><ul><li>The Timer is reset and held when:</li></ul></div><div><div><div></div></div></div><div><ul><li>There are no TLPs to transmit, or when the Replay Buffer is empty.</li></ul></div><div><div><div></div></div></div><div><ul><li>A NAK DLLP is received. The timer restarts when replay begins.</li></ul></div><div><div><div></div></div></div><div><ul><li>When the timer expires.</li></ul></div><div><div><div></div></div></div><div><ul><li>The Data Link Layer is inactive.</li></ul></div><div><div><div></div></div></div><div><ul><li>Timer is Held during Link training or re-training.</li></ul></div><div><div><div></div></div></div><div><div><div>REPLAY_TIMER Equation. The timer is loaded with a value that reflects the worst-case latency for the return of an ACK or NAK DLLP. This time depends on the maximum data payload allowed for a TLP and the width of the Link.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="280" id="mark-195a8b4a-3d94-4326-b3be-7caeb929f2fb" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>The equation to calculate the REPLAY_TIMER value required is:</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" display="true" tabindex="0" ctxtmenu_counter="380" style="font-size: 122.8%; position: relative;"><mjx-math display="true" class="MJX-TEX" aria-hidden="true" style="margin-left: 0px; margin-right: 0px;"><mjx-mrow><mjx-mo class="mjx-s3"><mjx-c class="mjx-c28 TEX-S3"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D440 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-mi class="mjx-n"><mjx-c class="mjx-c5F"></mjx-c></mjx-mi><mjx-texatom texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D443 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D459 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-mi class="mjx-n"><mjx-c class="mjx-c5F"></mjx-c></mjx-mi><mjx-texatom texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D446 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D467 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D447 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D43F TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D443 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D442 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D463 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45F TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2217"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D434 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D450 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D439 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D450 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45F TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mrow><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D43F TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi></mjx-mrow></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D43C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45F TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D459 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D437 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D459 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-s3"><mjx-c class="mjx-c29 TEX-S3"></mjx-c></mjx-mo></mjx-mrow><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2217"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c33"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D445 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-mi class="mjx-n"><mjx-c class="mjx-c5F"></mjx-c></mjx-mi><mjx-texatom texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D43F TEX-I"></mjx-c></mjx-mi><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-mi class="mjx-n"><mjx-c class="mjx-c5F"></mjx-c></mjx-mi><mjx-texatom texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D434 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D457 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mfrac><mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi>M</mi><mi>a</mi><mi>x</mi></mrow><mi mathvariant="normal">_</mi><mrow data-mjx-texclass="ORD"><mi>P</mi><mi>a</mi><mi>y</mi><mi>l</mi><mi>o</mi><mi>a</mi><mi>d</mi></mrow><mi mathvariant="normal">_</mi><mrow data-mjx-texclass="ORD"><mi>S</mi><mi>i</mi><mi>z</mi><mi>e</mi></mrow><mo>+</mo><mrow data-mjx-texclass="ORD"><mi>T</mi><mi>L</mi><mi>P</mi><mi>O</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>h</mi><mi>e</mi><mi>a</mi><mi>d</mi></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow><mo>∗</mo><mrow data-mjx-texclass="ORD"><mi>A</mi><mi>c</mi><mi>k</mi><mi>F</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></mrow></mrow><mrow><mi>L</mi><mi>i</mi><mi>n</mi><mi>k</mi><mi>W</mi><mi>i</mi><mi>d</mi><mi>t</mi><mi>h</mi></mrow></mfrac><mo>+</mo><mrow data-mjx-texclass="ORD"><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>n</mi><mi>a</mi><mi>l</mi><mi>D</mi><mi>e</mi><mi>l</mi><mi>a</mi><mi>y</mi></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow><mo>∗</mo><mn>3</mn><mo>+</mo><mrow data-mjx-texclass="ORD"><mi>R</mi><mi>x</mi></mrow><mi mathvariant="normal">_</mi><mrow data-mjx-texclass="ORD"><mi>L</mi><mn>0</mn><mi>s</mi></mrow><mi mathvariant="normal">_</mi><mrow data-mjx-texclass="ORD"><mi>A</mi><mi>d</mi><mi>j</mi><mi>u</mi><mi>s</mi><mi>t</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow></math></mjx-assistive-mml></mjx-container></div></div></div><div><div><div></div></div></div><div><div><div>The value in the timer represents a symbol time (4ns).</div></div></div><div><div><div></div></div></div><div><div><div>The equation fields are defined as follows:</div></div></div><div><div><div></div></div></div><div><ul><li>Max_Payload_Size is the value in the Max_Payload_Size field of the Device Control Register ("Device Capabilities Register" on page 900).</li></ul></div><div><div><div></div></div></div><div><ul><li>TLP Overhead includes the additional TLP fields beyond the data payload (header, digest, LCRC, and Start/End framing symbols). In the specification, the overhead value is treated as a constant of 28 symbols.</li></ul></div><div><div><div></div></div></div><div><ul><li>The Ack Factor is a fudge factor that represents the number of maximum-sized TLPs (based on Max_Payload) that can be received before an ACK DLLP must be sent. The AF value ranges from 1.0 to 3.0 and is used to balance Link bandwidth efficiency and Replay Buffer size. Figure 5-10 on page 229 summarizes the Ack Factor values for various Link widths and payloads. These Ack Factor values are chosen to allow implementations to achieve good performance without requiring a large uneconomical buffer.</li></ul></div><div><div><div></div></div></div><div><ul><li>Link Width ranges from 1-bit wide to 32-bits wide.</li></ul></div><div><div><div></div></div></div><div><ul><li>Internal Delay is the receiver's internal delay between receiving a TLP, processing it at the Data Link Layer, and returning an ACK or NAK DLLP. It is treated as a constant of 19 symbol times in these calculations.</li></ul></div><div><div><div></div></div></div><div><ul><li>Rx_L0s_Adjustment is the time required by the receive circuits to exit from L0s to L0, expressed in symbol times.</li></ul></div><div><div><div></div></div></div><div><div><div>REPLAY_TIMER Summary Table. Figure 5-10 on page 229 is a summary table that shows possible timer load values with various variables plugged into the REPLAY_TIMER equation.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="281" id="mark-904ab77b-96cb-4c24-bf23-814cbece280c" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 5-10: Table and Equation to Calculate REPLAY_TIMER Load Value</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Max_Payload Size</th><th>X1 Link</th><th>X2 Link</th><th>X4 Link</th><th>X8 Link</th><th>X12 Link</th><th>x16 Link</th><th>X32 Link</th></tr></thead><tbody><tr><td>128 Bytes</td><td>711</td><td>384</td><td>219</td><td>201</td><td>174</td><td>144</td><td>99</td></tr><tr><td>256 Bytes</td><td>1248</td><td>651</td><td>354</td><td>321</td><td>270</td><td>216</td><td>135</td></tr><tr><td>512 Bytes</td><td>1677</td><td>867</td><td>462</td><td>258</td><td>327</td><td>258</td><td>156</td></tr><tr><td>1024 Bytes</td><td>3213</td><td>1635</td><td>846</td><td>450</td><td>582</td><td>450</td><td>252</td></tr><tr><td>2048 Bytes</td><td>6285</td><td>3171</td><td>1614</td><td>834</td><td>1095</td><td>834</td><td>444</td></tr><tr><td>4096 Bytes</td><td>12,429</td><td>6243</td><td>3150</td><td>1602</td><td>2118</td><td>1602</td><td>828</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div>The table summarizes values calculated using the equation, minus the Rx_L0s_Adjustment term</div></div></div><div><div><div></div></div></div><div><div><div>Example: Assume a 2-lane link with a Max_Payload of 2048 bytes.</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="381" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mrow><mjx-mo class="mjx-lop"><mjx-c class="mjx-c5B TEX-S2"></mjx-c></mjx-mo><mjx-mfrac><mjx-frac><mjx-num><mjx-nstrut></mjx-nstrut><mjx-mrow size="s"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c34"></mjx-c><mjx-c class="mjx-c38"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c38"></mjx-c></mjx-mn></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c2217"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c39"></mjx-c></mjx-mn></mjx-texatom></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line></mjx-line><mjx-row><mjx-den><mjx-dstrut></mjx-dstrut><mjx-mn class="mjx-n" size="s"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-lop"><mjx-c class="mjx-c5D TEX-S2"></mjx-c></mjx-mo></mjx-mrow><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2217"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c33"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-munder space="4"><mjx-row><mjx-base><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c37"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-base></mjx-row><mjx-row><mjx-under style="padding-top: 0.18em;"><mjx-mo class="mjx-n"><mjx-box style="margin-bottom: -0.248em; vertical-align: -0.248em;"><mjx-stretchy-h class="mjx-c2013" style="width: 2em;"><mjx-ext><mjx-c></mjx-c></mjx-ext></mjx-stretchy-h></mjx-box></mjx-mo></mjx-under></mjx-row></mjx-munder></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">[</mo><mfrac><mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mn>2048</mn></mrow><mo>+</mo><mrow data-mjx-texclass="ORD"><mn>28</mn></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow><mo>∗</mo><mrow data-mjx-texclass="ORD"><mn>1.0</mn></mrow><mo>+</mo><mrow data-mjx-texclass="ORD"><mn>19</mn></mrow></mrow><mn>2</mn></mfrac><mo data-mjx-texclass="CLOSE">]</mo></mrow><mo>∗</mo><mn>3</mn><mo>=</mo><munder><mn>3171</mn><mo accent="true">―</mo></munder></math></mjx-assistive-mml></mjx-container> (about a 12.7uS timeout period)</div></div></div><div><div><div></div></div></div><h2><div><div>Transmitter DLLP Handling</div></div></h2><div><div><div></div></div></div><div><div><div>The DLLP CRC Error Checking block determines whether there is a CRC error in the received DLLP. The DLLP includes a 16-bit CRC for this purpose (see Table 5-1 on page 219). If there are no DLLP CRC errors, then the DLLPs are further processed. If a DLLP CRC error is detected, the DLLP is discarded, and the error is reported as a DLLP CRC error to the error handling logic which logs the error in the optional Advanced Error Reporting registers (see Bad DLLP in "Advanced Correctable Error Handling" on page 384). No further action is taken.</div></div></div><div><div><div></div></div></div><div><div><div>Discarding an ACK or NAK DLLP received in error is not a severe response because a subsequently received DLLP will accomplish the same goal as the discarded DLLP. The side effect of this action is that associated TLPs are purged a little later than they would have been or that a replay happens at a later time. If a subsequent DLLP is not received in time, the transmitter REPLAY_TIMER expires anyway, and the TLPs are replayed.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="282" id="mark-b6adc75d-58fe-4139-a69e-7c9abb7dc1de" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Receiver Protocol Details</div></div></h2><div><div><div></div></div></div><div><div><div>Consider the receive side of a device's Data Link Layer shown in Figure 5-5 on page 218.</div></div></div><div><div><div></div></div></div><h2><div><div>TLP Received at Physical Layer</div></div></h2><div><div><div></div></div></div><div><div><div>TLPs received at the Physical Layer are checked for STP and END framing errors as well as other receiver errors such as disparity errors. If there are no errors, the TLPs are passed to the Data Link Layer. If there are any errors, the TLP is discarded and the allocated storage is freed up. The Data Link Layer is informed of this error so that it can schedule a NAK DLLP. (see "Receiver Schedules a NAK" on page 233).</div></div></div><div><div><div></div></div></div><h2><div><div>Received TLP Error Check</div></div></h2><div><div><div></div></div></div><div><div><div>The receiver accepts TLPs from the Link into a receiver buffer and checks for CRC errors. The receiver calculates an expected LCRC value based on the received TLP (excluding the LCRC field) and compares this value with the TLP's 32-bit LCRC. If the two match, the TLP is good. If the two LCRC values do not match, the received TLP is bad and the receiver schedules a NAK DLLP to be returned to the remote transmitter. The receiver also checks for other types of non-CRC related errors (such as that described in the next section).</div></div></div><div><div><div></div></div></div><h2><div><div>Next Received TLP's Sequence Number</div></div></h2><div><div><div></div></div></div><div><div><div>The receiver keeps track of the next expected TLP's Sequence Number via a 12- bit counter referred to as the NEXT_RCV_SEQ counter. This counter is initialized to 0 at reset, or when the Data Link Layer is inactive. This counter is incremented once for each good TLP that is received and forwarded to the Transaction Layer. The counter rolls over to 0 after reaching a value of 4095 .</div></div></div><div><div><div></div></div></div><div><div><div>The receiver uses the NEXT_RCV_SEQ counter to identify the Sequence Number that should be in the next received TLP. If a received TLP has no LCRC error, the device compares its Sequence Number with the NEXT_RCV_SEQ count. Under normal operational conditions, these two numbers should match. If this is the case, the receiver accepts the TLP, forwards the TLP to the Transaction Layer, increments the NEXT_RCV_SEQ counter and is ready for the next TLP. An ACK DLLP may be scheduled for return if the ACKNAK_LATENCY_ TIMER expires or exceeds its set value. The receiver is ready to perform a comparison on the next received TLP's Sequence Number.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="283" id="mark-251aba18-97b0-4a07-8a8e-8dfb19dc6f6b" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>In some cases, a received TLP's Sequence Number may not match the NEXT_RCV_SEQ count. The received TLP's Sequence Number may be either logically greater than or logically less than NEXT_RCV_SEQ count (a logical number in this case accounts for the count rollover, so in fact a logically greater number may actually be a lower number if the count rolls over). See "Receiver Sequence Number Check" on page 234 for details on these two abnormal conditions.</div></div></div><div><div><div></div></div></div><div><div><div>For a TLP received with a CRC error, or a nullified TLP or a TLP for which the Sequence Number check described above fails, the NEXT_RCV_SEQ counter is not incremented.</div></div></div><div><div><div></div></div></div><h2><div><div>Receiver Schedules An ACK DLLP</div></div></h2><div><div><div></div></div></div><div><div><div>If the receiver does not detect an LCRC error (see "Received TLP Error Check" on page 230) or a Sequence Number related error (see "Next Received TLP's Sequence Number" on page 230) associated with a received TLP, it accepts the TLP and sends it to the Transaction Layer. The NEXT_RCV_SEQ counter is incremented and the receiver is ready for the next TLP. At this point, the receiver can schedule an ACK DLLP with the Sequence Number of the received TLP (see the AckNak_Seq_Num[11:0] field described in Table 5-1 on page 219). Alternatively, the receiver could also wait for additional TLPs and schedule an ACK DLLP with the Sequence Number of the last good TLP received.</div></div></div><div><div><div></div></div></div><div><div><div>The receiver is allowed to accumulate a number of good TLPs and then sends one aggregate ACK DLLP with a Sequence Number of the latest good TLP received. The coalesced ACK DLLP acknowledges the good receipt of a collection of TLPs starting with the oldest TLP in the transmitter's Replay Buffer and ending with the TLP being acknowledged by the current ACK DLLP. By doing so, the receiver optimizes the use of Link bandwidth due to reduced ACK DLLP traffic. The frequency with which ACK DLLPs are scheduled for return is described in "Receivers ACKNAK_LATENCY_TIMER" on page 237. When the ACKNAK_LATENCY_ TIMER expires or exceeds its set value and TLPs are received, an ACK DLLP with a Sequence Number of the last good TLP is returned to the transmitter. PCI Express System Architecture</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="284" id="mark-a417cc7b-cb1d-4e62-9f28-a6775eadbe69" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>When the receiver schedules an ACK DLLP to be returned to the remote transmitter, the receiver might have other packets (TLPs, DLLPs or PLPs) enqueued that also have to be transmitted on the Link in the same direction as the ACK DLLP. This implies that the receiver may not immediately return the ACK DLLP to the transmitter, especially if a large TLP (with up to a 4KB data payload) is already being transmitted (see "Recommended Priority To Schedule Packets" on page 244).</div></div></div><div><div><div></div></div></div><div><div><div>The receiver continues to receive TLPs and as long as there are no detected errors (LCRC or Sequence Number errors), it forwards the TLPs to the Transaction Layer. When the receiver has the opportunity to return the ACK DLLP to the remote transmitter, it appends the Sequence Number of the latest good TLP received and returns the ACK DLLP. Upon receipt of the ACK DLLP, the remote transmitter purges its Replay Buffer of the TLPs with matching Sequence Numbers and all TLPs transmitted earlier than the acknowledged TLP.</div></div></div><div><div><div></div></div></div><h2><div><div>Example of Receiver ACK Scheduling</div></div></h2><div><div><div></div></div></div><div><div><div>Example: Consider Figure 5-11 on page 233, with focus on the receiver Device B.</div></div></div><div><div><div></div></div></div><div><ol><li value="1">Device A transmits TLPs with Sequence Numbers 4094, 4095, 0, 1, and 2, where TLP 4094 is the first TLP sent and TLP 2 is the last TLP sent.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">Device B receives TLPs with Sequence Numbers 4094, 4095, 0, and 1, in that order. NEXT_RCV_SEQ count increments to 2. TLP 2 is still en route.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">Device B performs error checks and issues a coalesced ACK to collectively acknowledge receipt of TLPs 4094, 4095, 0, and 1, with the return of an ACK DLLP with Sequence Number of 1.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">Device B forwards TLPs 4094, 4095, 0, and 1 to its Transaction Layer.</li></ol></div><div><div><div></div></div></div><div><ol><li value="5">When Device B ultimately receives TLP 2, steps 3 and 4 may be repeated for TLP 2.</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="285" id="mark-11201e8d-b7ee-4fb8-ab97-29fcf7503c5f" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 5-11: Example that Shows Receiver Behavior with Receipt of Good TLP</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_292.jpg?x=223&amp;y=402&amp;w=995&amp;h=667"></div></div><div><div><div></div></div></div><h2><div><div>NAK Scheduled Flag</div></div></h2><div><div><div></div></div></div><div><div><div>The receiver implements a Flag bit referred to as the NAK_SCHEDULED flag. When a receiver detects a TLP CRC error, or any other non-CRC related error that requires it to schedule a NAK DLLP to be returned, the receiver sets the NAK_SCHEDULED flag and clears it when the receiver detects replayed TLPs from the transmitter for which there are no CRC errors.</div></div></div><div><div><div></div></div></div><h2><div><div>Receiver Schedules a NAK</div></div></h2><div><div><div></div></div></div><div><div><div>Upon receipt of a TLP, the first type of error condition the receiver may detect is a TLP LCRC error (see "Received TLP Error Check" on page 230). The receiver discards the bad TLP. If the NAK_SCHEDULED flag is clear, it schedules a NAK DLLP to return to the transmitter. The NAK_SCHEDULED flag is then set. The receiver uses the NEXT_RCV_SEQ count - 1 count value as the AckNak_Seq_Num [11:0] field in the NAK DLLP (Table 5-1 on page 219). At the time the receiver schedules a NAK DLLP to return to the transmitter, the Link may be in use to transmit other queued TLPs, DLLPs or PLPs. In that case, the PCI Express System Architecture</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="286" id="mark-220215db-82a7-4916-8876-fcd2e01cb3ed" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>receiver delays the transmission of the NAK DLLP (see "Recommended Priority To Schedule Packets" on page 244). When the Link becomes available, however, it sends the NAK DLLP to the remote transmitter. The transmitter replays the TLPs from the Replay Buffer (see "TLP Replay" on page 225).</div></div></div><div><div><div></div></div></div><div><div><div>In the meantime, TLPs currently en route continue to arrive at the receiver. These TLPs have later Sequence Numbers than the NEXT_RCV_SEQ count. The receiver discards them. The specification is unclear about whether the receiver should schedule a NAK DLLP for these TLPs. It is the authors' interpretation that the receiver must not schedule the return of additional NAK DLLPs for subsequently received TLPs while the NAK_SCHEDULED flag remains set.</div></div></div><div><div><div></div></div></div><div><div><div>The receiver detects a replayed TLP when it receives a TLP with Sequence Numbers that matches NEXT_RCV_SEQ count. If the replayed TLPs arrive with no errors, the receiver increments NEXT_RCV_SEQ count and clears the NAK_SCHEDULED flag. The receiver may schedule an ACK DLLP for return to the transmitter if the ACKNAK_LATENCY_TIMER expires. The good replayed TLPs are forwarded to the Transaction Layer.</div></div></div><div><div><div></div></div></div><div><div><div>There is a second scenario under which the receiver schedules NAK DLLPs to return to the transmitter. If the receiver detects a TLP with a later Sequence Number than the next expected Sequence Number indicated by NEXT_RCV_SEQ count or for which the TLP has a Sequence Number that is separated from NEXT_RCV_SEQ count by more than 2048, the above described procedure is repeated. See "Receiver Sequence Number Check" below for the reasons why this could happen.</div></div></div><div><div><div></div></div></div><div><div><div>The two error conditions just described wherein a NAK DLLP is scheduled for return are reported as errors associated with the Data Link Layer. The error reported is a bad TLP error with a severity of correctable.</div></div></div><div><div><div></div></div></div><h2><div><div>Receiver Sequence Number Check</div></div></h2><div><div><div></div></div></div><div><div><div>Every received TLP that passes the CRC check goes through a Sequence Number check. The received TLPs Sequence Number is compared with the NEXT_RCV_SEQ count. Below are three possibilities:</div></div></div><div><div><div></div></div></div><div><ul><li>TLP Sequence Number equal NEXT_RCV_SEQ count. This situation results when a good TLP is received. It also occurs when a replayed TLP is received. The TLP is accepted and forwarded to the Transaction Layer. NEXT_RCV_SEQ count is incremented and an ACK DLLP may be scheduled (according to the ACK DLLP scheduling rules described in "Receiver Schedules An ACK DLLP" on page 231).</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="287" id="mark-b527b3c0-7973-4aa0-b000-427a6f56e385" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><ul><li>TLP Sequence Number is logically less than NEXT_RCV_SEQ count (earlier Sequence Number). This situation results when a duplicate TLP is received as the result of a replay event. The duplicate TLP is discarded. NEXT_RCV_SEQ count is not incremented. An ACK DLLP is scheduled so that the transmitter can purge its Replay Buffer of the duplicate TLP(s). The receiver uses the NEXT_RCV_SEQ count - 1 in the ACK DLLP's AckNak_Seq_Num[11:0] field. What scenario results in a duplicate TLP being received? Consider this example. A receiver accepts a TLP and returns an associated ACK DLLP and increments the NEXT_RCV_SEQ count. The ACK DLLP is lost en route to the transmitter. As a result, this TLP remains in the remote transmitter's Replay Buffer. The transmitter's REPLAY_TIMER expires when no further ACK DLLPs are received. This causes the transmitter to replay the entire contents of the Replay Buffer. The receiver sees these TLPs with earlier Sequence Numbers than the NEXT_RCV_SEQ count and discards them because they are duplicate TLPs. More precisely, a TLP is a duplicate TLP if:</li></ul></div><div><div><div></div></div></div><div><div><div>(NEXT_RCV_SEQ - TLP Sequence Number) mod <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="382" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c39"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3C"></mjx-c><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c34"></mjx-c><mjx-c class="mjx-c38"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>4096</mn></mrow><mo>&lt;=</mo><mrow data-mjx-texclass="ORD"><mn>2048</mn></mrow></math></mjx-assistive-mml></mjx-container> . An ACK DLLP is returned for every duplicate TLP received.</div></div></div><div><div><div></div></div></div><div><ul><li>TLP Sequence Number is logically greater than NEXT_RCV_SEQ count (later Sequence Number). This situation results when one or more TLPs are lost en route. The receiver schedules a NAK DLLP for return to the transmitter if NAK_SCHEDULED flag is clear (see NAK DLLP scheduling rules described in "Receiver Schedules a NAK" on page 233). NEXT_RCV_SEQ count does not increment when the receiver receives such TLPs of later Sequence Number.</li></ul></div><div><div><div></div></div></div><h2><div><div>Receiver Preserves TLP Ordering</div></div></h2><div><div><div></div></div></div><div><div><div>In addition to guaranteeing reliable TLP transport, the ACK/NAK protocol preserves packet ordering. The receiver's Transaction Layer receives TLPs in the same order that the transmitter sent them.</div></div></div><div><div><div></div></div></div><div><div><div>A transmitter correctly orders TLPs according to the ordering rules before transmission in order to maintain correct program flow and to eliminate the occurrence of potential deadlock and livelock conditions (see Chapter 8, entitled "Transaction Ordering," on page 315). The Receiver is required to preserve TLP order (otherwise, application program flow is altered). To preserved this order, the receiver applies three rules:</div></div></div><div><div><div></div></div></div><div><ul><li>When the receiver detects a bad TLP, it discards the TLP and all new TLPs that follow in the pipeline until the replayed TLPs are detected.</li></ul></div><div><div><div></div></div></div><div><ul><li>Also, duplicate TLPs are discarded.</li></ul></div><div><div><div></div></div></div><div><ul><li>TLPs received after one or more lost TLPs are received are discarded. PCI Express System Architecture</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="288" id="mark-9136e917-802b-4eb3-b595-9360c7bed8f5" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>For TLPs that arrive after the first bad TLP, the motivation to discard these TLPs, not forward them to the Transaction Layer and schedule a NAK DLLP is as follows. When the receiver detects a bad TLP, it discards it and any new TLPs in the pipeline. The receiver then waits for TLP replay. After verifying that there are no errors in the replayed TLP(s), the receiver forwards them to the Transaction Layer and resumes acceptance of new TLPs in the pipeline. Doing so preserves TLP receive and acceptance order at the receivers Transaction Layer.</div></div></div><div><div><div></div></div></div><h2><div><div>Example of Receiver NAK Scheduling</div></div></h2><div><div><div></div></div></div><div><div><div>Example: Consider Figure 5-12 on page 237 with emphasis on the receiver Device B.</div></div></div><div><div><div></div></div></div><div><ol><li value="1">Device A transmits TLPs with Sequence Numbers 4094, 4095, 0, 1, and 2, where TLP 4094 is the first TLP sent and TLP 2 is the last TLP sent.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">Device B receives TLPs 4094, 4095, and 0, in that order. TLPs 1 and 2 are still in flight.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">Device B receives TLP 4094 with no errors and forwards it to the Transaction Layer. NEXT_RCV_SEQ count increments to 4095.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">Device B detects an LCRC error in TLP 4095 and hence returns a NAK DLLP with a Sequence Number of 4094 (NEXT_RCV_SEQ count - 1). The NAK_SCHEDULED flag is set. NEXT_RCV_SEQ count does not increment.</li></ol></div><div><div><div></div></div></div><div><ol><li value="5">Device B discards TLP 4095.</li></ol></div><div><div><div></div></div></div><div><ol><li value="6">Device B also discards TLP 0, even though it is a good TLP. Also TLP 1 and 2 are discarded when they arrive.</li></ol></div><div><div><div></div></div></div><div><ol><li value="7">Device B does not schedule a NAK DLLP for TLP 0, 1 and 2 because the NAK_SCHEDULED flag is set.</li></ol></div><div><div><div></div></div></div><div><ol><li value="8">Device A receives NAK 4094.</li></ol></div><div><div><div></div></div></div><div><ol><li value="9">Device A does not accept any new TLPs from its Transaction Layer.</li></ol></div><div><div><div></div></div></div><div><ol><li value="10">Device A first purges TLP 4094.</li></ol></div><div><div><div></div></div></div><div><ol><li value="11">Device A then replays TLPs 4095, 0, 1, and 2, but continues to save these TLPs in the Replay Buffer. It then accepts TLPs from the Transaction Layer.</li></ol></div><div><div><div></div></div></div><div><ol><li value="12">Replayed TLPs 4095, 0, 1, and 2 arrive at Device B in that order.</li></ol></div><div><div><div></div></div></div><div><ol><li value="13">After verifying that there are no CRC errors in the received TLPs, device B detects TLP 4095 as a replayed TLP because it has a Sequence Number equal to NEXT_RCV_SEQ count. NAK_SCHEDULED flag is cleared.</li></ol></div><div><div><div></div></div></div><div><ol><li value="14">Device B forwards these TLPs to the Transaction Layer in this order: 4095, 0, 1, and 2.</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="289" id="mark-3d541a9e-1296-42ce-bcc9-53b2f7f20da2" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 5-12: Example that Shows Receiver Behavior When It Receives Bad TLPs</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_296.jpg?x=224&amp;y=420&amp;w=994&amp;h=719"></div></div><div><div><div></div></div></div><h2><div><div>Receivers ACKNAK_LATENCY_TIMER</div></div></h2><div><div><div></div></div></div><div><div><div>The ACKNAK_LATENCY_TIMER measures the duration since an ACK or NAK DLLP was scheduled for return to the remote transmitter. This timer has a value that is approximately <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="383" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mn>3</mn></math></mjx-assistive-mml></mjx-container> that of the transmitter REPLAY_TIMER. When the timer expires, the receiver schedules an ACK DLLP with a Sequence Number of the last good unacknowledged TLP received. The timer guarantees that the receiver schedules an ACK or NAK DLLP for a received TLP before the transmitter's REPLAY_TIMER expires causing it to replay.</div></div></div><div><div><div></div></div></div><div><div><div>The timer resets to 0 and restarts when an ACK or NAK DLLP is scheduled.</div></div></div><div><div><div></div></div></div><div><div><div>The timer resets to 0 and holds when:</div></div></div><div><div><div></div></div></div><div><ul><li>All received TLPs have been acknowledged.</li></ul></div><div><div><div></div></div></div><div><ul><li>The Data Link Layer is in the inactive state.</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="290" id="mark-89726285-47aa-46cd-afbb-87a3850e8cb8" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>ACKNAK_LATENCY_TIMER Equation. The receiver's ACKNAK_ LATENCY_TIMER is loaded with a value that reflects the worst-case transmission latency in sending an ACK or NAK in response to a received TLP. This time depends on the anticipated maximum payload size and the width of the Link.</div></div></div><div><div><div></div></div></div><div><div><div>The equation to calculate the ACKNAK_LATENCY_TIMER value required is:</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" display="true" tabindex="0" ctxtmenu_counter="384" style="font-size: 122.8%; position: relative;"><mjx-math display="true" class="MJX-TEX" aria-hidden="true" style="margin-left: 0px; margin-right: 0px;"><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mtext class="mjx-n"><mjx-c class="mjx-cA0"></mjx-c><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c61"></mjx-c><mjx-c class="mjx-c78"></mjx-c><mjx-c class="mjx-c5F"></mjx-c><mjx-c class="mjx-c50"></mjx-c><mjx-c class="mjx-c61"></mjx-c><mjx-c class="mjx-c79"></mjx-c><mjx-c class="mjx-c6C"></mjx-c><mjx-c class="mjx-c6F"></mjx-c><mjx-c class="mjx-c61"></mjx-c><mjx-c class="mjx-c64"></mjx-c><mjx-c class="mjx-c5F"></mjx-c><mjx-c class="mjx-c53"></mjx-c><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c7A"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mtext class="mjx-n" space="3"><mjx-c class="mjx-cA0"></mjx-c><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c4C"></mjx-c><mjx-c class="mjx-c50"></mjx-c><mjx-c class="mjx-c4F"></mjx-c><mjx-c class="mjx-c76"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-c68"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c61"></mjx-c><mjx-c class="mjx-c64"></mjx-c><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2217"></mjx-c></mjx-mo><mjx-mtext class="mjx-n" space="3"><mjx-c class="mjx-cA0"></mjx-c><mjx-c class="mjx-c41"></mjx-c><mjx-c class="mjx-c63"></mjx-c><mjx-c class="mjx-c6B"></mjx-c><mjx-c class="mjx-c46"></mjx-c><mjx-c class="mjx-c61"></mjx-c><mjx-c class="mjx-c63"></mjx-c><mjx-c class="mjx-c74"></mjx-c><mjx-c class="mjx-c6F"></mjx-c><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mtext class="mjx-n"><mjx-c class="mjx-cA0"></mjx-c><mjx-c class="mjx-c4C"></mjx-c><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c6E"></mjx-c><mjx-c class="mjx-c6B"></mjx-c><mjx-c class="mjx-c57"></mjx-c><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c64"></mjx-c><mjx-c class="mjx-c74"></mjx-c><mjx-c class="mjx-c68"></mjx-c><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mtext class="mjx-n" space="3"><mjx-c class="mjx-cA0"></mjx-c><mjx-c class="mjx-c49"></mjx-c><mjx-c class="mjx-c6E"></mjx-c><mjx-c class="mjx-c74"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-c6E"></mjx-c><mjx-c class="mjx-c61"></mjx-c><mjx-c class="mjx-c6C"></mjx-c><mjx-c class="mjx-c44"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c6C"></mjx-c><mjx-c class="mjx-c61"></mjx-c><mjx-c class="mjx-c79"></mjx-c><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mtext class="mjx-n" space="3"><mjx-c class="mjx-cA0"></mjx-c><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c78"></mjx-c><mjx-c class="mjx-c5F"></mjx-c><mjx-c class="mjx-c4C"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c73"></mjx-c><mjx-c class="mjx-c5F"></mjx-c><mjx-c class="mjx-c41"></mjx-c><mjx-c class="mjx-c64"></mjx-c><mjx-c class="mjx-c6A"></mjx-c><mjx-c class="mjx-c75"></mjx-c><mjx-c class="mjx-c73"></mjx-c><mjx-c class="mjx-c74"></mjx-c><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c6E"></mjx-c><mjx-c class="mjx-c74"></mjx-c><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext></mjx-math><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mfrac><mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mtext>&nbsp;Max_Payload_Size&nbsp;</mtext><mo>+</mo><mtext>&nbsp;TLPOverhead&nbsp;</mtext></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow><mo>∗</mo><mtext>&nbsp;AckFactor&nbsp;</mtext></mrow><mtext>&nbsp;LinkWidth&nbsp;</mtext></mfrac><mo>+</mo><mtext>&nbsp;InternalDelay&nbsp;</mtext><mo>+</mo><mtext>&nbsp;Tx_L0s_Adjustment&nbsp;</mtext></math></mjx-assistive-mml></mjx-container></div></div></div><div><div><div></div></div></div><div><div><div>The value in the timer represents symbol times (a symbol time <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="385" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c34"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c6E"></mjx-c><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>4</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">ns</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> ).</div></div></div><div><div><div></div></div></div><div><div><div>The fields above are defined as follows:</div></div></div><div><div><div></div></div></div><div><ul><li>Max_Payload_Size is the value in the Max_Payload_Size field of the Device Control Register (see page 900).</li></ul></div><div><div><div></div></div></div><div><ul><li>TLP Overhead includes the additional TLP fields beyond the data payload (header, digest, LCRC, and Start/End framing symbols). In the specification, the overhead value is treated as a constant of 28 symbols.</li></ul></div><div><div><div></div></div></div><div><ul><li>The Ack Factor is the biggest number of maximum-sized TLPs (based on Max_Payload) which can be received before an ACK DLLP is sent. The AF value (it's a fudge factor) ranges from 1.0 to 3.0, and is used to balance Link bandwidth efficiency and Replay Buffer size. Figure 5-10 on page 229 summarizes the Ack Factor values for various Link widths and payloads. These Ack Factor values are chosen to allow implementations to achieve good performance without requiring a large, uneconomical buffer.</li></ul></div><div><div><div></div></div></div><div><ul><li>Link Width ranges from 1-bit wide to 32-bits wide.</li></ul></div><div><div><div></div></div></div><div><ul><li>Internal Delay is the receiver's internal delay between receiving a TLP, processing it at the Data Link Layer, and returning an ACK or NAK DLLP. It is treated as a constant of 19 symbol times in these calculations.</li></ul></div><div><div><div></div></div></div><div><ul><li>Tx_L0s_Adjustment: If L0s is enabled, the time required for the transmitter to exit L0s, expressed in symbol times. Note that setting the Extended Sync bit of the Link Control register affects the exit time from L0s and must be taken into account in this adjustment.</li></ul></div><div><div><div></div></div></div><div><div><div>It turns out that the entries in this table are approximately a third in value of the REPLAY_TIMER latency values in Figure 5-10 on page 229.</div></div></div><div><div><div></div></div></div><div><div><div>ACKNAK_LATENCY_TIMER Summary Table. Figure 5-13 on page 239 is a summary table that shows possible timer load values with various variables plugged into the ACKNAK_LATENCY_TIMER equation.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="291" id="mark-627ae087-9aa8-4540-a938-0b97acd01829" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 5-13: Table to Calculate ACKNAK_LATENCY_TIMER Load Value</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Max_Payload Size</th><th>X1 Link</th><th>X2 Link</th><th>X4 Link</th><th>X8 Link</th><th>X12 Link</th><th>x16 Link</th><th>X32 Link</th></tr></thead><tbody><tr><td>128 Bytes</td><td>237 (AF=1.4)</td><td>128 <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="386" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c41"></mjx-c><mjx-c class="mjx-c46"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">AF</mi></mrow></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>1.4</mn></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container></td><td>73 (AF=1.4)</td><td>67 (AF=2.5)</td><td>58 (AF=3.0)</td><td>48 (AF=3.0)</td><td>33 (AF=3.0)</td></tr><tr><td>256 Bytes</td><td>416 (AF=1.4)</td><td>217 (AF=1.4)</td><td>118 (AF=1.4)</td><td>107 (AF=2.5)</td><td>90 (AF=3.0)</td><td>72 (AF=3.0)</td><td>45 (AF=3.0)</td></tr><tr><td>512 Bytes</td><td>559 <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="387" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c41"></mjx-c><mjx-c class="mjx-c46"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">AF</mi></mrow></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>1.0</mn></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container></td><td>289 <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="388" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c41"></mjx-c><mjx-c class="mjx-c46"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">AF</mi></mrow></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>1.0</mn></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container></td><td>154 (AF=1.0)</td><td>86 (AF=1.0)</td><td>109 (AF=2.0)</td><td>86 (AF=2.0)</td><td>52 (AF=2.0)</td></tr><tr><td>1024 Bytes</td><td>1071 <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="389" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c41"></mjx-c><mjx-c class="mjx-c46"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">AF</mi></mrow></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>1.0</mn></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container></td><td>545 <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="390" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c41"></mjx-c><mjx-c class="mjx-c46"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">AF</mi></mrow></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>1.0</mn></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container></td><td>282 (AF=1.0)</td><td>150 (AF=1.0)</td><td>194 (AF=2.0)</td><td>150 (AF=2.0)</td><td>84 (AF=2.0)</td></tr><tr><td>2048 Bytes</td><td>2095 (AF=1.0)</td><td>1057 (AF=1.0)</td><td>538 (AF=1.0)</td><td>278 (AF=1.0)</td><td>365 (AF=2.0)</td><td>278 (AF=2.0)</td><td>148 (AF=2.0)</td></tr><tr><td>4096 Bytes</td><td>4143 (AF=1.0)</td><td>2081 <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="391" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c41"></mjx-c><mjx-c class="mjx-c46"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">AF</mi></mrow></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>1.0</mn></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container></td><td>1050 (AF=1.0)</td><td>534 (AF=1.0)</td><td>706 (AF=2.0)</td><td>534 (AF=2.0)</td><td>276 (AF=2.0)</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>Error Situations Reliably Handled by ACK/NAK Protocol</div></div></h2><div><div><div></div></div></div><div><div><div>This section describes the possible sources of errors that may occur in delivery of TLPs from a transmitter to a receiver across a Link. The ACK/NAK protocol guarantees reliable delivery of TLPs despite the unlikely event that these errors occur. Below is a bullet list of errors and the related error correction mechanism the protocol uses to resolve the error:</div></div></div><div><div><div></div></div></div><div><ul><li>Problem: CRC error occurs in transmission of a TLP (see "Transmitter's Response to a NAK DLLP" on page 224 and "Receiver Schedules a NAK" on page 233.)</li></ul></div><div><div><div></div></div></div><div><div><div>Solution: Receiver detects LCRC error and schedules a NAK DLLP with Sequence Number <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="392" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo></math></mjx-assistive-mml></mjx-container> NEXT_RCV_SEQ count - 1. Transmitter replays TLPs.</div></div></div><div><div><div></div></div></div><div><ul><li>Problem: One or more TLPs are lost en route to the receiver.</li></ul></div><div><div><div></div></div></div><div><div><div>Solution: The receiver performs a sequence number check on all received TLPs. The receiver expects TLPs to arrive with each TLP that has an incremented 12-bit Sequence Number from that in the previous TLP. If one or more TLPs are lost en route, a TLP will have a Sequence Number issued later than expected Sequence Number reflected in the NEXT_RCV_SEQ count. The receiver schedules a NAK DLLP with a Sequence Number <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="393" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo></math></mjx-assistive-mml></mjx-container> NEXT_RCV_SEQ count - 1. Transmitter replays the Replay Buffer contents.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="292" id="mark-17513a4f-0711-4391-a7fa-0a1044ab3a09" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><ul><li>Problem: Receiver returns an ACK DLLP, but it is corrupted en route to the transmitter. The remote Transmitter detects a CRC error in the DLLP (DLLP is covered by 16-bit CRC, see "ACK/NAK DLLP Format" on page 219). In fact, the transmitter does not know that the malformed DLLP just received is supposed to be an ACK DLLP. All it knows is that the packet is a DLLP. Solution:</li></ul></div><div><div><div></div></div></div><div><ul><li>Case 1: The Transmitter discards the DLLP. A subsequent ACK DLLP received with a later Sequence Number causes the transmitter Replay Buffer to purge all TLPs with equal and earlier generated Sequence Numbers. The transmitter never knew that anything went wrong.</li></ul></div><div><div><div></div></div></div><div><ul><li>Case 2: The Transmitter discards the DLLP. A subsequent NAK DLLP received with a later generated Sequence Number causes the transmitter Replay Buffer to purge TLPs with equal to an earlier Sequence Numbers. The transmitter then replay all TLPs with later Sequence Numbers till the last TLP in the Replay Buffer. The transmitter never knew that anything went wrong.</li></ul></div><div><div><div></div></div></div><div><ul><li>Problem: ACK or NAK DLLP for received TLPs are not returned by the receiver by the proper ACKNAK_LATENCY_TIMER time-out. The associated TLPs remain in the transmitter Replay Buffer.</li></ul></div><div><div><div></div></div></div><div><div><div>Solution: The REPLAY_TIMER times-out and the transmitter replays its Replay Buffer.</div></div></div><div><div><div></div></div></div><div><ul><li>Problem: The Receiver returns a NAK DLLP but it is corrupted en route to the transmitter. The remote Transmitter detects a CRC error in the DLLP. In fact, the transmitter does not know that the DLLP received is supposed to be an NAK DLLP. All it knows is that the packet is a DLLP.</li></ul></div><div><div><div></div></div></div><div><div><div>Solution: The Transmitter discards the DLLP. The receiver discards all subsequently received TLPs and awaits the replay. Given that the NAK was rejected by the transmitter, it's REPLAY_TIMER expires and triggers the replay.</div></div></div><div><div><div></div></div></div><div><ul><li>Problem: Due to an error in the receiver, it is unable to schedule an ACK or NAK DLLP for a received TLP.</li></ul></div><div><div><div></div></div></div><div><div><div>Solution: The transmitter REPLAY_TIMER will expire and result in TLP replay.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="293" id="mark-f415a723-17fb-4bec-9edb-4473f3f8538a" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>ACK/NAK Protocol Summary</div></div></h2><div><div><div></div></div></div><div><div><div>Refer to Figure 5-3 on page 212 and the following subsections for a summary of the elements of the Data Link Layer.</div></div></div><div><div><div></div></div></div><h2><div><div>Transmitter Side</div></div></h2><div><div><div></div></div></div><h2><div><div>Non-Error Case (ACK DLLP Management)</div></div></h2><div><div><div></div></div></div><div><ul><li>Unless blocked by the Data Link Layer, the Transaction Layer passes down the Header, Data, and Digest information for each TLP to be sent.</li></ul></div><div><div><div></div></div></div><div><ul><li>Each TLP is assigned a 12-bit Sequence Number using current NEXT_TRANSMIT_SEQ count.</li></ul></div><div><div><div></div></div></div><div><ul><li>A check is made to see if the acceptance of new TLPs from the Transaction Layer should be blocked. The transmitter performs a modulo 4096 subtraction of the ACKD_SEQ count from the NEXT_TRANSMIT_SEQ count to see if the result is <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="394" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3E"></mjx-c><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c34"></mjx-c><mjx-c class="mjx-c38"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c64"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>&gt;=</mo><mrow data-mjx-texclass="ORD"><mn>2048</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">d</mi></mrow></math></mjx-assistive-mml></mjx-container> . If it is,further TLPs are blocked until incoming ACK/NAK DLLPs render the equation untrue.</li></ul></div><div><div><div></div></div></div><div><ul><li>The NEXT_TRANSMIT_SEQ counter increments by one for each TLP processed. Note: if the transmitter wants to nullify a TLP being sent, it sends an inverted CRC to the physical layer and indicates an EDB end (End Bad Packet) symbol should be used (NEXT_TRANSMIT_SEQ is not incremented). See the "Switch Cut-Through Mode" on page 248 for details.</li></ul></div><div><div><div></div></div></div><div><ul><li>A 32-bit LCRC value is calculated for the TLP (the LCRC calculation includes the Sequence Number).</li></ul></div><div><div><div></div></div></div><div><ul><li>A copy of the TLP is placed in the Replay Buffer and the TLP is forwarded to the Physical Layer for transmission.</li></ul></div><div><div><div></div></div></div><div><ul><li>The Physical Layer adds STP and END framing symbols, then transmits the packet.</li></ul></div><div><div><div></div></div></div><div><ul><li>At a later time, assume the transmitter receives an ACK DLLP from the receiver. It performs a CRC error check and, if the check fails, discards the ACK DLLP (the same holds true if a bad NAK DLLP is received). If the check is OK, it purges the Replay buffer of TLPs from the oldest TLP up to and including the TLP with Sequence Number that matches the Sequence Number in the ACK DLLP. PCI Express System Architecture</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="294" id="mark-cd2438f5-0bed-446d-9c58-f6b93889523c" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Error Case (NAK DLLP Management)</div></div></h2><div><div><div></div></div></div><div><div><div>Repeat the process described in the previous section, but this time, assume that the transmitter receives a NAK DLLP:</div></div></div><div><div><div></div></div></div><div><ul><li>Upon receipt of the NAK DLLP with no CRC error, the transmitter follows the following sequence of steps in performing the Replay. NOTE: this is the same sequence of events which would occur if the REPLAY_TIMER expires instead.</li></ul></div><div><div><div></div></div></div><div><ul><li>The REPLAY_NUM is incremented. The maximum number of attempts to clear (ACK) all unacknowledged TLPs in the Replay Buffer is four.</li></ul></div><div><div><div></div></div></div><div><ul><li>If the REPLAY_NUM count rolls over from <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="395" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>11</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> to <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="396" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>00</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> ,the transmitter instructs the Physical Layer to re-train the Link.</li></ul></div><div><div><div></div></div></div><div><ul><li>If REPLAY_NUM does not roll over, proceed.</li></ul></div><div><div><div></div></div></div><div><ul><li>Block acceptance of new TLPs from the Transaction Layer.</li></ul></div><div><div><div></div></div></div><div><ul><li>Complete transmission of any TLPs in progress.</li></ul></div><div><div><div></div></div></div><div><ul><li>Purge any TLPs of equal or earlier Sequence Numbers than NAK DLLP's AckNak_Seq_Num[11:0].</li></ul></div><div><div><div></div></div></div><div><ul><li>Re-transmit TLPs with later Sequence Numbers than the NAK DLLP's</li></ul></div><div><div><div></div></div></div><div><div><div>AckNak_Seq_Num[11:0].</div></div></div><div><div><div></div></div></div><div><ul><li>ACK DLLPs or NAK DLLPs received during replay must be processed. The transmitter may disregard them until replay is complete or use them during replay to skip transmission of newly acknowledged TLPs. Earlier Sequence Numbers can be collapsed when an ACK DLLP is received with a later Sequence Number. Also, ACK DLLPs with later Sequence Numbers than a NAK DLLP received earlier supersede the earlier NAK DLLP.</li></ul></div><div><div><div></div></div></div><div><ul><li>When the replay is complete, unblock TLPs and return to normal operation.</li></ul></div><div><div><div></div></div></div><h2><div><div>Receiver Side</div></div></h2><div><div><div></div></div></div><h2><div><div>Non-Error Case</div></div></h2><div><div><div></div></div></div><div><div><div>TLPs are received at the Physical Layer where they are checked for framing errors and other receiver-related errors. Assume that there are no errors. If the Physical Layer reports the end symbol was EDB and the CRC value was inverted, this is not an error condition; discard the packet and free any allocated space (see "Switch Cut-Through Mode" on page 248). There will be no ACK or NAK DLLP returned for this case.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="295" id="mark-850bb876-f7f6-4ba5-9eae-d9f3f6206d8f" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>The sequence of steps performed are as follows:</div></div></div><div><div><div></div></div></div><div><ul><li>Calculate the CRC for the incoming TLP and check it against the LCRC provided with the packet. If the CRC passes, go to the next step.</li></ul></div><div><div><div></div></div></div><div><ul><li>Compare the Sequence Number for the inbound packet against the current value in the NEXT_RCV_SEQ count.</li></ul></div><div><div><div></div></div></div><div><ul><li>If they are the same, this is the next expected TLP. Forward the TLP to the Transaction Layer. Also increment the NEXT_RCV_SEQ count.</li></ul></div><div><div><div></div></div></div><div><ul><li>Clear the NAK_SCHEDULED flag if set.</li></ul></div><div><div><div></div></div></div><div><ul><li>If the ACKNAK_LATENCY_TIMER expires, schedule and ACK DLLP with AckNak_Seq_Num[11:0] = NEXT_RCV_SEQ count - 1.</li></ul></div><div><div><div></div></div></div><h2><div><div>Error Case</div></div></h2><div><div><div></div></div></div><div><div><div>TLPs are received at the Physical Layer where they are checked for framing errors and other receiver-related errors. In the event of an error, the Physical Layer discards the packet, reports the error, and frees any storage allocated for the TLP. If the EDB is set and the CRC is not inverted, this is a bad packet: discard the TLP and set the error flag. If the NAK_SCHEDULED flag is clear, set it, and schedule a NAK DLLP with the NEXT_RCV_SEQ count - 1 value used as the Sequence Number.</div></div></div><div><div><div></div></div></div><div><ul><li>If there are no Physical Layer errors detected, forward the TLP to the Data Link Layer.</li></ul></div><div><div><div></div></div></div><div><ul><li>Calculate the CRC for the incoming TLP and check it against the LCRC provided with the packet. If the CRC fails, set the NAK_SCHEDULED flag. Schedule a NAK DLLP with NEXT_RCV_SEQ count - 1 used as the Sequence Number. If LCRC error check passes, go to the next bullet.</li></ul></div><div><div><div></div></div></div><div><ul><li>If the LCRC check passes, then compare the Sequence Number for the inbound packet against the current value in the NEXT_RCV_SEQ count. If the TLP Sequence Number is not equal to NEXT_RCV_SEQ count and if (NEXT_RCV_SEQ - TLP Sequence Number) mod <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="397" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c39"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3C"></mjx-c><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c34"></mjx-c><mjx-c class="mjx-c38"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>4096</mn></mrow><mo>&lt;=</mo><mrow data-mjx-texclass="ORD"><mn>2048</mn></mrow></math></mjx-assistive-mml></mjx-container> ,the TLP is a duplicate TLP. Discard the TLP, and schedule an ACK with NEXT_RCV_SEQ count - 1 value used as AckNak_Seq_Num[11:0].</li></ul></div><div><div><div></div></div></div><div><ul><li>Discard TLPs received with Sequence Number other than the Sequence Number described by the above bullet. If the NAK_SCHEDULED flag is clear, set it, and schedule a NAK DLLP with NEXT_RCV_SEQ count - 1 used as AckNak_Seq_Num[11:0]. If the NAK _SCHEDULED flag bit is already set, keep it set and do not schedule a NAK DLLP.</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="296" id="mark-abac133e-e2d8-4812-a8e1-ab689f24ca77" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Recommended Priority To Schedule Packets</div></div></h2><div><div><div></div></div></div><div><div><div>A device may have many types of TLPs, DLLPs and PLPs to transmit on a given Link. The following is a recommended but not required set of priorities for scheduling packets:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">Completion of any TLP or DLLP currently in progress (highest priority).</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">PLP transmissions.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">NAK DLLP.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">ACK DLLP.</li></ol></div><div><div><div></div></div></div><div><ol><li value="5">FC (Flow Control) DLLP.</li></ol></div><div><div><div></div></div></div><div><ol><li value="6">Replay Buffer re-transmissions.</li></ol></div><div><div><div></div></div></div><div><ol><li value="7">TLPs that are waiting in the Transaction Layer.</li></ol></div><div><div><div></div></div></div><div><ol><li value="8">All other DLLP transmissions (lowest priority)</li></ol></div><div><div><div></div></div></div><h2><div><div>Some More Examples</div></div></h2><div><div><div></div></div></div><div><div><div>To demonstrate the reliable TLP delivery capability provided by the ACK/NAK Protocol, the following examples are provided.</div></div></div><div><div><div></div></div></div><h2><div><div>Lost TLP</div></div></h2><div><div><div></div></div></div><div><div><div>Consider Figure 5-14 on page 245 which shows the ACK/NAK protocol for handling lost TLPs.</div></div></div><div><div><div></div></div></div><div><ol><li value="1">Device A transmits TLPs 4094, 4095, 0, 1, and 2.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">Device B receives TLPs 4094, 4095, and 0, for which it returns ACK 0 . These TLPs are forwarded to the Transaction Layer. NEXT_RCV_SEQ is incremented and the next value of NEXT_RCV_SEQ count is 1. Device B is ready to receive TLP 1.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">Seeing ACK 0, Device A purges TLPs 4094, 4095, and 0 from its replay buffer.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">TLP 1 is lost en route.</li></ol></div><div><div><div></div></div></div><div><ol><li value="5">TLP 2 arrives instead. Upon performing a Sequence Number check, Device B realizes that TLP 2's Sequence Number is greater than NEXT_RCV_SEQ count.</li></ol></div><div><div><div></div></div></div><div><ol><li value="6">Device B discards TLP 2 and schedules NAK 0 (NEXT_RCV_SEQ count - 1).</li></ol></div><div><div><div></div></div></div><div><ol><li value="7">Upon receipt of NAK 0, Device A replays TLPs 1 and 2.</li></ol></div><div><div><div></div></div></div><div><ol><li value="8">TLPs 1 and 2 arrive without error at Device B and are forwarded to the Transaction Layer.</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="297" id="mark-7aad2820-f862-4a87-9f32-99a03466aa64" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 5-14: Lost TLP Handling</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_304.jpg?x=223&amp;y=412&amp;w=996&amp;h=682"></div></div><div><div><div></div></div></div><h2><div><div>Lost ACK DLLP or ACK DLLP with CRC Error</div></div></h2><div><div><div></div></div></div><div><div><div>Consider Figure 5-15 on page 246 which shows the ACK/NAK protocol for handling a lost ACK DLLP.</div></div></div><div><div><div></div></div></div><div><ol><li value="1">Device A transmits TLPs 4094, 4095, 0, 1, and 2.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">Device B receives TLPs 4094, 4095, and 0, for which it returns ACK 0 . These TLPs are forwarded to the Transaction Layer. NEXT_RCV_SEQ is incremented and the next value of NEXT_RCV_SEQ count is set to 1.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">ACK 0 is lost en route. TLPs 4094, 4095, and 0 remain in Device A's Replay Buffer.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">TLPs 1 and 2 arrive at Device B shortly thereafter. NEXT_RCV_SEQ count increments to 3 .</li></ol></div><div><div><div></div></div></div><div><ol><li value="5">Device B returns ACK 2 and sends TLPs 1 and 2 to the Transaction Layer.</li></ol></div><div><div><div></div></div></div><div><ol><li value="6">ACK 2 arrives at Device A.</li></ol></div><div><div><div></div></div></div><div><ol><li value="7">Device A purges its Replay Buffer of TLPs 4094, 4095, 0, 1, and 2.</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="298" id="mark-1ba5081f-8580-45fb-ad02-3efbc19f5971" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>The example would be the same if a CRC error existed in ACK packet 0 . Device A would detect the CRC error in ACK 0 and discard it. When received later, ACK 2 would cause the Replay Buffer to purge all TLPs (4094 through 2).</div></div></div><div><div><div></div></div></div><div><div><div>If ACK 2 is also lost or corrupted, and no further ACK or NAK DLLPs are returned to Device A, its REPLAY_TIMER will expire. This results in replay of its entire buffer. Device B receives TLP 4094, 4095, 0, 1 and 2 and detects them as duplicate TLPs because their Sequence Numbers are earlier than NEXT_RCV_SEQ count of 3. These TLPs are discarded and ACK DLLPs with AckNak_Seq_Num[11:0] <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="398" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>2</mn></math></mjx-assistive-mml></mjx-container> are returned to Device A for each duplicate TLP.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 5-15: Lost ACK DLLP Handling</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_305.jpg?x=224&amp;y=726&amp;w=994&amp;h=602"></div></div><div><div><div></div></div></div><h2><div><div>Lost ACK DLLP followed by NAK DLLP</div></div></h2><div><div><div></div></div></div><div><div><div>Consider Figure 5-16 on page 247 which shows the ACK/NAK protocol for handling a lost ACK DLLP followed by a valid NAK DLLP.</div></div></div><div><div><div></div></div></div><div><ol><li value="1">Device A transmits TLPs 4094, 4095, 0, 1, and 2.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">Device B receives TLPs 4094, 4095, and 0, for which it returns ACK 0 . These TLPs are forwarded to the Transaction Layer. NEXT_RCV_SEQ is incremented and the next value of NEXT_RCV_SEQ count is 1.</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="299" id="mark-921433ed-a121-48b7-820e-c1450181d110" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><ol><li value="3">ACK 0 is lost en route. TLPs 4094, 4095, and 0 remain in Device A's Replay Buffer.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">TLPs 1 and 2 arrive at Device B shortly thereafter. TLP 1 is good and NEXT_RCV_SEQ count increments to 2. TLP 1 is forwarded to the Transaction Layer.</li></ol></div><div><div><div></div></div></div><div><ol><li value="5">TLP 2 is corrupt. NEXT_RCV_SEQ count remains at 2.</li></ol></div><div><div><div></div></div></div><div><ol><li value="6">Device B returns a NAK with a Sequence Number of 1 and discards TLP 2.</li></ol></div><div><div><div></div></div></div><div><ol><li value="7">NAK 1 arrives at Device A.</li></ol></div><div><div><div></div></div></div><div><ol><li value="8">Device A first purges TLP 4094, 4095, 0 and 1</li></ol></div><div><div><div></div></div></div><div><ol><li value="9">Device A replays TLP 2.</li></ol></div><div><div><div></div></div></div><div><ol><li value="10">TLP 2 arrive at Device B. The NEXT_RCV_SEQ count is 2.</li></ol></div><div><div><div></div></div></div><div><ol><li value="11">Device B accepts good TLP 2 and forwards it to the Transaction Layer. NEXT_RCV_SEQ increments to 3.</li></ol></div><div><div><div></div></div></div><div><ol><li value="12">Device B may return an ACK with a Sequence Number of 2 if the ACKNAK_LATENCY_TIMER expires.</li></ol></div><div><div><div></div></div></div><div><ol><li value="13">Upon receipt of ACK 2, Device A purges TLP 2.</li></ol></div><div><div><div></div></div></div><div><div><div>Figure 5-16: Lost ACK DLLP Handling</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_306.jpg?x=224&amp;y=945&amp;w=992&amp;h=713"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="300" id="mark-bd4cceba-23a6-4a5e-9bca-edd8c1f64348" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Switch Cut-Through Mode</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express supports a switch-related feature that allows TLP transfer latency through a switch to be significantly reduced. This feature is referred to as the 'cut-through' mode. Without this feature, the propagation time through a switch could be significant.</div></div></div><div><div><div></div></div></div><h2><div><div>Without Cut-Through Mode</div></div></h2><div><div><div></div></div></div><h2><div><div>Background</div></div></h2><div><div><div></div></div></div><div><div><div>Consider an example where a large TLP needs to pass through a switch from one port to another. Until the tail end of the TLP is received by the switch's ingress port, the switch is unable to determine if there is a CRC error. Typically, the switch will not forward the packet through the egress port until it determines that there is no CRC error. This implies that the latency through the switch is at least the time to clock the packet into the switch. If the packet needs to pass through many switches to get to the final destination, the latencies would add up, increasing the time to get from source to destination.</div></div></div><div><div><div></div></div></div><h2><div><div>Possible Solution</div></div></h2><div><div><div></div></div></div><div><div><div>One option to reduce latency would be to start forwarding the TLP through the switch's egress port before the tail end of the TLP has been received by the switch ingress port. This is fine as long as the packet is not corrupted. Consider what would happen if the TLP were corrupt. The packet would begin transmitting through the egress port before the switch realized that there is an error. After the switch detects the CRC error, it would return a NAK to the TLP source and discard the packet, but part of the packet has already been transmitted and its transmission cannot be cleanly aborted in mid-transmit. There is no point keeping a copy of the bad TLP in the egress port Replay Buffer because it is bad. The TLP source port would at a later time replay after receiving the NAK DLLP. The TLP is already outbound and en route to the Endpoint destination. The Endpoint receives the packet, detects a CRC error, and returns a NAK to the switch. The switch is expected to replay the TLP, but the switch has already discarded the TLP due to the detected error on the inbound TLP. The switch is stuck between a rock and a hard place!</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="301" id="mark-8c211bd5-d923-4aee-9779-518e4de753a9" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Switch Cut-Through Mode</div></div></h2><div><div><div></div></div></div><h2><div><div>Background</div></div></h2><div><div><div></div></div></div><div><div><div>The PCI Express protocol permits the implementation of an optional feature referred to as cut-through mode. Cut-though is the ability to start streaming a packet through a switch without waiting for the receipt of the tail end of the packet. If, ultimately, a CRC error is detected when the CRC is received at the tail end of the packet, the packet that has already begun transmission from the switch egress port can be 'nullified'.</div></div></div><div><div><div></div></div></div><div><div><div>A nullified packet is a packet that terminates with an EDB symbol as opposed to an END. It also has an inverted 32-bit LCRC.</div></div></div><div><div><div></div></div></div><h2><div><div>Example That Demonstrates Switch Cut-Through Feature</div></div></h2><div><div><div></div></div></div><div><div><div>Consider the example in Figure 5-17 that illustrates the cut-though mode of a switch.</div></div></div><div><div><div></div></div></div><div><div><div>A TLP with large data payload passes from the left, through the switch, to the Endpoint on the right. The steps as the packet is routed through the switch are as follows:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">A TLP is inbound to a switch. While en route, the packet's contents is corrupted.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">The TLP header at the head of the TLP is decoded by the switch and the packet is forwarded to the egress port before the switch becomes aware of a CRC error. Finally, the tail end of the packet arrives in the switch ingress port and it is able to complete a CRC check.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">The switch detects a CRC error for which the switch returns a NAK DLLP to the TLP source.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">On the egress port, the switch replaces the END framing symbol at the tail end of the bad TLP with the EDB (End Bad) symbol. The CRC is also inverted from what it would normally be. The TLP is now 'nullified'. Once the TLP has exited the switch, the switch discards its copy from the Replay Buffer.</li></ol></div><div><div><div></div></div></div><div><ol><li value="5">The nullified packet arrives at the Endpoint. The Endpoint detects the EDB symbol and the inverted CRC and discards the packet.</li></ol></div><div><div><div></div></div></div><div><ol><li value="6">The Endpoint does not return a NAK DLLP (otherwise the switch would be obliged to replay).</li></ol></div><div><div><div></div></div></div><div><div><div>When the TLP source device receives the NAK DLLP, it replays the packet. This</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="302" id="mark-fae3fd90-8fbd-40a1-9ef5-3235f17f22c8" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>time no error occurs on the switch's ingress port. As the packet arrives in the switch, the header is decoded and the TLP is forwarded to the egress port with very short latency. When the tail end of the TLP arrives at the switch, a CRC check is performed. There is no error, so an ACK is returned to the TLP source which then purges its replay buffer. The switch stores a copy of the TLP in its egress port Replay Buffer. When the TLP reaches the destination Endpoint, the Endpoint device performs a CRC check. The packet is a good packet terminated with the END framing symbol. There are no CRC errors and so the Endpoint returns an ACK DLLP to the switch. The switch purges the copy of the TLP from its Replay Buffer. The packet has been routed from source to destination with minimal latency.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 5-17: Switch Cut-Through Mode Showing Error Handling</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_309.jpg?x=219&amp;y=755&amp;w=1002&amp;h=363"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="303" id="mark-279dce09-2914-47c8-b94e-37af8c643b06" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>QoS/TCs/VCs and  Arbitration</div></div></h2><div><div><div></div></div></div><h2><div><div>The Previous Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>The previous chapter detailed the Ack/Nak Protocol that verifies the delivery of TLPs between each port as they travel between the requester and completer devices. This chapter details the hardware retry mechanism that is automatically triggered when a TLP transmission error is detected on a given link.</div></div></div><div><div><div></div></div></div><h2><div><div>This Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>This chapter discusses Traffic Classes, Virtual Channels, and Arbitration that support Quality of Service concepts in PCI Express implementations. The concept of Quality of Service in the context of PCI Express is an attempt to predict the bandwidth and latency associated with the flow of different transaction streams traversing the PCI Express fabric. The use of QoS is based on application-specific software assigning Traffic Class (TC) values to transactions, which define the priority of each transaction as it travels between the Requester and Completer devices. Each TC is mapped to a Virtual Channel (VC) that is used to manage transaction priority via two arbitration schemes called port and VC arbitration.</div></div></div><div><div><div></div></div></div><h2><div><div>The Next Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>The next chapter discusses the purposes and detailed operation of the Flow Control Protocol. This protocol requires each device to implement credit-based link flow control for each virtual channel on each port. Flow control guarantees that transmitters will never send Transaction Layer Packets (TLPs) that the receiver can't accept. This prevents receive buffer over-runs and eliminates the need for inefficient disconnects, retries, and wait-states on the link. Flow Control also helps enable compliance with PCI Express ordering rules by maintaining separate virtual channel Flow Control buffers for three types of transactions: Posted (P), Non-Posted (NP) and Completions (Cpl).</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="304" id="mark-545e9b93-daee-49c7-9f53-4ce5b0dbad78" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Quality of Service</div></div></h2><div><div><div></div></div></div><div><div><div>Quality of Service (QoS) is a generic term that normally refers to the ability of a network or other entity (in our case, PCI Express) to provide predictable latency and bandwidth. QoS is of particular interest when applications require guaranteed bus bandwidth at regular intervals, such as audio data. To help deal with this type of requirement PCI Express defines isochronous transactions that require a high degree of QoS. However, QoS can apply to any transaction or series of transactions that must traverse the PCI Express fabric. Note that QoS can only be supported when the system and device-specific software is PCI Express aware.</div></div></div><div><div><div></div></div></div><div><div><div>QoS can involve many elements of performance including:</div></div></div><div><div><div></div></div></div><div><ul><li>Transmission rate</li></ul></div><div><div><div></div></div></div><div><ul><li>Effective Bandwidth</li></ul></div><div><div><div></div></div></div><div><ul><li>Latency</li></ul></div><div><div><div></div></div></div><div><ul><li>Error rate</li></ul></div><div><div><div></div></div></div><div><ul><li>Other parameters that affect performance</li></ul></div><div><div><div></div></div></div><div><div><div>Several features of PCI Express architecture provide the mechanisms that make QoS achievable. The PCI Express features that support QoS include:</div></div></div><div><div><div></div></div></div><div><ul><li>Traffic Classes (TCs)</li></ul></div><div><div><div></div></div></div><div><ul><li>Virtual Channels (VCs)</li></ul></div><div><div><div></div></div></div><div><ul><li>Port Arbitration</li></ul></div><div><div><div></div></div></div><div><ul><li>Virtual Channel Arbitration</li></ul></div><div><div><div></div></div></div><div><ul><li>Link Flow Control</li></ul></div><div><div><div></div></div></div><div><div><div>PCI Express uses these features to support two general classes of transactions that can benefit from the PCI Express implementation of QoS.</div></div></div><div><div><div></div></div></div><div><div><div>Isochronous Transactions - from Iso (same) + chronous (time), these transactions require a constant bus bandwidth at regular intervals along with guaranteed latency. Isochronous transactions are most often used when a synchronous connection is required between two devices. For example, a CD-ROM drive containing a music CD may be sourcing data to speakers. A synchronous connection exists when a headset is plugged directly into the drive. However, when the audio card is used to deliver the audio information to a set of external speakers, isochronous transactions may be used to simplify the delivery of the data.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="305" id="mark-c775749f-1d19-473c-91f2-acdd19fddf9a" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Asynchronous Transactions - This class of transactions involves a wide variety of applications that have widely varying requirements for bandwidth and latency. QoS can provide the more demanding applications (those requiring higher bandwidth and shorter latencies) with higher priority than the less demanding applications. In this way, software can establish a hierarchy of traffic classes for transactions that permits differentiation of transaction priority based on their requirements. The specification refers to this capability as differentiated services.</div></div></div><div><div><div></div></div></div><h2><div><div>Isochronous Transaction Support</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express supports QoS and the associated TC, VC, and arbitration mechanisms so that isochronous transactions can be performed. A classic example of a device that benefits from isochronous transaction support is a video camera attached to a tape deck. This real-time application requires that image and audio data be transferred at a constant rate (e.g., 64 frames/second). This type of application is typically supported via a direct synchronous attachment between the two devices.</div></div></div><div><div><div></div></div></div><h2><div><div>Synchronous Versus Isochronous Transactions</div></div></h2><div><div><div></div></div></div><div><div><div>Two devices connected directly perform synchronous transfers. A synchronous source delivers data directly to the synchronous sink through use of a common reference clock. In our example, the video camera (synchronous source) sends audio and video data to the tape deck (synchronous sink), which immediately stores the data in real time with little or no data buffering, and with only a slight delay due to signal propagation.</div></div></div><div><div><div></div></div></div><div><div><div>When these devices are connected via PCI Express a synchronous connection is not possible. Instead, PCI Express emulates synchronous connections through the use of isochronous transactions and data buffering. In this scenario, isochronous transactions can be used to ensure that a constant amount of data is delivered at specified intervals ( <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="399" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D707 TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>100</mn><mi>μ</mi></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> in this example),thus achieving the required transmission characteristics. Consider the following sequence (Refer to Figure 6-1 on page 254):</div></div></div><div><div><div></div></div></div><div><ol><li value="1">The synchronous source (video camera and PCI Express interface) accumulates data in Buffer A during service interval 1 (SI 1).</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">The camera delivers the accumulated data to the synchronous sink (tape deck) sometime during the next service interval (SI 2). The camera also accumulates the next block of data in Buffer B as the contents of Buffer A is delivered.</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="306" id="mark-b9ceae45-dd1b-4e7a-bce8-9860ed3ff036" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><ol><li value="3">The tape deck buffers the incoming data (in its Buffer A), which can then be delivered synchronously for recording on tape during service interval 3 . During SI 3 the camera once again accumulates data into Buffer A, and the cycle repeats. Chapter 6: QoS/TCs/VCs and Arbitration</li></ol></div><div><div><div></div></div></div><div><div><div>Figure 6-1: Example Application of Isochronous Transaction</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_313.jpg?x=314&amp;y=584&amp;w=806&amp;h=1005"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="307" id="mark-e25bef9a-d135-4608-b89a-25fa06cad5a9" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Isochronous Transaction Management</div></div></h2><div><div><div></div></div></div><div><div><div>Management of an isochronous communications channel is based on a Traffic Class (TC) value and an associated Virtual Channel (VC) number that software assigns during initialization. Hardware components including the Requester of a transaction and all devices in the path between the requester and completer are configured to transport the isochronous transactions from link to link via a hi-priority virtual channel.</div></div></div><div><div><div></div></div></div><div><div><div>The requester initiates isochronous transactions that include a TC value representing the desired QoS. The Requester injects isochronous packets into the fabric at the required rate (service interval), and all devices in the path between the Requester and Completer must be configured to support the transport of the isochronous transactions at the specified interval. Any intermediate device along the path must convert the TC to the associated VC used to control transaction arbitration. This arbitration results in the desired bandwidth and latency for transactions with the assigned TC. Note that the TC value remains constant for a given transaction while the VC number may change from link to link.</div></div></div><div><div><div></div></div></div><h2><div><div>Differentiated Services</div></div></h2><div><div><div></div></div></div><div><div><div>Various types of asynchronous traffic (all traffic other than isochronous) have different priority from the system perspective. For example, ethernet traffic requires higher priority (smaller latencies) than mass storage transactions. PCI Express software can establish different TC values and associated virtual channels and can set up the communications paths to ensure different delivery policies are established as required. Note that the specification does not define specific methods for identifying delivery requirements or the policies to be used when setting up differentiated services.</div></div></div><div><div><div></div></div></div><h2><div><div>Perspective on QOS/TC/VC and Arbitration</div></div></h2><div><div><div></div></div></div><div><div><div>PCI does not include any QoS-related features similar to those defined by PCI Express. Many questions arise regarding the need for such an elaborate scheme for managing traffic flow based on QoS and differentiated services. Without implementing these new features, the bandwidth available with a PCI Express system is far greater and latencies much shorter than PCI-based implementations, due primarily to the topology and higher delivery rates. Consequently, aside from the possible advantage of isochronous transactions, there appears to be little advantage to implementing systems that support multiple Traffic</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="308" id="mark-6353ee9b-8961-44c7-af6e-c5c0b8b4ec4d" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Classes and Virtual Channels.</div></div></div><div><div><div></div></div></div><div><div><div>While this may be true for most desktop PCs, other high-end applications may benefit significantly from these new features. The PCI Express specification also opens the door to applications that demand the ability to differentiate and manage system traffic based on Traffic Class prioritization.</div></div></div><div><div><div></div></div></div><h2><div><div>Traffic Classes and Virtual Channels</div></div></h2><div><div><div></div></div></div><div><div><div>During initialization a PCI Express device-driver communicates the levels of QoS that it desires for its transactions, and the operating system returns TC values that correspond to the QoS requested. The TC value ultimately determines the relative priority of a given transaction as it traverses the PCI Express fabric. Two hardware mechanisms provide guaranteed isochronous bandwidth and differentiated services:</div></div></div><div><div><div></div></div></div><h2><div><div>Virtual Channel Arbitration Port Arbitration</div></div></h2><div><div><div></div></div></div><div><div><div>These arbitration mechanisms use VC numbers to manage transaction priority. System configuration software must assign VC IDs and set up the association between the traffic class assigned to a transaction and the virtual channel to be used when traversing each link. This is done via VC configuration registers mapped within the extended configuration address space. The list of these registers and their location within configuration space is illustrated in Figure 6-2.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="309" id="mark-423c6d0c-564d-4b9b-a2fe-c88883aeb239" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 6: QoS/TCs/VCs and Arbitration</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 6-2: VC Configuration Registers Mapped in Extended Configuration Address Space</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_316.jpg?x=269&amp;y=399&amp;w=911&amp;h=708"></div></div><div><div><div></div></div></div><div><div><div>The TC value is carried in the transaction packet header and can contain one of eight values (TC0-TC7). TC0 must be implemented by all PCI Express devices and the system makes a "best effort" when delivering transactions with the TC0 label. TC values of TC1-TC7 are optional and provide seven levels of arbitration for differentiating between packet streams that require varying amounts of bandwidth. Similarly, eight VC numbers (VC0-VC7) are specified, with VC0 required and VC1-VC7 optional. ("VC Assignment and TC Mapping" on page 258 discusses VC initialization).</div></div></div><div><div><div></div></div></div><div><div><div>Note that TC0 is hardwired to VC0 in all devices. If configuration software is not PCI Express aware all transactions will use the default TC0 and VC0; thereby eliminating the possibility of supporting differentiated services and isochronous transactions. Furthermore, the specification requires some transaction types to use TC0/VC0 exclusively:</div></div></div><div><div><div></div></div></div><hr><div><div><div></div></div></div><div><!-- Code --></div><div><div><div></div></div></div><div><ul><li>Configuration</li></ul></div><div><div><div></div></div></div><div><ul><li><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="400" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c49"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4F"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">I</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">O</mi></mrow></math></mjx-assistive-mml></mjx-container></li></ul></div><div><div><div></div></div></div><div><!-- Code --></div><div><div><div></div></div></div><hr><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="310" id="mark-e9cd41d4-cd82-4138-aab5-3977596e9af2" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><ul><li>INTx Message</li></ul></div><div><div><div></div></div></div><div><ul><li>Power Management Message</li></ul></div><div><div><div></div></div></div><div><ul><li>Error Signaling Message</li></ul></div><div><div><div></div></div></div><div><ul><li>Unlock Message</li></ul></div><div><div><div></div></div></div><div><ul><li>Set_Slot_Power_Limit Message</li></ul></div><div><div><div></div></div></div><h2><div><div>VC Assignment and TC Mapping</div></div></h2><div><div><div></div></div></div><div><div><div>Configuration software designed for PCI Express sets up virtual channels for each link in the fabric. Recall that the default TC and VC assignments following Cold Reset will be TC0 and VC0, which is used when the configuration software is not PCI Express aware. The number of virtual channels used depends on the greatest capability shared by the two devices attached to a given link. Software assigns an ID for each VC and maps one or more TCs to each.</div></div></div><div><div><div></div></div></div><h2><div><div>Determining the Number of VCs to be Used</div></div></h2><div><div><div></div></div></div><div><div><div>Software checks the number of VCs supported by the devices attached to a common link and assigns the greatest number of VCs that both devices have in common. For example, consider the three devices attached to the switch in Figure 6- 3 on page 259. In this example, the switch supports all 8 VCs on each of its ports; while Device A supports only the default VC, Device B supports 4 VC s, and Device C support 8 VCs. When configuring VCs for each link, software determines the maximum number of VCs supported by both devices at each end of the link and assigns that number to both devices. The VC assignment applies to transactions flowing across a link in both directions.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="311" id="mark-0ad81fa3-04ce-4603-8987-bc6fb431925e" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 6-3: The Number of VCs Supported by Device Can Vary</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_318.jpg?x=261&amp;y=409&amp;w=924&amp;h=694"></div></div><div><div><div></div></div></div><div><div><div>Note that even though switch port A supports all 8 VCs Device A supports a single VC, leaving 7 VCs unused within switch port A. Similarly, 4 VCs are used by switch port B. Software of course configures and enables all 8 VCs within switch port <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="401" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c43"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">C</mi></mrow></math></mjx-assistive-mml></mjx-container> .</div></div></div><div><div><div></div></div></div><div><div><div>Configuration software determines the maximum number of VCs supported by each port interface by reading its Extended VC Count field contained within the "Virtual Channel Capability" registers. The smaller of the two values governs the maximum number of VCs supported by this link for both transmission and reception of transactions. Figure 6-4 on page 260 illustrates the location and format of the Extended VC Count field. Software may restrict the number of VCs configured and enabled to fewer than actually allowed. This may be done to achieve the QoS desired for a given platform or application.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="312" id="mark-4751e68f-61ab-404d-b0fa-de102beeb09f" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 6-4: Extended VCs Supported Field</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_319.jpg?x=385&amp;y=384&amp;w=679&amp;h=788"></div></div><div><div><div></div></div></div><h2><div><div>Assigning VC Numbers (IDs)</div></div></h2><div><div><div></div></div></div><div><div><div>Configuration software must assign VC numbers or IDs to each of the virtual channels, except VC0 which is always hardwired. As illustrated in Figure 6-5 on page 261, the VC Capabilities registers include 3 DWs used for configuring each VC. The first set of registers (starting at offset 10h) always applies to VC0. The Extended VCs Count field (described above) defines the number of additional VC register sets implemented by this port, each of which permits configuration of an additional VC. Note that these register sets are mapped in configuration space directly following the VC0 registers. The mapping is expressed as an offset from each of the three VC0 DW registers:</div></div></div><div><div><div></div></div></div><hr><div><div><div></div></div></div><div><!-- Code --></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" display="true" tabindex="0" ctxtmenu_counter="402" style="font-size: 122.8%; position: relative;"><mjx-math display="true" class="MJX-TEX" aria-hidden="true" style="margin-left: 0px; margin-right: 0px;"><mjx-mtext class="mjx-n"><mjx-c class="mjx-c2D"></mjx-c></mjx-mtext><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mrow space="3"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-msub><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-script style="vertical-align: -0.15em;"><mjx-texatom size="s" texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2217"></mjx-c></mjx-mo></mjx-texatom></mjx-script></mjx-msub><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c43"></mjx-c><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>-</mtext><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">h</mi></mrow><mo>+</mo><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><msub><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">n</mi></mrow></mrow><mrow data-mjx-texclass="ORD"><mo>∗</mo></mrow></msub><mn>0</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">Ch</mi></mrow></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container></div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" display="true" tabindex="0" ctxtmenu_counter="403" style="font-size: 122.8%; position: relative;"><mjx-math display="true" class="MJX-TEX" aria-hidden="true" style="margin-left: 0px; margin-right: 0px;"><mjx-mtext class="mjx-n"><mjx-c class="mjx-c2D"></mjx-c></mjx-mtext><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mrow space="3"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2217"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c43"></mjx-c><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>-</mtext><mrow data-mjx-texclass="ORD"><mn>14</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">h</mi></mrow><mo>+</mo><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">n</mi></mrow><mo>∗</mo><mn>0</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">Ch</mi></mrow></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container></div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" display="true" tabindex="0" ctxtmenu_counter="404" style="font-size: 122.8%; position: relative;"><mjx-math display="true" class="MJX-TEX" aria-hidden="true" style="margin-left: 0px; margin-right: 0px;"><mjx-mtext class="mjx-n"><mjx-c class="mjx-c2D"></mjx-c></mjx-mtext><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c38"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mrow space="3"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2217"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c43"></mjx-c><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>-</mtext><mrow data-mjx-texclass="ORD"><mn>18</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">h</mi></mrow><mo>+</mo><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">n</mi></mrow><mo>∗</mo><mn>0</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">Ch</mi></mrow></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container></div></div></div><div><div><div></div></div></div><div><!-- Code --></div><div><div><div></div></div></div><hr><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="313" id="mark-da23161d-9064-4b01-9f25-9bb54946ca96" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>The value " <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="405" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">n</mi></mrow></math></mjx-assistive-mml></mjx-container> " represents the number of additional VCs implemented. For example,if the Extended VCs Count contains a value of 3,then <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="406" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c2C"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="2"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">n</mi></mrow><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn></math></mjx-assistive-mml></mjx-container> ,and 3 for the three additional register sets. Note that these numbers simply identify the register sets for each VC supported and is not the VC ID.</div></div></div><div><div><div></div></div></div><div><div><div>Software assigns a VC ID for each of the additional VCs being used via the VC ID field within the VCn Resource Control Register. (See Figure 6-5) These IDs are not required to be assigned contiguous values, but the same VC value can be used only once.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 6-5: VC Resource Control Register</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_320.jpg?x=331&amp;y=688&amp;w=784&amp;h=841"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="314" id="mark-f534261e-50c3-4dea-b13f-d986b8817355" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><h2><div><div>Assigning TCs to each VC TC/VC Mapping</div></div></h2><div><div><div></div></div></div><div><div><div>The Traffic Class value assigned by a requester to each transaction must be associated with a VC as it traverses each link on its journey to the recipient. Also, the VC ID associated with a given TC may change from link to link. Configuration software establishes this association during initialization via the TC/VC Map field of the VC Resource Control Register. This 8-bit field permits any TC value to be mapped to the selected VC, where each bit position represents the corresponding TC value (i.e.,bit <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="407" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn><mo>=</mo></math></mjx-assistive-mml></mjx-container> TC0:: bit <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="408" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c37"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>7</mn><mo>=</mo></math></mjx-assistive-mml></mjx-container> TC7). Setting a bit assigns the corresponding TC value to the VC ID. Figure 6-6 shows a mapping example where TC0 and TC1 are mapped to VC0 and TC2::TC4 are mapped to VC3.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 6-6: TC to VC Mapping Example</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_321.jpg?x=224&amp;y=812&amp;w=992&amp;h=454"></div></div><div><div><div></div></div></div><div><div><div>Software is permitted a great deal of flexibility in assigning VC IDs and mapping the associated TCs. However, the specification states several rules associated with the TC/VC mapping:</div></div></div><div><div><div></div></div></div><div><ul><li>TC/VC mapping must be identical for the two ports attached to the same link.</li></ul></div><div><div><div></div></div></div><div><ul><li>One TC must not be mapped to multiple VCs in any PCI Express Port.</li></ul></div><div><div><div></div></div></div><div><ul><li>One or multiple TCs can be mapped to a single VC.</li></ul></div><div><div><div></div></div></div><div><div><div>Table 6-1 on page 263 lists a variety of combinations that may be implemented. This is intended only to illustrate a few combinations, and many more are possible.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="315" id="mark-92598543-6285-4189-8f7b-8738a8cdb80e" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Table 6-1: Example TC to VC Mappings</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>TC</th><th>VC Assignment</th><th>Comment</th></tr></thead><tbody><tr><td>TC0</td><td>VC0</td><td>Default setting, used by all transactions.</td></tr><tr><td>TC0-TC1</td><td>VC0</td><td>VCs are not required to be assigned consecutively.</td></tr><tr><td>TC2-TC7</td><td>VC7</td><td>Multiple TCs can be assigned to a single VC.</td></tr><tr><td>TC0</td><td>VC0</td><td rowspan="4">Several transaction types must use TC0/VC0. (1) TCs are not required to be assigned consecutively. Some TC/VC combinations can be used to support an isochronous connection.</td></tr><tr><td>TC1</td><td>VC1</td></tr><tr><td>TC6</td><td>VC6</td></tr><tr><td>TC7</td><td>VC7</td></tr><tr><td>TC0</td><td>VC0</td><td rowspan="8">All TCs can be assigned to the corresponding VC numbers.</td></tr><tr><td>TC1</td><td>VC1</td></tr><tr><td>TC2</td><td>VC2</td></tr><tr><td>TC3</td><td>VC3</td></tr><tr><td>TC4</td><td>VC4</td></tr><tr><td>TC5</td><td>VC5</td></tr><tr><td>TC6</td><td>VC6</td></tr><tr><td>TC7</td><td>VC7</td></tr><tr><td>TC0</td><td>VC0</td><td>The VC number that is assigned need not match</td></tr><tr><td>TC1-TC4</td><td>VC6</td><td>one of the corresponding TC numbers.</td></tr><tr><td>TC0</td><td>VC0</td><td>Illegal. A TC number can be assigned to only one</td></tr><tr><td>TC1-TC2</td><td>VC1</td><td>VC number. This example shows TC2 mapped to</td></tr><tr><td>TC2</td><td>VC2</td><td>both VC1 and VC2, which is not allowed.</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>Arbitration</div></div></h2><div><div><div></div></div></div><div><div><div>Two types of transaction arbitration provide the method for managing isochronous transactions and differentiated services:</div></div></div><div><div><div></div></div></div><div><ul><li>Virtual Channel (VC) Arbitration - determines the priority of transactions being transmitted from the same port, based on their VC ID.</li></ul></div><div><div><div></div></div></div><div><ul><li>Port Arbitration - determines the priority of transactions with the same VC assignment at the egress port, based on the priority of the port at which the transactions arrived. Port arbitration applies to transactions that have the same VC ID at the egress port, therefore a port arbitration mechanism exists for each virtual channel supported by the egress port. PCI Express System Architecture</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="316" id="mark-9c9cbb13-6cf4-4063-b286-3d90baad6693" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Arbitration is also affected by the requirements associated with transaction ordering and flow control. These additional requirements are discussed in subsequent chapters, but are mentioned in the context of arbitration as required in the following discussions.</div></div></div><div><div><div></div></div></div><h2><div><div>Virtual Channel Arbitration</div></div></h2><div><div><div></div></div></div><div><div><div>In addition to supporting QoS objectives, VC arbitration should also ensure that forward progress is made for all transactions. This prevents inadvertent split transaction time-outs. Any device that both initiates transactions and supports two or more VCs must implement VC arbitration. Furthermore, other device types that support more than one VC (e.g., switches) must also support VC arbitration.</div></div></div><div><div><div></div></div></div><div><div><div>VC arbitration allows a transmitting device to determine the priority of transactions based on their VC assignment. Key characteristics of VCs that are relevant to VC arbitration include:</div></div></div><div><div><div></div></div></div><div><ul><li>Each VC supported and enabled provides its own buffers and flow control.</li></ul></div><div><div><div></div></div></div><div><ul><li>Transactions mapped to the same VC are issued in strict order (unless the "Relaxed Ordering" attribute bit is set).</li></ul></div><div><div><div></div></div></div><div><ul><li>No ordering relationship exists between transactions assigned to different VCs.</li></ul></div><div><div><div></div></div></div><div><div><div>Figure 6-7 on page 265 illustrates the concept of VC arbitration. In this example two VCs are implemented (VC0 and VC1) and transmission priority is based on a 3:1 ratio, where 3 VC1 transactions are sent to each VC0 transaction. The device core issues transactions (that include a TC value) to the TC/VC Mapping logic. Based on the associated VC value, the transaction is routed to the appropriate VC buffer where it awaits transmission. The VC arbiter determines the VC buffer priority when sending transactions.</div></div></div><div><div><div></div></div></div><div><div><div>This example illustrates the flow of transaction in only one direction. The same logic exists for transmitting transactions simultaneously in the opposite direction. That is, the root port also contains transmit buffers and an arbiter and the endpoint device contains receive buffers. The method chosen by the designer is specified within the VC capability registers. In general, there are three approaches that can be taken:</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="317" id="mark-a113b06d-7a30-45b7-b763-8c24d3e90f6c" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 6-7: Conceptual VC Arbitration Example</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_324.jpg?x=442&amp;y=385&amp;w=566&amp;h=730"></div></div><div><div><div></div></div></div><div><div><div>A variety of VC arbitration mechanisms may be employed by a given design.</div></div></div><div><div><div></div></div></div><div><ul><li>Strict Priority Arbitration for all VCs</li></ul></div><div><div><div></div></div></div><div><ul><li>Split Priority Arbitration - VCs are segmented into low- and high-priority groups. The low-priority group uses some form of round robin arbitration and the high-priority group uses strict priority.</li></ul></div><div><div><div></div></div></div><div><ul><li>Round robin priority (standard or weighted) arbitration for all VCs</li></ul></div><div><div><div></div></div></div><h2><div><div>Strict Priority VC Arbitration</div></div></h2><div><div><div></div></div></div><div><div><div>The specification defines a default priority scheme based on the inherent priority of VC IDs (VC0=lowest priority and VC7=highest priority). The arbitration mechanism is hardware based, and requires no configuration. Figure 6-8 illustrates a strict priority arbitration example that includes all VCs. The VC ID governs the order in which transactions are sent. The maximum number of VCs</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="318" id="mark-7b808799-830b-4820-afad-a8c65a8ed2d4" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>that use strict priority arbitration cannot be greater than the value in the Extended VC Count field. (See Figure 6-4 on page 260.) Furthermore, if the designer has chosen strict priority arbitration for all VCs supported, the Low Priority Extended VC Count field of Port VC Capability Register 1 is hardwired to zero. (See Figure 6-9 on page 267.)</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th colspan="3">Figure 6-8: Strict Arbitration Priority</th></tr><tr><th>VC Resources</th><th colspan="2">Priority Order</th></tr></thead><tbody><tr><td>8th VC</td><td>VC7</td><td rowspan="8">Highest Lowest</td></tr><tr><td>7th VC</td><td>VC6</td></tr><tr><td>6th VC</td><td>VC5</td></tr><tr><td>5th VC</td><td>VC4</td></tr><tr><td>4th VC</td><td>VC3</td></tr><tr><td>3rd VC</td><td>VC2</td></tr><tr><td>2nd VC</td><td>VC1</td></tr><tr><td>1st VC</td><td>VC0</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div>Strict priority requires that VCs of higher priority get precedence over lower priority VCs based on the VC ID. For example, if all eight VCs are governed by strict priority, transactions with a VC ID of VC0 can only be sent when no transactions are pending transmission in VC1-VC7. In some circumstances strict priority can result in lower priority transactions being starved for bandwidth and experiencing extremely long latencies. Conversely, the highest priority transactions receive very high bandwidth with minimal latencies. The specification requires that high priority traffic be regulated to avoid starvation, and further defines two methods of regulation:</div></div></div><div><div><div></div></div></div><div><ul><li>The originating port can manage the injection rate of high priority transactions, to permit greater bandwidth for lower priority transactions.</li></ul></div><div><div><div></div></div></div><div><ul><li>Switches can regulate multiple data flows at the egress port that are vying for link bandwidth. This method may limit the throughput from high bandwidth applications and devices that attempt to exceed the limitations of the available bandwidth.</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="319" id="mark-141713a1-e641-4e12-945c-949140cc34ce" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>The designer of a device may also limit the number of VCs that participate in strict priority by specifying a split between the low- and high-priority VCs as discussed in the next section.</div></div></div><div><div><div></div></div></div><h2><div><div>Low- and High-Priority VC Arbitration</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 6-9 on page 267 illustrates the Low Priority Extended VC Count field within VC Capability Register 1. This read-only field specifies a VC ID value that identifies the upper limit of the low-priority arbitration group for the design. For example, if this count contains a value of 4 , then VC0-VC4 are members of the low-priority group and VC5-VC7 use strict priority. Note that a Low Priority Extended VC Count of 7 means that no strict priority is used. strict priority arbitration, while the low-priority arbitration group uses one of the other prioritization methods supported by the device. VC Capability Register 2 reports which alternate arbitration methods are supported for the low pri-PCI Express System Architecture</div></div></div><div><div><div></div></div></div><div><div><div>Figure 6-9: Low Priority Extended VC Count</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_326.jpg?x=379&amp;y=785&amp;w=688&amp;h=732"></div></div><div><div><div></div></div></div><div><div><div>As depicted in Figure 6-11 on page 269, the high-priority VCs continue to use</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="320" id="mark-609b6584-67cb-4027-a6db-27c803fae8b0" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>ority group, and the VC Control Register permits selection of the method to be used by this group. See Figure 6-10 on page 268. The low-priority arbitration schemes include:</div></div></div><div><div><div></div></div></div><div><ul><li>Hardware Based Fixed Arbitration Scheme - the specification permits the vendor to define a hardware-based fixed arbitration scheme that provides all VCs with the same priority. (e.g. round robin).</li></ul></div><div><div><div></div></div></div><div><ul><li>Weighted Round Robin (WRR) - with WRR some VCs can be given higher priority than others because they have more positions within the round robin than others. The specification defines three WRR configurations, each with a different number of entries (or phases).</li></ul></div><div><div><div></div></div></div><div><div><div>Figure 6-10: Determining VC Arbitration Capabilities and Selecting the Scheme</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_327.jpg?x=358&amp;y=761&amp;w=735&amp;h=687"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="321" id="mark-cf560a22-8905-446d-beb4-9d68a2f63967" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Figure 6-11: VC Arbitration with Low- and High-Priority Implementations</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_328.jpg?x=354&amp;y=401&amp;w=740&amp;h=451"></div></div><div><div><div></div></div></div><div><div><div>Hardware Fixed Arbitration Scheme. This selection defines a hardware-based VC arbitration scheme that requires no additional software setup. The specification mentions standard Round Robin arbitration as an example scheme that the designer may choose. In such a scheme, transactions pending transmission within each low-priority VC are sent during each pass through the round robin. The specification does not preclude other implementation-specific schemes.</div></div></div><div><div><div></div></div></div><div><div><div>Weighted Round Robin Arbitration Scheme. The weighted round robin (WRR) approach permits software to configure the VC Arbitration table. The number of arbitration table entries supported by the design is reported in the VC Arbitration Capability field of Port VC Capability Register 2. The table size is selected by writing the corresponding value in to the <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="409" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D449 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D436 TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi>V</mi><mi>C</mi></mrow></math></mjx-assistive-mml></mjx-container> Arbitration Select field of the Port VC Control Register. See Figure 6-10 on page 268. Each entry in the table represents one phase that software loads with a low priority VC ID value. The VC arbiter repeatedly scans all table entries in a sequential fashion and sends transactions from the VC buffer specified in the table entries. Once a transaction has been sent, the arbiter immediately proceeds to the next phase.</div></div></div><div><div><div></div></div></div><div><div><div>Software can set up the VC arbitration table such that some VCs are listed in more entries than others; thereby, allowing differentiation of QoS between the VCs. This gives software considerable flexibility in establishing the desired priority. Figure 6-12 on page 270 depicts the weighted round robin VC arbitration concept.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="322" id="mark-468a66f6-cb07-4df3-a89a-e361f15af8b4" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 6-12: Weighted Round Robin Low-Priority VC Arbitration Table Example</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_329.jpg?x=580&amp;y=446&amp;w=290&amp;h=552"></div></div><div><div><div></div></div></div><h2><div><div>Round Robin Arbitration (Equal or Weighted) for All VCs</div></div></h2><div><div><div></div></div></div><div><div><div>The hardware designer may choose to implement one of the round robin forms of VC arbitration for all VCs. This is accomplished by specifying the highest VC number supported by the device as a member of the low priority group (via the Lowest Priority Extended Count field. In this case, all VC priorities are managed via the VC arbitration table. Note that the VC arbitration table is not used when the Hardware Fixed Round Robin scheme is selected. See page 269.</div></div></div><div><div><div></div></div></div><h2><div><div>Loading the Virtual Channel Arbitration Table</div></div></h2><div><div><div></div></div></div><div><div><div>The VC Arbitration Table (VAT) is located at an offset from the beginning of the extended configuration space as indicated by the VC Arbitration Table Offset field. This offset is contained within Port VC Capability Register 2. (See Figure 6-13 on page 271.) Chapter 6: QoS/TCs/VCs and Arbitration</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="323" id="mark-d4541157-bb16-405b-aafc-e5db2d27de63" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 6-13: VC Arbitration Table Offset and Load VC Arbitration Table Fields</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_330.jpg?x=268&amp;y=418&amp;w=911&amp;h=976"></div></div><div><div><div></div></div></div><div><div><div>Refer to Figure 6-14 on page 272 during the following discussion. Each entry within the VAT is a 4-bit field that identifies the VC ID of the virtual channel buffer that is scheduled to deliver data during this corresponding phase. The table length is a function of the hardware design and the arbitration scheme selected if choices are supported by the design as illustrated in Figure 6-10 on page 268.</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="324" id="mark-0622f392-a7b3-4581-80c4-1fc657090aa1" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>The table is loaded by configuration software to achieve the priority order desired for the virtual channels. Hardware sets the VC Arbitration Table Status bit when software updates any entry within the table. Once the table is loaded, software sets the Load VC Arbitration Table bit within the Port VC Control register. This bit causes hardware to load the new values into the VC Arbiter. Hardware clears the VC Arbitration Table Status bit when table loading is complete; thereby, permitting software to verify successful loading.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 6-14: Loading the VC Arbitration Table Entries</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_331.jpg?x=244&amp;y=632&amp;w=967&amp;h=858"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="325" id="mark-c4628637-0a84-4f8b-826b-751c4fe0cd56" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>VC Arbitration within Multiple Function Endpoints</div></div></h2><div><div><div></div></div></div><div><div><div>The specification does not state how an endpoint should manage the arbitration of data flows from different functions within an endpoint. However it does state that "Multi-function Endpoints... should support PCI Express VC-based arbitration control mechanisms if multiple VCs are implemented for the PCI Express Link." VC arbitration when there are multiple functions raises interesting questions about the approach to be taken. Of course when the device functions support only VC0, no VC arbitration is necessary. The specification leaves the approach open to the designer.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 6-15 on page 274 shows a functional block diagram of an example implementation in which two functions are implemented within an endpoint device, each of which supports two VCs. The example approach is based upon the goal of using a standard PCI Express core to interface both functions to the link. The transaction layer within the link performs the TC/VC mapping and VC arbitration. The device-specific portion of the design is the function arbiter that determines the priority of data flows from the functions to the transaction layer of the core. Following are key considerations for such an approach:</div></div></div><div><div><div></div></div></div><div><ul><li>Rather than duplicating the TC/VC mapping within each function, the standard device core performs the task. An important consideration for this decision is that all functions must use the same TC/VC mapping. The specification requires that the TC/VC mapping be the same for devices at each end of a link. This means that each function within the endpoint must have the same mappings.</li></ul></div><div><div><div></div></div></div><div><ul><li>The function arbiter used TC values to determine the priority of transactions being delivered from the two functions, and selects the highest priority transaction from the functions when forwarding transactions to the transaction layer of the PCI Express core. The arbitration algorithm is hardwired based on the applications associated with each function.</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="326" id="mark-2ca47b4f-56e2-443b-a09c-388a71bb5be4" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 6-15: Example Multi-Function Endpoint Implementation with VC Arbitration</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_333.jpg?x=221&amp;y=401&amp;w=1001&amp;h=615"></div></div><div><div><div></div></div></div><h2><div><div>Port Arbitration</div></div></h2><div><div><div></div></div></div><div><div><div>When traffic from multiple ports vie for limited bandwidth associated with a common egress port, arbitration is required. The concept of port arbitration is pictured in Figure 6-16 on page 275. Note that port arbitration exists in three locations within a system:</div></div></div><div><div><div></div></div></div><div><ul><li>Egress ports of switches</li></ul></div><div><div><div></div></div></div><div><ul><li>Root Complex ports when peer-to-peer transactions are supported</li></ul></div><div><div><div></div></div></div><div><ul><li>Root Complex egress ports to that lead to sources such as main memory</li></ul></div><div><div><div></div></div></div><div><div><div>Port arbitration requires software configuration, which is handled via PCI-to-PCI bridge (PPB) configuration in both switches and peer-to-peer transfers within the Root Complex and by the Root Complex Register Block when accessing shared root complex resources such as main memory. Port arbitration occurs independently for each virtual channel supported by the egress port. In the example below, root port 2 supports peer-to-peer transfers from root ports 1 and 2; however, peer-to-peer transfer support between root complex ports is not required.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="327" id="mark-cb3d8d1d-347a-4c1f-939a-e947cda46609" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Because port arbitration is managed independently for each VC of the egress port or RCRB, a port arbitration table is required for each VC that supports programmable port arbitration as illustrated in Figure 6-17 on page 276. Port arbitration tables are supported only by switches and RCRBs and are not allowed for endpoints, root ports and PCI Express bridges.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 6-16: Port Arbitration Concept</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_334.jpg?x=261&amp;y=636&amp;w=922&amp;h=671"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="328" id="mark-79a1ef28-5471-442c-af96-25843a55839f" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_335.jpg?x=212&amp;y=340&amp;w=991&amp;h=652"></div></div><div><div><div></div></div></div><div><div><div>The process of arbitrating between different packet streams also implies the use of additional buffers to accumulate traffic from each port in the egress port as illustrated in Figure 6-18 on page 277. This example illustrates two ingress ports (1 and 2) whose transactions are routed to an egress port (3). The action taken by the switch include:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">Transactions arriving at the ingress ports are directed to the appropriate flow control buffers based on the TC/VC mapping.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">Transactions are forwarded from the flow control buffers to the routing logic is consulted to determine the egress port.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">Transactions are routed to the egress port (3) where TC/VC mapping determines into which VC buffer the transactions should be placed.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">A set of VC buffers is associated with each of the egress ports. Note that the ingress port number is tracked until transactions are placed in their VC buffer.</li></ol></div><div><div><div></div></div></div><div><ol><li value="5">Port arbitration logic determines the order in which transactions are sent from each group of VC buffers.</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="329" id="mark-b3a6fafa-5f96-4e52-bbce-cfdf6846309c" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 6-18: Port Arbitration Buffering</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_336.jpg?x=239&amp;y=400&amp;w=967&amp;h=741"></div></div><div><div><div></div></div></div><h2><div><div>The Port Arbitration Mechanisms</div></div></h2><div><div><div></div></div></div><div><div><div>The actual port arbitration mechanisms defined by the specification are similar to the models used for VC arbitration and include:</div></div></div><div><div><div></div></div></div><div><ul><li>Non-configurable hardware-fixed arbitration scheme</li></ul></div><div><div><div></div></div></div><div><ul><li>Weighted Round Robin (WRR) arbitration with 32 phases</li></ul></div><div><div><div></div></div></div><div><ul><li>WRR arbitration with 64 phases</li></ul></div><div><div><div></div></div></div><div><ul><li>WRR arbitration with 128 phases</li></ul></div><div><div><div></div></div></div><div><ul><li>Time-based WRR arbitration with 128 phases</li></ul></div><div><div><div></div></div></div><div><ul><li>WRR arbitration with 256 phases</li></ul></div><div><div><div></div></div></div><div><div><div>Configuration software must determine the port arbitration capability for a switch or RCRB and select the port arbitration scheme to be used for each enabled VC. Figure 6-19 on page 278 illustrates the registers and fields involved in determining port arbitration capabilities and selecting the port arbitration scheme to be used by each VC.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="330" id="mark-bc6317ba-e209-4d68-b50d-89c777d4fd3a" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 6-19: Software checks Port Arbitration Capabilities and Selects the Scheme to be Used.</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_337.jpg?x=289&amp;y=399&amp;w=872&amp;h=1058"></div></div><div><div><div></div></div></div><div><div><div>Non-Configurable Hardware-Fixed Arbitration. This port arbitration mechanism does not require configuration of the port arbitration table. Once selected by software, the mechanism is managed solely by hardware. The actual arbitration scheme is based on a round-robin or similar approach where each port has the same priority. This type of mechanism ensures a type of fairness and ensures that all transactions can make forward</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="331" id="mark-f974e745-d345-4695-8a9e-2cb1083094b7" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>progress. However, it does not service the goals of differentiated services and does not support isochronous transactions.</div></div></div><div><div><div></div></div></div><div><div><div>Weighted Round Robin Arbitration. Like the weighted round robin mechanism used for VC arbitration, software loads the port arbitration table such that some ports can receive higher priority than others based on the number of phases in the round robin that are allocated for each port. This approach allows software to facilitate differentiated services by assigning different weights to traffic coming from different ports.</div></div></div><div><div><div></div></div></div><div><div><div>As the table is scanned each table phase specifies a port number that identifies the VC buffer from which the next transaction is sent. Once the transaction is delivered arbitration control logic immediately proceeds to the next phase. For a given port, if no transaction is pending transmission the arbiter advances immediately to the next phase.</div></div></div><div><div><div></div></div></div><div><div><div>The specification defines four table lengths for WRR port arbitration, determined by the number of phases used by the table. The table length selections include:</div></div></div><div><div><div></div></div></div><div><ul><li>32 phases</li></ul></div><div><div><div></div></div></div><div><ul><li>64 phases</li></ul></div><div><div><div></div></div></div><div><ul><li>128 phases</li></ul></div><div><div><div></div></div></div><div><ul><li>256 phases</li></ul></div><div><div><div></div></div></div><div><div><div>Time-Based, Weighted Round Robin Arbitration. The time-based WRR mechanism is required for supporting isochronous transactions. Consequently, each switch egress port and RCRB that supports isochronous transactions must implement time-based WRR port arbitration.</div></div></div><div><div><div></div></div></div><div><div><div>Time-based weighted round robin adds the element of a virtual timeslot for each arbitration phase. Just as in WRR the port arbiter delivers one transaction from the Ingress Port VC buffer indicated by the Port Number of the current phase. However, rather than immediately advancing to the next phase, the time-based arbiter waits until the current virtual timeslot elaspses before advancing. This ensures that transactions are accepted from the ingress port buffer at regular intervals. Note that the timeslot does not govern the duration of the transfer, but rather the interval between transfers. The maximum duration of a transaction is the time it takes to complete the round robin and return to the original timeslot. Each timeslot is defined as 100ns.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="332" id="mark-935af1df-3acf-4448-ae9e-a4dd9a9f7a91" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Also, it is possible that no transaction is delivered during a timeslot, resulting in an idle timeslot. This occurs when:</div></div></div><div><div><div></div></div></div><div><ul><li>no transaction is pending for the selected ingress port during the current phase, or</li></ul></div><div><div><div></div></div></div><div><ul><li>the phase contains the port number of this egress port</li></ul></div><div><div><div></div></div></div><div><div><div>Time-based WRR arbitration supports a maximum table length of 128 phases. The actual number of phases implemented is reported via the Maximum Time Slot field of each virtual channel that supports Timed WRR arbitration. See the Figure 6-20 on page 280 which illustrate the Maximum Time Slots Field within the VCn Resource Capability register. See MindShare's website for a white paper on example applications of Time-Based WRR.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 6-20: Maximum Time Slots Register</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_339.jpg?x=242&amp;y=800&amp;w=963&amp;h=333"></div></div><div><div><div></div></div></div><h2><div><div>Loading the Port Arbitration Tables</div></div></h2><div><div><div></div></div></div><div><div><div>A port arbitration table is required for each VC supported by the egress port.</div></div></div><div><div><div></div></div></div><div><div><div>The actual size and format of the Port Arbitration Tables are a function of the number of phases and the number of ingress ports supported by the Switch, RCRB, or Root Port that supports peer-to-peer transfers. The maximum number of ingress ports supported by the Port Arbitration Table is 256 ports. The actual number of bits within each table entry is design dependent and governed by the number of ingress ports whose transactions can be delivered to the egress port. The size of each table entry is reported in the 2-bit Port Arbitration Table Entry Size field of Port VC Capability Register 1. The permissible values are:</div></div></div><div><div><div></div></div></div><hr><div><div><div></div></div></div><div><!-- Code --></div><div><div><div></div></div></div><div><ul><li><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="410" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>00</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mo>−</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> bit</li></ul></div><div><div><div></div></div></div><div><ul><li><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="411" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>01</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mo>−</mo><mn>2</mn></math></mjx-assistive-mml></mjx-container> bits</li></ul></div><div><div><div></div></div></div><div><ul><li><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="412" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mo>−</mo><mn>4</mn></math></mjx-assistive-mml></mjx-container> bits</li></ul></div><div><div><div></div></div></div><div><ul><li><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="413" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c38"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>11</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mo>−</mo><mn>8</mn></math></mjx-assistive-mml></mjx-container> bits</li></ul></div><div><div><div></div></div></div><div><!-- Code --></div><div><div><div></div></div></div><hr><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="333" id="mark-c8859ec0-143e-47f5-9103-ba50b08b1bff" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Chapter 6: QoS/TCs/VCs and Arbitration</div></div></h2><div><div><div></div></div></div><div><div><div>Configuration software loads each table with port numbers to accomplish the desired port priority for each VC supported. As illustrated in Figure 6-21 on page 281 , the port arbitration table format depends on the size of each entry and the number of time slots supported by this design.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 6-21: Format of Port Arbitration Table</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_340.jpg?x=278&amp;y=539&amp;w=905&amp;h=1076"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="334" id="mark-ae0a279b-d760-491d-a8d6-4dde6f32a663" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Switch Arbitration Example</div></div></h2><div><div><div></div></div></div><div><div><div>This section provides an example of a three-port switch with both Port and VC arbitration illustrated. The example presumes that packets arriving on ingress ports 0 and 1 are moving in the upstream direction and port 2 is the egress port facing the Root Complex. This example serves to summarize port and VC arbitration and illustrate their use within a PCI Express switch. Refer to Figure 6-22 on page 283 during the following discussion.</div></div></div><div><div><div></div></div></div><div><ol><li value="1">Packets arrive at ingress port 0 and are placed in a receiver flow control buffer based on TC/VC mapping associated with port 0 . As indicated, TLPs carrying traffic class TC0 or TC1 are sent to the VC0 receiver flow control buffers. TLPs carrying traffic class TC3 or TC5 are sent to the VC1 receiver flow control buffers. No other TCs are permitted on this link.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">Packets arrive at ingress port 1 and are placed in a receiver flow control buffer based on port <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="414" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c43"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c56"></mjx-c><mjx-c class="mjx-c43"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">TC</mi></mrow></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">VC</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> mapping. As indicated,TLPs carrying traffic class TC0 are sent to the VC0 receiver flow control buffers. TLPs carrying traffic class TC2-TC4 are sent to the VC3 receiver flow control buffers. NO OTHER TCs are permitted on this link.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">The target egress port is determined from routing information in each packet. Address routing is applied to memory or IO request TLPs, ID routing is applied to configuration or completion TLPs, etc.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">All packets destined for egress port 2 are subjected to the TC/VC mapping for that port. As shown, TLPs carrying traffic class TC0-TC2 are managed as virtual channel 0 (VC0) traffic, TLPs carrying traffic class TC3-TC7 are managed as VC1 traffic.</li></ol></div><div><div><div></div></div></div><div><ol><li value="5">Independent Port Arbitration is applied to packets within each VC. This may be a fixed or weighted round robin arbitration used to select packets from all possible different ingress ports. Port arbitration ultimately results in all VCs of a given type being routed to the same VC buffer.</li></ol></div><div><div><div></div></div></div><div><ol><li value="6">Following Port Arbitration, VC arbitration determines the order in which transactions pending transmission within the individual VC buffers will be transferred across the link. The arbitration algorithm may be fixed or weighted round robin. The arbiter selects transactions from the head of each VC buffer based on the priority scheme implemented.</li></ol></div><div><div><div></div></div></div><div><ol><li value="7">Note that the VC arbiter selects packets for transmission only if sufficient flow control credits exist.</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="335" id="mark-062d8637-eaf8-41ec-872d-cfa0a4d3f92b" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 6-22: Example of Port and VC Arbitration within A Switch</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_342.jpg?x=219&amp;y=412&amp;w=1012&amp;h=1219"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="336" id="mark-f5100ffe-0b36-4237-87f4-01fb23f8acba" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Flow Control</div></div></h2><div><div><div></div></div></div><h2><div><div>The Previous Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>This previous chapter discussed Traffic Classes, Virtual Channels, and Arbitration that supports Quality of Service concepts in PCI Express implementations. The concept of Quality of Service in the context of PCI Express is an attempt to predict the bandwidth and latency associated with the flow of different transaction streams traversing the PCI Express fabric. The use of QoS is based on application-specific software assigning Traffic Class (TC) values to transactions, which define the priority of each transaction as it travels between the Requester and Completer devices. Each TC is mapped to a Virtual Channel (VC) that is used to manage transaction priority via two arbitration schemes called port and VC arbitration.</div></div></div><div><div><div></div></div></div><h2><div><div>This Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>This chapter discusses the purposes and detailed operation of the Flow Control Protocol. This protocol requires each device to implement credit-based link flow control for each virtual channel on each port. Flow control guarantees that transmitters will never send Transaction Layer Packets (TLPs) that the receiver can't accept. This prevents receive buffer over-runs and eliminates the need for inefficient disconnects, retries, and wait-states on the link. Flow Control also helps enable compliance with PCI Express ordering rules by maintaining separate virtual channel Flow Control buffers for three types of transactions: Posted (P), Non-Posted (NP) and Completions (Cpl).</div></div></div><div><div><div></div></div></div><h2><div><div>The Next Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>The next chapter discusses the ordering requirements for PCI Express devices, as well as PCI and PCI-X devices that may be attached to a PCI Express fabric. The discussion describes the Producer/Consumer programming model upon which the fundamental ordering rules are based. It also describes the potential performance problems that can emerge when strong ordering is employed, describes the weak ordering solution, and specifies the rules defined for deadlock avoidance.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="337" id="mark-0bd7e961-06bd-4dbb-abb3-2d7859e75088" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Flow Control Concept</div></div></h2><div><div><div></div></div></div><div><div><div>The ports at each end of every PCI Express link must implement Flow Control. Before a transaction packet can be sent across a link to the receiving port, the transmitting port must verify that the receiving port has sufficient buffer space to accept the transaction to be sent. In many other architectures including PCI and PCI-X, transactions are delivered to a target device without knowing if it can accept the transaction. If the transaction is rejected due to insufficient buffer space, the transaction is resent (retried) until the transaction completes. This procedure can severely reduce the efficiency of a bus, by wasting bus bandwidth when other transactions are ready to be sent.</div></div></div><div><div><div></div></div></div><div><div><div>Because PCI Express is a point-to-point implementation, the Flow Control mechanism would be ineffective, if only one transaction stream was pending transmission across a link. That is, if the receive buffer was temporarily full, the transmitter would be prevented from sending a subsequent transaction due to transaction ordering requirements, thereby blocking any further transfers. PCI Express improves link efficiency by implementing multiple flow-control buffers for separate transaction streams (virtual channels). Because Flow Control is managed separately for each virtual channel implemented for a given link, if the Flow Control buffer for one VC is full, the transmitter can advance to another VC buffer and send transactions associated with it.</div></div></div><div><div><div></div></div></div><div><div><div>The link Flow Control mechanism uses a credit-based mechanism that allows the transmitting port to check buffer space availability at the receiving port. During initialization each receiver reports the size of its receive buffers (in Flow Control credits) to the port at the opposite end of the link. The receiving port continues to update the transmitting port regularly by transmitting the number of credits that have been freed up. This is accomplished via Flow Control DLLPs.</div></div></div><div><div><div></div></div></div><div><div><div>Flow control logic is located in the transaction layer of the transmitting and receiving devices. Both transmitter and receiver sides of each device are involved in flow control. Refer to Figure 7-1 on page 287 during the following descriptions.</div></div></div><div><div><div></div></div></div><div><ul><li>Devices Report Buffer Space Available - The receiver of each node contains the Flow Control buffers. Each device must report the amount of flow control buffer space they have available to the device on the opposite end of the link. Buffer space is reported in units called Flow Control Credits (FCCs). The number of Flow Control Credits within each buffer is forwarded from the transaction layer to the transmit side of the link layer as illustrated in Figure 7-1. The link creates a Flow Control DLLP that carries this credit information to the receiver at the opposite end of the link. This is done for each Flow Control Buffer.</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="338" id="mark-5f658023-2ed8-4103-9548-94f5c239dc72" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><ul><li>Receiving Credits - Notice that the receiver in Figure 7-1 also receives Flow Control DLLPs from the device at the opposite end of the link. This information is transferred to the transaction layer to update the Flow Control Counters that track the amount of Flow Control Buffer space in the other device.</li></ul></div><div><div><div></div></div></div><div><ul><li>Credit Checks Made - Each transmitter check consults the Flow Control Counters to check available credits. If sufficient credits are available to receive the transaction pending delivery then the transaction is forwarded to the link layer and is ultimately sent to the opposite device. If enough credits are not available the transaction is temporarily blocked until additional Flow Control credits are reported by the receiving device.</li></ul></div><div><div><div></div></div></div><div><div><div>Figure 7-1: Location of Flow Control Logic</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_346.jpg?x=230&amp;y=853&amp;w=903&amp;h=786"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="339" id="mark-14c9d850-a595-48a3-bbd7-ccd6b1d55aed" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Flow Control Buffers</div></div></h2><div><div><div></div></div></div><div><div><div>Flow control buffers are implemented for each VC resource supported by a PCI Express port. Recall that devices at each end of the link may not support the same number of VC resources, therefore the maximum number of VCs configured and enabled by software is the greatest number of VCs in common between the two ports.</div></div></div><div><div><div></div></div></div><h2><div><div>VC Flow Control Buffer Organization</div></div></h2><div><div><div></div></div></div><div><div><div>Each VC Flow Control buffer at the receiver is managed for each category of transaction flowing through the virtual channel. These categories are:</div></div></div><div><div><div></div></div></div><div><ul><li>Posted Transactions - Memory Writes and Messages</li></ul></div><div><div><div></div></div></div><div><ul><li>Non-Posted Transactions - Memory Reads, Configuration Reads and Writes, and I/O Reads and Writes</li></ul></div><div><div><div></div></div></div><div><ul><li>Completions - Read Completions and Write Completions</li></ul></div><div><div><div></div></div></div><div><div><div>In addition, each of these categories is separated into header and data portions of each transaction. Flow control operates independently for each of the six buffers listed below (also see Figure 7-2 on page 289).</div></div></div><div><div><div></div></div></div><div><ul><li>Posted Header</li></ul></div><div><div><div></div></div></div><div><ul><li>Posted Data</li></ul></div><div><div><div></div></div></div><div><ul><li>Non-Posted Header</li></ul></div><div><div><div></div></div></div><div><ul><li>Non-Posted Data</li></ul></div><div><div><div></div></div></div><div><ul><li>Completion Header</li></ul></div><div><div><div></div></div></div><div><ul><li>Completion Data</li></ul></div><div><div><div></div></div></div><div><div><div>Some transactions consist of a header only (e.g., read requests) while others consist of a header and data (e.g., write requests). The transmitter must ensure that both header and data buffer space is available as required for each transaction before the transaction can be sent. Note that when a transaction is received into a VC Flow Control buffer that ordering must be maintained when the transactions are forwarded to software or to an egress port in the case of a switch. The the receiver must also track the order of header and data components within the Flow Control buffer.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="340" id="mark-37426ac7-3e64-4715-81a2-7e1dc1abcdd7" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 7-2: Flow Control Buffer Organization</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_348.jpg?x=257&amp;y=399&amp;w=939&amp;h=784"></div></div><div><div><div></div></div></div><h2><div><div>Flow Control Credits</div></div></h2><div><div><div></div></div></div><div><div><div>Buffer space is reported by the receiver in units called Flow Control credits. The unit value of Flow Control credits (FCCs) may differ between header and data as listed below:</div></div></div><div><div><div></div></div></div><div><ul><li>Header FCCs - maximum header size + digest</li></ul></div><div><div><div></div></div></div><div><div><div>o 4 DWs for completions</div></div></div><div><div><div></div></div></div><div><div><div>o 5 DWs for requests</div></div></div><div><div><div></div></div></div><div><ul><li>Data FCCs -4 DWs (aligned 16 bytes)</li></ul></div><div><div><div></div></div></div><div><div><div>Flow control credits are passed within the header of the link layer Flow Control Packets. Note that DLLPs do not require Flow Control credits because they originate and terminate at the link layer. PCI Express System Architecture</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="341" id="mark-025fb5f6-1459-467f-ad29-ae007ffc8d94" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Maximum Flow Control Buffer Size</div></div></h2><div><div><div></div></div></div><div><div><div>The maximum buffer size that can be reported via the Flow Control Initialization and Update packets for the header and data portions of a transaction are as follows:</div></div></div><div><div><div></div></div></div><h2><div><div>128 Credits for headers</div></div></h2><div><div><div></div></div></div><div><ul><li>2,560 bytes Request Headers @ 20 bytes/credit</li></ul></div><div><div><div></div></div></div><div><ul><li>2048 bytes for completion headers @ 16 bytes/credit</li></ul></div><div><div><div></div></div></div><h2><div><div>2048 Credits for data</div></div></h2><div><div><div></div></div></div><div><ul><li><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="415" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c40"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>32</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">KB</mi></mrow></mrow><mrow data-mjx-texclass="ORD"><mo>@</mo></mrow><mrow data-mjx-texclass="ORD"><mn>16</mn></mrow></math></mjx-assistive-mml></mjx-container> bytes/credit</li></ul></div><div><div><div></div></div></div><div><div><div>The reason for these limits is discussed in the section entitled "Stage 1 - Flow Control Following Initialization" page 296, step 2.</div></div></div><div><div><div></div></div></div><h2><div><div>Introduction to the Flow Control Mechanism</div></div></h2><div><div><div></div></div></div><div><div><div>The specification defines the requirements of the Flow Control mechanism by describing conceptual registers and counters along with procedures and mechanisms for reporting, tracking, and calculating whether a transaction can be sent. These elements define the functional requirements; however, the actual implementation may vary from the conceptual model. This section introduces the specified model that serves to explain the concept and define the requirements. The approach taken focuses on a single flow control example for a non-posted header. The concepts discussed apply to all Flow Control buffer types.</div></div></div><div><div><div></div></div></div><h2><div><div>The Flow Control Elements</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 7-3 identifies and illustrates the elements used by the transmitter and receiver when managing flow control. This diagram illustrates transactions flowing in a single direction across a link, but of course another set of these elements is used to support transfers in the opposite direction. The primary function of each element within the transmitting and receiving devices is listed below. Note that for a single direction these Flow Control elements are duplicated for each Flow Control receive buffer, yielding six sets of elements. This example deals with non-posted header flow control.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="342" id="mark-e99f9ea9-4f29-498b-8a10-9d81861f92c8" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Transmitter Elements</div></div></h2><div><div><div></div></div></div><div><ul><li>Pending Transaction Buffer - holds transactions that are pending transfer within the same virtual channel.</li></ul></div><div><div><div></div></div></div><div><ul><li>Credit Consumed Counter - tracks the size of all transactions sent from the VC buffer (of the specified type, e.g., non-posted headers) in Flow Control credits. This count is abbreviated "CC."</li></ul></div><div><div><div></div></div></div><div><ul><li>Credit Limit Register - this register is initialized by the receiving device when it sends Flow Control initialization packets to report the size of the corresponding Flow Control receive buffer. Following initialization, Flow Control update packets are sent periodically to add more Flow Control credits as they become available at the receiver. This value is abbreviated “CL.”</li></ul></div><div><div><div></div></div></div><div><ul><li>Flow Control Gating Logic - performs the calculations to determine if the receiver has sufficient Flow Control credits to receive the pending TLP (PTLP). In essence, this check ensures that the total CREDITS_CONSUMED (CC) plus the credit required for the next packet pending transmission (PTLP) does not exceed the CREDIT_LIMIT (CL). This specification defines the following equation for performing the check, with all values represented in credits:</li></ul></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" display="true" tabindex="0" ctxtmenu_counter="416" style="font-size: 122.8%; position: relative;"><mjx-math display="true" class="MJX-TEX" aria-hidden="true" style="margin-left: 0px; margin-right: 0px;"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c43"></mjx-c><mjx-c class="mjx-c4C"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mrow space="3"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c43"></mjx-c><mjx-c class="mjx-c43"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mtext class="mjx-n" space="3"><mjx-c class="mjx-cA0"></mjx-c><mjx-c class="mjx-c50"></mjx-c><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c4C"></mjx-c><mjx-c class="mjx-c50"></mjx-c><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow><mjx-msup><mjx-texatom texclass="ORD"><mjx-mtext class="mjx-n"><mjx-c class="mjx-cA0"></mjx-c><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c6F"></mjx-c><mjx-c class="mjx-c64"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext></mjx-texatom><mjx-script style="vertical-align: 0.421em;"><mjx-texatom size="s" texclass="ORD"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mtext class="mjx-n"><mjx-c class="mjx-c46"></mjx-c><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c6C"></mjx-c><mjx-c class="mjx-c64"></mjx-c><mjx-c class="mjx-c53"></mjx-c><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c7A"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo></mjx-mrow></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2264"></mjx-c></mjx-mo><mjx-msup space="4"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom><mjx-script style="vertical-align: 0.413em;"><mjx-texatom size="s" texclass="ORD"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mtext class="mjx-n"><mjx-c class="mjx-c46"></mjx-c><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c6C"></mjx-c><mjx-c class="mjx-c64"></mjx-c><mjx-c class="mjx-c53"></mjx-c><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c7A"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo></mjx-mrow></mjx-texatom></mjx-script></mjx-msup><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">CL</mi></mrow></mrow><mo>−</mo><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">CC</mi></mrow></mrow><mo>+</mo><mtext>&nbsp;PTLP&nbsp;</mtext></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow><msup><mrow data-mjx-texclass="ORD"><mtext>&nbsp;mod 2&nbsp;</mtext></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">[</mo><mtext>FieldSize&nbsp;</mtext><mo data-mjx-texclass="CLOSE">]</mo></mrow></mrow></msup><mo>≤</mo><msup><mrow data-mjx-texclass="ORD"><mn>2</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">[</mo><mtext>FieldSize&nbsp;</mtext><mo data-mjx-texclass="CLOSE">]</mo></mrow></mrow></msup><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mn>2</mn></math></mjx-assistive-mml></mjx-container></div></div></div><div><div><div></div></div></div><div><div><div>For an example application of this equation, See "Stage 1 - Flow Control Following Initialization" on page 294.</div></div></div><div><div><div></div></div></div><h2><div><div>Receiver Elements</div></div></h2><div><div><div></div></div></div><div><ul><li>Flow Control (Receive) Buffer - stores incoming header or data information.</li></ul></div><div><div><div></div></div></div><div><ul><li>Credit Allocated - This counter tracks the total Flow Control credits that have been allocated (made available) since initialization. It is initialized by hardware to reflect the size of the associated Flow Control buffer. As the buffer fills the amount of available buffer space decreases until transactions are removed from the buffer. The number of Flow Control credits associated with each transaction removed from the buffer is added to the CREDIT_ALLOCATED counter; thereby keeping a running count of new credits made available.</li></ul></div><div><div><div></div></div></div><div><ul><li>Credits Received Counter (optional) - this counter keeps track of the total size of all data received from the transmitting device and placed into the Flow Control buffer (in Flow Control credits). When flow control is functioning properly, the CREDITS_RECEIVED count should be the same as</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="343" id="mark-af5e835b-6a2c-433b-a313-bc8a2e11a92b" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>CREDITS_CONSUMED count at the transmitter and be equal to or less than the CREDIT_ALLOCATED count. If this is not true, then a flow control buffer overflow has occurred and error is detected. Although optional the specification recommends its use.</div></div></div><div><div><div></div></div></div><div><div><div>Flow control management is based on keeping track of Flow Control credits using modulo counters. Consequently, the counters are designed to role over when the count saturates. The width of the counters depend on whether flow control is tracking transaction headers or data:</div></div></div><div><div><div></div></div></div><div><ul><li>Header flow control uses modulo 256 counters (8-bits wide)</li></ul></div><div><div><div></div></div></div><div><ul><li>Data flow control uses modulo 4096 counters (12-bits wide)</li></ul></div><div><div><div></div></div></div><div><div><div>In addition, all calculations are made using unsigned arithmetic. The operation of the counters and the calculations are explained by example on page 290 .</div></div></div><div><div><div></div></div></div><div><div><div>Figure 7-3: Flow Control Elements</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_351.jpg?x=223&amp;y=893&amp;w=1001&amp;h=754"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="344" id="mark-06287ca2-45ae-4370-acd5-61ad3f018b03" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Flow Control Packets</div></div></h2><div><div><div></div></div></div><div><div><div>The transmit side of a device reports flow control credit information from its receive buffers to the opposite device. The specification defines three types of Flow Control packets:</div></div></div><div><div><div></div></div></div><div><ul><li>Flow Control Init1 - used to report the size of the Flow Control buffers for a given virtual channel</li></ul></div><div><div><div></div></div></div><div><ul><li>Flow Control Init2 - same as Flow Control Init1 except it is used to verify completion of flow control initialization at each end of the link (receiving device ignores flow control credit information)</li></ul></div><div><div><div></div></div></div><div><ul><li>Flow Control Update - used to update Credit Limit periodically</li></ul></div><div><div><div></div></div></div><div><div><div>Each Flow Control packet contains the header and data flow control credit information for each virtual channel and type of Flow Control packet. The packet fields that carry the header and data Flow Control credits reflect the counter width as discussed in the previous section. Figure 7-4 pictures the format and content of these packets.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 7-4: Types and Format of Flow Control Packets</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_352.jpg?x=224&amp;y=1020&amp;w=994&amp;h=643"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="345" id="mark-76424065-2965-42fc-9866-870e0324de05" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Operation of the Flow Control Model An Example</div></div></h2><div><div><div></div></div></div><div><div><div>The purpose of this example is to explain the operation of the Flow Control mechanism based on the conceptual model presented by the specification. The example uses the non-posted header Flow Control buffer type, and spans four stages to capture the nuances of the flow control implementation:</div></div></div><div><div><div></div></div></div><div><div><div>Stage One - Immediately following initialization, the several transactions are tracked to explain the basic operation of the counters and registers as they track transactions as they are sent across the link. In this stage, data is accumulating within the Flow Control buffer, but no transactions are being removed.</div></div></div><div><div><div></div></div></div><div><div><div>Stage Two - If the transmitter sends non-posted transactions at a rate such that the Flow Control buffer is filled faster than the receiver can forward transactions from the buffer, the buffer will fill. Stage two describes this circumstance.</div></div></div><div><div><div></div></div></div><div><div><div>Stage Three - The modulo counters are designed to roll over and continue counting from zero. This stage describes the flow control operation at the point of the CREDITS_ALLOCATED count rolling over to zero.</div></div></div><div><div><div></div></div></div><div><div><div>Stage Four - The specification describes the optional error check that can be made by the receiver in the event of a Flow Control buffer overflow. This error check is described in this section.</div></div></div><div><div><div></div></div></div><h2><div><div>Stage 1 — Flow Control Following Initialization</div></div></h2><div><div><div></div></div></div><div><div><div>The assumption made in this example is that flow control initialization has just completed and the devices are ready for normal operation. The Flow Control buffer is presumed to be <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="417" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">KB</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> in size,which represents <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="418" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c64"></mjx-c></mjx-mi></mjx-texatom><mjx-mrow space="2"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>102</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">d</mi></mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mn>66</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">h</mi></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> Flow Control units with 20 bytes/header. Figure 7-5 on page 295 illustrates the elements involved with the values that would be in each counter and register following flow control initialization.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="346" id="mark-c297aea7-2794-4ce6-ab02-d73224d19ef9" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 7-5: Flow Control Elements Following Initialization</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_354.jpg?x=223&amp;y=403&amp;w=999&amp;h=768"></div></div><div><div><div></div></div></div><div><div><div>The transmitter must check Flow Control credit prior to sending a transaction. In the case of headers the number of Flow Control units required is always one. The transmitter takes the following steps to determine if the transaction can be sent. For simplicity, this example ignores the possibility of data being included in the transaction.</div></div></div><div><div><div></div></div></div><div><div><div>The credit check is made using unsigned arithmetic ( <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="419" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-var"><mjx-c class="mjx-c2032"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msup><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mrow data-mjx-texclass="ORD"><mn>2</mn></mrow><mrow data-mjx-texclass="ORD"><mi data-mjx-alternate="1">′</mi></mrow></msup><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> complement) in order to satisfy the following formula:</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" display="true" tabindex="0" ctxtmenu_counter="420" style="font-size: 122.8%; position: relative;"><mjx-math display="true" class="MJX-TEX" aria-hidden="true" style="margin-left: 0px; margin-right: 0px;"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c43"></mjx-c><mjx-c class="mjx-c4C"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mrow space="3"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c43"></mjx-c><mjx-c class="mjx-c43"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mtext class="mjx-n" space="3"><mjx-c class="mjx-cA0"></mjx-c><mjx-c class="mjx-c50"></mjx-c><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c4C"></mjx-c><mjx-c class="mjx-c50"></mjx-c><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow><mjx-msup><mjx-texatom texclass="ORD"><mjx-mtext class="mjx-n"><mjx-c class="mjx-cA0"></mjx-c><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c6F"></mjx-c><mjx-c class="mjx-c64"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext></mjx-texatom><mjx-script style="vertical-align: 0.421em;"><mjx-texatom size="s" texclass="ORD"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mtext class="mjx-n"><mjx-c class="mjx-c46"></mjx-c><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c6C"></mjx-c><mjx-c class="mjx-c64"></mjx-c><mjx-c class="mjx-c53"></mjx-c><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c7A"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo></mjx-mrow></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2264"></mjx-c></mjx-mo><mjx-msup space="4"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom><mjx-script style="vertical-align: 0.413em;"><mjx-texatom size="s" texclass="ORD"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mtext class="mjx-n"><mjx-c class="mjx-c46"></mjx-c><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c6C"></mjx-c><mjx-c class="mjx-c64"></mjx-c><mjx-c class="mjx-c53"></mjx-c><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c7A"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo></mjx-mrow></mjx-texatom></mjx-script></mjx-msup><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">CL</mi></mrow></mrow><mo>−</mo><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">CC</mi></mrow></mrow><mo>+</mo><mtext>&nbsp;PTLP&nbsp;</mtext></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow><msup><mrow data-mjx-texclass="ORD"><mtext>&nbsp;mod 2&nbsp;</mtext></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">[</mo><mtext>FieldSize&nbsp;</mtext><mo data-mjx-texclass="CLOSE">]</mo></mrow></mrow></msup><mo>≤</mo><msup><mrow data-mjx-texclass="ORD"><mn>2</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">[</mo><mtext>FieldSize&nbsp;</mtext><mo data-mjx-texclass="CLOSE">]</mo></mrow></mrow></msup><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mn>2</mn></math></mjx-assistive-mml></mjx-container></div></div></div><div><div><div></div></div></div><div><div><div>Substituting values from Figure 7-5 yields:</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" display="true" tabindex="0" ctxtmenu_counter="421" style="font-size: 122.8%; position: relative;"><mjx-math display="true" class="MJX-TEX" aria-hidden="true" style="margin-left: 0px; margin-right: 0px;"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mrow space="3"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c6F"></mjx-c><mjx-c class="mjx-c64"></mjx-c></mjx-mi><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-msup space="2"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom><mjx-script style="vertical-align: 0.413em;"><mjx-texatom size="s" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2264"></mjx-c></mjx-mo><mjx-msup space="4"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom><mjx-script style="vertical-align: 0.413em;"><mjx-texatom size="s" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow data-mjx-texclass="ORD"><mn>66</mn><mi>h</mi></mrow><mo>−</mo><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mn>00</mn><mi>h</mi></mrow><mo>+</mo><mrow data-mjx-texclass="ORD"><mn>01</mn><mi>h</mi></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi>mod</mi><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><msup><mrow data-mjx-texclass="ORD"><mn>2</mn></mrow><mrow data-mjx-texclass="ORD"><mn>8</mn></mrow></msup></mrow><mo>≤</mo><msup><mrow data-mjx-texclass="ORD"><mn>2</mn></mrow><mrow data-mjx-texclass="ORD"><mn>8</mn></mrow></msup><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mn>2</mn></math></mjx-assistive-mml></mjx-container></div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" display="true" tabindex="0" ctxtmenu_counter="422" style="font-size: 122.8%; position: relative;"><mjx-math display="true" class="MJX-TEX" aria-hidden="true" style="margin-left: 0px; margin-right: 0px;"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c6F"></mjx-c><mjx-c class="mjx-c64"></mjx-c></mjx-mi><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-texatom space="2" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2264"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow data-mjx-texclass="ORD"><mn>66</mn><mi>h</mi></mrow><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>01</mn><mi>h</mi></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi>mod</mi><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mrow data-mjx-texclass="ORD"><mn>256</mn></mrow></mrow><mo>≤</mo><mrow data-mjx-texclass="ORD"><mn>80</mn><mi>h</mi></mrow></math></mjx-assistive-mml></mjx-container></div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="347" id="mark-350834f2-6cfd-4d4a-8626-b8217e4f93ac" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>PCI Express System Architecture</div></div></div><div><div><div></div></div></div><div><ol><li value="1">The current CREDITS_CONSUMED count (CC) is added to the PTLP credits required, to determine the CUMULATIVE_CREDITS_REQUIRED (CR), or <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="423" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>00</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">h</mi></mrow><mo>+</mo><mrow data-mjx-texclass="ORD"><mn>01</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">h</mi></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>01</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">h</mi></mrow></math></mjx-assistive-mml></mjx-container> . Sufficient credits exist if this value is equal to or less than the credit limit.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">The CUMULATIVE_CREDITS_REQUIRED count is subtracted from the CREDIT_LIMIT count (CL) to determine if sufficient credits are available. The following description incorporates a brief review of 2's complement subtraction. When performing subtraction using 2's complement the number to be subtracted is complemented (1's complement) and 1 is added (2's complement). This value is then added to the number being subtracted from. Any carry due to the addition is simply ignored.</li></ol></div><div><div><div></div></div></div><div><div><div>The numbers to subtract are:</div></div></div><div><div><div></div></div></div><div><div><div>CL 01100110b (66h) - CR 00000001b (01h) = n</div></div></div><div><div><div></div></div></div><div><div><div>Number to be subtracted is converted to 2's complement:</div></div></div><div><div><div></div></div></div><div><div><div>0000001b &gt; 11111110b (1’s complement)</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="424" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>11111110</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mo>+</mo><mn>1</mn><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>11111111</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container>  (1’s complement  <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="425" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>+</mo><mn>1</mn><mo>=</mo><mn>2</mn></math></mjx-assistive-mml></mjx-container> ’s complement)</div></div></div><div><div><div></div></div></div><div><div><div>2's complement is added.</div></div></div><div><div><div></div></div></div><div><div><div>01100110</div></div></div><div><div><div></div></div></div><div><div><div>11111111 (add)</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="426" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>01100101</mn></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>01100101</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>65</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">h</mi></mrow></math></mjx-assistive-mml></mjx-container></div></div></div><div><div><div></div></div></div><h2><div><div>Is result <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="427" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3C"></mjx-c><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>&lt;=</mo><mrow data-mjx-texclass="ORD"><mn>80</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">h</mi></mrow></math></mjx-assistive-mml></mjx-container> ?</div></div></h2><div><div><div></div></div></div><div><div><div>Yes, <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="428" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3C"></mjx-c><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>65</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">h</mi></mrow><mo>&lt;=</mo><mrow data-mjx-texclass="ORD"><mn>80</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">h</mi></mrow></math></mjx-assistive-mml></mjx-container> (send transaction)</div></div></div><div><div><div></div></div></div><div><div><div>The result of the subtraction must be equal to or less than <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="429" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mn>2</mn></math></mjx-assistive-mml></mjx-container> the maximum value that can be tracked with a modulo 256 counter (128). This approach is taken to ensure unique results from the unsigned arithmetic. For example, unsigned 2's-complement subtraction yields the same results for both 0-128 and 255-127, as shown below.</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="430" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-mrow space="2"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-mrow space="2"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c38"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-mrow space="2"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c38"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>00</mn><mi>h</mi></mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mn>0</mn><mo data-mjx-texclass="CLOSE">)</mo></mrow><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>80</mn><mi>h</mi></mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mn>128</mn></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow><mo>=</mo><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>80</mn><mi>h</mi></mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mn>128</mn></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container></div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_355.jpg?x=313&amp;y=1365&amp;w=381&amp;h=29"></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="431" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>0000000</mn><mi>b</mi></mrow><mo>+</mo><mrow data-mjx-texclass="ORD"><mn>01111111</mn></mrow><mo>+</mo><mrow data-mjx-texclass="ORD"><mn>1</mn><mi>b</mi></mrow></math></mjx-assistive-mml></mjx-container> (add <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="432" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-var"><mjx-c class="mjx-c2032"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msup><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mrow data-mjx-texclass="ORD"><mn>2</mn></mrow><mrow data-mjx-texclass="ORD"><mi data-mjx-alternate="1">′</mi></mrow></msup><mi>s</mi></math></mjx-assistive-mml></mjx-container> complement)</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="433" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-mrow space="2"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>0000000</mn><mi>b</mi></mrow><mo>+</mo><mrow data-mjx-texclass="ORD"><mn>1000000</mn><mi>b</mi></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>1000000</mn><mi>b</mi></mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mn>10</mn><mi>h</mi></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container></div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" display="true" tabindex="0" ctxtmenu_counter="434" style="font-size: 122.8%; position: relative;"><mjx-math display="true" class="MJX-TEX" aria-hidden="true" style="margin-left: 0px; margin-right: 0px;"><mjx-mtext class="mjx-n"><mjx-c class="mjx-c46"></mjx-c><mjx-c class="mjx-c46"></mjx-c><mjx-c class="mjx-c68"></mjx-c><mjx-c class="mjx-c28"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c29"></mjx-c></mjx-mtext><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c37"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c46"></mjx-c><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mrow space="2"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c37"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom><mjx-mrow space="2"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c38"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>FFh(255)</mtext><mo>−</mo><mn>7</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">Fh</mi></mrow></mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mn>127</mn></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow><mo>=</mo><mo>+</mo><mrow data-mjx-texclass="ORD"><mn>80</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">h</mi></mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mn>128</mn></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container></div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" display="true" tabindex="0" ctxtmenu_counter="435" style="font-size: 122.8%; position: relative;"><mjx-math display="true" class="MJX-TEX" aria-hidden="true" style="margin-left: 0px; margin-right: 0px;"><mjx-mtext class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c62"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c2D"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c62"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c3D"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c6E"></mjx-c></mjx-mtext></mjx-math><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>11111111b - 01111111b = n</mtext></math></mjx-assistive-mml></mjx-container></div></div></div><div><div><div></div></div></div><div><div><div>11111111b + 10000000+1 (add 2's complement)</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="436" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mrow space="2"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>11111111</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mo>+</mo><mrow data-mjx-texclass="ORD"><mn>10000001</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>10000000</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">h</mi></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="348" id="mark-70ed970e-48cb-417d-924b-38688182fcb9" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>To ensure that conflicts such as the one above do not occur, the maximum number of unused credits that can be reported is limited to <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="437" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mrow data-mjx-texclass="ORD"><mn>2</mn></mrow><mrow data-mjx-texclass="ORD"><mn>8</mn></mrow></msup><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mn>2</mn></math></mjx-assistive-mml></mjx-container> (128) credits for headers and <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="438" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-mrow space="2"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c34"></mjx-c><mjx-c class="mjx-c38"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mrow data-mjx-texclass="ORD"><mn>2</mn></mrow><mrow data-mjx-texclass="ORD"><mn>12</mn></mrow></msup><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mn>2</mn><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mn>2048</mn></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> credits for data. This means that the CREDITS_ALLOCATED count must never exceed the CREDITS_CONSUMED count by more than 128 for headers and 2048 for data. This ensures that any result <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="439" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3C"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>&lt;</mo><mn>1</mn><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mn>2</mn></math></mjx-assistive-mml></mjx-container> the maximum register count is a positive number and represents credits available,and results <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="440" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3E"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>&gt;</mo><mn>1</mn><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mn>2</mn></math></mjx-assistive-mml></mjx-container> the maximum count are negative numbers that indicate credits not available.</div></div></div><div><div><div></div></div></div><div><ol><li value="3">The CREDITS_CONSUMED count increments by one when the transaction is forwarded to the link layer.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">When the transaction arrives at the receiver, the transaction header is placed into the Flow Control buffer and the CREDITS_RECEIVED counter (optional) increments by one. Note that CREDIT_ALLOCATED does not change.</li></ol></div><div><div><div></div></div></div><div><div><div>Figure 7-6 on page 297 illustrates the Flow Control elements following transfer of the first transaction.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 7-6: Flow Control Elements Following Delivery of First Transaction</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_356.jpg?x=235&amp;y=952&amp;w=980&amp;h=666"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="349" id="mark-2ea17312-9ec4-42a8-a22d-dd091cd54e37" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Stage 2 — Flow Control Buffer Fills Up</div></div></h2><div><div><div></div></div></div><div><div><div>This example presumes that the receiving device has been unable to move transactions from the Flow Control buffer since initialization. This could be caused if the device core was temporarily busy and unable to process transactions. Consequently, the Flow Control buffer has completely filled. Figure 7-7 on page 299 illustrates this scenario.</div></div></div><div><div><div></div></div></div><div><div><div>Again the transmitter checks Flow Control credits to determine if the next pending TLP can be sent. The unsigned arithmetic is performed to subtract the Credits Required from the CREDIT_LIMIT:</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="441" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-mrow space="2"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c43"></mjx-c><mjx-c class="mjx-c4C"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c37"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-mrow space="2"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c43"></mjx-c><mjx-c class="mjx-c52"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3C"></mjx-c><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>66</mn><mi>h</mi></mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">CL</mi></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>67</mn><mi>h</mi></mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">CR</mi></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow><mo>&lt;=</mo><mrow data-mjx-texclass="ORD"><mn>80</mn><mi>h</mi></mrow></math></mjx-assistive-mml></mjx-container></div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="442" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3C"></mjx-c><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>01100110</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>01100111</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mo>&lt;=</mo><mrow data-mjx-texclass="ORD"><mn>10000000</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> (if yes,send transaction)</div></div></div><div><div><div></div></div></div><div><div><div>CL 01100110 (66)</div></div></div><div><div><div></div></div></div><div><div><div>CR 10011001 (add 2's complement of 67h)</div></div></div><div><div><div></div></div></div><div><div><div>11111111 = FFh&lt;=80h (not true, don't send packet)</div></div></div><div><div><div></div></div></div><div><div><div>Not until the receiver moves one or more transactions from the Flow Control buffer can the pending transaction be sent. When the first transaction is moved from the Flow Control buffer, the CREDIT_ALLOCATED count is increased to 67h. When the Update Flow Control packet is delivered to the transmitter, the new CREDIT_LIMIT will be loaded into the CL register. The resulting check will pass the test, thereby permitting the packet to be sent.</div></div></div><div><div><div></div></div></div><div><div><div>CL 01100111 (67)</div></div></div><div><div><div></div></div></div><div><div><div>CR 10011001 add 2's complement of 67</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="443" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3C"></mjx-c><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>00000000</mn></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>00</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">h</mi></mrow><mo>&lt;=</mo><mrow data-mjx-texclass="ORD"><mn>80</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">h</mi></mrow></math></mjx-assistive-mml></mjx-container> (send transaction)</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="350" id="mark-add7e29e-b34a-453b-b4f5-6a1154c15c76" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 7-7: Flow Control Elements with Flow Control Buffer Filled</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_358.jpg?x=224&amp;y=404&amp;w=1000&amp;h=714"></div></div><div><div><div></div></div></div><h2><div><div>Stage 3 — The Credit Limit count Rolls Over</div></div></h2><div><div><div></div></div></div><div><div><div>The receiver's CREDIT_LIMIT (CL) always runs ahead of (or is equal to) the CREDITS_CONSUMED (CC) count. Each time the transmitter performs a credit check, it adds the credits required (CR) for a TLP to the current CREDITS_CONSUMED count and subtracts the result from the current CREDIT_LIMIT to determine if enough credits are available to send the TLP.</div></div></div><div><div><div></div></div></div><div><div><div>Because both the CL count and the CC count only index up, they are allowed to roll over from maximum count back to 0 . A problem appears to arise when the CL count (which, again, is running ahead) has rolled over and the CC has not. Figure 7-8 shows the CL and CR counts before and after CL rollover.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="351" id="mark-03e0ca49-561f-4274-815c-28d4582664bf" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 7-8: Flow Control Rollover Problem</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_359.jpg?x=221&amp;y=414&amp;w=1003&amp;h=565"></div></div><div><div><div></div></div></div><div><div><div>If a simple subtraction is performed in the rollover case, the result is negative. This indicates that credits are not available. However, because unsigned arithmetic is used the problem does not arise. See below:</div></div></div><div><div><div></div></div></div><div><div><div>CL 00001000 (08h)</div></div></div><div><div><div></div></div></div><div><div><div>CR 11111000 (F8h) <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="444" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3E"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-msup space="4"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-var"><mjx-c class="mjx-c2032"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>&gt;</mo><mrow data-mjx-texclass="ORD"><mn>00000111</mn></mrow><mo>+</mo><mn>1</mn><mo>=</mo><msup><mrow data-mjx-texclass="ORD"><mn>2</mn></mrow><mrow data-mjx-texclass="ORD"><mi data-mjx-alternate="1">′</mi></mrow></msup></math></mjx-assistive-mml></mjx-container> s complement</div></div></div><div><div><div></div></div></div><div><div><div>CL <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="445" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-mrow space="2"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c38"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>00001000</mn></mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mn>08</mn></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">h</mi></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container></div></div></div><div><div><div></div></div></div><div><div><div>CR 00001000 (add 2's complement)</div></div></div><div><div><div></div></div></div><div><div><div>00010000 or 10h</div></div></div><div><div><div></div></div></div><h2><div><div>Stage 4 — FC Buffer Overflow Error Check</div></div></h2><div><div><div></div></div></div><div><div><div>The specification recommends implementation of the optional FC buffer overflow error checking mechanism. These optional elements include:</div></div></div><div><div><div></div></div></div><div><ul><li>CREDITS_RECEIVED counter</li></ul></div><div><div><div></div></div></div><div><ul><li>Error Check Logic</li></ul></div><div><div><div></div></div></div><div><div><div>These elements permit the receiver to track Flow Control credits in the same manner as the transmitter. That is, the transmitter CREDIT_LIMIT count should</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="352" id="mark-0f26a32d-4903-4597-9d7b-9d28412f2682" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>be the same as the receiver's CREDITS_ALLOCATED count (after an Update DLLP is sent) and the receiver's CREDITS_RECEIVED count should be the same as the transmitter's CREDITS_CONSUMED count. If flow control is working correctly the following will be true:</div></div></div><div><div><div></div></div></div><div><ul><li>the transmitter’s CREDITS_CONSUMED count should always be <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="446" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2264"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>≤</mo></math></mjx-assistive-mml></mjx-container> its CREDIT_LIMIT</li></ul></div><div><div><div></div></div></div><div><ul><li>the receiver’s CREDITS_RECEIVED count (CR) should always be <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="447" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2264"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>≤</mo></math></mjx-assistive-mml></mjx-container> its CREDITS_ALLOCATED count (CA)</li></ul></div><div><div><div></div></div></div><div><div><div>An overflow condition is detected when the following formula is satisfied. Note that the field size is either 8 (headers) or 12 (data):</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" display="true" tabindex="0" ctxtmenu_counter="448" style="font-size: 122.8%; position: relative;"><mjx-math display="true" class="MJX-TEX" aria-hidden="true" style="margin-left: 0px; margin-right: 0px;"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D436 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D434 TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D436 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D445 TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow><mjx-msup><mjx-texatom texclass="ORD"><mjx-texatom texclass="OP"><mjx-mi class="mjx-n"><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c6F"></mjx-c><mjx-c class="mjx-c64"></mjx-c></mjx-mi><mjx-mn class="mjx-n" space="2"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-texatom><mjx-script style="vertical-align: 0.421em;"><mjx-texatom size="s" texclass="ORD"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mtext class="mjx-n"><mjx-c class="mjx-c46"></mjx-c><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c6C"></mjx-c><mjx-c class="mjx-c64"></mjx-c><mjx-c class="mjx-c53"></mjx-c><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c7A"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo></mjx-mrow></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3E"></mjx-c></mjx-mo><mjx-msup space="4"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom><mjx-script style="vertical-align: 0.413em;"><mjx-texatom size="s" texclass="ORD"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mtext class="mjx-n"><mjx-c class="mjx-c46"></mjx-c><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c6C"></mjx-c><mjx-c class="mjx-c64"></mjx-c><mjx-c class="mjx-c53"></mjx-c><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c7A"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo></mjx-mrow></mjx-texatom></mjx-script></mjx-msup><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi>C</mi><mi>A</mi></mrow><mo>−</mo><mrow data-mjx-texclass="ORD"><mi>C</mi><mi>R</mi></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow><msup><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="OP"><mi>mod</mi><mn>2</mn></mrow></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">[</mo><mtext>FieldSize&nbsp;</mtext><mo data-mjx-texclass="CLOSE">]</mo></mrow></mrow></msup><mo>&gt;</mo><msup><mrow data-mjx-texclass="ORD"><mn>2</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">[</mo><mtext>FieldSize&nbsp;</mtext><mo data-mjx-texclass="CLOSE">]</mo></mrow></mrow></msup><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mn>2</mn></math></mjx-assistive-mml></mjx-container></div></div></div><div><div><div></div></div></div><div><div><div>If the formula is true, then the result is negative; thus, more credits have been sent to the FC buffer than were available and an overflow has occurred. Note that the 1.0a version of the specification defines the equation as <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="449" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2265"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>≥</mo></math></mjx-assistive-mml></mjx-container> rather than <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="450" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3E"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>&gt;</mo></math></mjx-assistive-mml></mjx-container> as shown above. This appears to be an error, because when CA=CR no overflow condition exists. For example, for the case right after initialization where the receiver advertises that it has 128 credits for the transmitter to use, <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="451" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c43"></mjx-c><mjx-c class="mjx-c41"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c38"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">CA</mi></mrow></mrow><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>128</mn></mrow></math></mjx-assistive-mml></mjx-container> , and <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="452" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c43"></mjx-c><mjx-c class="mjx-c52"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">CR</mi></mrow></mrow><mo>=</mo><mn>0</mn></math></mjx-assistive-mml></mjx-container> because it hasn’t received anything yet,then this equation evaluates true. Which means it has overflowed, when actually all we have done is advertise our max allowed number of credits. If the equation evaluates for only <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="453" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3E"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>&gt;</mo></math></mjx-assistive-mml></mjx-container> and not <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="454" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2265"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>≥</mo></math></mjx-assistive-mml></mjx-container> ,then everything seems to work.</div></div></div><div><div><div></div></div></div><h2><div><div>Infinite Flow Control Advertisement</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express defines an infinite Flow Control credit value. A device that advertises infinite Flow Control credits need not send Flow Control Update packets following initialization and the transmitter will never be blocked from sending transactions. During flow control initialization, a device advertises "infinite" credits by delivering a zero in the credit field of the FC_INIT1 DLLP.</div></div></div><div><div><div></div></div></div><h2><div><div>Who Advertises Infinite Flow Control Credits?</div></div></h2><div><div><div></div></div></div><div><div><div>It's interesting to note that the minimum Flow Control credits that must be advertised includes infinite credits for completion transactions in certain situations. See Table 7-1 on page 303. These requirements involve devices that originate requests for which completions are expected to be returned (i.e., Endpoints</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="353" id="mark-b6807418-75b1-4ad8-82fe-6acb5779cced" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>and root ports that do not support peer-to-peer transfers). It does not include devices that merely forward completions (switches and root ports that support peer-to-peer transfers). This implies a requirement that any device initiating a request must commit buffer space for the expected completion header and data (if applicable). This guarantees that no throttling would ever occur when completions cross the final link to the original requester. This type of rule is required of PCI-X devices that initiate split transactions. Multiple searches of the specification failed to reveal this requirement explicitly stated for PCI Express devices; however, it is implied by the requirement to advertise infinite Flow Control credits.</div></div></div><div><div><div></div></div></div><div><div><div>Note also that infinite flow control credits can only be advertised during initial-iztion. This must be true, because the CA counter in the receiver could rollover to 00h and send an Update FC packet with the credit field set to 00h. If the Link is in the DL_Init state, this means infinite credits, but if the Link is in the DL_Active state, this does not mean infinite credits.</div></div></div><div><div><div></div></div></div><h2><div><div>Special Use for Infinite Credit Advertisements.</div></div></h2><div><div><div></div></div></div><div><div><div>The specification points out a special consideration for devices that do not need to implement all the FC buffer types for all VCs. For example, the only Non-Posted writes are I/O Writes and Configuration Writes both of which are permitted only on VC0. Thus, Non-Posted data buffers are not needed for VC1 - VC7. Because no Flow Control tracking is needed, a device can simply advertise infinite Flow Control credits during initialization, thereby eliminating the need to send needless FC_Update packets.</div></div></div><div><div><div></div></div></div><h2><div><div>Header and Data Advertisements May Conflict</div></div></h2><div><div><div></div></div></div><div><div><div>An infinite Flow Control advertisement might be sent for either the Data or header buffers (with same FC type) but not both. In this case, Update DLLPs are required for one buffer but not the other. This simply means that the device requiring credits will send an Update DLLP with the corresponding field containing the CREDITS_ALLOCATED credit information, and the other field must be set to zero (consistent with its advertisement).</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="354" id="mark-f7c1bb27-8fec-4baf-af31-4b3b75695053" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>The Minimum Flow Control Advertisement</div></div></h2><div><div><div></div></div></div><div><div><div>The minimum number of credits that can be reported for the different Flow Control buffer types is listed in Table 7-1 on page 303.</div></div></div><div><div><div></div></div></div><div><div><div>Table 7-1: Required Minimum Flow Control Advertisements</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Credit Type</th><th>Minimum Advertisement</th></tr></thead><tbody><tr><td>Posted Request Header (PH)</td><td>1 unit. Credit Value <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="455" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo></math></mjx-assistive-mml></mjx-container> one 4DW HDR <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="456" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>+</mo></math></mjx-assistive-mml></mjx-container> Digest <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="457" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo></math></mjx-assistive-mml></mjx-container> 5DW.</td></tr><tr><td>Posted Request Data (PD)</td><td>Largest possible setting of the Max_Payload_Size; for the component divided by FC Unit Size (4DW). Example: If the largest Max_Payload_Size value sup- ported is 1024 bytes, the smallest permitted initial credi value would be 040h.</td></tr><tr><td>Non-Posted Request HDR (NPH)</td><td>1 unit. Credit Value <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="458" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo></math></mjx-assistive-mml></mjx-container> one 4 DW HDR + Digest <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="459" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo></math></mjx-assistive-mml></mjx-container> 5DW.</td></tr><tr><td>Non-Posted Request Data (NPD)</td><td>1 unit. Credit Value = 4DW.</td></tr><tr><td>Completion HDR (CPLH)</td><td>1 unit. Credit Value <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="460" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo></math></mjx-assistive-mml></mjx-container> one 3DW HDR <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="461" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>+</mo></math></mjx-assistive-mml></mjx-container> Digest <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="462" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>4</mn></math></mjx-assistive-mml></mjx-container> DW; for Root Complex with peer-to-peer support and Switches. Infinite units. Initial Credit Value <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="463" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo></math></mjx-assistive-mml></mjx-container> all <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="464" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-var"><mjx-c class="mjx-c2032"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msup><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mrow data-mjx-texclass="ORD"><mn>0</mn></mrow><mrow data-mjx-texclass="ORD"><mi data-mjx-alternate="1">′</mi></mrow></msup><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> for Root Com- plex with no peer-to-peer support and Endpoints</td></tr><tr><td>Completion Data (CPLD)</td><td>n units. Value of largest possible setting of Max_Payload_Size or size of largest Read Request (which ever is smaller) divided by FC Unit Size (4DW); for Root Complex with peer-to-peer support and Switches. Infinite units. Initial Credit Value <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="465" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo></math></mjx-assistive-mml></mjx-container> all <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="466" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-var"><mjx-c class="mjx-c2032"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msup><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mrow data-mjx-texclass="ORD"><mn>0</mn></mrow><mrow data-mjx-texclass="ORD"><mi data-mjx-alternate="1">′</mi></mrow></msup><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> ; for Root Com- plex with no peer-to-peer support and Endpoints.</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="355" id="mark-d6231fc2-92f3-4143-9b16-a3f5d1e94cd1" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><h2><div><div>Flow Control Initialization</div></div></h2><div><div><div></div></div></div><div><div><div>Prior to sending any transactions, flow control initialization must be performed. Initialization occurs for each link in the system and involves a handshake between the devices attached to the same link. TLPs associated with the virtual channel being initialized cannot be forwarded across the link until Flow Control Initialization is performed successfully.</div></div></div><div><div><div></div></div></div><div><div><div>Once initiated, the flow control initialization procedure is fundamentally the same for all Virtual Channels. The small differences that exist are discussed later. Initialization of VC0 (default VC) must be done in hardware so that configuration transactions can traverse the PCI Express fabric. Other VCs initialize once configuration software has set up and enabled the VCs at both ends of the link. Enabling a VC triggers hardware to perform flow control initialization for this VC.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 7-9 pictures the Flow Control counters within the devices at both ends of the link, along with the state of flag bits used during initialization.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 7-9: Initial State of Example FC Elements</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_363.jpg?x=231&amp;y=1011&amp;w=977&amp;h=628"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="356" id="mark-2a4da3e2-d888-4354-9cd3-69e44ba27afd" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>The FC Initialization Sequence</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express defines two stages in flow control initialization: FC_INIT1 and FC_INIT2. Each stage of course involves the use of the Flow Control packets (FCPs).</div></div></div><div><div><div></div></div></div><div><ul><li>Flow Control Init1 - reports the size of the Flow Control buffers for a given virtual channel</li></ul></div><div><div><div></div></div></div><div><ul><li>Flow Control Init2 - verifies that the device transmitting the Init2 packet has completed the flow control initialization for the specified VC and buffer type.</li></ul></div><div><div><div></div></div></div><h2><div><div>FC Init1 Packets Advertise Flow Control Credits Available</div></div></h2><div><div><div></div></div></div><div><div><div>During the FC_INIT1 state, a device continuously outputs a sequence of 3 InitFC1 Flow Control packets advertising its posted, non-posted, and completion receiver buffer sizes. (See Figure 7-10.) Each device also waits to receive a similar sequence from its neighbor. Once a device has received the complete sequence and sent its own, it initializes transmit counters, sets an internal flag FI1, and exits FC_INIT1. This process is illustrated in Figure 7-11 on page 306 and described below. The example shows Device A reporting Non-Posted Buffer Credits and Device B reporting Posted Buffer Credits. This illustrates that the devices need not be in synchronization regarding what they are reporting. In fact, the two device will typically not start the flow control initialization process at the same time.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 7-10: INIT1 Flow Control Packet Format and Contents</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_364.jpg?x=234&amp;y=1218&amp;w=978&amp;h=392"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="357" id="mark-39debb21-2784-42de-8e38-5e8c81498251" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 7-11: Devices Send and Initialize Flow Control Registers</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_365.jpg?x=223&amp;y=408&amp;w=995&amp;h=680"></div></div><div><div><div></div></div></div><div><ol><li value="1">Each device sends InitFC1 type Flow Control packets (FCPs) to advertise the size of its respective receive buffers. A separate FCP for posted requests (P), non-posted requests (NP) and completion (CPL) packet types is required. The order in which this sequence of three FCPs is sent is:</li></ol></div><div><div><div></div></div></div><div><ul><li>Header and Data buffer credit units for Posted Requests (P).</li></ul></div><div><div><div></div></div></div><div><ul><li>Header and Data buffer credit units for Non-Posted Requests (NP)</li></ul></div><div><div><div></div></div></div><div><ul><li>Header and Data buffer credit units for Completions (CPL)</li></ul></div><div><div><div></div></div></div><div><div><div>The sequence of FCPs is repeated continuously until a device leaves the FC_INIT1 initialization state.</div></div></div><div><div><div></div></div></div><div><ol><li value="2">In the meantime, devices take the credit information and initialize the transmit credit limit registers. In this example, Device A loads its PH transmit Credit Limit register with a value of 4,which was reported by Device B for its posted request header FC buffer. It also loads its PD Credit Limit register with a value of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="467" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c64"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>64</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">d</mi></mrow></math></mjx-assistive-mml></mjx-container> credits (1024 bytes worth of data) for accompanying posted data. Similarly, Device B loads its NPH transmit Credit Limit counter with a value of 2 for non-posted request headers and its NPD transmit counter with a value of 32d credits (512 bytes worth of data) for accompanying non-posted data.</li></ol></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="358" id="mark-e279f226-3443-44c5-b971-830d6b51154b" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><ol><li value="3">Note that when this process is complete, the Credits Allocated counter in the receivers and the corresponding Credit Limit counters in the transmitters will be equal.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">Once a device receives Init1 FC values for a given buffer type (e.g., Posted) and has recorded them, the FC_INIT1 state is complete for that Flow Control buffer. Once all FC buffers for a given VC have completed the FC_INIT1 state, Flag 1 (Fl1) is set and the device ceases to send FCInit1 DLLPs and advances to FC Init2 state. Note that receipt of an Init2 FC packets may also cause Fl1 to be set. This can occur if the neighboring device has already advanced to the FC Init2 state.</li></ol></div><div><div><div></div></div></div><h2><div><div>FC Init2 Packets Confirm Successful FC Initialization</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express defines the InitFC2 state that is used for feedback to verify the Flow Control initialization has been successful for a given VC. During FC_INIT2, each device continuously outputs a sequence of 3 InitFC2 Flow Control packets; however, credit values are discarded during the FC_INIT2 state. Note that devices are permitted to send TLPs upon entering the FC_INIT2 state. Figure 7-12 illustrates InitFC2 behavior, which is described following the illustration.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 7-12: Device Confirm that Flow Control Initialization is Completed for a Given Buffer PCI Express System Architecture</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_366.jpg?x=243&amp;y=1006&amp;w=965&amp;h=622"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="359" id="mark-3e1e1c03-fb69-4bda-aec4-92b190ccf458" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><ol><li value="1">At the start of initialization state FC_INIT2, each device commences sending InitFC2 type Flow Control packets (FCPs) to indicate it has completed the FC_INIT1 state. Devices use the same repetitive sequence when sending FCPs in this state as before:</li></ol></div><div><div><div></div></div></div><div><ul><li>Header and Data buffer credit allocation for Posted Requests (P)</li></ul></div><div><div><div></div></div></div><div><ul><li>Header and Data buffer credit allocation for Non-Posted Requests (NP)</li></ul></div><div><div><div></div></div></div><div><ul><li>Header and Data buffer credit allocation for Completions (CPL)</li></ul></div><div><div><div></div></div></div><div><ol><li value="2">All credits reported in InitFC2 FCPs may be discarded, as the transmitter Credit Limit counters were already set up in FC_INIT1.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">Once a device receives an FC_INIT2 packet for any buffer type, it sets an internal flag (Fl2). (It doesn't wait to receive an FC_Init2 for each type.) Note that Fl2 is also set upon receipt of an UpdateFC packet or TLP.</li></ol></div><div><div><div></div></div></div><h2><div><div>Rate of FC_INIT1 and FC_INIT2 Transmission</div></div></h2><div><div><div></div></div></div><div><div><div>The specification defines the latency between sending FC_INIT DLLPs as follows:</div></div></div><div><div><div></div></div></div><div><ul><li>VC0. Hardware initiated flow control of VC0 requires that FC_INIT1 and FC_INIT2 packets be transmitted "continuously at the maximum rate possible." That is, the resend timer is set to a value of zero.</li></ul></div><div><div><div></div></div></div><div><ul><li>VC1-VC7. When software initiates flow control initialization, the FC_INIT sequence is repeated "when no other TLPs or DLLPs are available for transmission." However, the latency between the beginning of one sequence to the next can be no greater than <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="468" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c37"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D707 TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>17</mn><mi>μ</mi></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> .</li></ul></div><div><div><div></div></div></div><h2><div><div>Violations of the Flow Control Initialization Protocol</div></div></h2><div><div><div></div></div></div><div><div><div>A violation of the flow control initialization protocol can be optionally checked by a device. An error detected can be reported as a Data Link Layer protocol error. See "Link Flow Control-Related Errors" on page 363.</div></div></div><div><div><div></div></div></div><h2><div><div>Flow Control Updates Following FC_INIT</div></div></h2><div><div><div></div></div></div><div><div><div>The receiver must continually update its neighboring device to report additional Flow Control credits that have accumulated as a result of moving transactions from the Flow Control buffer. Figure 7-13 on page 309 illustrates an example where the transmitter was previously blocked from sending header transactions because the Flow Control buffer was full. In the example, the receiver has just removed three headers from the Flow Control buffer. More space is now available, but the neighboring device has no knowledge of this. As each header is removed from the Flow Control buffer, the</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="360" id="mark-1406e279-a057-4a71-bf9b-7c81e6d54089" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>CREDITS_ALLOCATED count increments. The new count is delivered to the CREDIT_LIMIT register of the neighboring device via an update Flow Control packet. The updated credit limit allows transmission of additional transactions.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 7-13: Flow Control Update Example</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_368.jpg?x=223&amp;y=551&amp;w=998&amp;h=724"></div></div><div><div><div></div></div></div><h2><div><div>FC_Update DLLP Format and Content</div></div></h2><div><div><div></div></div></div><div><div><div>Recall that update Flow Control packets, like the Flow Control initialization packets contain two update fields, one for header and one for data for the selected credit type (P, NP, and Cpl). Figure 7-14 on page 310 depicts the content of the update packet. The receiver's CREDITS_ALLOCATED counts that are reported in the HdrFC and DataFC fields may have been updated many times or not at all since the last update packet sent.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="361" id="mark-67df45c4-c54c-4656-89b1-2a2698e0131f" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 7-14: Update Flow Control Packet Format and Contents</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_369.jpg?x=223&amp;y=411&amp;w=992&amp;h=445"></div></div><div><div><div></div></div></div><h2><div><div>Flow Control Update Frequency</div></div></h2><div><div><div></div></div></div><div><div><div>The specification defines a variety of rules and suggested implementations that govern when and how often Flow Control Update DLLPs should be sent. The motivation includes:</div></div></div><div><div><div></div></div></div><div><ul><li>Notifying the transmitting device as early as possible about new credits allocated, which allows previously blocked transactions to continue.</li></ul></div><div><div><div></div></div></div><div><ul><li>Establishing worst-case latency between FC Packets.</li></ul></div><div><div><div></div></div></div><div><ul><li>Balancing the requirements and variables associated with flow control operation. This involves:</li></ul></div><div><div><div></div></div></div><div><div><div>o the need to report credits available often enough to prevent transaction blocking</div></div></div><div><div><div></div></div></div><div><div><div>o the desire to reduce the link bandwidth required to send FC_Update DLLPs</div></div></div><div><div><div></div></div></div><div><div><div>o selecting the optimum buffer size</div></div></div><div><div><div></div></div></div><div><div><div>o the maximum data payload size</div></div></div><div><div><div></div></div></div><div><ul><li>Detecting violation of the maximum latency between Flow Control packets.</li></ul></div><div><div><div></div></div></div><div><div><div>The update frequency limits specified assume that the link is in the active state (L0 or LOs (s=standby). All other link states represent more aggressive power management with longer recovery latencies that require link recovery prior to sending packets.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="362" id="mark-efd9eb97-b5ff-4cd7-83c3-57bd38dea855" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Immediate Notification of Credits Allocated</div></div></h2><div><div><div></div></div></div><div><div><div>When a Flow Control buffer has filled to the extent that maximum-sized packets cannot be sent, the specification requires immediate delivery of an FC_Update DLLP when the deficit is eliminated. Specifically, when additional credits are allocated by a receiver that guarantee sufficient space now exists to accepts another maximum-sized packet, an Update packet must be sent. Two cases exist:</div></div></div><div><div><div></div></div></div><div><ul><li>Maximum Packet Size <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="469" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> Credit. When packet transmission is blocked due to a buffer full condition for non-infinite NPH, NPD, PH, and CPLH buffer types, an UpdateFC packet must be scheduled for Transmission when one or more credits are made available (allocated) for that buffer type.</li></ul></div><div><div><div></div></div></div><div><ul><li>Maximum Packet Size = Max_Payload_Size. Flow Control buffer space may decrease to the extent that a maximum-sized packet cannot be sent for non-infinite PD and CPLD credit types. In this case, when one or more additional credits are allocated, an Update FCP must be scheduled for transmission.</li></ul></div><div><div><div></div></div></div><h2><div><div>Maximum Latency Between Update Flow Control DLLPs</div></div></h2><div><div><div></div></div></div><div><div><div>The transmission frequency of Update FCPs for each FC credit type (non-infinite) must be scheduled for transmission at least once every <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="470" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D707 TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom><mjx-mrow space="2"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mi class="mjx-n"><mjx-c class="mjx-c25"></mjx-c></mjx-mi><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-mi class="mjx-n"><mjx-c class="mjx-c25"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>30</mn><mi>μ</mi></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">s</mi></mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mo>−</mo><mn>0</mn><mi mathvariant="normal">%</mi><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mo>+</mo><mrow data-mjx-texclass="ORD"><mn>50</mn></mrow><mi mathvariant="normal">%</mi></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> . If the Extended Sync bit within the Control Link register is set, Updates must be scheduled no later than every <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="471" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D707 TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom><mjx-mrow space="2"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mi class="mjx-n"><mjx-c class="mjx-c25"></mjx-c></mjx-mi><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-mi class="mjx-n"><mjx-c class="mjx-c25"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>120</mn><mi>μ</mi></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">s</mi></mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mo>−</mo><mn>0</mn><mi mathvariant="normal">%</mi><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mo>+</mo><mrow data-mjx-texclass="ORD"><mn>50</mn></mrow><mi mathvariant="normal">%</mi></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> . Note that Update FCPs may be scheduled for transmission more frequently than is required.</div></div></div><div><div><div></div></div></div><h2><div><div>Calculating Update Frequency Based on Payload Size and  Link Width</div></div></h2><div><div><div></div></div></div><div><div><div>The specification offers a formula for calculating the frequency at which update packets need to be sent for maximum data payloads sizes and link widths. The formula, shown below, defines FC Update delivery intervals in symbol times (4ns).</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" display="true" tabindex="0" ctxtmenu_counter="472" style="font-size: 122.8%; position: relative;"><mjx-math display="true" class="MJX-TEX" aria-hidden="true" style="margin-left: 0px; margin-right: 0px;"><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mtext class="mjx-n"><mjx-c class="mjx-cA0"></mjx-c><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c61"></mjx-c><mjx-c class="mjx-c78"></mjx-c><mjx-c class="mjx-c50"></mjx-c><mjx-c class="mjx-c61"></mjx-c><mjx-c class="mjx-c79"></mjx-c><mjx-c class="mjx-c6C"></mjx-c><mjx-c class="mjx-c6F"></mjx-c><mjx-c class="mjx-c61"></mjx-c><mjx-c class="mjx-c64"></mjx-c><mjx-c class="mjx-c53"></mjx-c><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c7A"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mtext class="mjx-n" space="3"><mjx-c class="mjx-cA0"></mjx-c><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c4C"></mjx-c><mjx-c class="mjx-c50"></mjx-c><mjx-c class="mjx-c4F"></mjx-c><mjx-c class="mjx-c76"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-c68"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c61"></mjx-c><mjx-c class="mjx-c64"></mjx-c><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-cD7"></mjx-c></mjx-mo><mjx-mtext class="mjx-n" space="3"><mjx-c class="mjx-cA0"></mjx-c><mjx-c class="mjx-c55"></mjx-c><mjx-c class="mjx-c70"></mjx-c><mjx-c class="mjx-c64"></mjx-c><mjx-c class="mjx-c61"></mjx-c><mjx-c class="mjx-c74"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c46"></mjx-c><mjx-c class="mjx-c61"></mjx-c><mjx-c class="mjx-c63"></mjx-c><mjx-c class="mjx-c74"></mjx-c><mjx-c class="mjx-c6F"></mjx-c><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mtext class="mjx-n"><mjx-c class="mjx-cA0"></mjx-c><mjx-c class="mjx-c4C"></mjx-c><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c6E"></mjx-c><mjx-c class="mjx-c6B"></mjx-c><mjx-c class="mjx-c57"></mjx-c><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c64"></mjx-c><mjx-c class="mjx-c74"></mjx-c><mjx-c class="mjx-c68"></mjx-c><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mtext class="mjx-n" space="3"><mjx-c class="mjx-cA0"></mjx-c><mjx-c class="mjx-c49"></mjx-c><mjx-c class="mjx-c6E"></mjx-c><mjx-c class="mjx-c74"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-c6E"></mjx-c><mjx-c class="mjx-c61"></mjx-c><mjx-c class="mjx-c6C"></mjx-c><mjx-c class="mjx-c44"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c6C"></mjx-c><mjx-c class="mjx-c61"></mjx-c><mjx-c class="mjx-c79"></mjx-c><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext></mjx-math><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mfrac><mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mtext>&nbsp;MaxPayloadSize&nbsp;</mtext><mo>+</mo><mtext>&nbsp;TLPOverhead&nbsp;</mtext></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow><mo>×</mo><mtext>&nbsp;UpdateFactor&nbsp;</mtext></mrow><mtext>&nbsp;LinkWidth&nbsp;</mtext></mfrac><mo>+</mo><mtext>&nbsp;InternalDelay&nbsp;</mtext></math></mjx-assistive-mml></mjx-container></div></div></div><div><div><div></div></div></div><div><div><div>where:</div></div></div><div><div><div></div></div></div><div><ul><li>MaxPayloadSize = The value in the Max_Payload_Size field of the Device Control register</li></ul></div><div><div><div></div></div></div><div><ul><li>TLPOverhead = the constant value (28 symbols) representing the additional TLP components that consume Link bandwidth (header, LCRC, framing Symbols)</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="363" id="mark-00fe0dba-7a49-44b9-977f-52c19b016398" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><ul><li>UpdateFactor = the number of maximum size TLPs sent during the interval between UpdateFC Packets received. This number balances link bandwidth efficiency and receive buffer sizes - the value varies with Max_Payload_Size and Link width</li></ul></div><div><div><div></div></div></div><div><ul><li>LinkWidth = The operating width of the Link negotiated during initialization</li></ul></div><div><div><div></div></div></div><div><ul><li>InternalDelay <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="473" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo></math></mjx-assistive-mml></mjx-container> a constant value of 19 symbol times that represents the internal processing delays for received TLPs and transmitted DLLPs</li></ul></div><div><div><div></div></div></div><div><div><div>The simple relationship defined by the formula show that for a given data payload and buffer size, the frequency of update packet delivery becomes higher as the link width increases. This relatively simple approach suggests a timer implementation that triggers scheduling of update packets. Note that this formula does not account for delays associated with the receiver or transmitter being in the L0s power management state.</div></div></div><div><div><div></div></div></div><div><div><div>The specification recognizes that the formula will be inadequate for many applications such as those that stream large blocks of data. These applications may require buffer sizes larger than the minimum specified, as well as a more sophisticated update policy in order to optimize performance and reduce power consumption. Because a given solution is dependent on the particular requirements of an application, no definition for such policies is provided.</div></div></div><div><div><div></div></div></div><h2><div><div>Error Detection Timer — A Pseudo Requirement</div></div></h2><div><div><div></div></div></div><div><div><div>The specification defines an optional time-out mechanism that is highly recommended. So much so, that the specification points out that it is expected to become a requirement in futures versions of the spec. This mechanism detects prolonged absences of Flow Control packets. The maximum latency between FC packets for a given Flow Control credit type is specified to be no greater than <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="474" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D707 TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>120</mn><mi>μ</mi></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> . This error detection timer has a maximum limit of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="475" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D707 TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>200</mn><mi>μ</mi></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> ,and it gets reset any time a Flow Control packet of any type is received. If a time-out occurs, this suggests a serious problem with a device's ability to report Flow Control credits. Consequently, a time-out triggers the Physical Layer to enter its Recovery state which retrains the link and hopefully clears the error condition. Characteristics of this timer include:</div></div></div><div><div><div></div></div></div><div><ul><li>operational only when the link is in its active state (L0 or L0s)</li></ul></div><div><div><div></div></div></div><div><ul><li>maximum count limited to <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="476" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D707 TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom><mjx-mrow space="2"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mi class="mjx-n"><mjx-c class="mjx-c25"></mjx-c></mjx-mi><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-mi class="mjx-n"><mjx-c class="mjx-c25"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>200</mn><mi>μ</mi></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">s</mi></mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mo>−</mo><mn>0</mn><mi mathvariant="normal">%</mi><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mo>+</mo><mrow data-mjx-texclass="ORD"><mn>50</mn></mrow><mi mathvariant="normal">%</mi></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container></li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="364" id="mark-3ded1d1f-9fba-4a8f-a141-38f17cb48acf" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><ul><li>timer is reset when any Init or Update FCP is received, or optionally the timer may be reset by the receipt of any type of DLLP</li></ul></div><div><div><div></div></div></div><div><ul><li>when timer expires Physical Layer enters the Link Training Sequence State Machine (LTSSM) Recovery state 8</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="365" id="mark-b023a239-a2c5-4ce6-9614-9b5e75a653ff" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Transaction  Ordering</div></div></h2><div><div><div></div></div></div><h2><div><div>The Previous Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>The previous chapter discussed the purposes and detailed operation of the Flow Control Protocol. This protocol requires each device to implement credit-based link flow control for each virtual channel on each port. Flow control guarantees that transmitters will never send Transaction Layer Packets (TLPs) that the receiver can't accept. This prevents receive buffer over-runs and eliminates the need for inefficient disconnects, retries, and wait-states on the link. Flow Control also helps enable compliance with PCI Express ordering rules by maintaining separate Virtual Channel Flow Control buffers for three types of transactions: Posted (P), Non-Posted (NP) and Completions (Cpl).</div></div></div><div><div><div></div></div></div><h2><div><div>This Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>This chapter discusses the ordering requirements for PCI Express devices as well as PCI and PCI-X devices that may be attached to a PCI Express fabric. The discussion describes the Producer/Consumer programming model upon which the fundamental ordering rules are based. It also describes the potential performance problems that can emerge when strong ordering is employed and specifies the rules defined for deadlock avoidance.</div></div></div><div><div><div></div></div></div><h2><div><div>The Next Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>Native PCI Express devices that require interrupt support must use the Message Signaled Interrupt (MSI) mechanism defined originally in the PCI 2.2 specification. The next chapter details the MSI mechanism and also describes the legacy support that permits virtualization of the PCI INTx signals required by devices such as PCI Express-to-PCI Bridges.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="366" id="mark-8de88d71-6c39-4f4d-876f-283a9f211796" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Introduction</div></div></h2><div><div><div></div></div></div><div><div><div>As with other protocols, PCI Express imposes ordering rules on transactions moving through the fabric at the same time. The reasons for the ordering rules include:</div></div></div><div><div><div></div></div></div><div><ul><li>Ensuring that the completion of transactions is deterministic and in the sequence intended by the programmer.</li></ul></div><div><div><div></div></div></div><div><ul><li>Avoiding deadlocks conditions.</li></ul></div><div><div><div></div></div></div><div><ul><li>Maintaining compatibility with ordering already used on legacy buses (e.g., PCI, PCI-X, and AGP).</li></ul></div><div><div><div></div></div></div><div><ul><li>Maximize performance and throughput by minimizing read latencies and managing read/write ordering.</li></ul></div><div><div><div></div></div></div><div><div><div>PCI Express ordering is based on the same Producer/Consumer model as PCI. The split transaction protocol and related ordering rules are fairly straight forward when restricting the discussion to transactions involving only native PCI Express devices. However, ordering becomes more complex when including support for the legacy buses mentioned in bullet three above.</div></div></div><div><div><div></div></div></div><div><div><div>Rather than presenting the ordering rules defined by the specification and attempting to explain the rationale for each rule, this chapter takes the building block approach. Each major ordering concern is introduced one at a time. The discussion begins with the most conservative (and safest) approach to ordering, progresses to a more aggressive approach (to improve performance), and culminates with the ordering rules presented in the specification. The discussion is segmented into the following sections:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">The Producer/Consumer programming model upon which the fundamental ordering rules are based.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">The fundamental PCI Express device ordering requirements that ensure the Producer/Consumer model functions correctly.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">The Relaxed Ordering feature that permits violation of the Producer/Consumer ordering when the device issuing a request knows that the transaction is not part of a Producer/Consumer programming sequence.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">Modification of the strong ordering rules to improve performance.</li></ol></div><div><div><div></div></div></div><div><ol><li value="5">Avoiding deadlock conditions and support for PCI legacy implementations.</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="367" id="mark-8c048e47-3ef3-459c-9644-ab6d7ec52736" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Producer/Consumer Model</div></div></h2><div><div><div></div></div></div><div><div><div>Readers familiar with the Producer/Consumer programming model may choose to skip this section and proceed directly to "Native PCI Express Ordering Rules" on page 318.</div></div></div><div><div><div></div></div></div><div><div><div>The Producer/Consumer model is a common methodology that two requester-capable devices might use to communicate with each other. Consider the following example scenario:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">A network adapter begins to receive a stream of compressed video data over the network and performs a series of memory write transactions to deliver the stream of compressed video data into a Data buffer in memory (in other words the network adapter is the Producer of the data).</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">After the Producer moves the data to memory, it performs a memory write transaction to set an indicator (or Flag) in a memory location (or a register) to indicate that the data is ready for processing.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">Another requester (referred to as the Consumer) periodically performs a memory read from the Flag location to see if there's any data to be processed. In this example, this requester is a video decompressor that will decompress and display the data.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">When it sees that the Flag has been set by the Producer, it performs a memory write to clear the Flag, followed by a burst memory read transaction to read the compressed data (it consumes the data; hence the name Consumer) from the Data buffer in memory.</li></ol></div><div><div><div></div></div></div><div><ol><li value="5">When it is done consuming the Data, the Consumer writes the completion status into the Status location. It then resumes periodically reading the Flag location to determine when more data needs to be processed.</li></ol></div><div><div><div></div></div></div><div><ol><li value="6">In the meantime, the Producer has been reading periodically from the Status location to see if data processing has been completed by the other requester (the Consumer). This location typically contains zero until the other requester completes the data processing and writes the completion status into it. When the Producer reads the Status and sees that the Consumer has completed processing the Data, the Producer then performs a memory write to clear the Status location.</li></ol></div><div><div><div></div></div></div><div><ol><li value="7">The process then repeats whenever the Producer has more data to be processed.</li></ol></div><div><div><div></div></div></div><div><div><div>Ordering rules are required to ensure that the Producer/Consumer model works correctly no matter where the Producer, the Consumer, the Data buffer, the Flag location, and the Status location are located in the system (in other words, no matter how they are distributed on various links in the system).</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="368" id="mark-27c061b4-730c-4a3b-ac67-f315df88ae7b" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Native PCI Express Ordering Rules</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express transaction ordering for native devices can be summarized with four simple rules:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">PCI Express requires strong ordering of transactions (i.e., performing transactions in the order issued by software) flowing through the fabric that have the same TC assignment (see item 4 for the exception to this rule). Because all transactions that have the same TC value assigned to them are mapped to a given VC, the same rules apply to transactions within each VC.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">No ordering relationship exists between transactions with different TC assignments.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">The ordering rules apply in the same way to all types of transactions: memory, IO, configuration, and messages.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">Under limited circumstances, transactions with the Relaxed Ordering attribute bit set can be ordered ahead of other transactions with the same TC.</li></ol></div><div><div><div></div></div></div><div><div><div>These fundamental rules ensure that transactions always complete in the order intended by software. However, these rules are extremely conservative and do not necessarily result in optimum performance. For example, when transactions from many devices merge within switches, there may be no ordering relationship between transactions from these different devices. In such cases, more aggressive rules can be applied to improve performance as discussed in "Modified Ordering Rules Improve Performance" on page 322.</div></div></div><div><div><div></div></div></div><h2><div><div>Producer/Consumer Model with Native Devices</div></div></h2><div><div><div></div></div></div><div><div><div>Because the Producer/Consumer model depends on strong ordering, when the following conditions are met native PCI Express devices support this model without additional ordering rules:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">All elements associated with the Producer/Consumer model reside within native PCI Express devices.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">All transactions associated with the operation of the Producer/Consumer model transverse only PCI Express links within the same fabric.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">All associated transactions have the same TC values. If different TC values are used, then the strong ordering relationship between the transactions is no longer guaranteed.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">The Relaxed Ordering (RO) attribute bit of the transactions must be cleared to avoid reordering the transactions that are part of the Producer/Consumer transaction series.</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="369" id="mark-0bbb6915-439d-4cac-9d29-1b988665746f" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>When PCI legacy devices reside within a PCI Express system, the ordering rules become more involved. Consequently, additional ordering rules apply because of PCI's delayed transaction protocol. Without ordering rules, this protocol could permit Producer/Consumer transactions to complete out of order and cause the programming model to break.</div></div></div><div><div><div></div></div></div><h2><div><div>Relaxed Ordering</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express supports the Relaxed Ordering mechanism introduced by PCI-X; however, PCI Express introduces some changes (discussed later in this chapter). The concept of Relaxed Ordering in the PCI Express environment allows switches in the path between the Requester and Completer to reorder some transactions just received before others that were previously enqueued.</div></div></div><div><div><div></div></div></div><div><div><div>The ordering rules that exist to support the Producer/Consumer model may result in transactions being blocked, when in fact the blocked transactions are completely unrelated to any Producer/Consumer transaction sequence. Consequently, in certain circumstances, a transaction with its Relaxed Ordering (RO) attribute bit set can be re-ordered ahead of other transactions.</div></div></div><div><div><div></div></div></div><div><div><div>The Relaxed Ordering bit may be set by the device if its device driver has enabled it to do so (by setting the Enable Relaxed Ordering bit in the Device Control register-see Table 24-3 on page 906). Relaxed ordering gives switches and the Root Complex permission to move this transaction ahead of others, whereas the action is normally prohibited.</div></div></div><div><div><div></div></div></div><h2><div><div>RO Effects on Memory Writes and Messages</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express Switches and the Root Complex are affected by memory write and message transactions that have their RO bit set. Memory write and Message transactions are treated the same in most respects-both are handled as posted operations, both are received into the same Posted buffer, and both are subject to the same ordering requirements. When the RO bit is set, switches handle these transactions as follows:</div></div></div><div><div><div></div></div></div><div><ul><li>Switches are permitted to reorder memory write transactions just posted ahead of previously posted memory write transactions or message transactions. Similarly, message transactions just posted may be ordered ahead of previously posted memory write or message transactions. Switches must also forward the RO bit unmodified. The ability to reorder these transactions within switches is not supported by PCI-X bridges. In PCI-X, all PCI Express System Architecture posted writes must be forwarded in the exact order received. Another difference between the PCI-X and PCI Express implementations is that message transactions are not defined for PCI-X.</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="370" id="mark-928d7b26-2311-45a4-8c86-85ee5e973785" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><ul><li>The Root Complex is permitted to order a just-posted write transaction ahead of another write transaction that was received earlier in time. Also, when receiving write requests (with RO set), the Root Complex is required to write the data payload to the specified address location within system memory, but is permitted to write each byte to memory in any address order.</li></ul></div><div><div><div></div></div></div><h2><div><div>RO Effects on Memory Read Transactions</div></div></h2><div><div><div></div></div></div><div><div><div>All read transactions in PCI Express are handled as split transactions. When a device issues a memory read request with the RO bit set, the request may traverse one or more switches on its journey to the Completer. The Completer returns the requested read data in a series of one or more split completion transactions, and uses the same RO setting as in the request. Switch behavior for the example stated above is as follow:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">A switch that receives a memory read request with the RO bit set must forward the request in the order received, and must not reorder it ahead of memory write transactions that were previously posted. This action guarantees that all write transactions moving in the direction of the read request are pushed ahead of the read. Such actions are not necessarily part of the Producer/Consumer programming sequence, but software may depend on this flushing action taking place. Also, the RO bit must not be modified by the switch.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">When the Completer receives the memory read request, it fetches the requested read data and delivers a series of one or more memory read Completion transactions with the RO bit set (because it was set in the request).</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">A switch receiving the memory read Completion(s) detects the RO bit set and knows that it is allowed to order the read Completion(s) ahead of previously posted memory writes moving in the direction of the Completion. If the memory write transaction were blocked (due to flow control), then the memory read Completion would also be blocked if the RO was not set. Relaxed ordering in this case improves read performance.</li></ol></div><div><div><div></div></div></div><div><div><div>Table 8-1 summarizes the relaxed ordering behavior allowed by switches.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="371" id="mark-b40bc23f-6c74-4692-b3a1-ce9fa9c48bbb" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Table 8-1: Transactions That Can Be Reordered Due to Relaxed Ordering</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>These Transactions with RO=1 Can Pass</th><th>These Transactions</th></tr></thead><tbody><tr><td>Memory Write Request</td><td>Memory Write Request</td></tr><tr><td>Message Request</td><td>Memory Write Request</td></tr><tr><td>Memory Write Request</td><td>Message Request</td></tr><tr><td>Message Request</td><td>Message Request</td></tr><tr><td>Read Completion</td><td>Memory Write Request</td></tr><tr><td>Read Completion</td><td>Message Request</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>Summary of Strong Ordering Rules</div></div></h2><div><div><div></div></div></div><div><div><div>The PCI Express specification defines strong ordering rules associated with transactions that are assigned the same TC value, and further defines a Relaxed Ordering attribute that can be used when a device knows that a transaction has no ordering relationship to other transactions with the same TC value. Table 8-2 on page 322 summarizes the PCI Express ordering rules that satisfy the Producer/Consumer model and also provides for Relaxed Ordering. The table represents a draconian approach to ordering and does not consider issues of performance, preventing deadlocks, etc.</div></div></div><div><div><div></div></div></div><div><div><div>The table applies to transactions with the same TC assignment that are moving in the same direction. These rules ensure that transactions will complete in the intended program order and eliminates the possibility of deadlocks in a pure PCI Express implementation (i.e., systems with no PCI Bridges). Columns 2 - 6 represent transactions that have previously latched by a PCI Express device, while column 1 represents subsequently-latched transactions. The ordering relationship between the transaction in column 1 to other transactions previously enqueued is expressed in the table on a row-by-row basis. Note that these rules apply uniformly to all transaction types (Memory, Messages, IO, and Configuration). The table entries are defined as follows:</div></div></div><div><div><div></div></div></div><div><div><div>No - The transaction in column 1 must not be permitted to proceed ahead of the previously enqueued transaction in the corresponding columns (2-6).</div></div></div><div><div><div></div></div></div><div><div><div>Y/N (Yes/No) - The transaction in column 1 is allowed to proceed ahead of the previously enqueued transaction because its Relaxed Ordering bit is set (1), but it is not required to do so.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="372" id="mark-484851d3-a544-458c-9b2a-47c580705336" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Table 8-2: Fundamental Ordering Rules Based on Strong Ordering and RO Attribute</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><tbody><tr><td colspan="2" rowspan="2">Row Pass Column?</td><th>Posted Request</th><th colspan="2">Non-Posted Request</th><th colspan="2">Completion</th></tr><tr><td>Memory Write or MessageRequest (Col 2)</td><td>Read Request (Col 3)</td><td>I/O or Configuration Write Request (Col 4)</td><td>Read Completion (Col 5)</td><td>I/O or Configuration Write Completion (Col 6)</td></tr><tr><td>palsodisanday</td><td>Memory Write or Message Request (Row A)</td><td>a) No b) Y/N</td><td>No</td><td>No</td><td>No</td><td>No</td></tr><tr><td rowspan="2">PAISOD-UONisanbay</td><td>Read Request (Row B)</td><td>No</td><td>No</td><td>No</td><td>No</td><td>No</td></tr><tr><td>I/O or Configuration WriteRequest (Row C)</td><td>No</td><td>No</td><td>No</td><td>No</td><td>No</td></tr><tr><td rowspan="2">uonejdwog</td><td>Read Completion (Row D)</td><td>a) No b) Y/N</td><td>No</td><td>No</td><td>No</td><td>No</td></tr><tr><td>I/O or Configuration Write Completion (Row E)</td><td>No</td><td>No</td><td>No</td><td>No</td><td>No</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div>Note that the shaded area represents the ordering requirements that ensure the Producer/Consumer model functions correctly and is consistent with the basic rules associated with strong ordering. The transaction ordering associated with columns 3 - 6 play no role in the Producer/Consumer model.</div></div></div><div><div><div></div></div></div><h2><div><div>Modified Ordering Rules improve Performance</div></div></h2><div><div><div></div></div></div><div><div><div>This section describes how temporary transaction blocking can occur when the strong ordering rules listed in Table 8-2 are rigorously enforced. Modification of strong ordering between transactions that do not violate the Produce/Consumer programming model can eliminate many blocking conditions and improve link efficiency.</div></div></div><div><div><div></div></div></div><h2><div><div>Strong Ordering Can Result in Transaction Blocking</div></div></h2><div><div><div></div></div></div><div><div><div>Maintaining the strong ordering relationship between transactions would likely result in instances where all transactions would be blocked due to a single receive buffer being full. The strong ordering requirements to support the Producer/Consumer model cannot be modified (except in the case of relaxed</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="373" id="mark-d07711f9-9ece-4762-83d3-46bc7d697088" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>ordering described previously). However, transaction sequences that do not occur within the Producer/Consumer programming model can be modified to a weakly ordered scheme that can lead to improved performance.</div></div></div><div><div><div></div></div></div><h2><div><div>The Problem</div></div></h2><div><div><div></div></div></div><div><div><div>Consider the following example illustrated in Figure 8-1 on page 323 when strong ordering is maintained for all transaction sequences. This example depicts transmitter and receiver buffers associated with the delivery of transactions in a single direction (from left to right) for a single Virtual Channel (VC), and the transmit and receive buffers are organized in the same way. Also, recall that each of the transaction types (Posted, Non-Posted, and Completions) have independent flow control within the same VC. The numbers within the transmit buffers show the order in which these transactions were issued to the transmitter. In addition, the non-posted receive buffer is currently full. Consider the following sequence.</div></div></div><div><div><div></div></div></div><div><ol><li value="1">Transaction 1 (a memory read-non-posted operation) is the next transaction that must be sent (based on strong ordering). The flow control mechanism detects that insufficient credits are available, so Transaction 1 cannot be sent.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">Transaction 2 (a posted memory write) is the next transaction pending. When consulting Table 8-2 (based on strong ordering), entry A3 specifies that a memory write must not pass a previously posted read transaction.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">Because all entries in Table 8-2 are "No", all transactions are blocked due to the non-posted receive buffer being filled. PCI Express System Architecture</li></ol></div><div><div><div></div></div></div><div><div><div>Figure 8-1: Example of Strongly Ordered Transactions that Results in Temporary Blocking</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_382.jpg?x=303&amp;y=1220&amp;w=836&amp;h=437"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="374" id="mark-20db51ff-b0f4-4d36-9bec-eab24ba0d5db" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>The Weakly Ordered Solution</div></div></h2><div><div><div></div></div></div><div><div><div>As discussed previously, strong ordering is required to support the Producer/ Consumer model. This requirement is satisfied entirely by the shaded area in Table 8-2. The non-shaded area deals with transaction sequences that do not occur in the Producer/Consumer programming model, and therefore can be modified. Table 8-3 on page 326 lists these entries as weakly ordered. The modified entries are defined as:</div></div></div><div><div><div></div></div></div><div><div><div>Y/N (Yes/No) - The transaction in column 1 is allowed to proceed ahead of the previously enqueued transaction because the entry is not related to the Producer/Consumer strong ordering requirements and can be weakly ordered to improve performance.</div></div></div><div><div><div></div></div></div><div><div><div>Consider the scenario in Figure 8-1 with weak ordering employed:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">Transaction 1 (a memory read-non-posted operation) is the next transaction that must be sent. The flow control mechanism detects that insufficient credits are available, so Transaction 1 cannot be sent.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">The next transaction pending (2) is a posted memory write operation. When consulting Table 8-3 on page 326,entry <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="477" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c41"></mjx-c></mjx-mi></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn><mjx-mrow space="2"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c59"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4E"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">A</mi></mrow><mn>3</mn><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">Y</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">N</mi></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> allows the transmitter to reorder transaction 2 ahead of transaction 1. No blocking occurs!</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">The remaining transactions pending will also complete ahead of transaction 1 if the non-posted buffer remains full. When flow control credits are returned for the non-posted operations, transaction 1 will be the next transaction sent.</li></ol></div><div><div><div></div></div></div><div><div><div>In summary, these examples illustrate how strong ordering can temporarily block all transactions pending delivery, and that weak ordering rules can be used to improve link efficiency without violating the Producer/Consumer model.</div></div></div><div><div><div></div></div></div><h2><div><div>Order Management Accomplished with VC Buffers</div></div></h2><div><div><div></div></div></div><div><div><div>As the previous example illustrated, transaction ordering is managed within the Virtual Channel buffers. These buffers are grouped into Posted, Non-Posted, and Completion transactions and flow control is managed independently for each group. This makes it much easier to implement the modified (weak) ordering described in the previous example. See Chapter 7, entitled "Flow Control," on page 285 for details.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="375" id="mark-bcde66a6-5c68-43e5-b4d3-6472b9247db9" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Recall that transactions are mapped to Virtual Channels using the transaction's TC. If each TC is mapped to a separate VC, then each VC buffer will contain transactions with a single TC assignment. In this situation, VC flow control permits optimum flow of transactions.</div></div></div><div><div><div></div></div></div><h2><div><div>Summary of Modified Ordering Rules</div></div></h2><div><div><div></div></div></div><div><div><div>Table 8-3 on page 326 lists and highlights the modified ordering rules that allow switches to move some transactions ahead of others that may be stalled due to a receive buffer full condition. Definition of the entries are the same as the previous table:</div></div></div><div><div><div></div></div></div><div><div><div>No-The transaction in column 1 must not be permitted to proceed ahead of the previously enqueued transaction in the corresponding columns (2-6).</div></div></div><div><div><div></div></div></div><div><div><div>Y/N (Yes/No)-The transaction in column 1 is allowed to proceed ahead of the previously enqueued transaction because:</div></div></div><div><div><div></div></div></div><div><ul><li>its Relaxed Ordering bit is set (1), but it is not required to do so.</li></ul></div><div><div><div></div></div></div><div><ul><li>the entry is not subject to the Producer/Consumer strong ordering requirements and is weakly ordered to improve performance.</li></ul></div><div><div><div></div></div></div><div><div><div>Note: The "No" entry in Row D, Column 5 (D5) applies to cases where a Completer returns multiple Completions in response to a single read request. These Completions must return in order (i.e., Completions with the same transaction ID).</div></div></div><div><div><div></div></div></div><div><div><div>Upon examination of the table, some readers may question whether programs will operate correctly when weak ordering is employed. For example, note that a write transaction is permitted to be reordered ahead of a previously latched read request (entry A3). A programmer who reads from a location followed by a write to the same location must not expect these operations to complete in program order. Note that the ordering rules only guarantee proper operation of the Producer/Consumer programming model. If a programmer requires a read operation to complete ahead of a write transaction, then the write must not be issued until the read transaction completes.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="376" id="mark-70aa9256-c2a5-4d95-a47f-ce4f0d36eb7d" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Table 8-3: Weak Ordering Rules Enhance Performance</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><tbody><tr><td colspan="2" rowspan="2">Row Pass Column?</td><th>Posted Request</th><th colspan="2">Non-Posted Request</th><th colspan="2">Completion</th></tr><tr><td>Memory Write or Message Request (Col 2)</td><td>Read Request (Col 3)</td><td>I/O or Configuration Write Request (Col 4)</td><td>Read Completion (Col 5)</td><td>I/O or Configuration Write Completion (Col 6)</td></tr><tr><td>persod1.5 and 2.4</td><td>Memory Write or Message Request (Row A)</td><td>a) No b) Y/N</td><td>Y/N</td><td>Y/N</td><td>Y/N</td><td>Y/N</td></tr><tr><td rowspan="2">PAISOD-UONisenbey</td><td>Read Request (Row B)</td><td>No</td><td>Y/N</td><td>Y/N</td><td>Y/N</td><td>Y/N</td></tr><tr><td>I/O or Configuration Write Request (Row C)</td><td>No</td><td>Y/N</td><td>Y/N</td><td>Y/N</td><td>Y/N</td></tr><tr><td rowspan="2">uonejdwog</td><td>Read Completion (Row D)</td><td>a) No b) Y/N</td><td>Y/N</td><td>Y/N</td><td>a) Y/N b) No</td><td>Y/N</td></tr><tr><td>I/O or Configuration Write Completion (Row E)</td><td>No</td><td>Y/N</td><td>Y/N</td><td>Y/N</td><td>Y/N</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>Support for PCI Buses and Deadlock Avoidance</div></div></h2><div><div><div></div></div></div><div><div><div>Because the PCI bus employs delayed transactions, several deadlock scenarios can develop. These deadlock avoidance rules are included in PCI Express ordering to ensure that no deadlocks occur regardless of topology. Adhering to the ordering rules prevent problems when boundary conditions develop due to unanticipated topologies (e.g., two PCI Express to PCI bridges connected across the PCI Express fabric). Refer to the MindShare book entitled PCI System Architecture, Fourth Edition (published by Addison-Wesley) for a detailed explanation of the scenarios that are the basis for the PCI ordering rules related to deadlock avoidance. Table 8-4 on page 327 lists and highlights the deadlock avoidance ordering rules. Note that avoiding the deadlocks involves "Yes" entries in each case. If blocking occurs, the transaction in column 1 must be moved ahead of the transaction specified in the column where the "Yes" entry exists. Note also that the "Yes" entries in A5b and A6b apply only to PCI Express to PCI Bridges and PCI Express to PCI-X Bridges.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="377" id="mark-21268b8a-4a2c-4108-a046-a539ef3d27c9" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Table 8-4: Ordering Rules with Deadlock Avoidance Rules</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><tbody><tr><td colspan="2" rowspan="2">Row Pass Column?</td><th>Posted Request</th><th colspan="2">Non-Posted Request</th><th colspan="2">Completion</th></tr><tr><td>Memory Write or MessageRequest (Col 2)</td><td>Read Request (Col 3)</td><td>I/O or Configuration WriteRequest (Col 4)</td><td>Read Completion (Col 5)</td><td>I/O or Configuration Write Completion (Col 6)</td></tr><tr><td>pelsodisanday</td><td>Memory Write or MessageRequest (Row A)</td><td>a) No b) Y/N</td><td>Yes</td><td>Yes</td><td>a) Y/N b) Yes</td><td>a) Y/N b) Yes</td></tr><tr><td rowspan="2">PAISODisenbey</td><td>Read Request (Row B)</td><td>No</td><td>Y/N</td><td>Y/N</td><td>Y/N</td><td>Y/N</td></tr><tr><td>I/O or Configuration WriteRequest (Row C)</td><td>No</td><td>Y/N</td><td>Y/N</td><td>Y/N</td><td>Y/N</td></tr><tr><td rowspan="2">uonejdwog</td><td>Read Completion (Row D)</td><td>a) No b) Y/N</td><td>Yes</td><td>Yes</td><td>a) Y/N b) No</td><td>Y/N</td></tr><tr><td>I/O or Configuration Write Completion (Row E)</td><td>Y/N</td><td>Yes</td><td>Yes</td><td>Y/N</td><td>Y/N</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div>The specification provides the following explanation of the table entries:</div></div></div><div><div><div></div></div></div><div><ul><li>A2a - A Memory Write or Message Request with the Relaxed Ordering Attribute bit clear (0b) must not pass any other Memory Write or Message Request.</li></ul></div><div><div><div></div></div></div><div><ul><li>A2b - A Memory Write or Message Request with the Relaxed Ordering Attribute bit set (1b) is permitted to pass any other Memory Write or Message Request.</li></ul></div><div><div><div></div></div></div><div><ul><li>A3, A4 - A Memory Write or Message Request must be allowed to pass Read Requests and I/O or Configuration Write Requests to avoid deadlocks.</li></ul></div><div><div><div></div></div></div><div><ul><li>A5a, A6a - Endpoints, Switches, and Root Complexes may either allow Memory Write and Message Requests to pass Completions or to be blocked by Completions.</li></ul></div><div><div><div></div></div></div><div><ul><li>A5b, A6b -PCI Express to PCI Bridges and PCI Express to PCI-X Bridges (when operating in PCI mode), must allow Memory Write and Message Requests to pass Completions traveling in the PCI Express to PCI direction (Primary side of Bridge to Secondary side of Bridge) to avoid deadlock.</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="378" id="mark-b132d7e6-21a3-45c2-bdbe-b808c795d012" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><ul><li>B2, C2 — These Requests cannot pass a Memory Write or Message Request. This preserves strong write ordering required to support the Producer/ Consumer model.</li></ul></div><div><div><div></div></div></div><div><ul><li>B3, B4, C3, C4 - Read Requests and I/O or Configuration Write Requests are permitted to be blocked by or to pass other Read Requests and I/O or Configuration Write Requests.</li></ul></div><div><div><div></div></div></div><div><ul><li>B5, B6, C5, C6 - The Requests specified are permitted to be blocked by or to pass Completions.</li></ul></div><div><div><div></div></div></div><div><ul><li>D2a - If the Relaxed Ordering attribute bit is not set, then a Read Completion cannot pass a previously enqueued Memory Write or Message Request.</li></ul></div><div><div><div></div></div></div><div><ul><li>D2b -If the Relaxed Ordering attribute bit is set, then a Read Completion is permitted to pass a previously enqueued Memory Write or Message Request.</li></ul></div><div><div><div></div></div></div><div><ul><li>D3, D4, E3, E4 - Completions must be allowed to pass Read and I/O or Configuration Write Requests to avoid deadlocks.</li></ul></div><div><div><div></div></div></div><div><ul><li>D5a - Read Completions associated with different Read Requests are allowed to be blocked by or to pass each other.</li></ul></div><div><div><div></div></div></div><div><ul><li>D5b - When multiple completions are returned in response to a single Read Request, the completions must return the requested read data in the proper address order. Note that the data returned in each completion is delivered in ascending address order. Switches can recognize this condition because each completion will have the same Transaction ID. Completions with different transaction IDs can be reordered without concern.</li></ul></div><div><div><div></div></div></div><div><ul><li>D6 Read - Completions are permitted to be blocked by or to pass I/O or Configuration Write Completions.</li></ul></div><div><div><div></div></div></div><div><ul><li>E2 - I/O or Configuration Write Completions are permitted to be blocked by or to pass Memory Write and Message Requests. Such transactions are actually moving in the opposite direction, and have no ordering relationship.</li></ul></div><div><div><div></div></div></div><div><ul><li>E5, E6 - I/O or Configuration Write Completions are permitted to be blocked by or to pass Read Completions and other I/O or Configuration Write Completions.</li></ul></div><div><div><div></div></div></div><div><div><div>The specification also states the following additional rules:</div></div></div><div><div><div></div></div></div><div><ul><li>For Root Complex and Switch, Memory Write combining (as defined in the PCI Specification) is prohibited. Note: This is required so that devices can be permitted to optimize their receive buffer and control logic for Memory Write sizes matching their natural expected sizes, rather than being required to support the maximum possible Memory Write payload size.</li></ul></div><div><div><div></div></div></div><div><ul><li>Combining of Memory Read Requests, and/or Completions for different Requests is prohibited.</li></ul></div><div><div><div></div></div></div><div><ul><li>The No Snoop bit does not affect the required ordering behavior.</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="379" id="mark-54a16381-d7d0-42ce-81f4-523d1aa0b060" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Interrupts</div></div></h2><div><div><div></div></div></div><h2><div><div>The Previous Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>This chapter discusses the ordering requirements for PCI Express devices as well as PCI and PCI-X devices that may be attached to a PCI Express fabric. The discussion describes the Producer/Consumer programming model upon which the fundamental ordering rules are based. It also describes the potential performance problems that can emerge when strong ordering is employed and specifies the rules defined for deadlock avoidance.</div></div></div><div><div><div></div></div></div><h2><div><div>This Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>Native PCI Express devices that require interrupt support must use the Message Signaled Interrupt (MSI) mechanism defined originally in the PCI 2.2 version of the specification. This chapter details the MSI mechanism and also describes the legacy support that permits virtualization of the PCI INTx signals required by devices such as PCI Express-to-PCI Bridges.</div></div></div><div><div><div></div></div></div><h2><div><div>The Next Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>To this point it has been presumed that transactions traversing the fabric have not encountered any errors that cannot be corrected by hardware. The next chapter discusses both correctable and non-correctable errors and discusses the mechanisms used to report them. The PCI Express architecture provides a rich set of error detection, reporting, and logging capabilities. PCI Express error reporting classifies errors into three classes: correctable, non-fatal, and fatal. Prior to discussing the PCI Express error reporting capabilities, including PCI-compatible mechanisms, a brief review of the PCI error handling is included as background information.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="380" id="mark-ba9ab4d5-97a9-4810-afb5-157f2121bffc" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Two Methods of Interrupt Delivery</div></div></h2><div><div><div></div></div></div><div><div><div>Interrupt delivery is conditionally optional for PCI Express devices. When a native PCI Express function does depend upon delivering interrupts to call its device driver, Message Signaled Interrupts (MSI) must be used. However, in the event that a device connecting to a PCI Express link cannot use MSIs (i.e., legacy devices), an alternate mechanism is defined. Both mechanisms are summarized below:</div></div></div><div><div><div></div></div></div><div><div><div>Native PCI Express Interrupt Delivery - PCI Express eliminates the need for sideband signals by using the Message Signaled Interrupt (MSI), first defined by the 2.2 version of the PCI Specification (as an optional mechanism) and later required by PCI-X devices. The term "Message Signaled Interrupt" can be misleading in the context of PCI Express because of possible confusion with PCI Express's "Message" transactions. A Message Signaled Interrupt is not a PCI Express Message, instead it is simply a Memory Write transaction. A memory write associated with an MSI can only be distinguished from other memory writes by the address locations they target, which are reserved by the system for Interrupt delivery.</div></div></div><div><div><div></div></div></div><div><div><div>Legacy PCI Interrupt Delivery - This mechanism supports devices that must use PCI-Compatible interrupt signaling (i.e., INTA#, INTB#, INTC#, and INTD#) defined for the PCI bus. Legacy functions use one of the interrupt lines to signal an interrupt. An INTx# signal is asserted to request interrupt service and deasserted when the interrupt service accesses a device-specific register, thereby indicating the interrupt is being serviced. PCI Express defines in-band messages that act as virtual INTx# wires, which target the interrupt controller located typically within the Root Complex.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 9-1 illustrates the delivery of interrupts from three types of devices:</div></div></div><div><div><div></div></div></div><div><ul><li>Native PCI Express device - must use MSI delivery</li></ul></div><div><div><div></div></div></div><div><ul><li>Legacy endpoint device - must support MSI and optionally support INTx messages. Such devices may be boot devices that must use legacy interrupts during boot, but once its driver loads MSIs are used.</li></ul></div><div><div><div></div></div></div><div><ul><li>PCI Express-to-PCI (X) Bridge - must support INTx messages</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="381" id="mark-3365eb80-ef80-4076-8f3f-b4178f70a1e3" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 9-1: Native PCI Express and Legacy PCI Interrupt Delivery</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_390.jpg?x=222&amp;y=403&amp;w=1000&amp;h=857"></div></div><div><div><div></div></div></div><h2><div><div>Message Signaled Interrupts</div></div></h2><div><div><div></div></div></div><div><div><div>Message Signaled Interrupts (MSIs) are delivered to the Root Complex via memory write transactions. The MSI Capability register provides all the information that the device requires to signal MSIs. This register is set up by configuration software and includes the following information:</div></div></div><div><div><div></div></div></div><div><ul><li>Target memory address</li></ul></div><div><div><div></div></div></div><div><ul><li>Data Value to be written to the specified address location</li></ul></div><div><div><div></div></div></div><div><ul><li>The number of messages that can be encoded into the data</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="382" id="mark-a324c2f1-5be7-4f48-aeee-afbaf715f60a" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>See "Description of 3DW And 4DW Memory Request Header Fields" on page 176 for a review of the Memory Write Transaction Header. Note that MSIs always have a data payload of 1DW.</div></div></div><div><div><div></div></div></div><h2><div><div>The MSI Capability Register Set</div></div></h2><div><div><div></div></div></div><div><div><div>A PCI Express function indicates its support for MSI via the MSI Capability registers. Each native PCI Express function must implement a single MSI register set within its own configuration space. Note that the PCI Express specification defines two register formats:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">64-bit memory addressing format (Figure 9-2 on page 332) - required by all native PCI Express devices and optionally implemented by Legacy endpoints.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">32-bit memory addressing format (Figure 9-3 on page 332) - optionally supported by Legacy endpoints.</li></ol></div><div><div><div></div></div></div><div><div><div>Figure 9-2: 64-bit MSI Capability Register Format</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><tbody><tr><td colspan="2">3116 158</td><td>0</td><td rowspan="5">Dword 0 Dword 1 Dword 2 Dword 3</td></tr><tr><td>Message Control Register</td><td>Pointer to Next ID</td><td>Capability ID = 05h</td></tr><tr><td colspan="3">Least-Significant 32-bits of Message Address Register0 0</td></tr><tr><td colspan="3">Most-Significant 32-bits of Message Address Register</td></tr><tr><td></td><td colspan="2">Message Data Register</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div>Figure 9-3: 32-bit MSI Capability Register Set Format</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_391.jpg?x=227&amp;y=1248&amp;w=994&amp;h=168"></div></div><div><div><div></div></div></div><div><div><div>The following sections describe each field within the MSI registers.</div></div></div><div><div><div></div></div></div><h2><div><div>Capability ID</div></div></h2><div><div><div></div></div></div><div><div><div>The Capability ID that identifies the MSI register set is <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="478" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-b"><mjx-c class="mjx-c1D7CE TEX-B"></mjx-c><mjx-c class="mjx-c1D7D3 TEX-B"></mjx-c></mjx-mn><mjx-mi class="mjx-b"><mjx-c class="mjx-c1D421 TEX-B"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mn mathvariant="bold">05</mn><mi mathvariant="bold">h</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> . This is a hardwired, read-only value.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="383" id="mark-061b3b51-1378-458d-bd45-bf31eec1cdd9" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Pointer To Next New Capability</div></div></h2><div><div><div></div></div></div><div><div><div>The second byte of the register set either points to the next New Capability's register set or contains 00h if this is the end of the New Capabilities list. This is a hardwired, read-only value. If non-zero, it must be a dword-aligned value.</div></div></div><div><div><div></div></div></div><h2><div><div>Message Control Register</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 9-4 on page 333 and Table 9-1 on page 333 illustrate the layout and usage of the Message Control register.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 9-4: Message Control Register</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_392.jpg?x=224&amp;y=769&amp;w=997&amp;h=328"></div></div><div><div><div></div></div></div><div><div><div>Table 9-1: Format and Usage of Message Control Register</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Bit(s)</th><th>Field Name</th><th>Description</th></tr></thead><tbody><tr><td>15:8</td><td>Reserved</td><td>Read-Only. Always zero.</td></tr><tr><td>7</td><td>64-bit Address Capable</td><td>Read-Only. - <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="479" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn><mo>=</mo></math></mjx-assistive-mml></mjx-container> Function does not implement the upper 32- bits of the Message Address register and is inca- pable of generating a 64-bit memory address. - <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="480" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mo>=</mo></math></mjx-assistive-mml></mjx-container> Function implements the upper 32-bits of the Message Address register and is capable of gen- erating a 64-bit memory address.</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="384" id="mark-96d63e80-9350-4d14-a8c5-3f427806e39b" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 9-1: Format and Usage of Message Control Register (Continued)</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Bit(s)</th><th>Field Name</th><th>Description</th></tr></thead><tbody><tr><td rowspan="10">6:4</td><td rowspan="10">Multiple Message Enable</td><td rowspan="2">Read/Write. After system software reads the Mul- tiple Message Capable field (see next row in this table) to determine how many messages are requested by the device, it programs a 3-bit value into this field indicating the actual number of mes- sages allocated to the device. The number allocated can be equal to or less than the number actually requested. The state of this field after reset is <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="481" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>000</mn></mrow></math></mjx-assistive-mml></mjx-container> b. The field is encoded as follows:</td></tr><tr></tr><tr><td>Value Number of Messages Requested 000b1</td></tr><tr><td>001b2</td></tr><tr><td>010b4</td></tr><tr><td>011b8</td></tr><tr><td>100b16</td></tr><tr><td>101b32</td></tr><tr><td>110bReserved</td></tr><tr><td>111bReserved</td></tr><tr><td rowspan="11">3:1</td><td rowspan="10">Multiple Message Capable</td><td>Read-Only. System software reads this field to determine how many messages the device would like allocated to it. The requested number of mes- sages is a power of two, therefore a device that would like three messages must request that four messages be allocated to it. The field is encoded as follows:</td></tr><tr><td>ValueNumber of Messages Requested</td></tr><tr><td>000b1</td></tr><tr><td>001b2</td></tr><tr><td>010b4</td></tr><tr><td>011b8</td></tr><tr><td>100b16</td></tr><tr><td>101b32</td></tr><tr><td>110bReserved</td></tr><tr><td>111bReserved</td></tr><tr><td></td><td></td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="385" id="mark-82b5a5fe-1c2e-4717-aaec-51047a18abc8" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 9-1: Format and Usage of Message Control Register (Continued)</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Bit(s)</th><th>Field Name</th><th>Description</th></tr></thead><tbody><tr><td>0</td><td>MSI Enable</td><td>Read/Write. State after reset is 0 , indicating that the device’s MSI capability is disabled. - 0 = Function is disabled from using MSI. It must use INTX Messages to deliver interrupts (legacy endpoint or bridge). 1 = Function is enabled to use MSI to request service and is forbidden to use its interrupt pin.</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>Message Address Register</div></div></h2><div><div><div></div></div></div><div><div><div>The lower two bits of the 32-bit Message Address register are hardwired to zero and cannot be changed. In other words, the address assigned by system software is always aligned on a dword address boundary.</div></div></div><div><div><div></div></div></div><div><div><div>The upper 32-bits of the Message Address register are required for native PCI Express devices and optional for legacy endpoints. This register is present if Bit 7 of the Message Control register is set. If present, it is a read/write register and it is used in conjunction with the Message Address register to assign a 32-bit or a 64-bit memory address to the device:</div></div></div><div><div><div></div></div></div><div><ul><li>If the upper 32-bits of the Message Address register are set to a non-zero value by the system software, then a 64-bit message address has been assigned to the device using both the upper and lower halves of the register.</li></ul></div><div><div><div></div></div></div><div><ul><li>If the upper 32-bits of the Message Address register are set to zero by the system software, then a 32-bit message address has been assigned to the device using both the upper and lower halves of the register.</li></ul></div><div><div><div></div></div></div><h2><div><div>Message Data Register</div></div></h2><div><div><div></div></div></div><div><div><div>The system software assigns the device a base message data pattern by writing it into this 16-bit, read/write register. When the device must generate an interrupt request, it writes a 32-bit value to the memory address specified in the Message Address register. The data written has the following format:</div></div></div><div><div><div></div></div></div><div><ul><li>The upper 16 bits are always set to zero.</li></ul></div><div><div><div></div></div></div><div><ul><li>The lower 16 bits are supplied from the Message Data register. If more than one message has been assigned to the device, the device modifies the lower bits (the number of modifiable bits depends on how many messages have been assigned to the device by the configuration software) of the data from PCI Express System Architecture</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="386" id="mark-19b06161-641a-4ad6-b036-d50126d603fb" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>the Message Data register to form the appropriate message for the event it wishes to report to its driver. For an example, refer to the example cited in "Basics of Generating an MSI Interrupt Request" on page 338.</div></div></div><div><div><div></div></div></div><h2><div><div>Basics of MSI Configuration</div></div></h2><div><div><div></div></div></div><div><div><div>The following list specifies the steps taken by software to configure MSI interrupts for a PCI Express device. Refer to Figure 9-5 on page 337.</div></div></div><div><div><div></div></div></div><div><ol><li value="1">At startup time, the configuration software scans the PCI bus(es) (referred to as bus enumeration) and discovers devices (i.e., it performs configuration reads for valid Vendor IDs).When a PCI Express function is discovered, the configuration software reads the Capabilities List Pointer to obtain the location of the first Capability register within the chain of registers.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">The software then searches the capability register sets until it discovers the MSI Capability register set (Capability ID of 05h).</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">Software assigns a dword-aligned memory address to the device's Message Address register. This is the destination address of the memory write used when delivering an interrupt request.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">Software checks the Multiple Message Capable field in the device's Message Control register to determine how many event-specific messages the device would like assigned to it.</li></ol></div><div><div><div></div></div></div><div><ol><li value="5">The software then allocates a number of messages equal to or less than what the device requested. At a minimum, one message will be allocated to the device.</li></ol></div><div><div><div></div></div></div><div><ol><li value="6">The software writes the base message data pattern into the device's Message Data register.</li></ol></div><div><div><div></div></div></div><div><ol><li value="7">Finally, the software sets the MSI Enable bit in the device's Message Control register, thereby enabling it to generate interrupts using MSI memory writes.</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="387" id="mark-3b83d713-855f-4469-b154-49953e672389" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 9-5: Device MSI Configuration Process</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_396.jpg?x=532&amp;y=380&amp;w=370&amp;h=1041"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="388" id="mark-be428963-0d2e-464f-a17c-84e7805129ae" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Basics of Generating an MSI Interrupt Request</div></div></h2><div><div><div></div></div></div><div><div><div>When a PCI Express function generates an interrupt request to the processor it performs a memory write transaction. The associated data is platform specific and is always 1DW in size, and is written to a pre-defined memory address location. As described earlier, the configuration software is responsible for priming the function's MSI Address and Data registers with the appropriate memory address and the data to be written to that address when generating a request. It also primes a field in the Message Control register with the number of messages that have been allocated to the device.</div></div></div><div><div><div></div></div></div><h2><div><div>Memory Write Transaction (MSI)</div></div></h2><div><div><div></div></div></div><div><div><div>When the device must generate an interrupt request, it writes the Message Data register contents to the memory address specified in its Message Address register. Figure 9-6 on page 339 illustrates the contents of the Memory Write Transaction Header and Data field. Key points include:</div></div></div><div><div><div></div></div></div><div><ul><li>Format field must be 11b, indicating a 4DW header with Data (native functions) and may be 10b for Legacy Endpoints.</li></ul></div><div><div><div></div></div></div><div><ul><li>Header Attribute bits (No Snoop and Relaxed Ordering) must be zero.</li></ul></div><div><div><div></div></div></div><div><ul><li>Length field must be <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="482" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>01</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">h</mi></mrow></math></mjx-assistive-mml></mjx-container> to indicate maximum data payload of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="483" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c44"></mjx-c><mjx-c class="mjx-c57"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">DW</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> .</li></ul></div><div><div><div></div></div></div><div><ul><li>First BE field must be <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="484" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>0011</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> ,indicating valid data in lower 16 bits.</li></ul></div><div><div><div></div></div></div><div><ul><li>Last BE field must be 0000b, indicating a single DW transaction.</li></ul></div><div><div><div></div></div></div><div><ul><li>Address fields within the header come directly from the address fields within the MSI Capability registers.</li></ul></div><div><div><div></div></div></div><div><ul><li>Lower 16 bits of the Data payload come directly from the data field within the MSI Capability registers. Chapter 9: Interrupts</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="389" id="mark-6bdc2232-16ec-44bc-90c1-586fd954f291" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 9-6: Format of Memory Write Transaction for Native-Deive MSI Delivery</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_398.jpg?x=220&amp;y=386&amp;w=991&amp;h=968"></div></div><div><div><div></div></div></div><h2><div><div>Multiple Messages</div></div></h2><div><div><div></div></div></div><div><div><div>If the system software allocated more than one message to the device, it is permitted to modify the lower bits of the assigned Message Data value to send a different message for each device-specific event type that requires servicing by the device driver.</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="390" id="mark-c7bf2e7b-57d0-43a8-aea8-6df20877db42" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>As an example, assume the following:</div></div></div><div><div><div></div></div></div><div><ul><li>Four messages have been allocated to a device.</li></ul></div><div><div><div></div></div></div><div><ul><li>A data value of 0500h has been assigned to the device's Message Data register.</li></ul></div><div><div><div></div></div></div><div><ul><li>Memory address 0A000000h has been written into the device's Message Address register.</li></ul></div><div><div><div></div></div></div><div><div><div>When any one of four different device-specific events occurs, the device generates a request by performing a dword write to memory address 0A000000h with a data value of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="485" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c2C"></mjx-c></mjx-mo><mjx-texatom space="2" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c2C"></mjx-c></mjx-mo><mjx-texatom space="2" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>00000500</mn></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">h</mi></mrow><mo>,</mo><mrow data-mjx-texclass="ORD"><mn>00000501</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">h</mi></mrow><mo>,</mo><mrow data-mjx-texclass="ORD"><mn>00000502</mn></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">h</mi></mrow></math></mjx-assistive-mml></mjx-container> ,or <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="486" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>00000503</mn></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">h</mi></mrow></math></mjx-assistive-mml></mjx-container> . In other words, the device automatically appends the value <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="487" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>0000</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">h</mi></mrow></math></mjx-assistive-mml></mjx-container> to the upper part of its assigned message data value (to make a 32-bit value) and modifies the lower two bits of the value to indicate the specific message type.</div></div></div><div><div><div></div></div></div><h2><div><div>Memory Synchronization When Interrupt Handler  Entered</div></div></h2><div><div><div></div></div></div><h2><div><div>The Problem</div></div></h2><div><div><div></div></div></div><div><div><div>Assume that a PCI Express device performs one or more memory write transactions to deliver data (application data) into main memory, followed by an MSI (which notifies software that new application data has been moved to memory). Also assume the following:</div></div></div><div><div><div></div></div></div><div><ul><li>application data transactions have a Traffic Class of Zero (TC0) and will always flow through VC0 buffers.</li></ul></div><div><div><div></div></div></div><div><ul><li>the MSI transaction uses TC1, and it flows through the VC1 buffers.</li></ul></div><div><div><div></div></div></div><div><ul><li>These transactions traverse one or more switches on their way to the Root Complex and memory.</li></ul></div><div><div><div></div></div></div><div><ul><li>VC arbitration is set up so that VC1 transactions have a much higher priority than VC0 transactions.</li></ul></div><div><div><div></div></div></div><div><div><div>Flow Control and VC arbitration associated with the delivery of the data and the MSI may result in the MSI transaction being moved ahead of the application data transactions based on the goals of differentiated services. This is possible because there is no ordering relationship maintained between transactions that have different TC values and VC assignments. Consequently, the MSI may arrive at the Root Complex well ahead of the corresponding application data.</div></div></div><div><div><div></div></div></div><div><div><div>When the CPU is interrupted by the MSI, the currently-executing program is suspended and the processor executes the interrupt handler within the</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="391" id="mark-cbfed35d-f656-4394-a6ae-2c3812ff5ad5" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Requester's device driver. The driver may immediately read data from the target memory buffer in main memory. If some of the application data transactions that are still making their way upstream, the driver will fetch and process old data.</div></div></div><div><div><div></div></div></div><h2><div><div>Solving the Problem</div></div></h2><div><div><div></div></div></div><div><div><div>The problem can be solved in two ways:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">Ensure that the TC numbers of the Memory Write data and the MSI are the same. The MSI must also have its relaxed ordering bit cleared.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">The driver can solve this problem by performing a dummy read (Memory Read Dword with all Byte Enables deasserted) from a location within its device before processing the data. The read must also have the same TC number as the Memory Write data. The read completion returned to the Root Complex will travel in the same VC as the Memory Write data, thereby ensuring that the write data will be pushed ahead of the read completion and into memory prior to the completion being received by the driver. Recall that the ordering rules require that all transactions with the same TC must be performed in order. The only exception is a transaction with the relaxed ordering bit set.</li></ol></div><div><div><div></div></div></div><h2><div><div>Interrupt Latency</div></div></h2><div><div><div></div></div></div><div><div><div>The time from signaling an interrupt request until software services the device is referred to as its interrupt latency. As with the other interrupt request delivery mechanisms the MSI capability does not provide interrupt latency guarantees.</div></div></div><div><div><div></div></div></div><h2><div><div>MSI Results In ECRC Error</div></div></h2><div><div><div></div></div></div><div><div><div>Because MSIs are delivered as Memory Write transactions, and error associated with delivery of an MSI is treated the same as any other Memory Write error condition. See "ECRC Generation and Checking" on page 361 for treatment of ECRC errors.</div></div></div><div><div><div></div></div></div><h2><div><div>Some Rules, Recommendations, etc.</div></div></h2><div><div><div></div></div></div><div><ol><li value="1">It is the specification's intention that mutually-exclusive messages will be assigned to devices by the system software and that each message will be converted to an exclusive interrupt level upon delivery to the processor.</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="392" id="mark-daba3be6-5e68-4257-9ee0-57392cb3fa05" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><ol><li value="2">More than one MSI capability register set per function is prohibited.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">A read from the Message Address register produces undefined results.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">Reserved registers and bits are read-only and always return zero when read.</li></ol></div><div><div><div></div></div></div><div><ol><li value="5">System software can modify Message Control register bits, but the device is prohibited from doing so. In other words, it's not permitted to modify the bits via the "back door."</li></ol></div><div><div><div></div></div></div><div><ol><li value="6">At a minimum, a single message will be assigned to each device.</li></ol></div><div><div><div></div></div></div><div><ol><li value="7">System software must not write to the upper half of the dword that contains the Message Data register.</li></ol></div><div><div><div></div></div></div><div><ol><li value="8">If the device writes the same message multiple times, only one of those messages is guaranteed to be serviced. If all of them must be serviced, the device must not generate the same message again until the driver services the earlier one.</li></ol></div><div><div><div></div></div></div><div><ol><li value="9">If a device has more than one message assigned, and it writes a series of different messages, it is guaranteed that all of them will be serviced.</li></ol></div><div><div><div></div></div></div><h2><div><div>Legacy PCI Interrupt Delivery</div></div></h2><div><div><div></div></div></div><div><div><div>This section provides background information regarding the standard PCI interrupt delivery using INTx signals. This is followed by a detailed discussion of how PCI Express supports virtual INTx signaling. Readers familiar with PCI interrupt handling may wish to proceed to "Virtual INTx Signaling" on page 347.</div></div></div><div><div><div></div></div></div><h2><div><div>Background PCI Interrupt Signaling</div></div></h2><div><div><div></div></div></div><div><div><div>PCI devices that use interrupts have two options:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">INTx# active low-level signals that can be shared. These signals were defined in the original specification.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">Message Signaled Interrupts introduced with the 2.2 version of the specification are optional for PCI devices. These MSIs are compatible with PCI Express and require no modification by devices or by PCI Express-to-PCI Bridges.</li></ol></div><div><div><div></div></div></div><h2><div><div>Device INTx# Pins</div></div></h2><div><div><div></div></div></div><div><div><div>Each physical PCI component can implement up to 4 INTx# signals (INTA#, INTB#, INTC#, and INTD#). Because PCI devices (like PCI Express devices) can support up to 8 functions, four interrupt pins are supported. However, if a maximum of eight functions are implemented and all required interrupts then the INTx# signals would have to be shared. Also, no single function is permitted to use more than one INTx# signal.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="393" id="mark-a7e06a08-88ac-4b00-8be0-9a69e5a15e94" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Determining if a Function Uses INTx# Pins</div></div></h2><div><div><div></div></div></div><div><div><div>Each PCI function indicates support for an INTx# signal via the standard configuration header. The read-only Interrupt Pin register illustrated in Figure 9-7 on page 343, contains the information needed by configuration software to determine if INTx signals are supported and, if so, which INTx# signal is used by this function.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 9-7: Interrupt Pin Register within PCI Configuration Header</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_402.jpg?x=209&amp;y=736&amp;w=1016&amp;h=874"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="394" id="mark-cc916920-938b-4b8a-b789-a79e16695b1d" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><h2><div><div>Interrupt Routing</div></div></h2><div><div><div></div></div></div><div><div><div>The system designer determines the routing of INTx pins from devices. The INTx signals used by each device can be routed in a variety of ways so that ultimately the each INTx pin will go to an input of the interrupt controller. Figure 9- 8 on page 344 illustrates a variety of PCI devices using INTx pins to signal interrupts. As is typical, all PCI INTx signals are routed to one of four inputs. All INTx signals routed to a given input will be directed to a specific input to the interrupt controller, thus each of the INTx routed to the common interrupt input will also have the same interrupt Line number assigned to it by platform software. For example, IRQ15 has three PCI INTx inputs from different devices - INTB#, INTA#, and INTA#. Consequently, the functions using these INTx lines will share IRQ15 and its associated interrupt vector.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 9-8: INTx Signal Routing is Platform Specific</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_403.jpg?x=222&amp;y=818&amp;w=997&amp;h=737"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="395" id="mark-e765b8de-cd77-4a54-95dc-9939f22ad2ba" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Associating the INTx# Line to an IRQ Number</div></div></h2><div><div><div></div></div></div><div><div><div>Based on the routing of the INTx pin associated with each function, the Interrupt Line number is reported by configuration software (also pictured in Figure 9-7 on page 343). The value ultimately tells the function's device driver which interrupt vector will be reported when an interrupt occurs from this function. Therefore, when this function generates an interrupt the CPU will receive the vector number that corresponds to the IRQ specified in the Interrupt Line register. The CPU uses this vector to index into the interrupt service table to fetch the entry point of the interrupt service routine associated with the function's device driver. The method used to communicate this information is operating environment specific (e.g., the Windows XP or Linux).</div></div></div><div><div><div></div></div></div><div><div><div>Note that because the INTx# lines can be wire ORed from different devices, the interrupt line number assignment will be the same for those devices whose INTx# lines are wired together. In these cases, an interrupt signaled by any of the devices sharing the same IRQ will cause the same vector to be sent to the CPU. Software must ensure that all service routines that share the same IRQ input chain the service routines together so that all devices can be checked to determine which one(s) caused the interrupt request. Once again the mechanism used for chaining the service routines is operating environment specific.</div></div></div><div><div><div></div></div></div><h2><div><div>INTx# Signaling</div></div></h2><div><div><div></div></div></div><div><div><div>The INTx# lines are active low signals implemented as open-drain with a pullup resistor provided on each line by the system. Multiple devices connected to the same PCI interrupt request signal line can assert it simultaneously without damage.</div></div></div><div><div><div></div></div></div><div><div><div>When a device signals an interrupt it also sets a bit within a device-specific register to indicate that an interrupt is pending. This register can be mapped into memory or I/O address space and is read by device-specific software to verify that an interrupt is pending completion. When this bit is cleared, the INTx signal is deasserted.</div></div></div><div><div><div></div></div></div><div><div><div>The device must also set the Interrupt Status bit located in the Configuration Status register. This bit can be read by system software to see if an interrupt is currently pending completion. (See Figure 9-10 on page 347.)</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="396" id="mark-1b165ebf-e690-4f1e-ab78-a48c70a26879" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Interrupt Disable. The 2.3 specification added an interrupt disable bit (Bit 10) to the configuration command register. See Figure 9-9 on page 346. The bit is cleared at reset permitting generation of INTx signal generation. Software may set this bit thereby inhibiting generation of INTx signaling. Note that the Interrupt Disable bit has no effect on Message Signalled Interrupts (MSI). MSIs are enabled via the MSI capability command register.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 9-9: Configuration Command Register — Interrupt Disable Field</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_405.jpg?x=222&amp;y=664&amp;w=991&amp;h=657"></div></div><div><div><div></div></div></div><div><div><div>Interrupt Status. The PCI 2.3 specification added an interrupt status bit to the configuration status register (pictured in Figure 9-10 on page 347). A function must set this status bit when an interrupt is pending. In addition, if the Interrupt Disable bit in the configuration command register is cleared (i.e. interrupts enabled), then the function's INTx# signal is asserted, but only after the interrupt status bit is set. This bit is unaffected by the state of the interrupt disable bit, and it has no effect on the MSI mechanism. Note also that the bit is read only.</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="397" id="mark-d62f8f4c-6360-4dd7-ad2f-f1e02e218245" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_406.jpg?x=223&amp;y=391&amp;w=999&amp;h=555"></div></div><div><div><div></div></div></div><h2><div><div>Virtual INTx Signaling</div></div></h2><div><div><div></div></div></div><div><div><div>When circumstances make it impossible to use MSIs standard compatible INTx signaling may be used. Following are two examples of devices that cannot use MSI:</div></div></div><div><div><div></div></div></div><div><div><div>PCI Express-to-PCI(X) bridges - PCI devices will likely use the INTx signals to deliver an interrupt request (MSI is optional). Because PCI Express does not support sideband interrupt signaling, an INTx virtual wire message is used to signal the interrupt controller (located in the Root Complex). The interrupt controller in turn delivers an interrupt request to the CPU, including the vector number that identifies the entry point of the interrupt service routine.</div></div></div><div><div><div></div></div></div><div><div><div>Boot Devices - Standard PC systems typically use the legacy interrupt subsystem (8259 interrupt controller and related signals) during the boot sequence. Furthermore, the MSI subsystem cannot be used because it typically initializes after the Operating System (OS) loads and device drivers initialize. PCI Express devices involved in initializing the system and loading the OS (e.g., video, hard drive, and keyboard) are called "boot devices." Boot devices must use legacy interrupt support until the OS and device drivers for their devices install, after which they use MSI.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="398" id="mark-d0945039-3e10-47cc-b9c1-fb46a851617c" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><h2><div><div>Virtual INTx Wire Delivery</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 9-11 on page 348 illustrates an example PCI Express system that implements a legacy boot device and a PCI Express-to-PCI Bridge. The bridge can never issue MSIs because it does not know the source of the INTx# signals; whereas, the boot device can signal interrupt via MSI following the boot sequence. Figure 9-11 depicts the bridge using an INTB messages to signal the assertion and deassertion of INTB# from the PCI bus. The legacy device is shown signaling an INTA from its function. Note that INTx signaling involves two messages:</div></div></div><div><div><div></div></div></div><div><ul><li>The Assert_INTx messages that indicates a high to low transition of the virtual INTx# signal.</li></ul></div><div><div><div></div></div></div><div><ul><li>The Deassert_INTx messages that indicates a low to high transition of the virtual INTx# signal.</li></ul></div><div><div><div></div></div></div><div><div><div>When a Legacy device delivers an Assert_INTx message, it also sets its Interrupt Pending bit located in memory or I/O space and also sets the Interrupt Pending bit located within the Configuration Status register (Figure 9-10).</div></div></div><div><div><div></div></div></div><div><div><div>Figure 9-11: Legacy Devices use INTx Messages to Virtualize INTA#-INTD# Signal Transitions</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_407.jpg?x=353&amp;y=980&amp;w=737&amp;h=694"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="399" id="mark-7638256a-2b4b-45b5-8160-5b6ffff12871" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Collapsing INTx Signals within a Bridge</div></div></h2><div><div><div></div></div></div><div><div><div>Switches that have multiple downstream ports to which legacy devices attach must ensure that INTx transactions are delivered upstream in the correct fashion. The specific requirement is to ensure that the interrupt controller receives INTx messages that represent the wire-ORed behavior of legacy PCI implementations. As illustrated in Figure 9-8 on page 344, INTx lines may be shared when one or more INTx lines are tied together (wire-ORed). Consequently, when more than one devices signals an interrupt at roughly the same time only the first assertion is seen by the interrupt controller. Similarly, when one of these devices deasserts its INTx line, the line remains asserted and only the last deas-sertion will be seen by the interrupt controller.</div></div></div><div><div><div></div></div></div><div><div><div>Two or more legacy PCI Express devices sending the same INTx message on different ports of the same switch, must be treated as wire-ORed messages. This ensures that the interrupt controller observes the correct transitions. Figure 9-12 on page 350 illustrates two legacy devices issuing INTA messages to the Switch. Note that because the INTA messages overlap, the second Assert_INTA is blocked because an Assert_INTA message has been registered and no deasser-tion has yet occurred. Similarly the first Deassert_INTA message is blocked because two Assert_INTAs are outstanding and this is the first deassert message, so another will follow. This ensures that the interrupt controller will never receive two Assert_INTx messages of the same type nor two Deassert_INTX messages of the same type.</div></div></div><div><div><div></div></div></div><div><div><div>As described above, switches must track the state of each of the INTx messages at each port and transfer only those that represent a valid change in the virtual signaling.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="400" id="mark-e69091c3-8e18-4681-b99d-c89d331a95cd" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 9-12: Switch Collapses INTx Message to Achieve Wired-OR Characteristics</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_409.jpg?x=228&amp;y=465&amp;w=993&amp;h=1022"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="401" id="mark-8ad09e31-7a28-48ce-b3be-9da1dfccac7d" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>INTx Message Format</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 9-13 on page 351 depicts the format of the INTx message header and defines the message types supported. INTx messages are always delivered from upstream ports of Endpoints, Bridges, and Switches. The routing employed is "Local-Terminate at Receiver," with the interrupt controller as the ultimate destination. The message code field identifies the message type and eight codes are used by the INTx messages as listed in Table 9-2. PCI Express System Architecture</div></div></div><div><div><div></div></div></div><div><div><div>Figure 9-13: INTx Message Format and Types</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_410.jpg?x=261&amp;y=669&amp;w=926&amp;h=411"></div></div><div><div><div></div></div></div><div><div><div>Table 9-2: INTx Message Codes</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>INTx Messages</th><th>Message Code</th></tr></thead><tbody><tr><td>Assert_INTA</td><td>0010 0000</td></tr><tr><td>Assert_INTB</td><td>00100001</td></tr><tr><td>Assert_INTC</td><td>0010 0010</td></tr><tr><td>Assert_INTD</td><td>00100011</td></tr><tr><td>Deassert_INTA</td><td>0010 0100</td></tr><tr><td>Deassert_INTB</td><td>00100101</td></tr><tr><td>Deassert_INTC</td><td>0010 0110</td></tr><tr><td>Deassert_INTD</td><td>0010 0111</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="402" id="mark-21687470-69ff-49d0-a3d5-ef7388f288a0" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>The rules associated with the delivery of INTx messages are consistent with other message types, but have some unique characteristics. The INTx message rules are summarized below:</div></div></div><div><div><div></div></div></div><div><ul><li>Assert_INTx and Deassert_INTx are only issued in the upstream direction by Legacy Endpoint or Bridge devices. Note that an otherwise native PCI Express endpoint is allowed to send INTx messages prior to its device drivers being loaded, because it is a boot device.</li></ul></div><div><div><div></div></div></div><div><ul><li>Switches must issue INTx messages upstream when there is a change of the "collapsed" interrupt due to one of the downstream ports receiving an assert or deassert message. (See "Collapsing INTx Signals within a Bridge" on page 349.)</li></ul></div><div><div><div></div></div></div><div><ul><li>Devices on either side of a link must track the current state of INTA-INTD assertion.</li></ul></div><div><div><div></div></div></div><div><ul><li>A Switch tracks the state of the four virtual wires for each of its downstream ports, and presents a collapsed set of virtual wires on its upstream port.</li></ul></div><div><div><div></div></div></div><div><ul><li>The Root Complex must track the state of the four virtual wires (A-D) for each downstream port.</li></ul></div><div><div><div></div></div></div><div><ul><li>INTx signaling may be disabled with the Interrupt Disable bit in the Command Register.</li></ul></div><div><div><div></div></div></div><div><ul><li>If any INTx virtual wires are active and device interrupts are then disabled, a corresponding Deassert_INTx message must be sent.</li></ul></div><div><div><div></div></div></div><div><ul><li>If a switch downstream port goes to DL_Down status, any active INTx virtual wires must be deasserted, and the upstream port updated accordingly (Deassert_INTx message required if that INTx was in active state).</li></ul></div><div><div><div></div></div></div><h2><div><div>Devices May Support Both MSI and Legacy Interrupts</div></div></h2><div><div><div></div></div></div><div><div><div>When a PCI Express device supports both INTx messages and MSI, only one of the mechanism will be enabled at any given time. The most likely type of device that would support both capabilities is a boot device. A system in which a boot device resides may not support MSI during the boot sequence. Consequently configuration software will initialize interrupts by loading a Line register value and enabling the device for legacy operation just as is done for PCI devices. Once the OS loads, the device's MSI register set is loaded and the MSI enable bit is set. Setting this bit disables the devices ability to use INTx messages and enables the delivery of MSIs.</div></div></div><div><div><div></div></div></div><div><div><div>Note also that setting the Interrupt Disable bit in the Configuration Command register also inhibits the generation of INTx messages.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="403" id="mark-19853728-fe14-43a8-99b4-d4a4d646ccbc" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Special Consideration for Base System Peripherals</div></div></h2><div><div><div></div></div></div><div><div><div>Interrupts may also originate in embedded legacy hardware, such as an I/O Controller Hub or Super I/O device. Some of the typical legacy devices required in such systems include:</div></div></div><div><div><div></div></div></div><div><ul><li>Serial ports</li></ul></div><div><div><div></div></div></div><div><ul><li>Parallel ports</li></ul></div><div><div><div></div></div></div><div><ul><li>Keyboard and Mouse Controller</li></ul></div><div><div><div></div></div></div><div><ul><li>System Timer</li></ul></div><div><div><div></div></div></div><div><ul><li>IDE controllers</li></ul></div><div><div><div></div></div></div><div><div><div>These devices typically require a very specific IRQ line, which allows legacy software to interact with them correctly.</div></div></div><div><div><div></div></div></div><div><div><div>Using the INTx messages does not guarantee that the devices will receive the IRQ assignment that they require. Many different approaches and strategies may be employed to ensure they get the IRQs required. Following is an example system that supports legacy interrupt assignment.</div></div></div><div><div><div></div></div></div><h2><div><div>Example System</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 9-14 on page 354 illustrates a PCI Express system that includes an existing I/O Controller Hub (ICH) that attaches to the Root Complex via a proprietary link. The interrupt controller that is embedded within the ICH is an IOAPIC that can generate an MSI when it receives an interrupt request at its inputs. In such an implementation, software can assign the legacy vector number to each input, to ensure the correct legacy software is called.</div></div></div><div><div><div></div></div></div><div><div><div>The advantage to this approach is that existing hardware can be used to support the legacy requirements within a PCI Express platform. This system also requires that the MSI subsystem be configured for use during the boot sequence. The example illustrated eliminates the need for INTx messages, unless a PCI Express expansion device incorporates a PCI Express-to-PCI Bridge.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="404" id="mark-e27c27f2-4eba-4662-ac3f-399427aba5c4" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 9-14: PCI Express System with PCI-Based IO Controller Hub</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_413.jpg?x=221&amp;y=412&amp;w=1001&amp;h=903"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="405" id="mark-affd4b93-c3e7-49d1-b2e3-c7d886048442" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h1><div><div>10 Error Detection  and Handling</div></div></h1><div><div><div></div></div></div><h2><div><div>The Previous Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>Native PCI Express devices that require interrupt support must use the Message Signaled Interrupt (MSI) mechanism defined originally in the PCI 2.2 version of the specification. The previous chapter detailed the MSI mechanism and also described the legacy support that permits virtualization of the PCI INTx signals required by devices such as PCI Express-to-PCI Bridges.</div></div></div><div><div><div></div></div></div><h2><div><div>This Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>To this point it has been presumed that transactions traversing the fabric have not encountered any errors that cannot be corrected by hardware. This chapter discusses both correctable and non-correctable errors and discusses the mechanisms used to report them. The PCI Express architecture provides a rich set of error detection, reporting, and logging capabilities. PCI Express error reporting classifies errors into three classes: correctable, non-fatal, and fatal. PCI Express error reporting capabilities include PCI-compatible mechanisms, thus a brief review of the PCI error handling is included as background information.</div></div></div><div><div><div></div></div></div><h2><div><div>The Next Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>The next chapter describes the Logical Physical Layer core logic. It describes how an outbound packet is processed before clocking the packet out differentially. The chapter also describes how an inbound packet arriving from the Link is processed and sent to the Data Link Layer. Sub-block functions of the Physical Layer such as Byte Striping and Un-Striping logic, Scrambler and De-Scrambler, <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="488" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> Encoder and Decoder,Elastic Buffers are discussed,and more.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="406" id="mark-3cc8b976-ef3d-4684-8ac0-751eba70c213" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Background</div></div></h2><div><div><div></div></div></div><div><div><div>The original PCI bus implementation provides for basic parity checks on each transaction as it passes between two devices residing on the same bus. When a transaction crosses a bridge, the bridge is involved in the parity checks at both the originating and destination busses. Any error detected is registered by the device that has detected the error and optionally reported. The PCI architecture provides a method for reporting the following types of errors:</div></div></div><div><div><div></div></div></div><div><ul><li>data parity errors - reported via the PERR# (Parity Error) signal</li></ul></div><div><div><div></div></div></div><div><ul><li>data parity errors during multicast transactions (special cycles) - reported via the SERR# (System Error) signal</li></ul></div><div><div><div></div></div></div><div><ul><li>address and command parity errors - reported via the SERR# signal</li></ul></div><div><div><div></div></div></div><div><ul><li>other types of errors (e.g. device specific) - reported via SERR#</li></ul></div><div><div><div></div></div></div><div><div><div>Errors reported via PERR# are considered potentially recoverable, whereas, errors reported via SERR# are considered unrecoverable. How the errors reported via PERR# are handled is left up to the implementer. Error handling may involve only hardware, device-specific software, or system software. Errors signaled via SERR# are reported to the system and handled by system software. (See MindShare's PCI System Architecture book for details.)</div></div></div><div><div><div></div></div></div><div><div><div>PCI-X uses the same error reporting signals as PCI, but defines specific error handling requirements depending on whether device-specific error handling software is present. If a device-specific error handler is not present, then all parity errors are reported via SERR#.</div></div></div><div><div><div></div></div></div><div><div><div>PCI-X 2.0 adds limited support for Error Correction Codes (ECC) designed to automatically detect and correct single-bit errors within the address or data. (See MindShare's PCI-X System Architecture book for details.)</div></div></div><div><div><div></div></div></div><h2><div><div>Introduction to PCI Express Error Management</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express defines a variety of mechanisms used for checking errors, reporting those errors and identifying the appropriate hardware and software elements for handling these errors.</div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express Error Checking Mechanisms</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express error checking focuses on errors associated with the PCI Express interface and the delivery of transactions between the requester and completer functions. Figure 10-1 on page 357 illustrates the scope of the error checking that</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="407" id="mark-34047977-475b-4138-bd3d-c28e28761acc" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>is the focus of this chapter. Errors within a function that do not pertain to a given transaction are not reported through the error handling procedures defined by the PCI Express specification, and it is recommended that such errors be handled using proprietary methods that are reported via device-specific interrupts. Each layer of the PCI Express interface includes error checking capability as described in the following sections.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 10-1: The Scope of PCI Express Error Checking and Reporting</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_416.jpg?x=319&amp;y=631&amp;w=806&amp;h=835"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="408" id="mark-68cc3b7c-71d6-4ff9-a8b8-f92dbbfe7e2e" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><h2><div><div>Transaction Layer Errors</div></div></h2><div><div><div></div></div></div><div><div><div>The transaction layer checks are performed only by the Requestor and Completer. Packets traversing switches do not perform any transaction layer checks. Checks performed at the transaction layer include:</div></div></div><div><div><div></div></div></div><div><ul><li>ECRC check failure (optional check based on end-to-end CRC)</li></ul></div><div><div><div></div></div></div><div><ul><li>Malformed TLP (error in packet format)</li></ul></div><div><div><div></div></div></div><div><ul><li>Completion Time-outs during split transactions</li></ul></div><div><div><div></div></div></div><div><ul><li>Flow Control Protocol errors (optional)</li></ul></div><div><div><div></div></div></div><div><ul><li>Unsupported Requests</li></ul></div><div><div><div></div></div></div><div><ul><li>Data Corruption (reported as a poisoned packet)</li></ul></div><div><div><div></div></div></div><div><ul><li>Completer Abort (optional)</li></ul></div><div><div><div></div></div></div><div><ul><li>Unexpected Completion (completion does not match any Request pending completion)</li></ul></div><div><div><div></div></div></div><div><ul><li>Receiver Overflow (optional check)</li></ul></div><div><div><div></div></div></div><h2><div><div>Data Link Layer Errors</div></div></h2><div><div><div></div></div></div><div><div><div>Link layer error checks occur within a device involved in delivering the transaction between the requester and completer functions. This includes the requesting device, intermediate switches, and the completing device. Checks performed at the link layer include:</div></div></div><div><div><div></div></div></div><div><ul><li>LCRC check failure for TLPs</li></ul></div><div><div><div></div></div></div><div><ul><li>Sequence Number check for TLP s</li></ul></div><div><div><div></div></div></div><div><ul><li>LCRC check failure for DLLPs</li></ul></div><div><div><div></div></div></div><div><ul><li>Replay Time-out</li></ul></div><div><div><div></div></div></div><div><ul><li>Replay Number Rollover</li></ul></div><div><div><div></div></div></div><div><ul><li>Data Link Layer Protocol errors</li></ul></div><div><div><div></div></div></div><h2><div><div>Physical Layer Errors</div></div></h2><div><div><div></div></div></div><div><div><div>Physical layer error checks are also performed by all devices involved in delivering the transaction, including the requesting device, intermediate switches, and the completing device. Checks performed at the physical layer include:</div></div></div><div><div><div></div></div></div><div><ul><li>Receiver errors (optional)</li></ul></div><div><div><div></div></div></div><div><ul><li>Training errors (optional)</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="409" id="mark-9d3154ff-8493-41f0-8b75-db30f89bb57e" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Error Reporting Mechanisms</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express provides three mechanisms for establishing the error reporting policy. These mechanisms are controlled and reported through configuration registers mapped into three distinct regions of configuration space. (See Figure 10-2 on page 360.) The various error reporting features are enabled as follows:</div></div></div><div><div><div></div></div></div><div><ul><li>PCI-compatible Registers (required) - this error reporting mechanism provides backward compatibility with existing PCI compatible software and is enabled via the PCI configuration Command Register. This approach requires that PCI Express errors be mapped to PCI compatible error registers.</li></ul></div><div><div><div></div></div></div><div><ul><li>PCI Express Capability Registers (required) - this mechanism is available only to software that has knowledge of PCI Express. This required error reporting is enabled via the PCI Express Device Control Register mapped within PCI-compatible configuration space.</li></ul></div><div><div><div></div></div></div><div><ul><li>PCI Express Advanced Error Reporting Registers (optional) - this mechanism involves registers mapped into the extended configuration address space. PCI Express compatible software enables error reporting for individual errors via the Error Mask Register.</li></ul></div><div><div><div></div></div></div><div><div><div>The specification refers to baseline (required) error reporting capabilities and advanced (optional) error reporting capabilities. The baseline error reporting mechanisms require access to the PCI-compatible registers and PCI Express Capability registers (bullets 1 and 2 above), while advanced error reporting (bullet 3) requires access to the Advanced Error Reporting registers that are mapped into extended configuration address space as illustrated in Figure 10-2. This chapter details all error reporting mechanisms.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="410" id="mark-1c0d2763-edeb-4238-93d7-fd74bebcd2d6" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 10-2: Location of PCI Express Error-Related Configuration Registers</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_419.jpg?x=257&amp;y=406&amp;w=935&amp;h=783"></div></div><div><div><div></div></div></div><h2><div><div>Error Handling Mechanisms</div></div></h2><div><div><div></div></div></div><div><div><div>Errors are categorized into three classes that specify the severity of an error as listed below. Note also the specification defines the entity that should handle the error based on its severity:</div></div></div><div><div><div></div></div></div><div><ul><li>Correctable errors - handled by hardware</li></ul></div><div><div><div></div></div></div><div><ul><li>Uncorrectable errors-nonfatal - handled by device-specific software</li></ul></div><div><div><div></div></div></div><div><ul><li>Uncorrectable errors-fatal - handled by system software</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="411" id="mark-58b8a7c5-9d95-4846-afbe-8a5dfaec5ad0" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>By defining errors into these classes, error handling software can be partitioned into separate handlers to perform the actions required for a given platform. The actions taken based on severity of an error might range from monitoring the effects of correctable errors on system performance to simply resetting the system or PCI Express sub-system in the event of a fatal error.</div></div></div><div><div><div></div></div></div><div><div><div>Note that regardless of the severity of a given error, software can establish a policy whereby any error can be reported to the system (via the Root Complex) for the purpose of tracking and logging. (See page 390 for details.)</div></div></div><div><div><div></div></div></div><h2><div><div>Sources of PCI Express Errors</div></div></h2><div><div><div></div></div></div><div><div><div>This section provides a more detailed description of the error checks made by PCI Express interfaces when handling transactions.</div></div></div><div><div><div></div></div></div><h2><div><div>ECRC Generation and Checking</div></div></h2><div><div><div></div></div></div><div><div><div>ECRC generation and checking is optional and only supported by devices and systems that implement Advanced Error Reporting. Devices that support ECRC must implement the Advanced Error Capabilities and Control Register. Configuration software checks this register to determine if ECRC is supported, and to enable ECRC support.</div></div></div><div><div><div></div></div></div><div><div><div>A PCI Express device that originates a transaction (Request or Completion) can create and append a 32-bit CRC (within the digest field) that covers the header and data portions of the transaction. This CRC is termed end-to-end (ECRC) and is typically checked and reported by the ultimate recipient of the transaction. Switches in the path between the originating and receiving devices may optionally check and report ECRC errors, or merely forward the packet without checking the ECRC. If a Switch detects an ECRC error it must still forward the packet unaltered as it would any other packet. Switches may also be the originator or recipient of a transaction in which case they can participate in ECRC generation and checking in this role.</div></div></div><div><div><div></div></div></div><div><div><div>The actions taken when an ECRC error is detected is considered beyond the scope of the specification. However, the possible actions taken will likely depend on whether the ECRC error occurs in a Request or Completion:</div></div></div><div><div><div></div></div></div><div><ul><li>ECRC in Request - completers that detect an ECRC error may simply drop the transaction without forwarding it to the receiving function and as a result not return a completion. This ultimately will result in a completion time-out within the requesting device. The requester could then reschedule the transaction under software control.</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="412" id="mark-190a2e9d-d4a4-4d32-9557-2b1dba02284b" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><ul><li>ECRC in Completion - requesters that detect an ECRC error may drop the packet and report the error to the function's device driver via a function-specific interrupt. The driver would check the status bits in the Uncorrectable Error Status Register to detect the nature of the error and potentially reschedule the transaction in the event that a prefetchable address location was being accessed.</li></ul></div><div><div><div></div></div></div><div><div><div>Note that ECRC errors may also result in error messages being sent to the host for handling or logging.</div></div></div><div><div><div></div></div></div><h2><div><div>Data Poisoning (Optional)</div></div></h2><div><div><div></div></div></div><div><div><div>Data poisoning provides a way of indicating that data associated with a transaction is corrupted. When a TLP is received that contains a data field, the recipient will know that data is corrupted if the poisoned bit is set. Figure 10-3 illustrates the Error/Poisoned bit (EP) located within the first Dword of a packet.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 10-3: The Error/Poisoned Bit within Packet Headers</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_421.jpg?x=224&amp;y=943&amp;w=987&amp;h=221"></div></div><div><div><div></div></div></div><div><div><div>The specification includes three examples of data corruption that could result in data poisoning being used. In each of these cases, the error can be forwarded to the recipient via the data poisoning bit in the transaction header.</div></div></div><div><div><div></div></div></div><div><ul><li>When a Requester wishes to perform a Memory Write transaction it must first fetch the data it wishes to send to the completer from local memory. In the event of a parity error when reading the data, the data can be marked as poisoned.</li></ul></div><div><div><div></div></div></div><div><ul><li>When a Completer must return data in response to a Memory Read request, the data it fetches from memory may incur a parity error.</li></ul></div><div><div><div></div></div></div><div><ul><li>Data that is stored in a cache or buffer that has error checking may also result in data corruption being detected. The specification does not indicate where these caches or buffers may be located, but it is conceivable that any device that originates a transaction or forwards it may indicate that the data has been poisoned.</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="413" id="mark-ec069287-84bd-408d-a0c5-f9c903496732" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>The specification states that data poisoning applies to data associated with both posted and non-posted writes and read completions. Therefore data poisoning can be used in conjunction with Memory, I/O, and Configuration transactions that have a data payload.</div></div></div><div><div><div></div></div></div><div><div><div>Data poisoning can only be done at the transaction layer of a device. The link layer does not process or in any way affect the contents of the TLP header. The transaction layer indicates that data is corrupted by setting the Data Error/Poisoned bit <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="489" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c45"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c50"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">E</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">P</mi></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> in the Write request or Read Completion transaction header.</div></div></div><div><div><div></div></div></div><div><div><div>Data poisoning errors are enabled and reported via the Uncorrectable Error Registers.</div></div></div><div><div><div></div></div></div><h2><div><div>TC to VC Mapping Errors</div></div></h2><div><div><div></div></div></div><div><div><div>All PCI Express ports that implement the extended VC capability (endpoints, switches, and root ports) must check to verify that the TC of each inbound packet is mapped to an active VC. Packets with TC's that fail this check are treated as malformed TLPs. Similarly, when switches forward packets, they must also verify that the target outbound port of the switch also supports the packet's TC. If not, the packet is treated as a malformed TLP.</div></div></div><div><div><div></div></div></div><div><div><div>A requester or completer may implement more than one Virtual Channel (VC) and enable more than one Traffic Class (TC). If the device core issues a request to send a transaction with a TC number that is not enabled (pointing to an active VC) within the TC to VC mapping tables, the transaction is rejected and a malformed TLP is indicated. If the device has implemented the PCI Express Virtual Channel Capability structure (supports multiple VCs and/or TC filtering), then the malformed TLP error is detected at the transmitting device. However, if the device only supports the default TC0/VC0 configuration, then this error would be detected at the first receiving device along the packet's path that implements the extended VC capability and applies TC filtering.</div></div></div><div><div><div></div></div></div><div><div><div>Note also that the TC to VC mapping is a transaction layer function. (See "Assigning TCs to each VC - TC/VC Mapping" on page 262 for details).</div></div></div><div><div><div></div></div></div><h2><div><div>Link Flow Control-Related Errors</div></div></h2><div><div><div></div></div></div><div><div><div>Prior to forwarding the packet to the link layer for transmission across the link, the transaction layer must check flow control credits to ensure that the receive buffers in the adjacent node (switch or completer) have sufficient room to hold PCI Express System Architecture</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="414" id="mark-4de4a2fa-e466-4381-9e01-972065b72fdd" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>the transaction. Flow control protocol errors may occur that will likely prevent transactions from being sent. These errors can be reported to the Root Complex and are considered uncorrectable. The uncorrectable error registers are used to enable and check status for Flow Control (FC) errors. The specification does not require that these errors be checked and reported.</div></div></div><div><div><div></div></div></div><div><div><div>All five conditions that cause flow control related errors (flow control protocol errors and receiver overflow errors) are detected by and associated with the port receiving the flow control information. These error conditions are:</div></div></div><div><div><div></div></div></div><div><ul><li>The specification defines the minimum credit size that can be initially reported for each Flow Control type. During FC initialization for any Virtual Channel, if a receiver fails to advertise VC credit value equal to or greater than those permitted, it is considered an FC protocol error.</li></ul></div><div><div><div></div></div></div><div><ul><li>The maximum number of data payload credits that can be reported is restricted to 2048 unused credits and 128 unused credits for headers. Exceeding these limits is considered an FC protocol error.</li></ul></div><div><div><div></div></div></div><div><ul><li>During FC initialization receivers are allowed to report infinite FC credits. FC updates are required following initialization. FC updates are allowed providing that the credit value field is set to zero, which is ignored by the recipient. If the data field contains any value other than zero, it is considered an FC protocol error.</li></ul></div><div><div><div></div></div></div><div><ul><li>During FC initialization either the Data or header FC advertisement (but not both) for a given FC type may be infinite. FC update packets are required to report credits for the buffer that advertised limited FC credits. However the update credit value for the buffer advertised as infinite must be set to zero and ignored by the receiver. A non-zero credit value could cause an FC protocol error.</li></ul></div><div><div><div></div></div></div><div><ul><li>A specific check can be made at the receiving port to determine if a flow control receive buffer has overflowed, resulting in lost data. This check is optional and considered an FC protocol error.</li></ul></div><div><div><div></div></div></div><div><div><div>Flow Control Protocol errors are reported as uncorrectable errors, if supported and enabled.</div></div></div><div><div><div></div></div></div><h2><div><div>Malformed Transaction Layer Packet (TLP)</div></div></h2><div><div><div></div></div></div><div><div><div>When the ultimate recipient of a transaction receives a request or completion packet into the transaction layer, the packet format is checked for violations of the TLP formatting rules. The specification defines the following items that cause a malformed packet:</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="415" id="mark-187b3c86-3788-4101-a6d9-1094a2cc1534" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><ul><li>Data payload exceeds Max payload size.</li></ul></div><div><div><div></div></div></div><div><ul><li>The actual data length does not match data length specified in the header.</li></ul></div><div><div><div></div></div></div><div><ul><li>Start Memory DW address and length field results in the transaction crossing a <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="490" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c><mjx-c class="mjx-c42"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>4</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">KB</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> boundary.</li></ul></div><div><div><div></div></div></div><div><ul><li>TD field <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="491" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container> (indicating Digest included) but no digest field is present.</li></ul></div><div><div><div></div></div></div><div><ul><li>Byte Enable violation detected.</li></ul></div><div><div><div></div></div></div><div><ul><li>Packets which use an undefined Type field values.</li></ul></div><div><div><div></div></div></div><div><ul><li>Multiple completion packets are used to send read data back to the requester and the data size returned in any of the completion packets violates the Read Completion Boundary (RCB) value.</li></ul></div><div><div><div></div></div></div><div><ul><li>Completions with a Configuration Request Retry Status in response to a Request other than a Configuration Request.</li></ul></div><div><div><div></div></div></div><div><ul><li>Traffic Class field (TC) contains a value not assigned to an enabled Virtual Channel (VC) within the TC - VC mapping for the receiving device.</li></ul></div><div><div><div></div></div></div><div><ul><li>Transaction type requiring use of TC0 has TC value other than zero:</li></ul></div><div><div><div></div></div></div><div><div><div>o I/O Read or Write requests and completions</div></div></div><div><div><div></div></div></div><div><div><div>) Configuration Read or Write requests and completions</div></div></div><div><div><div></div></div></div><div><div><div>o Error messages</div></div></div><div><div><div></div></div></div><div><div><div>o INTx messages</div></div></div><div><div><div></div></div></div><div><div><div>o Power Management messages</div></div></div><div><div><div></div></div></div><div><div><div>o Unlock messages</div></div></div><div><div><div></div></div></div><div><div><div>o Slot Power messages</div></div></div><div><div><div></div></div></div><div><ul><li>Routing is incorrect for transaction type (e.g., transactions requiring routing to Root Complex detected moving away from Root Complex).</li></ul></div><div><div><div></div></div></div><h2><div><div>Split Transaction Errors</div></div></h2><div><div><div></div></div></div><div><div><div>A variety of failures can occur during a split transaction. When a transaction request is sent to a destination device a completion transaction is expected in response (except for Memory Write and Message transactions which are posted transactions). The various failure modes that can occur are discussed in the following sections.</div></div></div><div><div><div></div></div></div><h2><div><div>Unsupported Request</div></div></h2><div><div><div></div></div></div><div><div><div>When a recipient of a transaction request detects that it does not support this transaction, it returns a completion transaction with unsupported request (UR) specified in the completion status field. The specification defines a number of specific conditions that cause UR to be returned in the completion status field:</div></div></div><div><div><div></div></div></div><div><ul><li>Request type not supported.</li></ul></div><div><div><div></div></div></div><div><ul><li>Message request received with unsupported or undefined message code.</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="416" id="mark-03496291-d049-499d-b9e6-7cad7b21351b" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><ul><li>Request does not reference address space mapped within device.</li></ul></div><div><div><div></div></div></div><div><ul><li>Request contains an address that cannot be routed to any egress port of a bridge or a switch (i.e., address is not mapped to any port's base and limit registers).</li></ul></div><div><div><div></div></div></div><div><ul><li>Poisoned Write Request addresses an I/O or Memory mapped control space in the Completer. Such transactions must be discarded by the Completer and reported as a UR.</li></ul></div><div><div><div></div></div></div><div><ul><li>PCI Express endpoint device receives a MRdLk (lock) transaction. (Recall that lock is not supported by endpoint devices.)</li></ul></div><div><div><div></div></div></div><div><ul><li>The downstream port of the Root Complex or Switch receives a configuration request with a Device number of 1-31. The port must terminate the transaction and not initiate a configuration transaction on the downstream link. Instead a completion transaction is returned with UR status.</li></ul></div><div><div><div></div></div></div><div><ul><li>A configuration access that targets an un-implemented Bus, Dev, or Function results in termination of the transaction, and a completion transaction is returned with UR status.</li></ul></div><div><div><div></div></div></div><div><ul><li>Type 1 configuration request received at endpoint.</li></ul></div><div><div><div></div></div></div><div><ul><li>A completion is received at the requester with a reserved completion code. This must be interpreted as a UR.</li></ul></div><div><div><div></div></div></div><div><ul><li>A function is in the D1 or D2 power management states and a request other than a configuration request is received.</li></ul></div><div><div><div></div></div></div><div><ul><li>A configuration access that targets a bus that is not in the range of buses downstream of that port according to the secondary and subordinate register values.</li></ul></div><div><div><div></div></div></div><div><ul><li>A configuration request passing through a PCI Express - PCI Bridge for which the Extended Register Address field is non-zero that is directed toward a PCI bus that does not support Extended Configuration Space.</li></ul></div><div><div><div></div></div></div><div><ul><li>A transaction headed for a port with the Reject Snoop Transactions field set in the VC Resource Capability register that does not have the No Snoop bit set in the TLP header.</li></ul></div><div><div><div></div></div></div><div><ul><li>A transaction is targeting a device on a PCI bus but is Master Aborted after the request was accepted by the bridge.</li></ul></div><div><div><div></div></div></div><h2><div><div>Completer Abort</div></div></h2><div><div><div></div></div></div><div><div><div>These type of error checks are optional. Three circumstances can occur that could result in a Completer returning an abort to the Requester:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">A Completer receives a request that it cannot complete because the request violates the programming rules for the device. As an example, some devices may be designed to permit access to a single location within a specific DWord, while any attempt to access the other locations within the same DWord would fail. Such restrictions are not violations of the specification,</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="417" id="mark-91cf15bf-325d-46e2-8b0d-c5184f243edb" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>but rather legal restrictions associated with an implementation-specific programming interface for this function. Accesses to such devices are based upon the expectation that only the device-driver for this device understands how to access its function.</div></div></div><div><div><div></div></div></div><div><ol><li value="2">A completer receives a request that it cannot process because of some permanent error condition associated with the device. For example, a PCI Express wireless LAN card that is not accepting PCI Express transactions because it will not transmit or receive data over its radio unless there is an approved antenna attached.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">A PCI Express to PCI Bridge may receive a request that targets a PCI or PCI- <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="492" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c58"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">X</mi></mrow></math></mjx-assistive-mml></mjx-container> bus. These buses support a signaling convention that allows the target device to indicate that it has aborted the request (target abort) because it cannot complete the request due to some permanent condition or violation of the function's programming rules. The bridge in turn would return a PCI Express completion transaction indicating CA status.</li></ol></div><div><div><div></div></div></div><div><div><div>A Completer that aborts a request may report the error to the Root Complex as a Non-Fatal Error message. Further, if the aborted request requires a completion, the completion status would be reported as CA.</div></div></div><div><div><div></div></div></div><h2><div><div>Unexpected Completion</div></div></h2><div><div><div></div></div></div><div><div><div>A completion transaction that arrives at a Requester uses the transaction descriptor (Requester ID and Tag) to match the request to which this completion applies. In rare circumstances the transaction descriptor may not match a request that is pending completion. The typical reason for this unexpected completion is that the completion was mis-routed on its journey back to the intended requester. Consequently, two requesters will be surprised:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">the requester that has received the unexpected completion, and</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">the requester that fails to receive the completion (thereby causing a completion time-out)</li></ol></div><div><div><div></div></div></div><div><div><div>A Non-Fatal Error message can be sent by the device that receives the unexpected completion.</div></div></div><div><div><div></div></div></div><h2><div><div>Completion Time-out</div></div></h2><div><div><div></div></div></div><div><div><div>The previous discussion points out that a completion transaction can be routed to the wrong device. Consequently, the pending request will never receive its completion. The specification defines the completion time-out mechanism to identify this situation and report the error to requester software for possible recovery. The specification clearly defines that the intent of the completion time-</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="418" id="mark-f41769cc-3af8-4f93-8183-9530fb47cf86" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>out is to detect when a completion has no reasonable chance of returning and not related to expected latencies associated with split transactions.</div></div></div><div><div><div></div></div></div><div><div><div>The completion time-out mechanism must be implemented by any device that initiates requests that require completions to be returned. An exception is allowed for devices that only initiate configuration transactions. The specification defines the permissible range of the time-out value as follows:</div></div></div><div><div><div></div></div></div><div><ul><li>It is strongly recommended that a device not time-out earlier than <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="493" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">ms</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> after sending a request; however, if the device requires greater granularity a time-out can occur as early as <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="494" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D707 TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>50</mn><mi>μ</mi></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> .</li></ul></div><div><div><div></div></div></div><div><ul><li>Devices must time-out no later than <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="495" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>50</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">ms</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> .</li></ul></div><div><div><div></div></div></div><div><div><div>Note that for Memory Read requests a request may require two or more completions to return all of the requested data. All of the data must be returned prior to the time-out. If some but not all of the data has been returned when the time-out occurs, the requester may either discarded or keep the data.</div></div></div><div><div><div></div></div></div><h2><div><div>Error Classifications</div></div></h2><div><div><div></div></div></div><div><div><div>Errors are categorized into three classes that specify the severity of an error as listed below. Note also the specification defines the entity that should handle the error based on its severity:</div></div></div><div><div><div></div></div></div><div><ul><li>Correctable errors - handled by hardware</li></ul></div><div><div><div></div></div></div><div><ul><li>Uncorrectable errors-nonfatal - handled by device-specific software</li></ul></div><div><div><div></div></div></div><div><ul><li>Uncorrectable errors-fatal - handled by system software</li></ul></div><div><div><div></div></div></div><div><div><div>By defining errors into these classes, error handling software can be partitioned into separate handlers to perform the actions required of a given platform. The actions taken based on severity of an error might range from monitoring the effects of correctable errors on system performance to simply resetting the system in the event of a fatal error.</div></div></div><div><div><div></div></div></div><div><div><div>Note that regardless of the severity of a given error, software can establish a policy whereby the system is notified of all errors for the purpose of tracking and logging each category.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="419" id="mark-9549b43d-fcbc-40db-9963-db7ec18b30c9" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Correctable Errors</div></div></h2><div><div><div></div></div></div><div><div><div>The specification defines correctable errors as those errors that are corrected solely by hardware. Such errors may have an impact on performance (i.e., latency and bandwidth), but no information is lost as a result of the error. These types of error can be reported to software, which can take a variety of actions, Including:</div></div></div><div><div><div></div></div></div><div><ul><li>log the error</li></ul></div><div><div><div></div></div></div><div><ul><li>update calculations of PCI Express performance</li></ul></div><div><div><div></div></div></div><div><ul><li>track errors to project possible weaknesses within the fabric. This can suggest areas where greater potential exists for fatal errors in the future.</li></ul></div><div><div><div></div></div></div><h2><div><div>Uncorrectable Non-Fatal Errors</div></div></h2><div><div><div></div></div></div><div><div><div>Non-fatal errors mean that the integrity of the PCI Express fabric is not affected, but that information has been lost. Non-fatal errors typically mean that a transaction has been corrupted, and the PCI Express hardware cannot correct the error. However, the PCI Express fabric continues to function correctly and other transactions are unaffected. Recovery from a non-fatal error may or may not be possible. The possibility of recovery rests in the hands of the device-specific software associated with the requester that initiated the transaction.</div></div></div><div><div><div></div></div></div><h2><div><div>Uncorrectable Fatal Errors</div></div></h2><div><div><div></div></div></div><div><div><div>Fatal errors indicate that a link in the PCI Express fabric is no longer reliable. Data has been lost and every attempt to recover data under software control will likely fail also. Such conditions affect all transactions that traverse a given link. In some cases, the error condition leading to the fatal errors may be resolved by resetting the link. Alternatively, the specification invites implementation-specific approaches, in which software may attempt to limit the effects of the failure. The specification does not define any particular actions that should or could be taken by software.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="420" id="mark-af4ed5dc-ec09-431d-aed2-9a337464a0f3" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><h2><div><div>How Errors are Reported</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express includes two methods of reporting errors:</div></div></div><div><div><div></div></div></div><div><ul><li>error message transactions - used to report errors to the host</li></ul></div><div><div><div></div></div></div><div><ul><li>completion status - used by the completer to report errors to the requester</li></ul></div><div><div><div></div></div></div><div><div><div>Each reporting mechanism is described below.</div></div></div><div><div><div></div></div></div><h2><div><div>Error Messages</div></div></h2><div><div><div></div></div></div><div><div><div>As discussed previously, PCI reports errors via the PERR# and SERR# signals. Because PCI Express eliminates theses error-related signals, error messages have been defined to replace these signals by acting as virtual wires. Furthermore, these messages provide additional information that could not be conveyed directly via the PERR# and SERR# signals. This includes identification of the device that detected the error and an indication of the severity of each error.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 10-4 illustrates the format of the error messages. Note that these packets are routed to the Root Complex for handling by system software. The message code defines the type of message being signaled. As one might guess, the specification defines three basic types of error messages shown in Table 10-1.</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_429.jpg?x=224&amp;y=1173&amp;w=985&amp;h=397"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="421" id="mark-cf0491e6-de43-4453-8fd9-7c38d947e509" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 10-1: Error Message Codes and Description</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Message Code</th><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>30h</td><td>ERR_COR</td><td>used when a PCI Express device detects a cor- rectable error</td></tr><tr><td>31h</td><td>ERR_NONFATAL</td><td>used when a device detects a non-fatal, uncor- rectable error</td></tr><tr><td>33h</td><td>ERR_FATAL</td><td>used when a device detects a fatal, uncorrect- able error</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>Completion Status</div></div></h2><div><div><div></div></div></div><div><div><div>PCI Express defines a completion status field within the completion header that enables the transaction completer to report errors back to the requester. Figure 10-5 illustrates the location of the completion field and Table 10-2 defines the completion values. Note that the shaded status entries represent error conditions that can be reported via error messages.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 10-5: Completion Status Field within the Completion Header</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_430.jpg?x=225&amp;y=1153&amp;w=987&amp;h=319"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="422" id="mark-4f86e324-26b2-4ad1-a972-22c0677d4085" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 10-2: Completion Code and Description</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Status Code</th><th>Completion Status Definition</th></tr></thead><tbody><tr><td>000b</td><td>Successful Completion (SC)</td></tr><tr><td>001b</td><td>Unsupported Request (UR)</td></tr><tr><td>010b</td><td>Configuration Request Retry Status (CRS)</td></tr><tr><td>011b</td><td>Completer Abort (CA)</td></tr><tr><td>100b - 111b</td><td>Reserved</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>Baseline Error Detection and Handling</div></div></h2><div><div><div></div></div></div><div><div><div>This section defines the required support for detecting and reporting PCI Express errors. Each PCI Express compliant devices must include:</div></div></div><div><div><div></div></div></div><div><ul><li>PCI-Compatible support - required to support operating environments that have no knowledge of PCI Express.</li></ul></div><div><div><div></div></div></div><div><ul><li>PCI Express Error reporting - available to operating environments that do have knowledge of PCI Express.</li></ul></div><div><div><div></div></div></div><h2><div><div>PCI-Compatible Error Reporting Mechanisms</div></div></h2><div><div><div></div></div></div><div><div><div>Each PCI Express must map required PCI Express error support to the PCI-related error registers. This involves enabling error reporting and setting status bits that can be read by PCI-compliant software. To understand the features available from the PCI-compatible point of view consider the error-related bits of the Command and Status registers located within the Configuration header. While the command and status register bits have the PCI name, some of the field definitions have been modified to reflect the related PCI Express error conditions and reporting mechanisms. The PCI Express errors tracked by the PCI-compatible registers are:</div></div></div><div><div><div></div></div></div><div><ul><li>Transaction Poisoning/Error Forwarding (optional)</li></ul></div><div><div><div></div></div></div><div><ul><li>Completer Abort (CA) detected by a completer</li></ul></div><div><div><div></div></div></div><div><ul><li>Unrecognizable Request (UR) detected by a completer</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="423" id="mark-7c2d13f0-fc12-4904-912f-a5c0d106182b" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 10: Error Detection and Handling</div></div></h2><div><div><div></div></div></div><div><div><div>The PCI mechanism for reporting errors is the assertion of PERR# (data parity errors) and SERR# (unrecoverable errors). The PCI Express mechanisms for reporting these events are via the split transaction mechanism (transaction completions) and virtual SERR# signaling via error messages.</div></div></div><div><div><div></div></div></div><h2><div><div>Configuration Command and Status Registers</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 10-6 illustrates the command register and the location of the error-related fields. These bits are set to enable baseline error reporting under control of PCI-compatible software. Table 10-3 defines the specific effects of each bit.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 10-6: PCI-Compatible Configuration Command Register</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_432.jpg?x=222&amp;y=733&amp;w=993&amp;h=620"></div></div><div><div><div></div></div></div><div><div><div>Table 10-3: Error-Related Command Register Bits</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>SERR# Enable</td><td>Setting this bit (1) enables the generation of the appropriate PCI Express error messages to the Root Complex. Error messages are sent by the device that has detected either a fatal or non-fatal erro</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="424" id="mark-1d63a538-aa01-4ddc-8703-99e9158ad988" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 10-3: Error-Related Command Register Bits (Continued)</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>Parity Error Response</td><td>This bit enables poisoned TLP reporting. This error is typically reported as an Unsupported Request (UR) and may also result in <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="496" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></mjx-assistive-mml></mjx-container> non-fatal error message if SERR# enable=1b. Note that reporting in some cases is device-specific.</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div>Figure 10-7 illustrates the configuration status register and the location of the error-related bit fields. Table 10-4 on page 374 defines the circumstances under which each bit is set and the actions taken by the device when error reporting is enabled.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 10-7: PCI-Compatible Status Register (Error-Related Bits)</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_433.jpg?x=226&amp;y=818&amp;w=989&amp;h=532"></div></div><div><div><div></div></div></div><div><div><div>Table 10-4: Description of PCI-Compatible Status Register Bits for Reporting Errors</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Error-Related Bit</th><th>Description</th></tr></thead><tbody><tr><td>Detected Parity Error</td><td>Set by the interface that receives a Write Request or Read Completion transaction with the poisoned bit se This action pertains to the requestors, completers, and switches. (This bit is updated regardless of the state of the Parity Error enable bit.)</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="425" id="mark-50294590-b853-49f7-866a-7cb242211dbc" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 10-4: Description of PCI-Compatible Status Register Bits for Reporting Errors</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Error-Related Bit</th><th>Description</th></tr></thead><tbody><tr><td>Signalled System Error</td><td>This bit is set by a device that has detected an uncorrect- able error and reported it via an error message (requires SERR# enable bit to be set in the Command register to send error message).</td></tr><tr><td>Received Master Abort</td><td>Set by a requester that receives a completion transaction with Unsupported Request (UR) in the completion sta- tus field.</td></tr><tr><td>Received Target Abort</td><td>Set by a requester that receives a completion transaction with Completer Abort (CA) in the completion status field.</td></tr><tr><td>Signalled Target Abort</td><td>Set by a completer when aborting a request that violates the device’s programming rules.</td></tr><tr><td>Master Data Parity Error</td><td>Set by a transmitter that initiates or forwards a transac- tion with the poisoned bit set and to a receiver device that received a completion with the poisoned bit set. This bit is set by a device that either: - receives a completion packet that has been poisoned - transmits a write packet that has been poisoned</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>PCI Express Baseline Error Handling</div></div></h2><div><div><div></div></div></div><div><div><div>The Baseline capability also requires use of the PCI Express capability registers. These registers include error detection and handling bit fields that provide finer granularity regarding the nature of an error that is supplied with standard PCI error handling.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 10-8 on page 376 illustrates the PCI Express capability register set. These registers provide support for:</div></div></div><div><div><div></div></div></div><div><ul><li>Enabling/disabling error reporting (Error Message Generation)</li></ul></div><div><div><div></div></div></div><div><ul><li>Providing error status</li></ul></div><div><div><div></div></div></div><div><ul><li>Providing status for link training errors</li></ul></div><div><div><div></div></div></div><div><ul><li>Initiating link re-training</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="426" id="mark-56858b23-6bba-46cc-827f-79f21549806a" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 10-8: PCI Express Capability Register Set</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_435.jpg?x=230&amp;y=462&amp;w=985&amp;h=525"></div></div><div><div><div></div></div></div><h2><div><div>Enabling/Disabling Error Reporting</div></div></h2><div><div><div></div></div></div><div><div><div>The Device Control and Device Status registers permit software to enable generation of Error Messages for four error-related events and to check status information to determine which type of error has been detected:</div></div></div><div><div><div></div></div></div><div><ul><li>Correctable Errors</li></ul></div><div><div><div></div></div></div><div><ul><li>Non-Fatal Errors</li></ul></div><div><div><div></div></div></div><div><ul><li>Fatal Errors</li></ul></div><div><div><div></div></div></div><div><ul><li>Unsupported Request Errors</li></ul></div><div><div><div></div></div></div><div><div><div>Note that the only specific type of error condition identified is the unsupported request (UR). No granularity is provided for determining other types of error conditions that occur. Only the classification of the error is reported within the device status register. Table 10-5 on page 377 lists each error type and its associated error classification.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="427" id="mark-3ebf6348-b269-4df5-a88e-581d1b10838d" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Table 10-5: Default Classification of Errors</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Classification</th><th>Name of Error</th><th>Layer Detected</th></tr></thead><tbody><tr><td>Correctable</td><td>Receiver Error</td><td>Physical</td></tr><tr><td>Correctable</td><td>Bad TLP</td><td>Link</td></tr><tr><td>Correctable</td><td>Bad DLLP</td><td>Link</td></tr><tr><td>Correctable</td><td>Replay Time-out</td><td>Link</td></tr><tr><td>Correctable</td><td>Replay Number Rollover</td><td>Link</td></tr><tr><td>Uncorrectable - Non Fatal</td><td>Poisoned TLP Received</td><td>Transaction</td></tr><tr><td>Uncorrectable - Non Fatal</td><td>ECRC Check Failed</td><td>Transaction</td></tr><tr><td>Uncorrectable - Non Fatal</td><td>Unsupported Request</td><td>Transaction</td></tr><tr><td>Uncorrectable - Non Fatal</td><td>Completion Time-out</td><td>Transaction</td></tr><tr><td>Uncorrectable - Non Fatal</td><td>Completion Abort</td><td>Transaction</td></tr><tr><td>Uncorrectable - Non Fatal</td><td>Unexpected Completion</td><td>Transaction</td></tr><tr><td>Uncorrectable - Fatal</td><td>Training Error</td><td>Physical</td></tr><tr><td>Uncorrectable - Fatal</td><td>DLL Protocol Error</td><td>Link</td></tr><tr><td>Uncorrectable - Fatal</td><td>Receiver Overflow</td><td>Transaction</td></tr><tr><td>Uncorrectable - Fatal</td><td>Flow Control Protocol Error</td><td>Transaction</td></tr><tr><td>Uncorrectable - Fatal</td><td>Malformed TLP</td><td>Transaction</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div>Enabling Error Reporting - Device Control Register. Setting the corresponding bit in the Device Control Register enables the generation of the corresponding Error Message which reports errors associated with each classification. (Refer to Figure 10-9 on page 378.) Unsupported Request errors are specified as Non-Fatal errors and are reported via a Non-Fatal Error Message, but only when the UR Reporting Enable bit is set.</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="428" id="mark-8c88a02f-fb78-45fb-98d1-09928cf7ff4b" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Figure 10-9: Device Control Register Bit Fields Related to Error Handling</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_437.jpg?x=219&amp;y=402&amp;w=1000&amp;h=606"></div></div><div><div><div></div></div></div><div><div><div>Error Status — Device Status Register. See Figure 10-10 on page 379. An error status bit is set any time an error associated with its classification is detected. These bits are set irrespective of the setting of the Error Reporting Enable bits within the Device Control Register. Because Unsupported Request errors are by default considered Non-Fatal Errors, when these errors occur both the Non-Fatal Error status bit and the Unsupported Request status bit will be set. Note that these bits are cleared by software when writing a one (1) to the bit field.</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="429" id="mark-dfa04c16-b701-45b6-b402-1ad7fbaa6f62" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Chapter 10: Error Detection and Handling</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 10-10: Device Status Register Bit Fields Related to Error Handling</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_438.jpg?x=227&amp;y=406&amp;w=991&amp;h=559"></div></div><div><div><div></div></div></div><h2><div><div>Link Errors</div></div></h2><div><div><div></div></div></div><div><div><div>The physical link connecting two devices may fail causing a variety of errors. Link failures are typically detected within the physical layer and communicated to the Data Link Layer. Because the link has incurred errors, the error cannot be reported to the host via the failed link. Therefore, link errors must be reported via the upstream port of switches or by the Root Port itself. Also the related fields in the PCI Express Link Control and Status registers are only valid in Switch and Root downstream ports (never within endpoint devices or switch upsteam ports). This permits system software to access link-related error registers on the port that is closest to the host.</div></div></div><div><div><div></div></div></div><div><div><div>If software can isolate one or more errors to a given link, one method of attempting to clear a non-correctable error is to retrain the link. The Link Control Register includes a bit that when set forces the Root or Switch port to retrain the link. If transaction (upon completion of the retraining) can once again traverse the link without errors, the problem will have been solved. Figure 10-11 illustrates the Link Control Register and highlights the Retrain Link field that software sets to initiate retaining.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="430" id="mark-d69d7ea1-a4ef-45c4-a992-2e90c472c713" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 10-11: Link Control Register Allows Retraining of Link</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_439.jpg?x=221&amp;y=407&amp;w=998&amp;h=536"></div></div><div><div><div></div></div></div><div><div><div>Software can monitor the Link Training bit in the Link Status Register to determine when retraining has completed. Software can also check the Link Training Error bit to verify that link training was successful. Link Training errors are reported via the Fatal Error Message. Figure 10-12 highlights these status bits.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 10-12: Link Retraining Status Bits within the Link Status Register</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_439.jpg?x=259&amp;y=1188&amp;w=928&amp;h=479"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="431" id="mark-54cc9ae8-38ac-4a49-8301-ae8b7c1595e6" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Chapter 10: Error Detection and Handling</div></div></h2><div><div><div></div></div></div><h2><div><div>Root's Response to Error Message</div></div></h2><div><div><div></div></div></div><div><div><div>When a message is received by the Root Complex the action that it takes when reporting the error message to the host system is determined in part by the Root Control Register settings. Figure 10-13 depicts this register and highlights the three bit fields that specify whether an error should be reported as a fatal System Error (SERR set enables generation of a system error). In x86 systems it is likely that a Non-Maskable Interrupt (NMI) will be signaled if the error is to be reported as a SERR.</div></div></div><div><div><div></div></div></div><div><div><div>The PME Interrupt Enable bit (3) allows software to enable and disable interrupt generation upon the Root Complex detecting a PME Message transaction.</div></div></div><div><div><div></div></div></div><div><div><div>Other options for reporting error messages are not configurable via standard registers. The most likely scenario is that a system interrupt will be signaled to the processor that will call an Error Handler, which may attempt to clear the error condition and/or simply log the error.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 10-13: Root Control Register</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_440.jpg?x=299&amp;y=933&amp;w=852&amp;h=528"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="432" id="mark-a65d0b7d-756f-48fc-ad9a-eb42cd8c6cc1" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Advanced Error Reporting Mechanisms</div></div></h2><div><div><div></div></div></div><div><div><div>Advanced Error Reporting requires implementation of the Advanced Error Reporting registers illustrated in Figure 10-14 on page 382. (Note that the lighter fields at the bottom of the Capability register diagram are used only for root ports, discussed later.) These registers provide several additional error reporting features:</div></div></div><div><div><div></div></div></div><div><ul><li>finer granularity in defining the actual type of error that has occurred within each classification.</li></ul></div><div><div><div></div></div></div><div><ul><li>ability to specify the severity of each uncorrectable error type to determine whether it should be reported as a fatal or non-fatal error.</li></ul></div><div><div><div></div></div></div><div><ul><li>support for logging errors.</li></ul></div><div><div><div></div></div></div><div><ul><li>enable/disable Root Complex to report errors to the system.</li></ul></div><div><div><div></div></div></div><div><ul><li>identify source of the error.</li></ul></div><div><div><div></div></div></div><div><ul><li>ability to mask reporting individual types of errors.</li></ul></div><div><div><div></div></div></div><div><div><div>Figure 10-14: Advanced Error Capability Registers</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_441.jpg?x=217&amp;y=944&amp;w=1005&amp;h=722"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="433" id="mark-73311f32-44c9-42ab-8641-d3ec70ec5480" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>ECRC Generation and Checking</div></div></h2><div><div><div></div></div></div><div><div><div>End-to-End CRC (ECRC) generation and checking can be enabled only if the Advanced Error Reporting Capability registers are implemented. Specifically, the Advanced Error Capability and Control register provides control over ECRC generation and checking as illustrated in Figure 10-15 on page 383.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 10-15: The Advanced Error Capability &amp; Control Register</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_442.jpg?x=303&amp;y=644&amp;w=843&amp;h=313"></div></div><div><div><div></div></div></div><div><div><div>This register reports whether this device supports ECRC generation and checking. If so, configuration software can enable one or both features.</div></div></div><div><div><div></div></div></div><div><div><div>In some cases, multiple uncorrectable errors may be detected prior to software reading and clearing the register. The First Error Pointer field identifies the bit position within the Advanced Uncorrectable Status register corresponding to the error that occurred first. (See Figure 10-18 on page 387.)</div></div></div><div><div><div></div></div></div><div><div><div>The First Error Pointer and the ECRC Check and Generation Enable bits must be implemented as sticky bits.</div></div></div><div><div><div></div></div></div><h2><div><div>Handling Sticky Bits</div></div></h2><div><div><div></div></div></div><div><div><div>Several of the Advanced Configuration Error Registers employ sticky fields. Many of these fields are single bits. The designations of sticky fields are as follows:</div></div></div><div><div><div></div></div></div><div><ul><li>ROS - Read Only/Sticky</li></ul></div><div><div><div></div></div></div><div><ul><li>RWS - Read/Write/Sticky</li></ul></div><div><div><div></div></div></div><div><ul><li>RW1CS - Read/Write 1 to Clear/Sticky PCI Express System Architecture</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="434" id="mark-8cd0b35e-81d8-4e06-ad4c-cc8db4b3c69d" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Sticky error register fields behave differently in that a Hot Reset has no affect on the contents of these fields. For all other register fields, Hot Reset forces default values into the fields. Sticky bits are important in error handling to ensure that Error-related control and status information is not lost due to a Hot Reset. Software may initiate a Hot Reset in an attempt to clear errors.</div></div></div><div><div><div></div></div></div><h2><div><div>Advanced Correctable Error Handling</div></div></h2><div><div><div></div></div></div><div><div><div>Advanced error reporting provides the ability to pinpoint specific correctable errors. These errors can selectively cause the generation of a Correctable Error Message being sent to the host system:</div></div></div><div><div><div></div></div></div><div><ul><li>Receiver Errors (optional) - caused when the Physical Layer detects an error in the incoming packet (TLP or DLLP). The Physical Layer discards the packet, frees buffer space allocated to the packet, and signals the Link Layer that a receive error has occurred. This error is reported by setting a status bit and must not result in the Link Layer also reporting an error for this packet (e.g., the Link Layer must not report a Bad TLP or Bad DLLP).</li></ul></div><div><div><div></div></div></div><div><ul><li>Bad TLPs - caused when the Link Layer detects a packet with a bad CRC check, an incorrectly nullified packet, or an incorrect Packet Sequence Number (not a duplicate). In each case, the Link Layer discards the packet and reports a NAK DLLP to the transmitter, which triggers a transaction retry.</li></ul></div><div><div><div></div></div></div><div><ul><li>Bad DLLPs - caused by a CRC check failure. This type of error may be corrected by a subsequent DLLP or a time-out that results ultimately in DLLP retry. The exact corrective action depends on the type of DLLP that has failed and the circumstances associated with packet transmission.</li></ul></div><div><div><div></div></div></div><div><ul><li>REPLAY_NUM Rollover - the REPLAY_NUM is a count maintained within the transmitting side of the link layer that keeps track of the number of times that a transaction had been retransmitted without successful delivery. When the count rolls over, hardware automatically retrains the link in an attempt to clear the fault condition.</li></ul></div><div><div><div></div></div></div><div><ul><li>Replay Timer Time-out - this timer is maintained within the transmitting side of the Link Layer and is intended to trigger a retry when forward progress in sending TLPs has stopped. A time-out occurs when unacknowledged TLPs have not received an acknowledgement within the time-out period. A time-out results in a retry of all unacknowledged TLPs.</li></ul></div><div><div><div></div></div></div><div><div><div>Knowledge of which error has occurred can help system software to make better predictions of components that are likely to fail completely in the future. Software may also choose to mask recognition of some correctable errors while reporting others.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="435" id="mark-0a297441-d90e-44b0-886a-e6787c7b483a" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Advanced Correctable Error Status</div></div></h2><div><div><div></div></div></div><div><div><div>When a correctable error occurs the corresponding bit within the Advanced Correctable Error Status register is set. (See Figure 10-16.) These bits are automatically set by hardware and are cleared by software when writing a " 1 " to the bit position. These bits are set whether or not the error is reported via an Error Message. Each status bit in this register is designated RW1CS.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 10-16: Advanced Correctable Error Status Register</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_444.jpg?x=286&amp;y=634&amp;w=877&amp;h=392"></div></div><div><div><div></div></div></div><h2><div><div>Advanced Correctable Error Reporting</div></div></h2><div><div><div></div></div></div><div><div><div>Whether a particular correctable error is reported to the host is specified by the Correctable Mask register illustrated in Figure 10-17. The default state of the mask bits are cleared (0), thereby causing a Correctable Error message to be delivered when any of the correctable errors are detected. Software may choose to set one or more bits to prevent a Correctable Error Message from being sent when the selected error is detected. Each bit in this register is designated RWS.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="436" id="mark-cd1ba910-1b02-4fbe-971d-a647ec6e995a" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 10-17: Advanced Correctable Error Mask Register</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_445.jpg?x=227&amp;y=404&amp;w=991&amp;h=352"></div></div><div><div><div></div></div></div><h2><div><div>Advanced Uncorrectable Error Handling</div></div></h2><div><div><div></div></div></div><div><div><div>Advanced error reporting provides the ability to pinpoint which uncorrectable error has occurred. Furthermore software can specify the severity of each error and select which errors will result in an Error Message being sent to the host system (Root Complex).</div></div></div><div><div><div></div></div></div><div><ul><li>Training Errors (optional) - caused by failure in the link training sequence at the Physical Layer.</li></ul></div><div><div><div></div></div></div><div><ul><li>Data Link Protocol Errors - caused by Link Layer protocol errors including the ACK/NAK retry mechanism. [Note: The specification states that "Violations of Flow Control initialization protocol are Data Link Layer Protocol Errors" and that checking these errors is optional. It seems likely that these error should be treated as Flow Control Protocol errors (which are optional) and not Data Link Layer Protocol errors (which are required)].</li></ul></div><div><div><div></div></div></div><div><ul><li>Poisoned TLP Errors - caused by data corruption storage error within memory or data buffers.</li></ul></div><div><div><div></div></div></div><div><ul><li>Flow Control Protocol Errors (optional) - errors associated with failures of the flow control mechanism within the transaction layer.</li></ul></div><div><div><div></div></div></div><div><ul><li>Completion Time-out Errors - caused by excessive delays in the return of the expected completion. This error is detected by the Requester.</li></ul></div><div><div><div></div></div></div><div><ul><li>Completer Abort Errors (optional) - occurs when the Completer cannot fulfill the transaction request due to a variety of possible problems with the request or failure of the completer device.</li></ul></div><div><div><div></div></div></div><div><ul><li>Unexpected Completion Errors - occurs when a requester receives a completion transaction that does not match an request pending completion.</li></ul></div><div><div><div></div></div></div><div><ul><li>Receiver Overflow Errors (optional) - caused by a flow-control buffer overflow condition.</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="437" id="mark-c07dba76-f1f9-41db-845f-c6e99a100217" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><ul><li>Malformed TLPs - caused by processing errors associated with the transaction header. This error is detected within the Transaction Layer of the device receiving the TLP.</li></ul></div><div><div><div></div></div></div><div><ul><li>ECRC Errors (optional) - caused by an End-to-End CRC (ECRC) check failure within the transaction layer of the receiving device.</li></ul></div><div><div><div></div></div></div><div><ul><li>Unsupported Request Errors - occurs when the Completer does not support the request. The request is correctly formed and has not incurred any detected error during transport, however the transaction cannot be fulfilled by the completer due to a variety of reasons including illegal access and invalid command for this device.</li></ul></div><div><div><div></div></div></div><div><div><div>The errors noted as optional in the list above may not be implemented in the Advanced Uncorrectable register set.</div></div></div><div><div><div></div></div></div><h2><div><div>Advanced Uncorrectable Error Status</div></div></h2><div><div><div></div></div></div><div><div><div>When an uncorrectable error occurs the corresponding bit within the Advanced Uncorrectable Error Status register is set. (See Figure 10-18 on page 387.) These bits are automatically set by hardware and are cleared by software when writing a " 1 " to the bit position. These bits are set whether or not the error is reported via an Error Message. Each status bit in this register is designated RW1CS.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 10-18: Advanced Uncorrectable Error Status Register</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_446.jpg?x=238&amp;y=1083&amp;w=978&amp;h=468"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="438" id="mark-f808f82e-f95c-4f66-923e-25806153de76" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><h2><div><div>Selecting the Severity of Each Uncorrectable Error</div></div></h2><div><div><div></div></div></div><div><div><div>Advanced error handling permits software to select the severity of each error within the Advanced Uncorrectable Error Severity register. This gives software the opportunity to treat errors according to the severity associated with a given application. For example, Poisoned TLP data associated with audio data being sent to a speaker, while not correctable has no serious side effects relative to the integrity of the system. However, if real-time status information is being retrieved that will help make critical decisions, any errors in this data can be very serious. Figure 10-19 illustrates the Error Severity register. The default values are illustrated in the individual bit fields. These represent the default severity levels for each type of error <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="497" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mtext class="mjx-n" space="4"><mjx-c class="mjx-c46"></mjx-c><mjx-c class="mjx-c61"></mjx-c><mjx-c class="mjx-c74"></mjx-c><mjx-c class="mjx-c61"></mjx-c><mjx-c class="mjx-c6C"></mjx-c><mjx-c class="mjx-c2C"></mjx-c></mjx-mtext><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mtext class="mjx-n" space="4"><mjx-c class="mjx-c4E"></mjx-c><mjx-c class="mjx-c6F"></mjx-c><mjx-c class="mjx-c6E"></mjx-c><mjx-c class="mjx-c2D"></mjx-c><mjx-c class="mjx-c46"></mjx-c><mjx-c class="mjx-c61"></mjx-c><mjx-c class="mjx-c74"></mjx-c><mjx-c class="mjx-c61"></mjx-c><mjx-c class="mjx-c6C"></mjx-c></mjx-mtext></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mn>1</mn><mo>=</mo><mtext>Fatal,</mtext><mn>0</mn><mo>=</mo><mtext>Non-Fatal</mtext></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> .</div></div></div><div><div><div></div></div></div><div><div><div>Figure 10-19: Advanced Uncorrectable Error Severity Register</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_447.jpg?x=231&amp;y=817&amp;w=987&amp;h=468"></div></div><div><div><div></div></div></div><div><div><div>Those uncorrectable errors that are selected to be non fatal will result in a NonFatal Error Message being delivered and those selected as Fatal errors will result in a Fatal Error Message delivered. However, whether or not an Error Message is generated for a given error is specified in the Advanced Uncorrectable Mask register.</div></div></div><div><div><div></div></div></div><h2><div><div>Uncorrectable Error Reporting</div></div></h2><div><div><div></div></div></div><div><div><div>Software can mask out specific errors so that they never cause an Error Message to be generated. The default condition is to generate Error Messages for each type of error (all bits are cleared). Figure 10-20 on page 389 depicts the Advanced Uncorrectable Error Mask register.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="439" id="mark-8e62102a-8277-4453-802f-02de9953438a" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 10: Error Detection and Handling</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 10-20: Advanced Uncorrectable Error Mask Register</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_448.jpg?x=276&amp;y=403&amp;w=903&amp;h=414"></div></div><div><div><div></div></div></div><h2><div><div>Error Logging</div></div></h2><div><div><div></div></div></div><div><div><div>A four DWord portion of the Advanced Error Registers block is reserved for storing the header of the transaction that has incurred a failure. Only a select group of Transaction Layer errors result in the transaction header being logged. Table 10-6 lists the transactions that are logged.</div></div></div><div><div><div></div></div></div><div><div><div>Table 10-6: Transaction Layer Errors That are Logged</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Name of Error</th><th>Default Classification</th></tr></thead><tbody><tr><td>Poisoned TLP Received</td><td>Uncorrectable - Non Fatal</td></tr><tr><td>ECRC Check Failed</td><td>Uncorrectable - Non Fatal</td></tr><tr><td>Unsupported Request</td><td>Uncorrectable - Non Fatal</td></tr><tr><td>Completion Abort</td><td>Uncorrectable - Non Fatal</td></tr><tr><td>Unexpected Completion</td><td>Uncorrectable - Non Fatal</td></tr><tr><td>Malformed TLP</td><td>Uncorrectable - Fatal</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div>The format of the header is preserved when captured and placed into the register. That is, the illustration of header format in this book is exactly how the headers will appear within the Error Logging register. Note also that the contents of this register are designated ROS.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="440" id="mark-7e05a015-ec97-4bd3-974f-3f31283caddb" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Root Complex Error Tracking and Reporting</div></div></h2><div><div><div></div></div></div><div><div><div>The Root Complex is the target of all Error Messages issued by devices within the PCI Express fabric. Errors received by the Root Complex result in status registers being updated and the error being conditionally reported to the appropriate software handler or handlers.</div></div></div><div><div><div></div></div></div><h2><div><div>Root Complex Error Status Registers</div></div></h2><div><div><div></div></div></div><div><div><div>When the Root Complex receives an Error Message, it sets status bits within the Root Error Status register (Figure 10-21 on page 391). This register indicates the types of errors received and also indicates when multiple errors of the same type have been received. Note that an error detected at the root port is treated as if the port sent itself an Error Message.</div></div></div><div><div><div></div></div></div><div><div><div>The Advanced Root Error Status register tracks the occurrence of errors as follows:</div></div></div><div><div><div></div></div></div><h2><div><div>Correctable Errors</div></div></h2><div><div><div></div></div></div><div><ul><li>Sets the "Received Correctable Error" bit upon receipt of the first ERR_COR Message, or detection of a root port correctable error.</li></ul></div><div><div><div></div></div></div><div><ul><li>Sets the "Multiple Correctable Error Message Received" bit upon receipt of an ERR_COR Message, or detection of a root port correctable error when the "Received Correctable Error" bit is already set.</li></ul></div><div><div><div></div></div></div><h2><div><div>Uncorrectable Errors</div></div></h2><div><div><div></div></div></div><div><ul><li>Sets the "Received Uncorrectable Error" bit upon receipt of the first ERR_FATAL or ERR_NONFATAL Error Message, or detection of a root port uncorrectable error.</li></ul></div><div><div><div></div></div></div><div><ul><li>Set the "Multiple Uncorrectable Error Message Received" bit upon receipt of an ERR_FATAL or ERR_NONFATAL Message, or detection of a root port correctable error when the "Received Uncorrectable Error" bit is already set.</li></ul></div><div><div><div></div></div></div><h2><div><div>Detecting and Reporting First Uncorrectable Fatal versus Non-Fatal Errors</div></div></h2><div><div><div></div></div></div><div><div><div>If the system wishes to implement separate software error handlers for Correctable, Non-Fatal, and Fatal errors. The Root Error Status register includes bits to differentiate Correctable from Uncorrectable Errors but needs additional bits to also determine whether Uncorrectable errors are fatal or non-fatal:</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="441" id="mark-31562fc7-b8b0-4258-872d-f77d7a7079cf" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><ul><li>If the first Uncorrectable Error Message received is FATAL the "First Uncorrectable Fatal" bit is also set along with the "Fatal Error Message Received" bit.</li></ul></div><div><div><div></div></div></div><div><ul><li>If the first Uncorrectable Error Message received is NONFATAL the "NonFatal Error Message Received" bit is set. (If a subsequent Uncorrectable Error is Fatal, the "Fatal Error Message Received" bit will be set, but because the "First Uncorrectable Fatal" remains cleared, software knows that the first Uncorrectable Error received was Non-Fatal.)</li></ul></div><div><div><div></div></div></div><div><div><div>Figure 10-21: Root Error Status Register</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_450.jpg?x=280&amp;y=665&amp;w=885&amp;h=481"></div></div><div><div><div></div></div></div><h2><div><div>Advanced Source ID Register</div></div></h2><div><div><div></div></div></div><div><div><div>Software error handlers may need to read and clear error status registers within the device that detected and reported the error. The Error Messages contain the ID of the device reporting the error. The Source ID register captures the Error Message ID associated with the first Fatal and first Non-Fatal Error message received by the Root Complex. The format of this register is shown in Figure 10- 22 on page 391.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 10-22: Advanced Source ID Register</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_450.jpg?x=278&amp;y=1472&amp;w=895&amp;h=197"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="442" id="mark-a5cbd084-e862-4da9-8470-dc750ba81b91" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><h2><div><div>Root Error Command Register</div></div></h2><div><div><div></div></div></div><div><div><div>The Root Error Status register sets status bits that determines whether a Correctable, Fatal, or Non-Fatal error has occurred. In conjunction with these status bits the Root Complex can also generate separate interrupts that call handlers for each of the error categories. The Root Error Command register enables interrupt generation for all three categories as pictured in Figure 10-23 on page 392.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 10-23: Advanced Root Error Command Register</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_451.jpg?x=224&amp;y=693&amp;w=1004&amp;h=324"></div></div><div><div><div></div></div></div><h2><div><div>Reporting Errors to the Host System</div></div></h2><div><div><div></div></div></div><div><div><div>Software error handlers will initially read Root Complex status registers to determine the nature of the error, and may also need to read device-specific error registers of the device that reported the error.</div></div></div><div><div><div></div></div></div><h2><div><div>Summary of Error Logging and Reporting</div></div></h2><div><div><div></div></div></div><div><div><div>The actions taken by a function when an error is detected is governed by the type of error and the settings of the error-related configuration registers. The specification includes the flow chart in Figure 10-24 on page 393 that specifies the actions taken by a device upon detecting an error. This flow chart presumes that PCI Express compatible software is being used and does not cover the case of error handling when only legacy PCI software is used.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="443" id="mark-5d16b556-a60d-4594-8da8-c2732068fb0b" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 10-24: Error Handling Flow Chart</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_452.jpg?x=222&amp;y=401&amp;w=1002&amp;h=1057"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="444" id="mark-b4143d28-142f-4eca-ba39-c3a42b8d2733" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Part Three</div></div></div><div><div><div></div></div></div><div><div><div>The Physical Layer</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="445" id="mark-71e19633-00fa-426e-9f5e-26c305b67813" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>11 Physical Layer  Logic</div></div></h2><div><div><div></div></div></div><h2><div><div>The Previous Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>The previous chapter discussed both correctable and non-correctable errors and the mechanisms used to log and report them. Prior to discussing the PCI Express error reporting capabilities, a brief review of the PCI error handling was included as background information.</div></div></div><div><div><div></div></div></div><h2><div><div>This Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>This chapter describes the Logical characteristics of the Physical Layer core logic. It describes how an outbound packet is processed before clocking the packet out differentially. The chapter also describes how an inbound packet arriving from the Link is processed and sent to the Data Link Layer. The chapter describes sub-block functions of the Physical Layer such as Byte Striping and Un-Striping logic, Scrambler and De-Scrambler, 8b/10b Encoder and Decoder, Elastic Buffers and more.</div></div></div><div><div><div></div></div></div><h2><div><div>The Next Chapter</div></div></h2><div><div><div></div></div></div><div><div><div>The next chapter describes the electrical characteristics of the Physical Layer. It describes the analog characteristics of the differential drivers and receivers that connect a PCI Express device to the Link.</div></div></div><div><div><div></div></div></div><h2><div><div>Physical Layer Overview</div></div></h2><div><div><div></div></div></div><div><div><div>The Physical Layer shown in Figure 11-1 on page 398 connects to the Link on one side and interfaces to the Data Link Layer on the other side. The Physical Layer processes outbound packets before transmission to the Link and processes inbound packets received from the Link. The two sections of the Physical Layer associated with transmission and reception of packets are referred to as the transmit logic and the receive logic throughout this chapter.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="446" id="mark-aad1ac5d-cfac-41ee-aaad-bbd72c885251" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>The transmit logic of the Physical Layer essentially processes packets arriving from the Data Link Layer, then converts them into a serial bit stream. The bit stream is clocked out at 2.5 Gbits/s/Lane onto the Link.</div></div></div><div><div><div></div></div></div><div><div><div>The receive logic clocks in a serial bit stream arriving on the Lanes of the Link with a clock that is recovered from the incoming bit stream. The receive logic converts the serial bit steam into a parallel symbol stream, processes the incoming symbols, assembles packets and sends them to the Data Link Layer.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 11-1: Physical Layer</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_457.jpg?x=227&amp;y=671&amp;w=997&amp;h=843"></div></div><div><div><div></div></div></div><div><div><div>In the future, data rates per Lane are expected to go to 5 Gbits/s, 10 Gbits/s and beyond. When this happens, an existing design can be adapted to the higher data rates by redesigning the Physical Layer while maximizing reuse of the Data Link Layer, Transaction Layer and Device Core/Software Layer. The Phys-</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="447" id="mark-51d50358-c04f-41af-afdb-24ddf9ea5932" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>ical Layer may be designed as a standalone entity separate from the Data Link Layer and Transaction Layer. This allows a design to be migrated to higher data rates or even to an optical implementation if such a Physical Layer is supported in the future.</div></div></div><div><div><div></div></div></div><div><div><div>Two sub-blocks make up the Physical Layer. These are the logical Physical Layer and the electrical Physical Layer as shown in Figure 11-2. This chapter describes the logical sub-block, and the next chapter describes the electrical subblock. Both sub-blocks are split into transmit logic and receive logic (independent of each other) which allow dual simplex communication.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 11-2: Logical and Electrical Sub-Blocks of the Physical Layer</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_458.jpg?x=229&amp;y=726&amp;w=984&amp;h=733"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="448" id="mark-671c6a2d-fdc0-4b38-b92d-408158259b44" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Disclaimer</div></div></h2><div><div><div></div></div></div><div><div><div>To facilitate description of the Physical Layer functionality, an example implementation is described that is not necessarily the implementation assumed by the specification nor is a designer compelled to implement a Physical Layer in such a manner. A designer may implement the Physical Layer in any manner that is compliant with the functionality expected by the PCI Express specification.</div></div></div><div><div><div></div></div></div><h2><div><div>Transmit Logic Overview</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 11-3 on page 401 shows the elements that make up the transmit logic:</div></div></div><div><div><div></div></div></div><div><ul><li>a multiplexer (mux),</li></ul></div><div><div><div></div></div></div><div><ul><li>byte striping logic (only necessary if the link implements more than one data lane),</li></ul></div><div><div><div></div></div></div><div><ul><li>scramblers,</li></ul></div><div><div><div></div></div></div><div><ul><li><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="498" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> encoders,</li></ul></div><div><div><div></div></div></div><div><ul><li>and parallel-to-serial converters.</li></ul></div><div><div><div></div></div></div><div><div><div>TLPs and DLLPs from the Data Link layer are clocked into a Tx (transmit) Buffer. With the aid of a multiplexer, the Physical Layer frames the TLPs or DLLPs with Start and End characters. These characters are framing symbols which the receiver device uses to detect start and end of packet.</div></div></div><div><div><div></div></div></div><div><div><div>The framed packet is sent to the Byte Striping logic which multiplexes the bytes of the packet onto the Lanes. One byte of the packet is transferred on one Lane, the next byte on the next Lane and so on for the available Lanes.</div></div></div><div><div><div></div></div></div><div><div><div>The Scrambler uses an algorithm to pseudo-randomly scramble each byte of the packet. The Start and End framing bytes are not scrambled. Scrambling eliminates repetitive patterns in the bit stream. Repetitive patterns result in large amounts of energy concentrated in discrete frequencies which leads to significant EMI noise generation. Scrambling spreads energy over a frequency range, hence minimizing average EMI noise generated.</div></div></div><div><div><div></div></div></div><div><div><div>The scrambled 8-bit characters (8b characters) are encoded into 10-bit symbols (10b symbols) by the <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="499" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> Encoder logic. And yes,there is a <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="500" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom><mjx-mi class="mjx-n"><mjx-c class="mjx-c25"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>25</mn></mrow><mi mathvariant="normal">%</mi></math></mjx-assistive-mml></mjx-container> loss in transmission performance due to the expansion of each byte into a 10-bit character. A Character is defined as the 8-bit un-encoded byte of a packet. A Symbol is defined as the 10-bit encoded equivalent of the 8-bit character. The purpose of Chapter 11: Physical Layer Logic</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="449" id="mark-7e932d41-ca88-4bbb-aeb4-bb38f2444b46" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="501" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> Encoding the packet characters is primarily to create sufficient 1-to-0 and 0-to-1 transition density in the bit stream so that the receiver can re-create a receive clock with the aid of a receiver Phase Lock Loop (PLL). Note that the clock used to clock the serial data bit stream out of the transmitter is not itself transmitted onto the wire. Rather, the receive clock is used to clock in an inbound packet.</div></div></div><div><div><div></div></div></div><div><div><div>The 10b symbols are converted to a serial bit stream by the Parallel-to-Serial converter. This logic uses a <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="502" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c47"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>2.5</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">GHz</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> clock to serially clock the packets out on each Lane. The serial bit stream is sent to the electrical sub-block which differentially transmits the packet onto each Lane of the Link.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 11-3: Physical Layer Details</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_460.jpg?x=223&amp;y=776&amp;w=995&amp;h=741"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="450" id="mark-549f5686-c6a6-45be-8551-f4c79d8f2187" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><h2><div><div>Receive Logic Overview</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 11-3 shows the elements that make up the receiver logic:</div></div></div><div><div><div></div></div></div><div><ul><li>receive PLL,</li></ul></div><div><div><div></div></div></div><div><ul><li>serial-to-parallel converter,</li></ul></div><div><div><div></div></div></div><div><ul><li>elastic buffer,</li></ul></div><div><div><div></div></div></div><div><ul><li><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="503" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> decoder,</li></ul></div><div><div><div></div></div></div><div><ul><li>de-scrambler,</li></ul></div><div><div><div></div></div></div><div><ul><li>byte un-striping logic (only necessary if the link implements more than one data lane),</li></ul></div><div><div><div></div></div></div><div><ul><li>control character removal circuit,</li></ul></div><div><div><div></div></div></div><div><ul><li>and a packet receive buffer.</li></ul></div><div><div><div></div></div></div><div><div><div>As the data bit stream is received, the receiver PLL is synchronized to the clock frequency with which the packet was clocked out of the remote transmitter device. The transitions in the incoming serial bit stream are used to re-synchronize the PPL circuitry and maintain bit and symbol lock while generating a clock recovered from the data bit stream. The serial-to-parallel converter is clocked by the recovered clock and outputs <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="504" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> symbols.</div></div></div><div><div><div></div></div></div><div><div><div>The 10b symbols are clocked into the Elastic Buffer using the recovered clock associated with the receiver PLL. The Elastic Buffer is used for clock tolerance compensation; i.e. the Elastic Buffer is used to adjust for minor clock frequency variation between the recovered clock used to clock the incoming bit stream into the Elastic Buffer and the locally-generated clock associated that is used to clock data out of the Elastic Buffer.</div></div></div><div><div><div></div></div></div><div><div><div>The <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="505" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> symbols are converted back to <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="506" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> characters by the <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="507" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> Decoder. The Start and End characters that frame a packet are eliminated. The <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="508" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> Decoder also looks for errors in the incoming 10b symbols. For example, error detection logic can check for invalid <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="509" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> symbols or detect a missing Start or End character.</div></div></div><div><div><div></div></div></div><div><div><div>The De-Scrambler reproduces the de-scrambled packet stream from the incoming scrambled packet stream. The De-Scrambler implements the inverse of the algorithm implemented in the transmitter Scrambler.</div></div></div><div><div><div></div></div></div><div><div><div>The bytes from each Lane are un-striped to form a serial byte stream that is loaded into the receive buffer to feed to the Data Link layer.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="451" id="mark-05ed8916-3627-4948-b381-3f9050f34f7b" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Physical Layer Link Active State Power Management</div></div></h2><div><div><div></div></div></div><div><div><div>The full-on power state of the Physical Layer and Link is called the L0 state. Devices support two lower power states, L0s (L0 suspend) and L1 Active that are actively and automatically managed by the Physical Layer. L1 Active power state is a lower power state than L0s and is optionally supported. The L0s power state is managed by the Physical Layer. The L1 Active power state is managed by a combination of Data Link Layer and Physical Layer.</div></div></div><div><div><div></div></div></div><div><div><div>A Link can be placed in the L0s power state in one direction independent of the other direction while a Link in the L1 Active power state is in this state in both directions.</div></div></div><div><div><div></div></div></div><div><div><div>Software enables support of the L0s and L1 Active power states via configuration registers. After reset, these registers are in a state that disables lower power state functionality. The Physical Layer automatically manages entering these lower power states upon detection of a period of inactivity on the Link. Once a device is in L0s or L1 Active and it intends to transmit packets, it can transition its Link power state back to L0. The exit latency from L1 Active is greater than the exit latency from L0s.</div></div></div><div><div><div></div></div></div><div><div><div>Additional details on Link Active State Power Management are covered in "Link Training and Status State Machine (LTSSM)" on page 508 on Link Training and "Link Active State Power Management" on page 608.</div></div></div><div><div><div></div></div></div><h2><div><div>Link Training and Initialization</div></div></h2><div><div><div></div></div></div><div><div><div>The Physical Layer is responsible for the Link Initialization and Training. The process is described in "Link Initialization and Training Overview" on page 500 .</div></div></div><div><div><div></div></div></div><h2><div><div>Transmit Logic Details</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 11-4 on page 406 shows the transmit logic of the Logical Physical Layer. This section describes packet processing from the time packets are received from the Data Link Layer until the packet is clocked out of the Physical Layer onto the Link.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="452" id="mark-a0bef0ae-f618-452e-a27c-c1dcb7c6bda8" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Tx Buffer</div></div></h2><div><div><div></div></div></div><div><div><div>The Tx Buffer receives TLPs and DLLPs from the Data Link Layer. Along with the packets, the Data Link Layer indicates the start and end of the packet using a 'Control' signal so that the Physical Layer can append Start and End framing characters to the packet. The Tx Buffer uses a 'throttle' signal to throttle the flow of packets from the Data Link Layer in case the Tx Buffer fills up.</div></div></div><div><div><div></div></div></div><h2><div><div>Multiplexer (Mux) and Mux Control Logic</div></div></h2><div><div><div></div></div></div><h2><div><div>General</div></div></h2><div><div><div></div></div></div><div><div><div>The Mux shown in Figure 11-5 on page 407 primarily gates packet characters from the Tx Buffer to the Byte Striping logic (only necessary if the link implements more than one data lane). However, under certain circumstances, the Mux may gate other inputs to the Byte Striping logic. Here is a summary of the four Mux inputs and when they are gated:</div></div></div><div><div><div></div></div></div><div><ul><li>Transmit Data Buffer. When the Data Link Layer supplies a packet to be transmitted, the Mux gates the packet's character stream through to the Byte Striping logic. Characters within the Tx Buffer are Data or 'D' characters. Hence the D/K# signal is driven High when Tx Buffer contents are gated. See "Definition of Characters and Symbols" on page 405.</li></ul></div><div><div><div></div></div></div><div><ul><li>Start and End characters. These Control characters are appended to the start and end of every TLP and DLLP as shown in Figure 11-6 on page 408. These framing characters allow a receiver to easily detect the start and end of a packet. There are two types of Start characters, one is the start TLP character (STP) and the other is the start DLLP character (SDP). There are two types of end characters, the End Good TLP or DLLP character (END), and the End Bad TLP character (EDB). See Table 11-5 on page 432 for a list of Control characters. A control signal from the Data Link Layer in combination with the packet type determine what type of framing character to gate. Start and End characters are Control or ’ <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="510" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">K</mi></mrow></math></mjx-assistive-mml></mjx-container> ’ characters,hence the D/K# signal is driven low when the Start and End characters are gated out at the start and end of a packet, respectively.</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="453" id="mark-4ea2849b-f169-4b9a-bd42-ab21308a91e5" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><ul><li>Ordered-Sets. Ordered-Sets are multiples of 4 character sequences that starts with a comma (COM) control character followed by other characters. They are transmitted during special events as described below:</li></ul></div><div><div><div></div></div></div><div><ul><li>During Link training, Training Sequence 1 and 2 (TS1 and TS2) Ordered-Sets are transmitted over the Link. Link training occurs after fundamental reset, hot reset, or after certain error conditions occur. Refer to "Ordered-Sets Used During Link Training and Initialization" on page 504 for detailed usage of TS1 and TS2 Ordered-Sets.</li></ul></div><div><div><div></div></div></div><div><ul><li>At periodic intervals, the Mux gates the SKIP Ordered-Set pattern through to the Byte Striping logic to facilitate clock tolerance compensation in the receiver circuit of the port at the other end of the Link. For a detailed description, refer to "Inserting Clock Compensation Zones" on page 436 and "Receiver Clock Compensation Logic" on page 442.</li></ul></div><div><div><div></div></div></div><div><ul><li>When a device wants to place its transmitter in the electrical Idle state, it must inform the remote receiver at the other end of the Link. The device gates an electrical Idle Ordered-Set to do so.</li></ul></div><div><div><div></div></div></div><div><ul><li>When a device wants to change the Link power state from L0s low power state to the L0 full-on power state, it transmits Fast Training Sequence (FTS) Ordered-Sets to the receiver. The receiver uses this Ordered-Set to re-synchronize its PLL to the transmitter clock.</li></ul></div><div><div><div></div></div></div><div><ul><li>Ordered-Sets begin with a <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="511" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">K</mi></mrow></math></mjx-assistive-mml></mjx-container> character and,depending on the type of set, may contain D or K characters. Hence, during transmission of an Ordered-Set, the D/K# signal is driven Low for a clock and then may be driven High or Low there after.</li></ul></div><div><div><div></div></div></div><div><ul><li>Logical Idle Sequence. When there are no packets to transmit on the Link (referred to as Logical Idle Link), rather than leave the Link in a floating state or drive nothing, logical Idle characters are gated. Doing so guarantees signal transitions on the Link thus allowing the receiver's PLL to maintain clock synchronization with the transmit clock. In addition, the receiver is able to maintain bit and symbol lock. The logical Idle sequence consists of transmitting <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="512" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>00</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">h</mi></mrow></math></mjx-assistive-mml></mjx-container> characters. It therefore consists of D type characters,hence, the D/K# signal is high while the Mux is gating logical Idle sequences.</li></ul></div><div><div><div></div></div></div><h2><div><div>Definition of Characters and Symbols</div></div></h2><div><div><div></div></div></div><div><div><div>Each character is 8-bits in size. They can be grouped into two categories, Control or ’ <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="513" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">K</mi></mrow></math></mjx-assistive-mml></mjx-container> ’ characters,and Data or ’ <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="514" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c44"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">D</mi></mrow></math></mjx-assistive-mml></mjx-container> ’ characters. From the standpoint of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="515" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> Encoding, D characters are encoded into a different 10-bit symbol than K characters of the same 8-bit value. Each 10-bit encoded character is referred to as a symbol.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="454" id="mark-3fa8ee8a-eef1-4fd1-aa2e-cc81aaf4540b" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 11-4: Physical Layer Transmit Logic Details</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_465.jpg?x=221&amp;y=448&amp;w=845&amp;h=992"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="455" id="mark-0c0a963b-8c77-4bf0-8427-66bffabd0b38" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Chapter 11: Physical Layer Logic</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 11-5: Transmit Logic Multiplexer</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_466.jpg?x=231&amp;y=395&amp;w=993&amp;h=725"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="456" id="mark-57783e2b-09a8-4b77-a7b9-93175ae52fa3" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Figure 11-6: TLP and DLLP Packet Framing with Start and End Control Characters</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_467.jpg?x=336&amp;y=484&amp;w=786&amp;h=441"></div></div><div><div><div></div></div></div><h2><div><div>Byte Striping (Optional)</div></div></h2><div><div><div></div></div></div><div><div><div>When a port implements more than one data Lane (i.e., more than one serial data path on the external Link), the packet data is striped across the 2, 4, 8, 12, 16, or 32 Lanes by the Byte Striping logic. Striping means that each consecutive outbound character in a character stream is multiplexed onto the consecutive Lanes. Examples of Byte Striping are illustrated in Figure 11-7 on page 409, Figure 11-8 on page 410, Figure 11-9 on page 411. The number of Lanes used is configured during the Link training process.</div></div></div><div><div><div></div></div></div><div><div><div>Disclaimer: This example assumes that the Byte Striping logic is implemented before the Scrambler and <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="516" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> Encoder. Every Lane implements a Scrambler and an <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="517" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> Encoder. This permits a receiver Physical Layer to detect errors on any Lane independent of the other Lanes. For example, an error that may have occurred in the transmitter Scrambler or <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="518" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> Encoder is detectable if a receiver detects an invalid <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="519" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> character on a given Lane. When an error is detected on a Lane and cannot be cleared, the Lane could be disabled and the Link re-trained and re-initialized with fewer Lanes. This error recovery feature is suggested and not required by specification. Chapter 11: Physical Layer Logic</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="457" id="mark-3b43400d-1bf5-4e85-b2ad-57a863616d0f" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>On the other hand, to simplify and reduce the size of the Physical Layer logic, a designer may choose to place the Byte Striping logic after the Scrambler and <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="520" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> Encoder but before the Parallel-to-Serial converter. This reduces the number of Scramblers and <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="521" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> Encoders to one. If the receiver detects an error in the incoming bit stream however, it cannot isolate the error to a particular Lane.</div></div></div><div><div><div></div></div></div><div><div><div>Figure 11-7: <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="522" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi>x</mi><mn>1</mn></mrow></math></mjx-assistive-mml></mjx-container> Byte Striping</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_468.jpg?x=212&amp;y=751&amp;w=1009&amp;h=858"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="458" id="mark-7eb5aba0-7f94-450a-a3db-a2b2a93ba876" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 11-8: x4 Byte Striping</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_469.jpg?x=221&amp;y=454&amp;w=997&amp;h=730"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="459" id="mark-5c48ce6e-19c6-496c-b3e8-434e4ca24fea" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Chapter 11: Physical Layer Logic</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 11-9: <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="523" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c2C"></mjx-c></mjx-mo><mjx-texatom space="2" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c2C"></mjx-c></mjx-mo><mjx-texatom space="2" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c2C"></mjx-c></mjx-mo><mjx-texatom space="2" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi>x</mi><mn>8</mn></mrow><mo>,</mo><mrow data-mjx-texclass="ORD"><mi>x</mi><mn>12</mn></mrow><mo>,</mo><mrow data-mjx-texclass="ORD"><mi>x</mi><mn>16</mn></mrow><mo>,</mo><mrow data-mjx-texclass="ORD"><mi>x</mi><mn>32</mn></mrow></math></mjx-assistive-mml></mjx-container> Byte Striping</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_470.jpg?x=218&amp;y=453&amp;w=1001&amp;h=706"></div></div><div><div><div></div></div></div><h2><div><div>Packet Format Ruies</div></div></h2><div><div><div></div></div></div><div><div><div>After passing through the Byte Striping logic, a TLP or DLLP character stream is striped across the Lanes. This section describes the rules used to byte stripe packets so that the packets are correctly striped across the Lanes of the Link.</div></div></div><div><div><div></div></div></div><div><div><div>General Packet Format Rules. The following are the general packet format rules:</div></div></div><div><div><div></div></div></div><div><ul><li>The total packet length (including Start and End characters) of each packet must be a multiple of four characters.</li></ul></div><div><div><div></div></div></div><div><ul><li>TLPs always start with the STP character.</li></ul></div><div><div><div></div></div></div><div><ul><li>DLLPs always start with SDP and are 8 characters long (6 characters + SDP + END)</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="460" id="mark-df0b61c8-b0d4-446e-b639-9e6688c322ee" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><ul><li>All TLPs terminate with either an END or EDB character.</li></ul></div><div><div><div></div></div></div><div><ul><li>DLLPs terminate with the END character.</li></ul></div><div><div><div></div></div></div><div><ul><li>STP and SDP characters must be placed on Lane 0 when starting the transmission of a packet after the transmission of Logical Idles. If not starting a packet transmission from Logical Idle (i.e. back-to-back transmission of packets), then STP and SDP must start on a Lane number divisible by 4.</li></ul></div><div><div><div></div></div></div><div><ul><li>Any violation of these rules may be reported as a Receiver Error to the Data Link Layer.</li></ul></div><div><div><div></div></div></div><div><div><div>x1 Packet Format Example. Figure 11-10 on page 413 illustrates the format of packets transmitted over a x1 Link (i.e., a Link with only one Lane operational). The illustration shows the following sequence of packets:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">One TLP.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">One 8-byte DLLP.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">One clock compensation packet consisting of a SKIP Ordered-Set (i.e., a COM followed by three SKP characters).</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">Two TLPs.</li></ol></div><div><div><div></div></div></div><div><ol><li value="5">One 8-byte DLLP.</li></ol></div><div><div><div></div></div></div><div><ol><li value="6">One TLP.</li></ol></div><div><div><div></div></div></div><div><ol><li value="7">A Flow Control Packet.</li></ol></div><div><div><div></div></div></div><div><ol><li value="8">Logical Idles transmitted because there are no more packets to transmit.</li></ol></div><div><div><div></div></div></div><div><div><div>x4 Packet Format Rules. The following rules apply when a packet is transmitted over a x4 Link (i.e., a Link with four Lanes):</div></div></div><div><div><div></div></div></div><div><ul><li>STP and SDP characters are always transmitted on Lane 0.</li></ul></div><div><div><div></div></div></div><div><ul><li>END and EDB characters are always transmitted on Lane 3.</li></ul></div><div><div><div></div></div></div><div><ul><li>When an Ordered-Set such as the SKIP Ordered-Set is transmitted (for clock compensation in the receiver), it must be sent on all four Lanes simultaneously.</li></ul></div><div><div><div></div></div></div><div><ul><li>When Logical Idle sequences are transmitted, they must be transmitted on all Lanes.</li></ul></div><div><div><div></div></div></div><div><ul><li>Any violation of these rules may be reported as a Receiver Error to the Data Link Layer.</li></ul></div><div><div><div></div></div></div><div><div><div>x4 Packet Format Example. Figure 11-11 on page 414 illustrates the format of packets transmitted over a <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="524" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-cD7"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>×</mo><mn>4</mn></math></mjx-assistive-mml></mjx-container> Link (i.e.,a Link with four data Lanes operational). The illustration shows the following sequence of packets:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">One TLP.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">A SKIP Ordered-Set transmitted on all Lanes for periodic receiver clock compensation.</li></ol></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="461" id="mark-c5ce7f9d-93f9-4377-9579-7e15b2333134" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><ol><li value="3">A DLLP.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">Logical Idles on all Lanes because there are no more packets to transmit.</li></ol></div><div><div><div></div></div></div><div><div><div>Figure 11-10: x1 Packet Format</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_472.jpg?x=222&amp;y=523&amp;w=1002&amp;h=679"></div></div><div><div><div></div></div></div><div><div><div>x8, x12, x16 or x32 Packet Format Rules. The following rules apply when a packet is transmitted over a x8, x12, x16, or x32 Link:</div></div></div><div><div><div></div></div></div><div><ul><li>STP/SDP characters are always transmitted on Lane 0 when transmission starts after a period during which Logical Idles are transmitted.</li></ul></div><div><div><div></div></div></div><div><ul><li>STP/SDP characters may only be transmitted on Lane numbers divisible by 4 when transmitting back-to-back packets.</li></ul></div><div><div><div></div></div></div><div><ul><li>END/EDB characters are transmitted on Lane numbers divisible by 4 less 1.</li></ul></div><div><div><div></div></div></div><div><ul><li>If a packet doesn't end on the last Lane and there are no more packet transmissions, PAD symbols are transmitted on the Lanes above the Lane on which the END/EDB character is transmitted. This keeps the Link aligned so that transmission of the Logical Idle sequence can start on all Lanes at the same time.</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="462" id="mark-b8297f9d-353c-4ec5-9723-34cb75cd9b78" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><ul><li>When an Ordered-Set such as the SKIP Ordered-Set is transmitted (for clock compensation in the receiver), it must be sent on all four Lanes simultaneously.</li></ul></div><div><div><div></div></div></div><div><ul><li>When Logical Idle sequences are transmitted, they must be transmitted on all Lanes.</li></ul></div><div><div><div></div></div></div><div><ul><li>Any violation of these rules may be reported as a Receiver Error to the Data Link Layer.</li></ul></div><div><div><div></div></div></div><div><div><div>Figure 11-11: x4 Packet Format</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_473.jpg?x=231&amp;y=630&amp;w=981&amp;h=881"></div></div><div><div><div></div></div></div><div><div><div>Note: There are no PAD characters to transmit on a x4 Link because all packets are multiples of 4 Bytes</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="463" id="mark-9b9b7e53-86b5-492c-899a-944fe070a346" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>x8 Packet Format Example. Figure 11-12 on page 415 illustrates the format of packets transmitted over a x8 Link (i.e., a Link with 8 Lanes operational). The illustration shows the following sequence of packets:</div></div></div><div><div><div></div></div></div><div><ol><li value="1">A TLP.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">A SKIP Ordered-Set transmitted on all Lanes for periodic receiver clock compensation.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">A DLLP.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">A TLP that ends on Lane 3. The remaining Lanes are filled with PADs so that the Link is aligned for the next transmission.</li></ol></div><div><div><div></div></div></div><div><ol><li value="5">Logical Idles on all Lanes because there are no more packets to transmit.</li></ol></div><div><div><div></div></div></div><div><div><div>Figure 11-12: x8 Packet Format</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_474.jpg?x=222&amp;y=783&amp;w=993&amp;h=804"></div></div><div><div><div></div></div></div><div><div><div>PAD characters are transmitted to maintain packet framing alignment</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="464" id="mark-ab0ba1f4-4c60-4b66-8e12-7123036e1baf" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Scrambler</div></div></h2><div><div><div></div></div></div><div><div><div>After byte striping, the outbound packets are transmitted across the Lanes. As shown in Figure 11-4 on page 406, each Lane in the Physical Layer design incorporates a Scrambler.</div></div></div><div><div><div></div></div></div><h2><div><div>Purpose of Scrambling Outbound Transmission</div></div></h2><div><div><div></div></div></div><div><div><div>The Scrambler eliminates generation of repetitive patterns on a transmitted data stream. As an example, when scrambled, a stream of 0 s will result in a pseudorandom bit pattern.</div></div></div><div><div><div></div></div></div><div><div><div>Repetitive patterns result in large amount of energy concentrated in discrete frequencies which results in significant EMI noise generated. By scrambling the transmitted data, repetitive patterns-such as 10101010-are eliminated. As a result, no single frequency component of the signal is transmitted for significant periods of time. Thus the radiated EMI energy of a transmission is spread over a range in the frequency spectrum. This technique referred to as 'spread spectrum' effectively 'whitens' the frequency content of a signal and reduces the radiated power at any particular frequency.</div></div></div><div><div><div></div></div></div><div><div><div>On a bare systemboard with the wires of the Link un-shielded and high frequency transmission of 2.5 Gbits/s, EMI noise generation is significant. Scrambling makes the radiated power from the Link effectively look like white noise. This helps meet FCC requirements.</div></div></div><div><div><div></div></div></div><div><div><div>Also, on a multi-Lane Link with wires routed in close proximity, a scrambled transmission on one Lane generates white noise which does not interfere or correlate with another Lane's data transmission. This 'spatial frequency de-correlation' or reduction of crosstalk noise assists the receiver on each Lane to distinguish the desired signal from the background white noise.</div></div></div><div><div><div></div></div></div><h2><div><div>Scrambler Algorithm</div></div></h2><div><div><div></div></div></div><div><div><div>The Scrambler in Figure 11-13 on page 418 is implemented with a 16-bit Linear Feedback Shift Registers (LFSR) that implements the polynomial:</div></div></div><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" display="true" tabindex="0" ctxtmenu_counter="525" style="font-size: 122.8%; position: relative;"><mjx-math display="true" class="MJX-TEX" aria-hidden="true" style="margin-left: 0px; margin-right: 0px;"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c47"></mjx-c></mjx-mi></mjx-texatom><mjx-mrow space="2"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-msup space="4"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c58"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-script style="vertical-align: 0.413em;"><mjx-texatom size="s" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-msup space="3"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c58"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-script style="vertical-align: 0.413em;"><mjx-texatom size="s" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-msup space="3"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c58"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-script style="vertical-align: 0.413em;"><mjx-texatom size="s" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-msup space="3"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c58"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-script style="vertical-align: 0.413em;"><mjx-texatom size="s" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">G</mi></mrow><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">x</mi></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow><mo>=</mo><msup><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">X</mi></mrow></mrow><mrow data-mjx-texclass="ORD"><mn>16</mn></mrow></msup><mo>+</mo><msup><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">X</mi></mrow></mrow><mrow data-mjx-texclass="ORD"><mn>5</mn></mrow></msup><mo>+</mo><msup><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">X</mi></mrow></mrow><mrow data-mjx-texclass="ORD"><mn>4</mn></mrow></msup><mo>+</mo><msup><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">X</mi></mrow></mrow><mrow data-mjx-texclass="ORD"><mn>3</mn></mrow></msup><mo>+</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container></div></div></div><div><div><div></div></div></div><div><div><div>The LFSR is clocked at the bit transfer rate. The LFSR output is serially clocked into an 8-bit register that is XORed with the 8-bit characters to form the scrambled data.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="465" id="mark-846bc83d-5ca6-43aa-9eb9-7c5c62084627" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Implementation Note: The LFSR bit rate clock is 8 times the frequency (2GHz) of the byte clock (250MHz) that feeds the Scrambler output.</div></div></div><div><div><div></div></div></div><h2><div><div>Some Scrambler implementation rules:</div></div></h2><div><div><div></div></div></div><div><ul><li>On a multi-Lane Link implementation, Scramblers associated with each Lane must operate in concert, maintaining the same simultaneous value in each LFSR.</li></ul></div><div><div><div></div></div></div><div><ul><li>Scrambling is applied to 'D' characters associated with TLP and DLLPs, including the Logical Idle (00h) sequence. ’D’ characters within the TS1 and TS2 Ordered-Set are not scrambled.</li></ul></div><div><div><div></div></div></div><div><ul><li>’ <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="526" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">K</mi></mrow></math></mjx-assistive-mml></mjx-container> ’ characters and characters within Ordered-Sets-such as TS1,TS2,SKIP, FTS and Electrical Idle Ordered-Sets-are not scrambled. These characters bypass the scrambler logic.</li></ul></div><div><div><div></div></div></div><div><ul><li>Compliance Pattern related characters are not scrambled.</li></ul></div><div><div><div></div></div></div><div><ul><li>When a COM character exits the Scrambler, (COM does not get scrambled) it initializes the LFSR. The initialized value of the 16-bit LFSR is FFFFh. Similarly on the receiver side, when a COM character enters the De-Scrambler, it is initialized.</li></ul></div><div><div><div></div></div></div><div><ul><li>With one exception, the LFSR serially advances eight times for every character (D or K character) transmission. The LFSR does NOT advance on SKP characters associated with the SKIP Ordered-Set. The reason the LFSR is not advanced for SKPs is because a receiver of inbound packets may add or delete SKP symbols to perform clock tolerance compensation. Changing the number of characters in the receiver from the number of characters transmitted will cause the value in the receiver LFSR to lose synchronization with the transmitter LFSR value. For a detailed description, refer to "Inserting Clock Compensation Zones" on page 436 and "Receiver Clock Compensation Logic" on page 442.</li></ul></div><div><div><div></div></div></div><div><ul><li>By default, Scrambling is always enabled. Although the specification does allow the Scrambler to be disabled for test and debug purposes, it does not provide a standard software or configuration register-related method to disable the Scrambler.</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="466" id="mark-d3935f61-af33-45cf-965b-e1b4cf2bfeea" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 11-13: Scrambler</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_477.jpg?x=214&amp;y=421&amp;w=1013&amp;h=670"></div></div><div><div><div></div></div></div><h2><div><div>Disabling Scrambling</div></div></h2><div><div><div></div></div></div><div><div><div>As stated in the previous section, the Scrambler can be disabled to help facilitate test and debug. Software or test equipment may tell a device to disable scrambling. However, the specification does not indicate the mechanism by which a device's Physical Layer is instructed to disable scrambling.</div></div></div><div><div><div></div></div></div><div><div><div>Scrambling is disabled in the Configuration State of Link Training described on the page 519. The device receiving the software request to disable scrambling will do so during the Link Training Configuration State, and transmits at least two TS1/TS2 Ordered-Sets with the disable scrambling bit set on all its configured Lanes to the remote device it is connected to. The remote receiver device disables its Scrambler/De-Scrambler. It is required that the Port that is sending the Disable Scrambling request will also disable scrambling.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="467" id="mark-caa516ce-5e0f-49a2-8167-d2136dc846ea" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>8b/10b Encoding</div></div></h2><div><div><div></div></div></div><h2><div><div>General</div></div></h2><div><div><div></div></div></div><div><div><div>Each Lane of a device's transmitter implements an 8-bit to 10-bit Encoder that encodes 8-bit data or control characters into 10-bit symbols. The coding scheme was invented by IBM in 1982 and is documented in the ANSI X3.230-1994 document, clause 11 (and also IEEE 802.3z, 36.2.4) and US Patent Number 4,486,739 entitled "Byte Oriented DC Balanced 8b/10b Partitioned Block Transmission Code". 8b/10b coding is now widely used in architectures such as Gigabit Ethernet, Fibre Channel, ServerNet, FICON, IEEE1394b, InfiniBand, etc.</div></div></div><div><div><div></div></div></div><h2><div><div>Purpose of Encoding a Character Stream</div></div></h2><div><div><div></div></div></div><div><div><div>The primary purpose of this scheme is to embed a clock into the serial bit stream transmitted on all Lanes. No clock is therefore transmitted along with the serial data bit stream. This eliminates the need for a high frequency <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="527" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c47"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>2.5</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">GHz</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> clock signal on the Link which would generate significant EMI noise and would be a challenge to route on a standard FR4 board. Link wire routing between two ports is much easier given that there is no clock to route, removing the need to match clock length to Lane signal trace lengths. Two devices are connected by simply wiring their Lanes together.</div></div></div><div><div><div></div></div></div><div><div><div>Below is a summary of the advantages of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="528" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> encoding scheme:</div></div></div><div><div><div></div></div></div><div><ul><li>Embedded Clock. Creates sufficient 0-to-1 and 1-to-0 transition density (i.e., signal changes) to facilitate re-creation of the receive clock on the receiver end using a PLL (by guaranteeing a limited run length of consecutive ones or zeros). The recovered receive clock is used to clock inbound 10- bit symbols into an elastic buffer. Figure 11-14 on page 420 illustrates the example case wherein <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="529" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>00</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">h</mi></mrow></math></mjx-assistive-mml></mjx-container> is converted to 1101000110b,where an 8-bit character with no transitions has 5 transitions when converted to a 10b symbol. These transitions keep the receiver PLL synchronized to the transmit circuit clock:</li></ul></div><div><div><div></div></div></div><div><ul><li>Limited 'run length' means that the encoding scheme ensures the signal line will not remain in a high or low state for an extended period of time. The run length does not exceed five consecutive 1s or 0s.</li></ul></div><div><div><div></div></div></div><div><ul><li>1s and 0s are clocked out on the rising-edge of the transmit clock. At the receiver, a PLL can recreate the clock by sync'ing to the leading edges of 1s and 0s.</li></ul></div><div><div><div></div></div></div><div><ul><li>Limited run length ensures minimum frequency drift in the receiver's PLL relative to the local clock in the transmit circuit.</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="468" id="mark-c8ea0552-9130-47b4-bb7b-a95b6ffab3fe" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 11-14: Example of 8-bit Character of 00h Encoded to 10-bit Symbol</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_479.jpg?x=396&amp;y=447&amp;w=658&amp;h=372"></div></div><div><div><div></div></div></div><div><ul><li>DC Balance. Keeps the number of 1s and 0s transmitted as close to equal as possible, thus maintaining DC balance on the transmitted bit stream to an average of half the signal threshold voltage. This is very important in capacitive- and transformer-coupled circuits.</li></ul></div><div><div><div></div></div></div><div><ul><li>Maintains a balance between the number of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="530" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> and <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="531" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> on the signal line, thereby ensuring that the received signal is free of any DC component. This reduces the possibility of inter-bit interference. Inter-bit interference results from the inability of a signal to switch properly from one logic level to the other because the Lane coupling capacitor or intrinsic wire capacitance is over-charged.</li></ul></div><div><div><div></div></div></div><div><ul><li>Encoding of Special Control Characters. Permits the encoding of special control <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="532" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-msup><mjx-texatom texclass="ORD"></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-var"><mjx-c class="mjx-c2032"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msup><mjx-msup><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-var"><mjx-c class="mjx-c2032"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msup></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><msup><mrow data-mjx-texclass="ORD"></mrow><mrow data-mjx-texclass="ORD"><mi data-mjx-alternate="1">′</mi></mrow></msup><msup><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">K</mi></mrow></mrow><mrow data-mjx-texclass="ORD"><mi data-mjx-alternate="1">′</mi></mrow></msup></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> characters such as the Start and End framing characters at the start and end of TLPs and DLLPs.</li></ul></div><div><div><div></div></div></div><div><ul><li>Error Detection. A secondary benefit of the encoding scheme is that it facilitates the detection of most transmission errors. A receiver can check for 'running disparity' errors, or the reception of invalid symbols. Via the running disparity mechanism (see "Disparity" on page 423), the data bit stream transmitted maintains a balance of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="533" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> and <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="534" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> . The receiver checks the difference between the total number of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="535" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> and <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="536" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> transmitted since link initialization and ensures that it is as close to zero as possible. If it isn't, a disparity error is detected and reported, implying that a transmission error occurred.</li></ul></div><div><div><div></div></div></div><div><div><div>The disadvantage of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="537" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> encoding scheme is that,due to the expansion of each 8-bit character into a 10-bit symbol prior to transmission, the actual transmission performance is degraded by <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="538" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-mi class="mjx-n"><mjx-c class="mjx-c25"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>20</mn></mrow><mi mathvariant="normal">%</mi></math></mjx-assistive-mml></mjx-container> or said another way,the transmission overhead is increased by <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="539" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom><mjx-mi class="mjx-n"><mjx-c class="mjx-c25"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>25</mn></mrow><mi mathvariant="normal">%</mi></math></mjx-assistive-mml></mjx-container> (everything good has a price tag).</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="469" id="mark-aa8211bb-4a07-410f-84ca-5fcdad771fe8" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 11: Physical Layer Logic</div></div></h2><div><div><div></div></div></div><h2><div><div>Properties of 10-bit (10b) Symbols</div></div></h2><div><div><div></div></div></div><div><ul><li>For 10-bit symbol transmissions, the average number of 1s transmitted over time is equal to the number of 0 s transmitted, no matter what the 8-bit character to be transmitted is; i.e., the symbol transmission is DC balanced.</li></ul></div><div><div><div></div></div></div><div><ul><li>The bit stream never contains more than five continuous <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="540" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> or <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="541" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> (limited-run length).</li></ul></div><div><div><div></div></div></div><div><ul><li>Each 10-bit symbol contains:</li></ul></div><div><div><div></div></div></div><div><ul><li>Four 0s and six 1s (not necessarily contiguous), or</li></ul></div><div><div><div></div></div></div><div><ul><li>Six 0s and four 1s (not necessarily contiguous), or</li></ul></div><div><div><div></div></div></div><div><ul><li>Five 0s and five 1s (not necessarily contiguous).</li></ul></div><div><div><div></div></div></div><div><ul><li>Each 10-bit symbol is subdivided into two sub-blocks: the first is six bits wide and the second is four bits wide.</li></ul></div><div><div><div></div></div></div><div><ul><li>The 6-bit sub-block contains no more than four 1s or four 0s.</li></ul></div><div><div><div></div></div></div><div><ul><li>The 4-bit sub-block contains no more than three 1s or three 0s.</li></ul></div><div><div><div></div></div></div><div><ul><li>Any symbol with other than the above properties is considered invalid and a receiver consider this an error.</li></ul></div><div><div><div></div></div></div><div><ul><li>An 8-bit character is submitted to the <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="542" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> encoder along with a signal indicating whether the character is a Data (D) or Control (K) character. The encoder outputs the equivalent 10-bit symbol along with a current running disparity (CRD) that represents the sum of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="543" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> and <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="544" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> for this transmission link since link initialization. See "Disparity" on page 423 for more information.</li></ul></div><div><div><div></div></div></div><div><ul><li>The PCI Express specification defines Control characters that encode into the following Control symbols: STP, SDP, END, EDB, COM, PAD, SKP, FTS, and IDL (see "Control Character Encoding" on page 430).</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="470" id="mark-c8b7fc33-cf05-4287-8f60-273b650d9b58" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><h2><div><div>Preparing 8-bit Character Notation</div></div></h2><div><div><div></div></div></div><div><div><div><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="545" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> conversion lookup tables refer to all 8-bit characters using a special notation (represented by Dxx.y for Data characters and Kxx.y. for Control characters). Figure 11-15 on page 422 illustrates the notation equivalent for any 8-bit D or K character. Below are the steps to covert the 8-bit number to its notation equivalent.</div></div></div><div><div><div></div></div></div><div><div><div>In Figure 11-15 on page 422, the example character is the Data character, 6Ah.</div></div></div><div><div><div></div></div></div><div><ol><li value="1">The bits in the character are identified by the capitalized alpha designators A through H.</li></ol></div><div><div><div></div></div></div><div><ol><li value="2">The character is partitioned into two sub-blocks: one 3-bits wide and the other 5-bits wide.</li></ol></div><div><div><div></div></div></div><div><ol><li value="3">The two sub-blocks are flipped.</li></ol></div><div><div><div></div></div></div><div><ol><li value="4">The character takes the written form Zxx.y, where:</li></ol></div><div><div><div></div></div></div><div><ol><li value="5"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="546" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44D TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c1D437 TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Z</mi><mo>=</mo><mi>D</mi></math></mjx-assistive-mml></mjx-container> or <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="547" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">K</mi></mrow></math></mjx-assistive-mml></mjx-container> for Data or Control,</li></ol></div><div><div><div></div></div></div><div><ol><li value="6"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="548" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c78"></mjx-c><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">xx</mi></mrow></mrow><mo>=</mo></math></mjx-assistive-mml></mjx-container> the decimal value of the 5-bit field,</li></ol></div><div><div><div></div></div></div><div><ol><li value="7"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="549" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi><mo>=</mo></math></mjx-assistive-mml></mjx-container> the decimal value of the 3-bit field.</li></ol></div><div><div><div></div></div></div><div><ol><li value="8">The example character is represented as D10.3 in the <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="550" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> lookup tables.</li></ol></div><div><div><div></div></div></div><div><div><div>Figure 11-15: Preparing 8-bit Character for Encode</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_481.jpg?x=223&amp;y=1024&amp;w=995&amp;h=643"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="471" id="mark-79be805d-7220-4bfc-8c1b-c9ac26468f70" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Disparity</div></div></h2><div><div><div></div></div></div><div><div><div>Definition. Character disparity refers to the difference between the number of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="551" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> and <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="552" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> in a 10-bit symbol:</div></div></div><div><div><div></div></div></div><div><ul><li>When a symbol has more 0s than 1s, the symbol has negative (-) disparity (e.g., 0101000101b).</li></ul></div><div><div><div></div></div></div><div><ul><li>When a symbol has more <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="553" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> than <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="554" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> ,the symbol has positive (+) disparity (e.g., 1001101110b).</li></ul></div><div><div><div></div></div></div><div><ul><li>When a symbol has an equal number of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="555" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> and <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="556" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> ,the symbol has neutral disparity (e.g., 0110100101b).</li></ul></div><div><div><div></div></div></div><div><ul><li>Each 10-bit symbol contains one of the following numbers of ones and zeros (not necessarily contiguous):</li></ul></div><div><div><div></div></div></div><div><ul><li>Four 0s and six 1s (+ disparity).</li></ul></div><div><div><div></div></div></div><div><ul><li>Six 0s and four <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="557" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> (-disparity).</li></ul></div><div><div><div></div></div></div><div><ul><li>Five 0s and five 1s (neutral disparity).</li></ul></div><div><div><div></div></div></div><div><div><div>Two Categories of 8-bit Characters. There are two categories of 8-bit characters:</div></div></div><div><div><div></div></div></div><div><ul><li>Those that encode into 10-bit symbols with + or - disparity.</li></ul></div><div><div><div></div></div></div><div><ul><li>Those that encode into 10-bit symbols with neutral disparity.</li></ul></div><div><div><div></div></div></div><div><div><div>CRD (Current Running Disparity). The CRD reflects the total number of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="558" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> and <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="559" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> transmitted over the link since link initialization and has the following characteristics:</div></div></div><div><div><div></div></div></div><div><ul><li>Its current state indicates the balance of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="560" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> and <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="561" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> transmitted since link initialization.</li></ul></div><div><div><div></div></div></div><div><ul><li>The CRD's initial state (before any characters are transmitted) can be + or - .</li></ul></div><div><div><div></div></div></div><div><ul><li>The CRD's current state can be either positive (if more 1s than 0s have been transmitted) or negative (if more 0s than 1s).</li></ul></div><div><div><div></div></div></div><div><ul><li>Each character is converted via a table lookup with the current state of the CRD factored in.</li></ul></div><div><div><div></div></div></div><div><ul><li>As each new character is encoded, the CRD either remains the same (if the newly generated 10-bit character has neutral disparity) or it flips to the opposite polarity (if the newly generated character has + or - disparity). PCI Express System Architecture</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="472" id="mark-d1936154-d177-4b23-8536-f56531efd582" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>8b/10b Encoding Procedure</div></div></h2><div><div><div></div></div></div><div><div><div>Refer to Figure 11-16 on page 425. The encode is accomplished by performing two table lookups in parallel (not shown separately in the illustration):</div></div></div><div><div><div></div></div></div><div><ul><li>First Table Lookup: Three elements are submitted to a 5-bit to 6-bit table for a lookup (see Table 11-1 on page 427 and Table 11-2 on page 429):</li></ul></div><div><div><div></div></div></div><div><ul><li>The 5-bit portion of the 8-bit character (bits A through E).</li></ul></div><div><div><div></div></div></div><div><ul><li>The Data/Control (D/K#) indicator.</li></ul></div><div><div><div></div></div></div><div><ul><li>The current state of the CRD (positive or negative).</li></ul></div><div><div><div></div></div></div><div><ul><li>The table lookup yields the upper 6-bits of the 10-bit symbol (bits abc-dei).</li></ul></div><div><div><div></div></div></div><div><ul><li>Second Table Lookup: Three elements are submitted to a 3-bit to 4-bit table</li></ul></div><div><div><div></div></div></div><div><div><div>for a lookup (see Table 11-3 on page 429 and Table 11-4 on page 430):</div></div></div><div><div><div></div></div></div><div><ul><li>The 3-bit portion of the 8-bit character (bits F through H).</li></ul></div><div><div><div></div></div></div><div><ul><li>The same Data/Control (D/K#) indicator.</li></ul></div><div><div><div></div></div></div><div><ul><li>The current state of the CRD (positive or negative).</li></ul></div><div><div><div></div></div></div><div><ul><li>The table lookup yields the lower 4-bits of the 10-bit symbol (bits <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="562" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D453 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D454 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D457 TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi>f</mi><mi>g</mi><mi>h</mi><mi>j</mi></mrow></math></mjx-assistive-mml></mjx-container> ).</li></ul></div><div><div><div></div></div></div><div><div><div>The <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="563" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> encoder computes a new CRD based on the resultant 10-bit symbol and supplies this CRD for the <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="564" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> encode of the next character. If the resultant 10-bit symbol is neutral (i.e., it has an equal number of 1s and 0s), the polarity of the CRD remains unchanged. If the resultant 10-bit symbol is + or -, the CRD flips to its opposite state. It is an error if the CRD is currently + or - and the next 10-bit symbol produced has the same polarity as the CRD (unless the next symbol has neutral disparity, in which case the CRD remains the same).</div></div></div><div><div><div></div></div></div><div><div><div>The <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="565" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> encoder feeds a Parallel-to-Serial converter which clocks 10-bit symbols out in the bit order 'abcdeifghj' (shown in Figure 11-16 on page 425).</div></div></div><div><div><div></div></div></div><div><div><div>Example Encodings. Figure 11-17 on page 426 illustrates some example 8-bit to 10-bit encodings. The following is an explanation of the conversion of the 8-bit Data character 6Ah:</div></div></div><div><div><div></div></div></div><div><ul><li>The 8-bit character is broken down into its two sub-blocks: 011b and <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="566" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>01010</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> .</li></ul></div><div><div><div></div></div></div><div><ul><li>The two sub-blocks are flipped and represented as the D10.3 character. The binary-weighted value of the 5-bit block is 10d and the value of the 3-bit field is <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="567" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c64"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>3</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">d</mi></mrow></math></mjx-assistive-mml></mjx-container> .</li></ul></div><div><div><div></div></div></div><div><ul><li>The two blocks are submitted to the data character lookup tables (Table 11-1 on page 427 and Table 11-3 on page 429 are for D lookups) along with the current state of the CRD).</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="473" id="mark-29e22c41-96a1-4461-9129-cda99b27a264" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><ul><li>The last two columns show the 10-bit symbol produced by the two parallel table lookups (Table 11-1 on page 427 and Table 11-3 on page 429) when the CRD is negative or positive. and transmission of three characters: the first one is the control character BCh (K28.5), the second character is also BCh (K28.5) and the third character is the data character <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="568" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c41"></mjx-c><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>6</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">Ah</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> (D10.3):</li></ul></div><div><div><div></div></div></div><div><div><div>Figure 11-16: 8-bit to 10-bit (8b/10b) Encoder</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_484.jpg?x=220&amp;y=516&amp;w=998&amp;h=747"></div></div><div><div><div></div></div></div><div><div><div>Example Transmission. Figure 11-18 on page 427 illustrates the encode</div></div></div><div><div><div></div></div></div><div><ul><li>If the initial CRD is negative at the time of the encode, the K28.5 is encoded into 001111010b (positive disparity), flipping the CRD from negative to positive.</li></ul></div><div><div><div></div></div></div><div><ul><li>If the CRD is positive at the time of the encode, the K28.5 is encoded into 1100000101b (negative disparity), flipping the CRD from positive to negative.</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="474" id="mark-2a161404-cffd-4908-bc21-148cbae6a48c" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>PCI Express System Architecture</div></div></h2><div><div><div></div></div></div><div><ul><li>The D10.3 is encoded into 0101011100b (neutral disparity). The CRD therefore remains unchanged (negative) for the next encoding (not shown).</li></ul></div><div><div><div></div></div></div><div><ul><li>Notice that the resultant symbol stream is DC balanced.</li></ul></div><div><div><div></div></div></div><div><div><div>Figure 11-17: Example 8-bit/10-bit Encodings</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>D or K Character</th><th>Hex Byte</th><th>Binary Bits HGF EDCBA</th><th>Byte Name</th><th>CRD – abcdeifghj</th><th>CRD + abcdei fghj</th><th></th></tr></thead><tbody><tr><td>Data (D)</td><td>6A</td><td>011 01010</td><td>D10.3</td><td>0101011100</td><td>010101 0011</td><td></td></tr><tr><td>Data (D)</td><td>1B</td><td>000 11011</td><td>D27.0</td><td>1101100100</td><td>001001</td><td>1011</td></tr><tr><td>Data (D)</td><td>F7</td><td>111 10111</td><td>D23.7</td><td>1110100001</td><td>000101</td><td>1110</td></tr><tr><td>Control (K)</td><td>F7</td><td>111 10111</td><td>K23.7</td><td>1110101000</td><td>000101 0111</td><td></td></tr><tr><td>Control (K)</td><td>BC</td><td>101 11100</td><td>K28.5</td><td>0011111010</td><td>110000 0101</td><td></td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div>If character encode yields neutral disparity, then CRD remains unchanged, else it flips</div></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="475" id="mark-0ecc56eb-1dc1-46ce-8ed9-901fdeb77144" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><h2><div><div>Chapter 11: Physical Layer Logic</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 11-18: Example 8-bit/10-bit Transmission</div></div></div><div><div><div></div></div></div><div><div><div>Use these two characters in the example below:</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>D/K#</th><th>Hex Byte</th><th>Binary Bits HGF EDCBA</th><th>Byte Name</th><th>CRD – abcdei fghj</th><th>CRD + abcdei fghj</th></tr></thead><tbody><tr><td>Control (K)</td><td>BC</td><td>101 11100</td><td>K28.5</td><td>001111 1010</td><td>110000 0101</td></tr><tr><td>Data (D)</td><td>6A</td><td>011 01010</td><td>D10.3</td><td>010101 1100</td><td>010101 0011</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div>Example Transmission</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th></th><th>CRD</th><th>Character</th><th>CRD</th><th>Character</th><th>CRD</th><th>Character</th><th>CRD</th></tr></thead><tbody><tr><td>Character to be transmitted</td><td rowspan="2">-</td><td>K28.5 (BCh)</td><td rowspan="2"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="569" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>+</mo></math></mjx-assistive-mml></mjx-container></td><td>K28.5 (BCh)</td><td rowspan="2"></td><td>D10.3 (6Ah)</td><td rowspan="2">-</td></tr><tr><td>Bit stream transmitted</td><td>Yields 001111 1010 CRD is +</td><td>Yields 110000 0101 CRD is</td><td>Yields 010101 1100 CRD is neutral</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div>Initialized value of CRD is don't care. Receiver can determine from incoming bit stream</div></div></div><div><div><div></div></div></div><h2><div><div>The Lookup Tables</div></div></h2><div><div><div></div></div></div><div><div><div>The following four tables define the table lookup for the two sub-blocks of 8-bit Data and Control characters.</div></div></div><div><div><div></div></div></div><div><div><div>Table 11-1: 5-bit to 6-bit Encode Table for Data Characters</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Data Byte Name</th><th>Unencoded Bits EDCBA</th><th>Current RD – abcdei</th><th>Current RD + abcdei</th></tr></thead><tbody><tr><td>D0</td><td>00000</td><td>100111</td><td>011000</td></tr><tr><td>D1</td><td>00001</td><td>011101</td><td>100010</td></tr><tr><td>D2</td><td>00010</td><td>101101</td><td>010010</td></tr><tr><td>D3</td><td>00011</td><td>110001</td><td>110001</td></tr><tr><td>D4</td><td>00100</td><td>110101</td><td>001010</td></tr><tr><td>D5</td><td>00101</td><td>101001</td><td>101001</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="476" id="mark-b712c1bb-1829-484e-935d-4e3da7ea616d" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 11-1: 5-bit to 6-bit Encode Table for Data Characters (Continued)</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Data Byte Name</th><th>Unencoded Bits EDCBA</th><th>Current RD – abcdei</th><th>Current RD + abcdei</th></tr></thead><tbody><tr><td>D6</td><td>00110</td><td>011001</td><td>011001</td></tr><tr><td>D7</td><td>00111</td><td>111000</td><td>000111</td></tr><tr><td>D8</td><td>01000</td><td>111001</td><td>000110</td></tr><tr><td>D9</td><td>01001</td><td>100101</td><td>100101</td></tr><tr><td>D10</td><td>01010</td><td>010101</td><td>010101</td></tr><tr><td>D11</td><td>01011</td><td>110100</td><td>110100</td></tr><tr><td>D12</td><td>01100</td><td>001101</td><td>001101</td></tr><tr><td>D13</td><td>01101</td><td>101100</td><td>101100</td></tr><tr><td>D14</td><td>01110</td><td>011100</td><td>011100</td></tr><tr><td>D15</td><td>01111</td><td>010111</td><td>101000</td></tr><tr><td>D16</td><td>10000</td><td>011011</td><td>100100</td></tr><tr><td>D17</td><td>10001</td><td>100011</td><td>100011</td></tr><tr><td>D18</td><td>10010</td><td>010011</td><td>010011</td></tr><tr><td>D19</td><td>10011</td><td>110010</td><td>110010</td></tr><tr><td>D20</td><td>10100</td><td>001011</td><td>001011</td></tr><tr><td>D21</td><td>10101</td><td>101010</td><td>101010</td></tr><tr><td>D22</td><td>10110</td><td>011010</td><td>011010</td></tr><tr><td>D23</td><td>10111</td><td>111010</td><td>000101</td></tr><tr><td>D24</td><td>11000</td><td>110011</td><td>001100</td></tr><tr><td>D25</td><td>11001</td><td>100110</td><td>100110</td></tr><tr><td>D26</td><td>11010</td><td>010110</td><td>010110</td></tr><tr><td>D27</td><td>11011</td><td>110110</td><td>001001</td></tr><tr><td>D28</td><td>11100</td><td>001110</td><td>001110</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="477" id="mark-f8796d62-635e-4444-b317-aa9e49bc88c2" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 11-1: 5-bit to 6-bit Encode Table for Data Characters (Continued)</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Data Byte Name</th><th>Unencoded Bits EDCBA</th><th>Current RD – abcdei</th><th>Current RD + abcdei</th></tr></thead><tbody><tr><td>D29</td><td>11101</td><td>101110</td><td>010001</td></tr><tr><td>D30</td><td>11110</td><td>011110</td><td>100001</td></tr><tr><td>D31</td><td>11111</td><td>101011</td><td>010100</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div>Table 11-2: 5-bit to 6-bit Encode Table for Control Characters</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Data Byte Name</th><th>Unencoded Bits EDCBA</th><th>Current RD – abcdei</th><th>Current RD + abcdei</th></tr></thead><tbody><tr><td>K28</td><td>11100</td><td>001111</td><td>110000</td></tr><tr><td>K23</td><td>10111</td><td>111010</td><td>000101</td></tr><tr><td>K27</td><td>11011</td><td>110110</td><td>001001</td></tr><tr><td>K29</td><td>11101</td><td>101110</td><td>010001</td></tr><tr><td>K30</td><td>11110</td><td>011110</td><td>100001</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div>Table 11-3: 3-bit to 4-bit Encode Table for Data Characters</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Data Byte Name</th><th>Unencoded Bits HGF</th><th>Current RD - fghj</th><th>Current RD + fghj</th></tr></thead><tbody><tr><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="570" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>.0</mn></mrow></math></mjx-assistive-mml></mjx-container></td><td>000</td><td>1011</td><td>0100</td></tr><tr><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="571" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>.1</mn></mrow></math></mjx-assistive-mml></mjx-container></td><td>001</td><td>1001</td><td>1001</td></tr><tr><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="572" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>.2</mn></mrow></math></mjx-assistive-mml></mjx-container></td><td>010</td><td>0101</td><td>0101</td></tr><tr><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="573" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>.3</mn></mrow></math></mjx-assistive-mml></mjx-container></td><td>011</td><td>1100</td><td>0011</td></tr><tr><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="574" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>.4</mn></mrow></math></mjx-assistive-mml></mjx-container></td><td>100</td><td>1101</td><td>0010</td></tr><tr><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="575" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>.5</mn></mrow></math></mjx-assistive-mml></mjx-container></td><td>101</td><td>1010</td><td>1010</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="478" id="mark-4342d1c6-5d20-4829-933a-6c9b8da75c7f" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 11-3: 3-bit to 4-bit Encode Table for Data Characters</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Data Byte Name</th><th>Unencoded Bits HGF</th><th>Current RD - fghj</th><th>Current RD + fghj</th></tr></thead><tbody><tr><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="576" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>.6</mn></mrow></math></mjx-assistive-mml></mjx-container></td><td>110</td><td>0110</td><td>0110</td></tr><tr><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="577" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c37"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>.7</mn></mrow></math></mjx-assistive-mml></mjx-container></td><td>111</td><td>1110/0111</td><td>0001/1000</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div>Table 11-4: 3-bit to 4-bit Encode Table for Control Characters</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Data Byte Name</th><th>Unencoded Bits HGF</th><th>Current RD - fghj</th><th>Current RD + fghj</th></tr></thead><tbody><tr><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="578" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>.0</mn></mrow></math></mjx-assistive-mml></mjx-container></td><td>000</td><td>1011</td><td>0100</td></tr><tr><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="579" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>.1</mn></mrow></math></mjx-assistive-mml></mjx-container></td><td>001</td><td>0110</td><td>1001</td></tr><tr><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="580" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>.2</mn></mrow></math></mjx-assistive-mml></mjx-container></td><td>010</td><td>1010</td><td>0101</td></tr><tr><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="581" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>.3</mn></mrow></math></mjx-assistive-mml></mjx-container></td><td>011</td><td>1100</td><td>0011</td></tr><tr><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="582" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>.4</mn></mrow></math></mjx-assistive-mml></mjx-container></td><td>100</td><td>1101</td><td>0010</td></tr><tr><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="583" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>.5</mn></mrow></math></mjx-assistive-mml></mjx-container></td><td>101</td><td>0101</td><td>1010</td></tr><tr><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="584" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>.6</mn></mrow></math></mjx-assistive-mml></mjx-container></td><td>110</td><td>1001</td><td>0110</td></tr><tr><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="585" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c37"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>.7</mn></mrow></math></mjx-assistive-mml></mjx-container></td><td>111</td><td>0111</td><td>1000</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>Control Character Encoding</div></div></h2><div><div><div></div></div></div><div><div><div>Table 11-5 on page 432 shows the encoding of the PCI Express-defined Control characters. These characters are not scrambled by the transmitter logic, but are encoded into 10-bit symbols. Because these Control characters are not scrambled, the receiver logic can easily detect these symbols in an incoming symbol stream.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="479" id="mark-ec44c922-c047-4895-8c51-18430beca4f3" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>These Control characters have the following properties</div></div></div><div><div><div></div></div></div><div><ul><li>COM (comma) character. The COM character is used as the first character of any Ordered-Set. Ordered-Sets are a collection of multiples of 4 characters that are used for specialized purposes (see "Ordered-Sets" on page 433). The 10-bit encoding of the COM (K28.5) character contains two bits of one polarity followed by five bits of the opposite polarity (001111 1010 or 1100000101). The COM (and FTS) symbols are the only two symbols that have this property, thereby making it easy to detect at the receiver's Physical Layer. A receiver detects the COM pattern to detect the start of an Ordered-Set. In particular, the COM character associated with TS1, TS2, or FTS Ordered-Sets are used by a receiver to achieve bit and symbol lock on the incoming symbol stream. See "Link Training and Initialization" on page 403 for more details.</li></ul></div><div><div><div></div></div></div><div><ul><li>PAD character. On a multi-Lane Link, assume the transmitter transmits the END character associated with a packet end on an intermediate Lane such as Lane 3 of a x8 Link. If the Link goes to the Logical Idle state after the transmission of the packet's END character, then the PAD character is used to fill in the remaining Lanes. This is done so packets as well as Logical Idle sequences always begin on Lane 0 . For more information, see "x8, x12, x16 or x32 Packet Format Rules" on page 413 and "x8 Packet Format Example" on page 415.</li></ul></div><div><div><div></div></div></div><div><ul><li>SKP (skip) character. The SKP character is used as part of the SKIP Ordered-Set. The SKIP Ordered-Set is transmitted for clock tolerance compensation. For a detailed description, refer to "Inserting Clock Compensation Zones" on page 436 and "Receiver Clock Compensation Logic" on page 442.</li></ul></div><div><div><div></div></div></div><div><ul><li>STP (Start TLP) character. This character is inserted to identify the start of a TLP.</li></ul></div><div><div><div></div></div></div><div><ul><li>SDP (Start DLLP) character. This character is inserted to identify the start of a DLLP.</li></ul></div><div><div><div></div></div></div><div><ul><li>END character. This character is inserted to identify the end of a TLP or DLLP that has not experienced any CRC errors on previously-traversed links.</li></ul></div><div><div><div></div></div></div><div><ul><li>EDB (EnD Bad packet) character. This character is inserted to identify the end of a TLP that a forwarding device (such as a switch) wishes to 'nullify'. Cut-through mode is a mode in which the switch forwards a packet from its ingress port to an egress port with minimal latency without having to buffer the incoming packet first. A switch may have started forwarding a packet in cut-through mode and then discovered that the packet is corrupted. It therefore must instruct the receiver of this packet to discard it. To nullify a TLP, the switch ends the packet with the EDB character and inverts the LCRC from its calculated value. A receiver that receives such a nullified PCI Express System Architecture packet discards it and does not return an ACK or NAK. Also see the chapter on Ack/Nak for a detailed description of the switch cut-through mode.</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="480" id="mark-0138c510-6b87-4583-97e0-c91d35addeca" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><ul><li>FTS (Fast Training Sequence) character. This character is used as part of the FTS Ordered-Set. FTS Ordered-Sets are transmitted by a device in order to transition a Link from the low power L0s low power state back to the full-on <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="586" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4C"></mjx-c></mjx-mi></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">L</mi></mrow><mn>0</mn></math></mjx-assistive-mml></mjx-container> state.</li></ul></div><div><div><div></div></div></div><div><ul><li>IDL (Idle) character. This character is used as part of the Electrical Idle Ordered-Set. The Ordered-Set is transmitted to inform the receiver that the Link is about to transition to the L0s low power state (also referred to as the Electrical Idle state of the Link).</li></ul></div><div><div><div></div></div></div><div><div><div>Table 11-5: Control Character Encoding and Definition</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Character Name</th><th>8b Name</th><th>10b (CRD-)</th><th>10b (CRD+)</th><th>Description</th></tr></thead><tbody><tr><td>COM</td><td>K28.5 (BCh)</td><td>001111 1010</td><td>110000 0101</td><td>First character in any Ordered-Set. Detected by receiver and used to achieve symbol lock dur- ing TS1 / TS2 Ordered-Set reception at receiver</td></tr><tr><td>PAD</td><td>K23.7 (F7h)</td><td>111010 1000</td><td>000101 0111</td><td>Packet Padding character</td></tr><tr><td>SKP</td><td>K28.0 (1Ch)</td><td>001111 0100</td><td>110000 1011</td><td>Used in SKIP Ordered- Set. This Ordered-Set is used for Clock Tolerance Compensation</td></tr><tr><td>STP</td><td>K27.7 (FBh)</td><td>110110 1000</td><td>001001 0111</td><td>Start of TLP character</td></tr><tr><td>SDP</td><td>K28.2 (5Ch)</td><td>001111 0101</td><td>110000 1010</td><td>Start of DLLP character</td></tr><tr><td>END</td><td>K29.7 (FDh)</td><td>101110 1000</td><td>010001 0111</td><td>End of Good Packet character</td></tr><tr><td>EDB</td><td>K30.7 (FEh)</td><td>011110 1000</td><td>100001 0111</td><td>Character used to mark the end of a ‘nullified’ TLP.</td></tr></tbody></table></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="481" id="mark-7bdaaf4b-1b20-42bb-9930-66bcd8f7842d" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Table 11-5: Control Character Encoding and Definition</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><thead><tr><th>Character Name</th><th>8b Name</th><th>10b (CRD-)</th><th>10b (CRD+)</th><th>Description</th></tr></thead><tbody><tr><td>FTS</td><td>K28.1 (3Ch)</td><td>001111 1001</td><td>110000 0110</td><td>Used in FTS Ordered-Set. This Ordered-Set used to exit from L0s low power state to <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="587" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4C"></mjx-c></mjx-mi></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">L</mi></mrow><mn>0</mn></math></mjx-assistive-mml></mjx-container></td></tr><tr><td>IDL</td><td>K28.3 (7Ch)</td><td>001111 0011</td><td>110000 1100</td><td>Used in Electrical Idle Ordered-Set. This Ordered-Set used to place Link in Electrical Idle state</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>Ordered-Sets</div></div></h2><div><div><div></div></div></div><div><div><div>General. Ordered-Sets are Physical Layer Packets (PLPs) consisting of a series of characters starting with the COM character and consisting a total of four characters. When transmitted, they are transmitted on all Lanes. Ordered-Sets are used for special functions such as:</div></div></div><div><div><div></div></div></div><div><ul><li>Link Training. See "Link Training and Initialization" on page 403 for a detailed description.</li></ul></div><div><div><div></div></div></div><div><ul><li>Clock Tolerance Compensation. See "Inserting Clock Compensation Zones" on page 436 and "Receiver Clock Compensation Logic" on page 442.</li></ul></div><div><div><div></div></div></div><div><ul><li>Placing the Link into the low power L0s state (also referred to as the Electrical Idle Link state).</li></ul></div><div><div><div></div></div></div><div><ul><li>Changing the Link state from the low power L0s state (also referred to as Electrical Idle state) to the full-on L0 state.</li></ul></div><div><div><div></div></div></div><div><div><div>The PCI Express specification defines five Ordered-Sets:</div></div></div><div><div><div></div></div></div><div><ul><li>Training Sequence 1 (TS1),</li></ul></div><div><div><div></div></div></div><div><ul><li>Training Sequence 2 (TS2),</li></ul></div><div><div><div></div></div></div><div><ul><li>SKIP,</li></ul></div><div><div><div></div></div></div><div><ul><li>Fast Training Sequence (FTS)</li></ul></div><div><div><div></div></div></div><div><ul><li>and Electrical IDLE Ordered-Sets.</li></ul></div><div><div><div></div></div></div><div><div><div>A brief description of each Ordered-Set follows.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="482" id="mark-a6d7d4da-62fd-4c33-b532-803b21c7dd77" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>TS1 and TS2 Ordered-Sets. These two Ordered-Sets are used during Link training. They are transmitted by a port's transmitter to the other port's receiver, where they are used to achieve bit and symbol lock. They are also used by the ports at opposite ends of a Link to number their Links and Lanes. These Ordered-Sets are used during Link speed and width negotiation.</div></div></div><div><div><div></div></div></div><div><div><div>SKIP Ordered-Set. In a multi-lane implementation, the SKIP Ordered-Set is periodically transmitted on all Lanes to allow the receiver clock tolerance compensation logic to compensate for clock frequency variations between the clock used by the transmitting device to clock out the serial bit stream and the receiver device's local clock. The receiver adds a SKP symbol to a SKIP Ordered-Set in the receiver elastic buffer to prevent a potential buffer underflow condition from occurring due to the transmitter clock being slower than the local receiver clock. Alternately, the receiver deletes a SKP symbol from the SKIP Ordered-Set in the receiver elastic buffer to prevent a potential buffer overflow condition from occurring due to the transmitter clock being faster than the local receiver clock. For a detailed description, refer to "Inserting Clock Compensation Zones" on page 436 and "Receiver Clock Compensation Logic" on page 442.</div></div></div><div><div><div></div></div></div><div><div><div>Electrical Idle Ordered-Set. A transmitter device that wishes to place the Link in the Electrical Idle state (aka the L0s low power state) transmits this Ordered-Set to a receiver. Upon receipt, the differential receivers prepare for this low power state during which the transmitter driver can be in the low- or high-impedance state and packet transmission stops. The differential receiver remains in the low-impedance state while in this state.</div></div></div><div><div><div></div></div></div><div><div><div>FTS Ordered-Set. FTS Ordered-Sets are transmitted by a device to transition a Link from the low power L0s state back to the full-on L0 state. The receiver detects the FTS Ordered-Set and uses it to achieve bit and symbol lock as well as to re-synchronize its receiver PLL to the transmitter clock used to transmit the serial bit stream. See the Link Training and Power Management chapters for more details on FTS Ordered-Set usage.</div></div></div><div><div><div></div></div></div><h2><div><div>Parallel-to-Serial Converter (Serializer)</div></div></h2><div><div><div></div></div></div><div><div><div>The <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="588" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> Encoder on each Lane feeds the Parallel-to-Serial converter associated with that Lane. The Parallel-to-Serial converter clocks 10-bit symbols out in the bit order 'abcdeifghj', with the least significant bit (a) shifted out first and the most significant bit (j) shifted out last (as shown in Figure 11-16 on page 425). The symbols supplied by the <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="589" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> Encoder are clocked into the con-</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="483" id="mark-d82a2b38-417f-4ad1-a4a3-a9fb78172ed1" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Chapter 11: Physical Layer Logic</div></div></h2><div><div><div></div></div></div><div><div><div>verter at <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="590" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>250</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MHz</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> . The serial bit stream is clocked out of the Parallel-to-Serial converter at <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="591" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c47"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>2.5</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">GHz</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> .</div></div></div><div><div><div></div></div></div><h2><div><div>Differential Transmit Driver</div></div></h2><div><div><div></div></div></div><div><div><div>The differential driver that actually drives the serialized bit stream onto the wire (or fiber) uses NRZ encoding and drives the serial bit stream at the <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="592" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c47"></mjx-c><mjx-c class="mjx-c62"></mjx-c><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c74"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>2.5</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">Gbit</mi></mrow></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">s</mi></mrow></math></mjx-assistive-mml></mjx-container> transfer rate. The differential driver output per Lane consists of two signals (D+ and D-). A logical one is signaled by driving the D+ signal high and the D- signal low,thus creating a positive voltage difference between the D+ and D- signals. A logical zero is signaled by driving the D+ signal low and the D- signal high,thus creating a negative voltage difference between the D+ and D- signals.</div></div></div><div><div><div></div></div></div><div><div><div>Differential peak-to-peak voltage driven by the transmitter is between <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="593" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c56"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>800</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">mV</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> (min.) and <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="594" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c56"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>1200</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">mV</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> (max).</div></div></div><div><div><div></div></div></div><div><ul><li>Logical 1 is signalled with a positive differential voltage.</li></ul></div><div><div><div></div></div></div><div><ul><li>Logical 0 is signalled with a negative differential voltage.</li></ul></div><div><div><div></div></div></div><div><div><div>During the Link's electrical Idle state, the transmitter drives a differential peak voltage between <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="595" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c56"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">mV</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> and <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="596" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c56"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>20</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">mV</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> (the transmitter may be in the low- or high-impedance state).</div></div></div><div><div><div></div></div></div><div><div><div>Details regarding the electrical characteristics of the driver are discussed in "Transmitter Driver Characteristics" on page 477</div></div></div><div><div><div></div></div></div><h2><div><div>Transmit (Tx) Clock</div></div></h2><div><div><div></div></div></div><div><div><div>The serial output of the Parallel-to-Serial converter on each Lane is clocked out to the differential driver by the Tx Clock signal (see Figure 11-16 on page 425). <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="597" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">Tx</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> clock frequency is <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="598" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c47"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>2.5</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">GHz</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> and it must be accurate to <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="599" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom space="3" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c70"></mjx-c><mjx-c class="mjx-c70"></mjx-c><mjx-c class="mjx-c6D"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>+</mo><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mo>−</mo><mrow data-mjx-texclass="ORD"><mn>300</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">ppm</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> from a center frequency of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="600" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c47"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>2.5</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">GHz</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> (or <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="601" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c70"></mjx-c><mjx-c class="mjx-c70"></mjx-c><mjx-c class="mjx-c6D"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>600</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">ppm</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> total). The clock can skew by one clock every 1666 clock cycles. Note that this Tx Clock is different from the local clock of the Physical Layer which is a much slower clock. The Physical Layer receives a clock from an external source. PCI Express devices on peripheral cards as well as system boards may use a <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="602" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4D"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>100</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">MHz</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> clock supplied by the system board. This clock is multiplied by a factor with the aid of a PLL internal to the Physical Layer. The resultant local clock, which runs at a much slower frequency than <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="603" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c47"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>2.5</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">GHz</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> ,clocks Physical Layer logic such as the Byte Striping logic,the Scrambler,the <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="604" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> Encoder,the buffers,etc. The PLL also produces the <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="605" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c47"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>2.5</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">GHz</mi></mrow></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">Tx</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> clock used to feed the Parallel-to-Serial converters.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="484" id="mark-0e3bdd27-a1cd-474f-841b-26a3e6fdd123" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Other Miscellaneous Transmit Logic Topics</div></div></h2><div><div><div></div></div></div><h2><div><div>Logical Idle Sequence</div></div></h2><div><div><div></div></div></div><div><div><div>In order to keep the receiver's PLL sync'd up (i.e., to keep it from drifting), something must be transmitted during periods when there are no TLPs, DLLPs or PLPs to transmit. The logical Idle sequence is transmitted during these times. The Idle sequence is gated to the Mux as described in the section "Multiplexer (Mux) and Mux Control Logic" on page 404. Some properties of the Logical Idle sequence are:</div></div></div><div><div><div></div></div></div><div><ul><li>The logical Idle sequence consists of the 8-bit Data character with a value of <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="606" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c68"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>00</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">h</mi></mrow></math></mjx-assistive-mml></mjx-container> .</li></ul></div><div><div><div></div></div></div><div><ul><li>When transmitted, it is simultaneously transmitted on all Lanes. The Link is said to be in the logical Idle state (not to be confused with electrical Idle-the state when the Link is not driven and there are no packet transmissions and the receiver PLL loses synchronization).</li></ul></div><div><div><div></div></div></div><div><ul><li>The logical Idle sequence is scrambled. This implies that, on the Link, the logical Idle sequence has a pseudo-random value. A receiver can distinguish the logical Idle sequence from other packet transmissions because it occurs outside the packet framing context (i.e., the logical Idle sequence occurs after an END or EDB Control symbol, but before an STP or SDP Control symbol).</li></ul></div><div><div><div></div></div></div><div><ul><li>The logical Idle Sequence is <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="607" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> encoded.</li></ul></div><div><div><div></div></div></div><div><ul><li>During Logical Idle sequence transmission, SKIP Ordered-Sets are also transmitted periodically.</li></ul></div><div><div><div></div></div></div><h2><div><div>Inserting Clock Compensation Zones</div></div></h2><div><div><div></div></div></div><div><div><div>Background. When the receiver logic receives a symbol stream, it sometimes needs to add or remove a symbol from the received symbol stream to compensate for transmitter verses receiver clock frequency variations (for background, refer to "Receiver Clock Compensation Logic" on page 442).</div></div></div><div><div><div></div></div></div><div><div><div>It should be obvious that the receiver logic can't arbitrarily pick a symbol to add or delete. This means that, on a periodic basis, the transmit logic must transmit a special Control character sequence that can be used for this purpose. This sequence is referred to as the SKIP Ordered-Set (see Figure 11-19) which consists of a COM character followed by three SKP characters.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="485" id="mark-9151d408-3341-45e5-8be3-fd215f6d9142" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>SKIP Ordered-Set Insertion Rules. A transmitter is required to transmit SKIP Ordered-Sets on a periodic basis. The following rules apply:</div></div></div><div><div><div></div></div></div><div><ul><li>The set must be scheduled for insertion at most once every <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="608" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c38"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c73"></mjx-c><mjx-c class="mjx-c79"></mjx-c><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c62"></mjx-c><mjx-c class="mjx-c6F"></mjx-c><mjx-c class="mjx-c6C"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>1180</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">symbol</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> clocks (i.e., symbol times) and at least once every 1538 symbol clocks.</li></ul></div><div><div><div></div></div></div><div><ul><li>When it's time to insert a SKIP Ordered-Set, it is inserted at the next packet boundary (not in the middle of a packet). SKIP Ordered-Sets are inserted between packets simultaneously on all Lanes. If a long packet transmission is already in progress, the SKIP Ordered-Sets are accumulated and then inserted consecutively at the next packet boundary.</li></ul></div><div><div><div></div></div></div><div><ul><li>In a multi-Lane environment, the SKIP Ordered-Set must be transmitted on all Lanes simultaneously (see Figure 11-11 on page 414 and Figure 11-12 on page 415). When necessary, the Link is padded so as to allow all the transmission of the SKIP Ordered-Sets to start on the same clock (see Figure 11-12 on page 415).</li></ul></div><div><div><div></div></div></div><div><ul><li>During all lower power Link states, any counter(s) used to schedule SKIP Ordered-Sets must be reset.</li></ul></div><div><div><div></div></div></div><div><ul><li>SKIP Ordered-Sets must not be transmitted while the Compliance Pattern is in progress.</li></ul></div><div><div><div></div></div></div><div><div><div>Figure 11-19: SKIP Ordered-Set Encoding</div></div></div><div><div><div></div></div></div><div><div class="table-container"><table class="fixed-table"><tbody><tr><td></td><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="609" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2194"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">↔</mo></math></mjx-assistive-mml></mjx-container> K28.5</td></tr><tr><td></td><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="610" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2192"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">→</mo></math></mjx-assistive-mml></mjx-container> K28.0</td></tr><tr><td>SKP</td><td>→  <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="611" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c4B"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c38"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">K</mi></mrow><mrow data-mjx-texclass="ORD"><mn>28.0</mn></mrow></math></mjx-assistive-mml></mjx-container></td></tr><tr><td>SKP</td><td><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="612" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2192"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">→</mo></math></mjx-assistive-mml></mjx-container> K28.0</td></tr></tbody></table></div></div><div><div><div></div></div></div><h2><div><div>Receive Logic Details</div></div></h2><div><div><div></div></div></div><div><div><div>Figure 11-20 shows the receiver logic of the Logical Physical Layer. This section describes packet processing from the time the data is received serially on each Lane until the packet byte stream is clocked to the Data Link Layer.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="486" id="mark-c7aa7872-d514-4e7c-bb86-9382849c235b" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>Figure 11-20: Physical Layer Receive Logic Details</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_497.jpg?x=220&amp;y=446&amp;w=949&amp;h=1044"></div></div><div><div><div></div></div></div><div><div><div></div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="487" id="mark-b0fb1fc6-f882-433d-9955-382713cf7b03" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div>Figure 11-21 illustrates the receiver logic's front end on each Lane. This is comprised of:</div></div></div><div><div><div></div></div></div><div><ul><li>The differential receiver.</li></ul></div><div><div><div></div></div></div><div><ul><li>The Rx Clock recovery logic.</li></ul></div><div><div><div></div></div></div><div><ul><li>The COM symbol and Ordered-Set detector.</li></ul></div><div><div><div></div></div></div><div><ul><li>The Serial-to-Parallel converter (Deserializer).</li></ul></div><div><div><div></div></div></div><div><ul><li>The Lane-to-Lane De-Skew logic (delay circuit).</li></ul></div><div><div><div></div></div></div><div><ul><li>The Elastic Buffer and Clock Tolerance Compensation logic.</li></ul></div><div><div><div></div></div></div><div><div><div>Figure 11-21: Receiver Logic's Front End Per Lane</div></div></div><div><div><div></div></div></div><div><div class="text-center"><img class="max-w-[100%]" draggable="false" src="https://cdn.noedgeai.com/019122e1-e32f-77cd-ac5e-62acd65bf1f6_498.jpg?x=222&amp;y=711&amp;w=994&amp;h=604"></div></div><div><div><div></div></div></div><h2><div><div>Differential Receiver</div></div></h2><div><div><div></div></div></div><div><div><div>Refer to Figure 11-21. The differential receiver on each Lane senses differential peak-to-peak voltage differences <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="613" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3E"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c37"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c56"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>&gt;</mo><mrow data-mjx-texclass="ORD"><mn>175</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">mV</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> but <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="614" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3C"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c56"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>&lt;</mo><mrow data-mjx-texclass="ORD"><mn>1200</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">mV</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> :</div></div></div><div><div><div></div></div></div><div><ul><li>+ difference <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="615" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo></math></mjx-assistive-mml></mjx-container> Logical 1.</li></ul></div><div><div><div></div></div></div><div><ul><li>difference <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="616" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo></math></mjx-assistive-mml></mjx-container> Logical 0 . PCI Express System Architecture</li></ul></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="488" id="mark-d1cbfc26-a970-4743-bae3-62b6fb78b77b" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><div><div><div>A signal peak-to-peak difference <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="617" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3C"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c56"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>&lt;</mo><mrow data-mjx-texclass="ORD"><mn>65</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">mV</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> is considered a signal absent condition and the Link is in the electrical Idle state. During this time, the receiver de-gates its input to prevent the error circuit from detecting an error. A signal peak-to-peak differential voltage between <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="618" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c56"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>65</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">mV</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> and <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="619" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c37"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c56"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>175</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">mV</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> serves as noise guard band.</div></div></div><div><div><div></div></div></div><h2><div><div>Rx Clock Recovery</div></div></h2><div><div><div></div></div></div><h2><div><div>General</div></div></h2><div><div><div></div></div></div><div><div><div>Using a PLL (Phase-Locked Loop), the receiver circuit generates the Rx Clock from the data bit transitions in the input data stream. This recovered clock has the same frequency <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="620" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c47"></mjx-c><mjx-c class="mjx-c48"></mjx-c><mjx-c class="mjx-c7A"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-mrow></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mn>2.5</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">GHz</mi></mrow></mrow></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container> as that of the <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="621" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c54"></mjx-c><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">Tx</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> Clock used by the transmitting device to clock the data bit stream onto the wire (or fiber). The Rx Clock is used to clock the inbound serial symbol stream into the Serial-to-Parallel converter (Deserializer). The 10-bit symbol stream produced by the Deserializer is clocked into the elastic buffer with a divide by 10 version of the Rx Clock. The Rx Clock is different from the Local Clock that is used to clock symbols out of the Elastic Buffer to the <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="622" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> decoder. The Local Clock must be accurate to within <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="623" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>+</mo><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mo>−</mo></math></mjx-assistive-mml></mjx-container> <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="624" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-texatom texclass="ORD"><mjx-mi class="mjx-n"><mjx-c class="mjx-c70"></mjx-c><mjx-c class="mjx-c70"></mjx-c><mjx-c class="mjx-c6D"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mn>300</mn></mrow><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="ORD"><mi data-mjx-auto-op="false">ppm</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container> from center frequency.</div></div></div><div><div><div></div></div></div><h2><div><div>Achieving Bit Lock</div></div></h2><div><div><div></div></div></div><div><div><div>Recollect that the inbound serial symbol stream is guaranteed to have frequent 1-to-0 and 0-to-1 transitions due to the <mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="625" style="font-size: 122.8%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mstyle><mjx-mspace style="width: 0.278em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-n"><mjx-c class="mjx-c62"></mjx-c></mjx-mi></mjx-texatom></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow><mrow data-mjx-texclass="ORD"><mstyle scriptlevel="0"><mspace width="0.278em"></mspace></mstyle><mi mathvariant="normal">b</mi></mrow></math></mjx-assistive-mml></mjx-container> encoding scheme. A transition is guaranteed at least every 5 bit-times. The receiver PLL uses the transitions in the received bit-stream to synchronize the Rx Clock with the Tx Clock that was used at the transmitter to clock out the serialized bit stream. When the receiver PLL locks on to the Tx Clock frequency, the receiver is said to have achieved "Bit Lock".</div></div></div><div><div><div></div></div></div><div><div><div>During Link training, the transmitter device sends a long series of back-to-back TS1 and TS2 Ordered-Sets to the receiver and the receiver uses the bit transitions in these Ordered-Sets to achieve Bit Lock. Once the Link is in the full-on L0 state, transitions on the Link occur on a regular basis and the receiver PLL is able to maintain Bit Lock.</div></div></div></span></div></div></div></div><div><div class="relative cursor-pointer md-tranlate-menu-layout"><div data-page="489" id="mark-2c98541d-5f07-46cd-ace2-7f023a9ed5d1" class="markdown-parser-view mb-5 relative cursor-pointer"><div><span style="display: block;"><div><div><div></div></div></div><div><div><div></div></div></div><h2><div><div>Losing Bit Lock</div></div></h2><div><div><div></div></div></div><div><div><div>If the Link is put in a low power state (such as L0s) where packet transmission ceases, the receiver's PLL gradually loses synchronization. The transmitter sends an electrical Idle Ordered-Set to tell the receiver to de-gate its input to prevent the error circuit from detecting an error.</div></div></div><div><div><div></div></div></div><h2><div><div>Regaining Bit Lock</div></div></h2><div><div><div></div></div></div><div><div><div>When the Link is in the L0s state, the transmitter sends a few FTS Ordered-sets (on the order of four FTSs) to the receiver and the receiver uses these to regain Bit Lock. Only a few FTSs are needed by the receiver in order to achieve Bit Lock (thus the wake up latency is of short duration). Because the Link is in the L0s state for a short time, the receiver PLL does not completely lose synchronization with the Tx Clock before it receives the FTSs.</div></div></div><div><div><div></div></div></div><h2><div><div>Serial-to-Parallel converter (Deserializer)</div></div></h2><div><div><div></div></div></div><div><div><div>The incoming serial data on each Lane is clocked into that Lane's Deserializer (the serial-to-parallel converter) by the Rx clock (see Figure 11-21 on page 439). The 10-bit symbols produced are clocked into an Elastic Buffer using a divide-by-10 version of the Rx Clock.</div></div></div><div><div><div></div></div></div><h2><div><div>Symbol Boundary Sensing (Symbol Lock)</div></div></h2><div><div><div></div></div></div><div><div><div>When the receive logic starts receiving a bit stream, it is JABOB (just a bunch of bits) with no markers to differentiate one symbol from another. The receive logic must have some way to determine the start and end of a 10-bit symbol. The Comma (COM) symbol serves this purpose.</div></div></div><div><div><div></div></div></div><div><div><div>The 10-bit encoding of the COM (K28.5) symbol contains two bits of one polarity followed by five bits of the opposite polarity (0011111010b or 1100000101b). Unless an error occurs, no other character has this property, thereby making it easily detectable. Recollect that the COM Control character, like all other Control characters, is not scrambled by the transmitter. This makes the COM easily detectable by the COM detector which looks for two consecutive 0s or two consecutive 1s followed by a string of five 1s or five 0s, respectively. Upon detection of the COM symbol, the COM Detector knows that the next bit received after the COM symbol is the first bit of a valid 10-bit symbol. The Deserializer is then initialized so that it can henceforth generate valid 10-bit symbols. The Deserial-izer is said to achieve 'Symbol Lock'.</div></div></div></span></div></div></div></div>
      </body>
    </html>
  